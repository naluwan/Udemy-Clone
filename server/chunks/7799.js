exports.id=7799,exports.ids=[7799],exports.modules={83104:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(3528);let a=(0,r.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]])},25757:e=>{/*!
 * mux-embed
 * @version 4.28.1
 * @copyright 2023 Mux, Inc
 */e.exports=function(){var e={80:function(e,t,i){e.exports=i(728).default},728:function(e,t,i){"use strict";i.d(t,{default:function(){return tO}});var r=i(48),a=i.n(r),s=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},n=function(){return("000000"+(2176782336*Math.random()<<0).toString(36)).slice(-6)},o=function(e){return e&&void 0!==e.nodeName?(e.muxId||(e.muxId=e.id||n()),e.muxId):e},l=function(e){e&&void 0!==e.nodeName?e=o(t=e):t=document.querySelector(e);var t,i=t&&t.nodeName?t.nodeName.toLowerCase():"";return[t,e,i]},d=i(640),u=i.n(d),h=u().methodFactory;u().methodFactory=function(e,t,i){var r=h(e,t,i);return function(){for(var e=["[mux]"],t=0;t<arguments.length;t++)e.push(arguments[t]);r.apply(void 0,e)}},u().setLevel(u().getLevel());var c=u();function m(){return"1"===(a().doNotTrack||a().navigator&&a().navigator.doNotTrack)}var f={now:function(){var e=a().performance,t=e&&e.timing,i=t&&t.navigationStart;return Math.round("number"==typeof i&&"function"==typeof e.now?i+e.now():Date.now())}},p=function(e){return g(e)[0]},g=function(e){if("string"!=typeof e||""===e)return["localhost"];var t,i=(e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return i&&(t=(i.match(/[^\.]+\.[^\.]+$/)||[])[0]),[i,t]},v={exists:function(){var e=a().performance;return void 0!==(e&&e.timing)},domContentLoadedEventEnd:function(){var e=a().performance,t=e&&e.timing;return t&&t.domContentLoadedEventEnd},navigationStart:function(){var e=a().performance,t=e&&e.timing;return t&&t.navigationStart}};function E(e,t,i){i=void 0===i?1:i,e[t]=e[t]||0,e[t]+=i}var b=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"],y=["x-cdn","content-type"].concat(b);function T(e){var t={};return(e=e||"").trim().split(/[\r\n]+/).forEach(function(e){if(e){var i=e.split(": "),r=i.shift();r&&(y.indexOf(r.toLowerCase())>=0||0===r.toLowerCase().indexOf("x-litix-"))&&(t[r]=i.join(": "))}}),t}function A(e){if(e){var t=b.find(function(t){return void 0!==e[t]});return t?e[t]:void 0}}var _=function(e){var t={};for(var i in e){var r=e[i];-1!==r["DATA-ID"].search("io.litix.data.")&&(t[r["DATA-ID"].replace("io.litix.data.","")]=r.VALUE)}return t};function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function k(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach(function(t){var r;r=i[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var L=function(e){if(!e)return{};var t=v.navigationStart(),i=e.loading,r=i?i.start:e.trequest,a=i?i.first:e.tfirst,s=i?i.end:e.tload;return{bytesLoaded:e.total,requestStart:Math.round(t+r),responseStart:Math.round(t+a),responseEnd:Math.round(t+s)}},I=function(e){if(e&&"function"==typeof e.getAllResponseHeaders)return T(e.getAllResponseHeaders())};function R(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function w(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?R(Object(i),!0).forEach(function(t){var r;r=i[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):R(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var D=function(e,t){if(!e||"function"!=typeof e.getRequests)return{};var i=e.getRequests({state:"executed"});if(0===i.length)return{};var r,a=i[i.length-1],s=p(a.url),n=a.url,o=a.bytesLoaded,l=new Date(a.requestStartDate).getTime(),d=new Date(a.firstByteDate).getTime(),u=new Date(a.requestEndDate).getTime(),h=isNaN(a.duration)?0:a.duration,c="function"==typeof t.getMetricsFor?t.getMetricsFor(a.mediaType).HttpList:t.getDashMetrics().getHttpRequests(a.mediaType);return c.length>0&&(r=T(c[c.length-1]._responseHeaders||"")),{requestStart:l,requestResponseStart:d,requestResponseEnd:u,requestBytesLoaded:o,requestResponseHeaders:r,requestMediaDuration:h,requestHostname:s,requestUrl:n,requestId:r?A(r):void 0}},C=function(e,t){var i=t.getQualityFor(e),r=t.getCurrentTrackFor(e).bitrateList;return r?{currentLevel:i,renditionWidth:r[i].width||null,renditionHeight:r[i].height||null,renditionBitrate:r[i].bandwidth}:{}},M=function(e){var t;return null===(t=e.match(/.*codecs\*?="(.*)"/))||void 0===t?void 0:t[1]};function x(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=0,P=function(){var e,t;function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i)}return e=[{key:"on",value:function(e,t,i){return t._eventEmitterGuid=t._eventEmitterGuid||++O,this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],i&&(t=t.bind(i)),this._listeners[e].push(t),t}},{key:"off",value:function(e,t){var i=this._listeners&&this._listeners[e];i&&i.forEach(function(e,r){e._eventEmitterGuid===t._eventEmitterGuid&&i.splice(r,1)})}},{key:"one",value:function(e,t,i){var r=this;t._eventEmitterGuid=t._eventEmitterGuid||++O;var a=function a(){r.off(e,a),t.apply(i||this,arguments)};a._eventEmitterGuid=t._eventEmitterGuid,this.on(e,a)}},{key:"emit",value:function(e,t){var i=this;if(this._listeners){t=t||{};var r=this._listeners["before*"]||[],a=this._listeners[e]||[],s=this._listeners["after"+e]||[],n=function(t,r){(t=t.slice()).forEach(function(t){t.call(i,{type:e},r)})};n(r,t),n(a,t),n(s,t)}}}],x(i.prototype,e),t&&x(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}();function N(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){var e;function t(e){var i=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,t),this.pm=e,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,e.on("playing",function(){i._playheadShouldBeProgressing=!0}),e.on("play",this._startPlaybackHeartbeatInterval.bind(this)),e.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),e.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),e.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),e.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),e.on("seeking",this._startPlaybackHeartbeatInterval.bind(this)),e.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),e.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),e.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),e.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("seeked",function(){e.data.player_is_paused?i._stopPlaybackHeartbeatInterval():i._startPlaybackHeartbeatInterval()}),e.on("timeupdate",function(){null!==i._playbackHeartbeatInterval&&e.emit("playbackheartbeat")}),e.on("devicesleep",function(t,r){null!==i._playbackHeartbeatInterval&&(a().clearInterval(i._playbackHeartbeatInterval),e.emit("playbackheartbeatend",{viewer_time:r.viewer_time}),i._playbackHeartbeatInterval=null)})}return N(t.prototype,[{key:"_startPlaybackHeartbeatInterval",value:function(){var e=this;null===this._playbackHeartbeatInterval&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=a().setInterval(function(){e.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(a().clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}]),e&&N(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}();function F(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=(e3=function e(t){var i=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,e),t.on("viewinit",function(){i.viewErrored=!1}),t.on("error",function(e,r){try{var a=t.errorTranslator({player_error_code:r.player_error_code,player_error_message:r.player_error_message,player_error_context:r.player_error_context});a?(t.data.player_error_code=a.player_error_code||r.player_error_code,t.data.player_error_message=a.player_error_message||r.player_error_message,t.data.player_error_context=a.player_error_context||r.player_error_context,i.viewErrored=!0):(delete t.data.player_error_code,delete t.data.player_error_message,delete t.data.player_error_context)}catch(e){t.mux.log.warn("Exception in error translator callback.",e),i.viewErrored=!0}})},e4&&F(e3.prototype,e4),e5&&F(e3,e5),Object.defineProperty(e3,"prototype",{writable:!1}),e3);function $(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var V=function(){var e,t;function i(e){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,i),this.pm=e,this._watchTimeTrackerLastCheckedTime=null,e.on("playbackheartbeat",this._updateWatchTime.bind(this)),e.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}return e=[{key:"_updateWatchTime",value:function(e,t){var i=t.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=i),E(this.pm.data,"view_watch_time",i-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=i}},{key:"_clearWatchTimeState",value:function(e,t){this._updateWatchTime(e,t),this._watchTimeTrackerLastCheckedTime=null}}],$(i.prototype,e),t&&$(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}();function H(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var G=function(){var e,t;function i(e){var t=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,i),this.pm=e,this._playbackTimeTrackerLastPlayheadPosition=-1,this._lastTime=f.now(),this._isAdPlaying=!1,this._callbackUpdatePlaybackTime=null;var r=this._startPlaybackTimeTracking.bind(this);e.on("playing",r),e.on("adplaying",r),e.on("seeked",r);var a=this._stopPlaybackTimeTracking.bind(this);e.on("playbackheartbeatend",a),e.on("seeking",a),e.on("adplaying",function(){t._isAdPlaying=!0}),e.on("adended",function(){t._isAdPlaying=!1}),e.on("adpause",function(){t._isAdPlaying=!1}),e.on("adbreakstart",function(){t._isAdPlaying=!1}),e.on("adbreakend",function(){t._isAdPlaying=!1}),e.on("adplay",function(){t._isAdPlaying=!1}),e.on("viewinit",function(){t._playbackTimeTrackerLastPlayheadPosition=-1,t._lastTime=f.now(),t._isAdPlaying=!1,t._callbackUpdatePlaybackTime=null})}return e=[{key:"_startPlaybackTimeTracking",value:function(){null===this._callbackUpdatePlaybackTime&&(this._callbackUpdatePlaybackTime=this._updatePlaybackTime.bind(this),this._playbackTimeTrackerLastPlayheadPosition=this.pm.data.player_playhead_time,this.pm.on("playbackheartbeat",this._callbackUpdatePlaybackTime))}},{key:"_stopPlaybackTimeTracking",value:function(){this._callbackUpdatePlaybackTime&&(this._updatePlaybackTime(),this.pm.off("playbackheartbeat",this._callbackUpdatePlaybackTime),this._callbackUpdatePlaybackTime=null,this._playbackTimeTrackerLastPlayheadPosition=-1)}},{key:"_updatePlaybackTime",value:function(){var e=this.pm.data.player_playhead_time,t=f.now(),i=-1;this._playbackTimeTrackerLastPlayheadPosition>=0&&e>this._playbackTimeTrackerLastPlayheadPosition?i=e-this._playbackTimeTrackerLastPlayheadPosition:this._isAdPlaying&&(i=t-this._lastTime),i>0&&i<=1e3&&E(this.pm.data,"view_content_playback_time",i),this._playbackTimeTrackerLastPlayheadPosition=e,this._lastTime=t}}],H(i.prototype,e),t&&H(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}();function W(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var K=function(){var e,t;function i(e){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,i),this.pm=e;var t=this._updatePlayheadTime.bind(this);e.on("playbackheartbeat",t),e.on("playbackheartbeatend",t),e.on("timeupdate",t),e.on("destroy",function(){e.off("timeupdate",t)})}return e=[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=void 0===this.pm.data.view_max_playhead_position?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(e,t){var i=this,r=function(){i.pm.currentFragmentPDT&&i.pm.currentFragmentStart&&(i.pm.data.player_program_time=i.pm.currentFragmentPDT+i.pm.data.player_playhead_time-i.pm.currentFragmentStart)};if(t&&t.player_playhead_time)this.pm.data.player_playhead_time=t.player_playhead_time,r(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var a=this.pm.getPlayheadTime();void 0!==a&&(this.pm.data.player_playhead_time=a,r(),this._updateMaxPlayheadPosition())}}}],W(i.prototype,e),t&&W(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}();function q(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=(e8=function e(t){if(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e),!t.disableRebufferTracking){var i,r=function(e,t){a(t),i=void 0},a=function(e){if(i){var r=e.viewer_time-i;E(t.data,"view_rebuffer_duration",r),i=e.viewer_time,t.data.view_rebuffer_duration>3e5&&(t.emit("viewend"),t.send("viewend"),t.mux.log.warn("Ending view after rebuffering for longer than ".concat(3e5,"ms, future events will be ignored unless a programchange or videochange occurs.")))}t.data.view_watch_time>=0&&t.data.view_rebuffer_count>0&&(t.data.view_rebuffer_frequency=t.data.view_rebuffer_count/t.data.view_watch_time,t.data.view_rebuffer_percentage=t.data.view_rebuffer_duration/t.data.view_watch_time)};t.on("playbackheartbeat",function(e,t){return a(t)}),t.on("rebufferstart",function(e,a){i||(E(t.data,"view_rebuffer_count",1),i=a.viewer_time,t.one("rebufferend",r))}),t.on("viewinit",function(){i=void 0,t.off("rebufferend",r)})}},e9&&q(e8.prototype,e9),e6&&q(e8,e6),Object.defineProperty(e8,"prototype",{writable:!1}),e8);function Y(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){var e,t;function i(e){var t=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,i),this.pm=e,e.disableRebufferTracking||e.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,e.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),e.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),e.on("seeking",function(){t._cleanupRebufferTracker(null,{viewer_time:f.now()})}))}return e=[{key:"_checkIfRebuffering",value:function(e,t){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(e,t);else if(null!==this._lastCheckedTime){if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var i=t.viewer_time-this._lastPlayheadTimeUpdatedTime;"number"==typeof this.pm.sustainedRebufferThreshold&&i>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=t.viewer_time}else this._cleanupRebufferTracker(e,t,!0)}else this._prepareRebufferTrackerState(t.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(e){this._lastCheckedTime=e,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=e}},{key:"_cleanupRebufferTracker",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:t.viewer_time});else{if(null===this._lastCheckedTime)return;var r=this.pm.data.player_playhead_time-this._lastPlayheadTime,a=t.viewer_time-this._lastPlayheadTimeUpdatedTime;"number"==typeof this.pm.minimumRebufferDuration&&r>0&&a-r>this.pm.minimumRebufferDuration&&(this._lastCheckedTime=null,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+a-r}))}i?this._prepareRebufferTrackerState(t.viewer_time):this._clearRebufferTrackerState()}}],Y(i.prototype,e),t&&Y(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}();function X(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Q=function(){var e;function t(e){var i=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,t),this.pm=e,e.on("viewinit",function(){var t=e.data,r=t.view_id;if(!t.view_program_changed){var a=function(t,a){var s=a.viewer_time;"playing"===t.type&&void 0===e.data.view_time_to_first_frame?i.calculateTimeToFirstFrame(s||f.now(),r):"adplaying"===t.type&&(void 0===e.data.view_time_to_first_frame||i._inPrerollPosition())&&i.calculateTimeToFirstFrame(s||f.now(),r)};e.one("playing",a),e.one("adplaying",a),e.one("viewend",function(){e.off("playing",a),e.off("adplaying",a)})}})}return X(t.prototype,[{key:"_inPrerollPosition",value:function(){return void 0===this.pm.data.view_content_playback_time||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(e,t){t===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:e}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}]),e&&X(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}();function Z(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=(e7=function e(t){var i=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,e),t.on("viewinit",function(){i._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(e){t.on(e,function(){if(i._lastPlayheadPosition>=0&&t.data.player_playhead_time>=0&&i._lastPlayerWidth>=0&&i._lastSourceWidth>0&&i._lastPlayerHeight>=0&&i._lastSourceHeight>0){var e=t.data.player_playhead_time-i._lastPlayheadPosition;if(e<0)return void(i._lastPlayheadPosition=-1);var r=Math.min(i._lastPlayerWidth/i._lastSourceWidth,i._lastPlayerHeight/i._lastSourceHeight),a=Math.max(0,r-1),s=Math.max(0,1-r);t.data.view_max_upscale_percentage=Math.max(t.data.view_max_upscale_percentage||0,a),t.data.view_max_downscale_percentage=Math.max(t.data.view_max_downscale_percentage||0,s),E(t.data,"view_total_content_playback_time",e),E(t.data,"view_total_upscaling",a*e),E(t.data,"view_total_downscaling",s*e)}i._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(e){t.on(e,function(){i._lastPlayheadPosition=t.data.player_playhead_time,i._lastPlayerWidth=t.data.player_width,i._lastPlayerHeight=t.data.player_height,i._lastSourceWidth=t.data.video_source_width,i._lastSourceHeight=t.data.video_source_height})})},te&&Z(e7.prototype,te),tt&&Z(e7,tt),Object.defineProperty(e7,"prototype",{writable:!1}),e7);function ee(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var et=(ti=function e(t){var i=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,e),this.isSeeking=!1;var r=-1,a=function(){var e=f.now(),a=(t.data.viewer_time||e)-(r||e);E(t.data,"view_seek_duration",a),t.data.view_max_seek_time=Math.max(t.data.view_max_seek_time||0,a),i.isSeeking=!1,r=-1};t.on("seeking",function(e,s){Object.assign(t.data,s),i.isSeeking&&s.viewer_time-r<=2e3?r=s.viewer_time:(i.isSeeking&&a(),i.isSeeking=!0,r=s.viewer_time,E(t.data,"view_seek_count",1),t.send("seeking"))}),t.on("seeked",function(){a()}),t.on("viewend",function(){i.isSeeking&&(a(),t.send("seeked")),i.isSeeking=!1,r=-1})},tr&&ee(ti.prototype,tr),ta&&ee(ti,ta),Object.defineProperty(ti,"prototype",{writable:!1}),ti);function ei(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,a,s=[],n=!0,o=!1;try{for(i=i.call(e);!(n=(r=i.next()).done)&&(s.push(r.value),!t||s.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return er(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?er(e,t):void 0}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function er(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function ea(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var es=function(e,t){e.push(t),e.sort(function(e,t){return e.viewer_time-t.viewer_time})},en=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror","adclicked","adskipped"],eo=function(){var e,t;function i(e){var t=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,i),this.pm=e,e.on("viewinit",function(){t.isAdBreak=!1,t._currentAdRequestNumber=0,t._currentAdResponseNumber=0,t._adRequests=[],t._adResponses=[],t._adHasPlayed=!1,t._wouldBeNewAdPlay=!0,t._prerollPlayTime=void 0}),en.forEach(function(i){return e.on(i,t._updateAdData.bind(t))});var r=function(){t.isAdBreak=!1};e.on("adbreakstart",function(){t.isAdBreak=!0}),e.on("play",r),e.on("playing",r),e.on("viewend",r),e.on("adrequest",function(i,r){r=Object.assign({ad_request_id:"generatedAdRequestId"+t._currentAdRequestNumber++},r),es(t._adRequests,r),E(e.data,"view_ad_request_count"),t.inPrerollPosition()&&(e.data.view_preroll_requested=!0,t._adHasPlayed||E(e.data,"view_preroll_request_count"))}),e.on("adresponse",function(i,r){r=Object.assign({ad_request_id:"generatedAdRequestId"+t._currentAdResponseNumber++},r),es(t._adResponses,r);var a=t.findAdRequest(r.ad_request_id);a&&E(e.data,"view_ad_request_time",Math.max(0,r.viewer_time-a.viewer_time))}),e.on("adplay",function(i,r){t._adHasPlayed=!0,t._wouldBeNewAdPlay&&(t._wouldBeNewAdPlay=!1,E(e.data,"view_ad_played_count")),t.inPrerollPosition()&&!e.data.view_preroll_played&&(e.data.view_preroll_played=!0,t._adRequests.length>0&&(e.data.view_preroll_request_time=Math.max(0,r.viewer_time-t._adRequests[0].viewer_time)),e.data.view_start&&(e.data.view_startup_preroll_request_time=Math.max(0,r.viewer_time-e.data.view_start)),t._prerollPlayTime=r.viewer_time)}),e.on("adplaying",function(i,r){t.inPrerollPosition()&&void 0===e.data.view_preroll_load_time&&void 0!==t._prerollPlayTime&&(e.data.view_preroll_load_time=r.viewer_time-t._prerollPlayTime,e.data.view_startup_preroll_load_time=r.viewer_time-t._prerollPlayTime)}),e.on("adclicked",function(i,r){t._wouldBeNewAdPlay||E(e.data,"view_ad_clicked_count")}),e.on("adskipped",function(i,r){t._wouldBeNewAdPlay||E(e.data,"view_ad_skipped_count")}),e.on("adended",function(){t._wouldBeNewAdPlay=!0}),e.on("aderror",function(){t._wouldBeNewAdPlay=!0})}return e=[{key:"inPrerollPosition",value:function(){return void 0===this.pm.data.view_content_playback_time||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(e){for(var t=0;t<this._adRequests.length;t++)if(this._adRequests[t].ad_request_id===e)return this._adRequests[t]}},{key:"_updateAdData",value:function(e,t){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&t.ad_tag_url){var i=ei(g(t.ad_tag_url),2),r=i[0],a=i[1];this.pm.data.view_preroll_ad_tag_domain=a,this.pm.data.view_preroll_ad_tag_hostname=r}if(!this.pm.data.view_preroll_ad_asset_hostname&&t.ad_asset_url){var s=ei(g(t.ad_asset_url),2),n=s[0],o=s[1];this.pm.data.view_preroll_ad_asset_domain=o,this.pm.data.view_preroll_ad_asset_hostname=n}}this.pm.data.ad_asset_url=null==t?void 0:t.ad_asset_url,this.pm.data.ad_tag_url=null==t?void 0:t.ad_tag_url,this.pm.data.ad_creative_id=null==t?void 0:t.ad_creative_id,this.pm.data.ad_id=null==t?void 0:t.ad_id,this.pm.data.ad_universal_id=null==t?void 0:t.ad_universal_id}}],ea(i.prototype,e),t&&ea(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}();function el(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ed=(ts=function e(t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e);var i,r,s=function(){t.disableRebufferTracking||i&&(E(t.data,"view_waiting_rebuffer_duration",f.now()-i),i=!1,a().clearInterval(r))},n=!1,o=function(){n=!1,s()};t.on("waiting",function(){n&&(t.disableRebufferTracking||(E(t.data,"view_waiting_rebuffer_count",1),i=f.now(),r=a().setInterval(function(){if(i){var e=f.now();E(t.data,"view_waiting_rebuffer_duration",e-i),i=e}},250)))}),t.on("playing",function(){s(),n=!0}),t.on("pause",o),t.on("seeking",o)},tn&&el(ts.prototype,tn),to&&el(ts,to),Object.defineProperty(ts,"prototype",{writable:!1}),ts);function eu(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var eh=(tl=function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e);var r=function(){i.lastWallClockTime=f.now(),t.on("before*",a)},a=function(e){var r=f.now(),a=i.lastWallClockTime;i.lastWallClockTime=r,r-a>3e4&&(t.emit("devicesleep",{viewer_time:a}),Object.assign(t.data,{viewer_time:a}),t.send("devicesleep"),t.emit("devicewake",{viewer_time:r}),Object.assign(t.data,{viewer_time:r}),t.send("devicewake"))};t.one("playbackheartbeat",r),t.on("playbackheartbeatend",function(){t.off("before*",a),t.one("playbackheartbeat",r)})},td&&eu(tl.prototype,td),tu&&eu(tl,tu),Object.defineProperty(tl,"prototype",{writable:!1}),tl),ec=i(375),em=i(655),ef=i.n(em),ep="muxData",eg=function(){var e;try{e=ec.parse(ef().get(ep)||"")}catch(t){e={}}return e},ev=function(e){try{ef().set(ep,ec.stringify(e),{expires:365})}catch(e){}},eE=function(){var e=eg();return e.mux_viewer_id=e.mux_viewer_id||s(),e.msn=e.msn||Math.random(),ev(e),{mux_viewer_id:e.mux_viewer_id,mux_sample_number:e.msn}},eb=function(){var e;switch(ey()){case"cellular":e="cellular";break;case"ethernet":e="wired";break;case"wifi":e="wifi";break;case void 0:break;default:e="other"}return e},ey=function(){var e=a().navigator,t=e&&(e.connection||e.mozConnection||e.webkitConnection);return t&&t.type};eb.getConnectionFromAPI=ey;var eT=e_({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),eA=e_({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",ck:"clicked",cl:"canceled",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fa:"failed",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",ha:"has",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",sd:"skipped",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",un:"universal",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function e_(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function eS(e){var t={},i={};return Object.keys(e).forEach(function(r){var a=!1;if(e.hasOwnProperty(r)&&void 0!==e[r]){var s=r.split("_"),n=s[0],o=eT[n];o||(c.info("Data key word `"+s[0]+"` not expected in "+r),o=n+"_"),s.splice(1).forEach(function(e){"url"===e&&(a=!0),eA[e]?o+=eA[e]:Number(e)&&Math.floor(Number(e))===Number(e)?o+=e:(c.info("Data key word `"+e+"` not expected in "+r),o+="_"+e+"_")}),a?i[o]=e[r]:t[o]=e[r]}}),Object.assign(t,i)}var ek={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},eL=["hb","requestcompleted","requestfailed","requestcanceled"],eI=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._beaconUrl=e||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=Object.assign({},ek,t)};eI.prototype.queueEvent=function(e,t){var i=Object.assign({},t);return(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===e)&&(this._eventQueue.push(i),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},eI.prototype.flushEvents=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&1===this._eventQueue.length?this._eventQueue.pop():(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},eI.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,e?this._clearBeaconQueue():this.flushEvents(),a().clearTimeout(this._sendTimeout)},eI.prototype._clearBeaconQueue=function(){var e=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,t=this._eventQueue.slice(e);e>0&&Object.assign(t[t.length-1],eS({mux_view_message:"event queue truncated"}));var i=this._createPayload(t);eR(this._beaconUrl,i,!0,function(){})},eI.prototype._sendBeaconQueue=function(){var e=this;if(!this._postInFlight){var t=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var i=this._createPayload(t),r=f.now();eR(this._beaconUrl,i,!1,function(i,a){a?(e._eventQueue=t.concat(e._eventQueue),e._failureCount+=1,c.info("Error sending beacon: "+a)):e._failureCount=0,e._roundTripTime=f.now()-r,e._postInFlight=!1})}},eI.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var e=Math.pow(2,this._failureCount-1);return(1+(e*=Math.random()))*this._options.baseTimeBetweenBeacons},eI.prototype._startBeaconSending=function(){var e=this;a().clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=a().setTimeout(function(){e._eventQueue.length&&e._sendBeaconQueue(),e._startBeaconSending()},this._getNextBeaconTime()))},eI.prototype._createPayload=function(e){var t,i,r,a=this,s={transmission_timestamp:Math.round(f.now())};this._roundTripTime&&(s.rtt_ms=Math.round(this._roundTripTime));var n=function(){r=(t=JSON.stringify({metadata:s,events:i||e})).length/1024},o=function(){return r<=a._options.maxPayloadKBSize};return n(),o()||(c.info("Payload size is too big ("+r+" kb). Removing unnecessary events."),i=e.filter(function(e){return -1===eL.indexOf(e.e)}),n()),o()||(c.info("Payload size still too big ("+r+" kb). Cropping fields.."),i.forEach(function(e){for(var t in e){var i=e[t];"string"==typeof i&&i.length>51200&&(e[t]=i.substring(0,51200))}}),n()),t};var eR=function(e,t,i,r){if(i&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(e,t))r();else if(a().fetch)a().fetch(e,{method:"POST",body:t,headers:{"Content-Type":"text/plain"},keepalive:t.length<=57344}).then(function(e){return r(null,e.ok?null:"Error")}).catch(function(e){return r(null,e)});else{if(a().XMLHttpRequest){var s=new(a()).XMLHttpRequest;return s.onreadystatechange=function(){if(4===s.readyState)return r(null,200!==s.status?"error":void 0)},s.open("POST",e),s.setRequestHeader("Content-Type","text/plain"),void s.send(t)}r()}};function ew(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function eD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function eC(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?eD(Object(i),!0).forEach(function(t){eO(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eD(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function eM(e){return(eM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ex(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function eO(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var eP=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],eN=["adplay","adplaying","adpause","adfirstquartile","admidpoint","adthirdquartile","adended","adresponse","adrequest"],eU=["ad_id","ad_creative_id","ad_universal_id"],eF=["viewstart","error","ended","viewend"],eB=function(){var e,t;function i(e,t){var r,s,n,o,l,d,u,h,c,m,f,p,g,v,E,b,y,T,A,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,i),eO(this,"previousBeaconData",null),eO(this,"lastEventTime",0),eO(this,"rateLimited",!1),this.mux=e,this.envKey=t,this.options=_,this.eventQueue=new eI((r=this.envKey,n=(s=this.options).beaconCollectionDomain,o=s.beaconDomain,n?"https://"+n:(r=r||"inferred").match(/^[a-z0-9]+$/)?"https://"+r+"."+(o||"litix.io"):"https://img.litix.io/a.gif")),this.sampleRate=null!==(l=this.options.sampleRate)&&void 0!==l?l:1,this.disableCookies=null!==(d=this.options.disableCookies)&&void 0!==d&&d,this.respectDoNotTrack=null!==(u=this.options.respectDoNotTrack)&&void 0!==u&&u,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:null===(h=this.options.platform)||void 0===h?void 0:h.name,viewer_application_version:null===(c=this.options.platform)||void 0===c?void 0:c.version,viewer_application_engine:null===(m=this.options.platform)||void 0===m?void 0:m.layout,viewer_device_name:null===(f=this.options.platform)||void 0===f?void 0:f.product,viewer_device_category:"",viewer_device_manufacturer:null===(p=this.options.platform)||void 0===p?void 0:p.manufacturer,viewer_os_family:null===(g=this.options.platform)||void 0===g||null===(v=g.os)||void 0===v?void 0:v.family,viewer_os_architecture:null===(E=this.options.platform)||void 0===E||null===(b=E.os)||void 0===b?void 0:b.architecture,viewer_os_version:null===(y=this.options.platform)||void 0===y||null===(T=y.os)||void 0===T?void 0:T.version,viewer_connection_type:eb(),page_url:null===a()||void 0===a()||null===(A=a().location)||void 0===A?void 0:A.href},this.viewerData=this.disableCookies?{}:eE()}return e=[{key:"send",value:function(e,t){var i;if(e&&null!=t&&t.view_id){if(this.respectDoNotTrack&&m())return c.info("Not sending `"+e+"` because Do Not Track is enabled");if(!t||"object"!==eM(t))return c.error("A data object was expected in send() but was not provided");var r,a,n=this.disableCookies?{}:(r=eg(),a=f.now(),r.session_start&&(r.sst=r.session_start,delete r.session_start),r.session_id&&(r.sid=r.session_id,delete r.session_id),r.session_expires&&(r.sex=r.session_expires,delete r.session_expires),(!r.sex||r.sex<a)&&(r.sid=s(),r.sst=a),r.sex=a+15e5,ev(r),{session_id:r.sid,session_start:r.sst,session_expires:r.sex}),o=eC(eC(eC(eC(eC({},this.pageLevelData),t),n),this.viewerData),{},{event:e,env_key:this.envKey});o.user_id&&(o.viewer_user_id=o.user_id,delete o.user_id);var l=(null!==(i=o.mux_sample_number)&&void 0!==i?i:0)>=this.sampleRate,d=eS(this._deduplicateBeaconData(e,o));if(this.lastEventTime=this.mux.utils.now(),l)return c.info("Not sending event due to sample rate restriction",e,o,d);if(this.envKey||c.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",e,o,d),!this.rateLimited){if(c.info("Sending event",e,o,d),this.rateLimited=!this.eventQueue.queueEvent(e,d),this.mux.WINDOW_UNLOADING&&"viewend"===e)this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&"hb"===e?this.eventQueue.flushEvents(!0):eF.indexOf(e)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return o.event="eventrateexceeded",d=eS(o),this.eventQueue.queueEvent(o.event,d),c.error("Beaconing disabled due to rate limit.")}}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(e,t){var i=this,r={},a=t.view_id;if("-1"===a||"viewstart"===e||"viewend"===e||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)r=eC({},t),a&&(this.previousBeaconData=r),a&&"viewend"===e&&(this.previousBeaconData=null);else{var s=0===e.indexOf("request");Object.entries(t).forEach(function(t){var a=function(e){if(Array.isArray(e))return e}(t)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,a,s=[],n=!0,o=!1;try{for(i=i.call(e);!(n=(r=i.next()).done)&&(s.push(r.value),!t||s.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return s}}(t,2)||function(e,t){if(e){if("string"==typeof e)return ew(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ew(e,t):void 0}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=a[0],o=a[1];i.previousBeaconData&&(o!==i.previousBeaconData[n]||eP.indexOf(n)>-1||i.objectHasChanged(s,n,o,i.previousBeaconData[n])||i.eventRequiresKey(e,n))&&(r[n]=o,i.previousBeaconData[n]=o)})}return r}},{key:"objectHasChanged",value:function(e,t,i,r){return!(!e||0!==t.indexOf("request_")||"request_response_headers"!==t&&"object"===eM(i)&&"object"===eM(r)&&Object.keys(i||{}).length===Object.keys(r||{}).length)}},{key:"eventRequiresKey",value:function(e,t){return"renditionchange"===e&&0===t.indexOf("video_source_")||!(!eU.includes(t)||!eN.includes(e))}}],ex(i.prototype,e),t&&ex(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}();function e$(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var eV=(th=function e(t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e);var i=0,r=0,a=0,s=0,n=0,o=0,l=0;t.on("requestcompleted",function(e,o){var l,d,u=o.request_start,h=o.request_response_start,c=o.request_response_end,m=o.request_bytes_loaded;if(s++,h?(l=h-(null!=u?u:0),d=(null!=c?c:0)-h):d=(null!=c?c:0)-(null!=u?u:0),d>0&&m&&m>0){var f=m/d*8e3;n++,r+=m,a+=d,t.data.view_min_request_throughput=Math.min(t.data.view_min_request_throughput||1/0,f),t.data.view_average_request_throughput=r/a*8e3,t.data.view_request_count=s,l>0&&(i+=l,t.data.view_max_request_latency=Math.max(t.data.view_max_request_latency||0,l),t.data.view_average_request_latency=i/n)}}),t.on("requestfailed",function(e,i){s++,o++,t.data.view_request_count=s,t.data.view_request_failed_count=o}),t.on("requestcanceled",function(e,i){s++,l++,t.data.view_request_count=s,t.data.view_request_canceled_count=l})},tc&&e$(th.prototype,tc),tm&&e$(th,tm),Object.defineProperty(th,"prototype",{writable:!1}),th);function eH(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var eG=(tf=function e(t){var i=this;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,e),t.on("before*",function(e,r){var a=r.viewer_time,s=f.now(),n=i._lastEventTime;if(i._lastEventTime=s,n&&s-n>36e5){var o=Object.keys(t.data).reduce(function(e,i){var r,a;return 0===i.indexOf("video_")?Object.assign(e,(r={},a=t.data[i],i in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,r)):e},{});t.mux.log.info("Received event after at least an hour inactivity, creating a new view"),t.emit("viewinit",Object.assign({viewer_time:a},o)),t.playbackHeartbeat._playheadShouldBeProgressing&&"play"!==e.type&&"adbreakstart"!==e.type&&(t.emit("play",{viewer_time:a}),"playing"!==e.type&&t.emit("playing",{viewer_time:a}))}})},tp&&eH(tf.prototype,tp),tg&&eH(tf,tg),Object.defineProperty(tf,"prototype",{writable:!1}),tf);function eW(e){return(eW="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eK(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function eq(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ej(e,t){return(ej=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eY(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ez(e){return(ez=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eX=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],eQ=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ej(e,t)}(n,e);var t,i,r,a=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=ez(n);if(t){var r=ez(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){if(t&&("object"===eW(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return eY(e)}(this,e)});function n(e,t,i){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,n),(o=a.call(this)).DOM_CONTENT_LOADED_EVENT_END=v.domContentLoadedEventEnd(),o.NAVIGATION_START=v.navigationStart(),o.mux=e,o.id=t,null!==(r=i)&&void 0!==r&&r.beaconDomain&&o.mux.log.warn("The `beaconDomain` setting has been deprecated in favor of `beaconCollectionDomain`. Please change your integration to use `beaconCollectionDomain` instead of `beaconDomain`."),(i=Object.assign({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(e){return e}},i)).data=i.data||{},i.data.property_key&&(i.data.env_key=i.data.property_key,delete i.data.property_key),c.setLevel(i.debug?"debug":"warn"),o.getPlayheadTime=i.getPlayheadTime,o.getStateData=i.getStateData||function(){return{}},o.getAdData=i.getAdData||function(){},o.minimumRebufferDuration=i.minimumRebufferDuration,o.sustainedRebufferThreshold=i.sustainedRebufferThreshold,o.playbackHeartbeatTime=i.playbackHeartbeatTime,o.disableRebufferTracking=i.disableRebufferTracking,o.disableRebufferTracking&&o.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),o.disablePlayheadRebufferTracking=i.disablePlayheadRebufferTracking,o.errorTranslator=i.errorTranslator,o.playbackEventDispatcher=new eB(e,i.data.env_key,i),o.data={player_instance_id:s(),mux_sample_rate:i.sampleRate,beacon_domain:i.beaconCollectionDomain||i.beaconDomain},o.data.view_sequence_number=1,o.data.player_sequence_number=1,o.oldEmit=o.emit,o.emit=function(e,t){t=Object.assign({viewer_time:this.mux.utils.now()},t),this.oldEmit(e,t)};var r,o,l=(function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}).bind(eY(o));o.on("viewinit",function(e,t){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),Object.assign(this.data,t),this._initializeViewData(),this.one("play",l),this.one("adbreakstart",l)});var d=(function(e){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",e)}).bind(eY(o));if(o.on("videochange",function(e,t){d(t)}),o.on("programchange",function(e,t){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),d(Object.assign(t,{view_program_changed:!0})),l(),this.emit("play"),this.emit("playing")}),o.on("fragmentchange",function(e,t){this.currentFragmentPDT=t.currentFragmentPDT,this.currentFragmentStart=t.currentFragmentStart}),o.on("destroy",o.destroy),"undefined"!=typeof window&&"function"==typeof window.addEventListener&&"function"==typeof window.removeEventListener){var u=function(){var e=void 0!==o.data.view_start;o.mux.WINDOW_HIDDEN="hidden"===document.visibilityState,e&&o.mux.WINDOW_HIDDEN&&(o.data.player_is_paused||o.emit("hb"))};window.addEventListener("visibilitychange",u,!1);var h=function(e){e.persisted||o.destroy()};window.addEventListener("pagehide",h,!1),o.on("destroy",function(){window.removeEventListener("visibilitychange",u),window.removeEventListener("pagehide",h)})}return o.on("playerready",function(e,t){Object.assign(this.data,t)}),eX.forEach(function(e){o.on(e,function(t,i){0!==e.indexOf("ad")&&this._updateStateData(),Object.assign(this.data,i),this._sanitizeData()}),o.on("after"+e,function(){("error"!==e||this.errorTracker.viewErrored)&&this.send(e)})}),o.on("viewend",function(e,t){Object.assign(o.data,t)}),o.one("playerready",function(e){var t=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=t-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),o.longResumeTracker=new eG(eY(o)),o.errorTracker=new B(eY(o)),new eh(eY(o)),o.seekingTracker=new et(eY(o)),o.playheadTime=new K(eY(o)),o.playbackHeartbeat=new U(eY(o)),new J(eY(o)),o.watchTimeTracker=new V(eY(o)),new G(eY(o)),o.adTracker=new eo(eY(o)),new z(eY(o)),new j(eY(o)),new Q(eY(o)),new ed(eY(o)),new eV(eY(o)),i.hlsjs&&o.addHLSJS(i),i.dashjs&&o.addDashJS(i),o.emit("viewinit",i.data),o}return i=[{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(e){if(this.data.view_id){var t=Object.assign({},this.data);if(void 0===t.video_source_is_live&&(t.player_source_duration===1/0||t.video_source_duration===1/0?t.video_source_is_live=!0:(t.player_source_duration>0||t.video_source_duration>0)&&(t.video_source_is_live=!1)),t.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(e){t[e]=void 0}),t.video_source_url=t.video_source_url||t.player_source_url,t.video_source_url){var i,r=function(e){if(Array.isArray(e))return e}(i=g(t.video_source_url))||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,a,s=[],n=!0,o=!1;try{for(i=i.call(e);!(n=(r=i.next()).done)&&(s.push(r.value),!t||s.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return s}}(i,2)||function(e,t){if(e){if("string"==typeof e)return eK(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?eK(e,t):void 0}}(i,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),a=r[0],s=r[1];t.video_source_domain=s,t.video_source_hostname=a}delete t.ad_request_id,this.playbackEventDispatcher.send(e,t),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat(),"viewend"===e&&delete this.data.view_id}}},{key:"_updateStateData",value:function(){Object.assign(this.data,this.getStateData()),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var e=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(t){var i=parseInt(e.data[t],10);e.data[t]=isNaN(i)?void 0:i}),["player_source_url","video_source_url"].forEach(function(t){if(e.data[t]){var i=e.data[t].toLowerCase();0!==i.indexOf("data:")&&0!==i.indexOf("blob:")||(e.data[t]="MSE style URL")}})}},{key:"_resetVideoData",value:function(e,t){var i=this;Object.keys(this.data).forEach(function(e){0===e.indexOf("video_")&&delete i.data[e]})}},{key:"_resetViewData",value:function(){var e=this;Object.keys(this.data).forEach(function(t){0===t.indexOf("view_")&&delete e.data[t]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(e,t){delete this.data.player_error_code,delete this.data.player_error_message}},{key:"_initializeViewData",value:function(){var e=this,t=this.data.view_id=s(),i=function(){t===e.data.view_id&&E(e.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",i):i()}},{key:"_restartHeartBeat",value:function(){var e=this;window.clearTimeout(this._heartBeatTimeout),this.errorTracker.viewErrored||(this._heartBeatTimeout=window.setTimeout(function(){e.data.player_is_paused||e.emit("hb")},1e4))}},{key:"addHLSJS",value:function(e){e.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=e.hlsjs,function(e,t,i){var r=arguments.length>4?arguments[4]:void 0,a=e.log,s=e.utils.secondsToMs,n=function(e){var t,i=parseInt(r.version);return 1===i&&null!==e.programDateTime&&(t=e.programDateTime),0===i&&null!==e.pdt&&(t=e.pdt),t};if(v.exists()){var o=function(i,r){return e.emit(t,i,r)},l=function(e,t){var i=t.levels,r=t.audioTracks,a=t.url,s=t.stats,n=t.networkDetails,l=t.sessionData,d={},u={};i.forEach(function(e,t){d[t]={width:e.width,height:e.height,bitrate:e.bitrate,attrs:e.attrs}}),r.forEach(function(e,t){u[t]={name:e.name,language:e.lang,bitrate:e.bitrate}});var h=L(s),c=h.bytesLoaded,m=h.requestStart,f=h.responseStart,g=h.responseEnd;o("requestcompleted",k(k({},_(l)),{},{request_event_type:e,request_bytes_loaded:c,request_start:m,request_response_start:f,request_response_end:g,request_type:"manifest",request_hostname:p(a),request_response_headers:I(n),request_rendition_lists:{media:d,audio:u,video:{}}}))};i.on(r.Events.MANIFEST_LOADED,l);var d=function(e,t){var i=t.details,r=t.level,a=t.networkDetails,l=L(t.stats),d=l.bytesLoaded,u=l.requestStart,h=l.responseStart,c=l.responseEnd,m=i.fragments[i.fragments.length-1],f=n(m)+s(m.duration);o("requestcompleted",{request_event_type:e,request_bytes_loaded:d,request_start:u,request_response_start:h,request_response_end:c,request_current_level:r,request_type:"manifest",request_hostname:p(i.url),request_response_headers:I(a),video_holdback:i.holdBack&&s(i.holdBack),video_part_holdback:i.partHoldBack&&s(i.partHoldBack),video_part_target_duration:i.partTarget&&s(i.partTarget),video_target_duration:i.targetduration&&s(i.targetduration),video_source_is_live:i.live,player_manifest_newest_program_time:isNaN(f)?void 0:f})};i.on(r.Events.LEVEL_LOADED,d);var u=function(e,t){var i=t.details,r=t.networkDetails,a=L(t.stats);o("requestcompleted",{request_event_type:e,request_bytes_loaded:a.bytesLoaded,request_start:a.requestStart,request_response_start:a.responseStart,request_response_end:a.responseEnd,request_type:"manifest",request_hostname:p(i.url),request_response_headers:I(r)})};i.on(r.Events.AUDIO_TRACK_LOADED,u);var h=function(e,t){var r=t.stats,a=t.networkDetails,s=t.frag,n=L(r=r||s.stats),l=n.bytesLoaded,d=n.requestStart,u=n.responseStart,h=n.responseEnd,c=a?I(a):void 0,m={request_event_type:e,request_bytes_loaded:l,request_start:d,request_response_start:u,request_response_end:h,request_hostname:a?p(a.responseURL):void 0,request_id:c?A(c):void 0,request_response_headers:c,request_media_duration:s.duration,request_url:null==a?void 0:a.responseURL};"main"===s.type?(m.request_type="media",m.request_current_level=s.level,m.request_video_width=(i.levels[s.level]||{}).width,m.request_video_height=(i.levels[s.level]||{}).height,m.request_labeled_bitrate=(i.levels[s.level]||{}).bitrate):m.request_type=s.type,o("requestcompleted",m)};i.on(r.Events.FRAG_LOADED,h);var c=function(e,t){var i=t.frag,r=i.start;o("fragmentchange",{currentFragmentPDT:n(i),currentFragmentStart:s(r)})};i.on(r.Events.FRAG_CHANGED,c);var m=function(e,t){var i,a=t.type,s=t.details,n=t.response,l=t.fatal,d=t.frag,u=t.networkDetails,h=(null==d?void 0:d.url)||t.url||"",c=u?I(u):void 0;s!==r.ErrorDetails.MANIFEST_LOAD_ERROR&&s!==r.ErrorDetails.MANIFEST_LOAD_TIMEOUT&&s!==r.ErrorDetails.FRAG_LOAD_ERROR&&s!==r.ErrorDetails.FRAG_LOAD_TIMEOUT&&s!==r.ErrorDetails.LEVEL_LOAD_ERROR&&s!==r.ErrorDetails.LEVEL_LOAD_TIMEOUT&&s!==r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&s!==r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT&&s!==r.ErrorDetails.SUBTITLE_LOAD_ERROR&&s!==r.ErrorDetails.SUBTITLE_LOAD_TIMEOUT&&s!==r.ErrorDetails.KEY_LOAD_ERROR&&s!==r.ErrorDetails.KEY_LOAD_TIMEOUT||o("requestfailed",{request_error:s,request_url:h,request_hostname:p(h),request_id:c?A(c):void 0,request_type:s===r.ErrorDetails.FRAG_LOAD_ERROR||s===r.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":s===r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||s===r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT?"audio":s===r.ErrorDetails.SUBTITLE_LOAD_ERROR||s===r.ErrorDetails.SUBTITLE_LOAD_TIMEOUT?"subtitle":s===r.ErrorDetails.KEY_LOAD_ERROR||s===r.ErrorDetails.KEY_LOAD_TIMEOUT?"encryption":"manifest",request_error_code:null==n?void 0:n.code,request_error_text:null==n?void 0:n.text}),l&&o("error",{player_error_code:a,player_error_message:s,player_error_context:"".concat(h?"url: ".concat(h,"\n"):"")+"".concat(n&&(n.code||n.text)?"response: ".concat(n.code,", ").concat(n.text,"\n"):"")+"".concat(t.reason?"failure reason: ".concat(t.reason,"\n"):"")+"".concat(t.level?"level: ".concat(t.level,"\n"):"")+"".concat(t.parent?"parent stream controller: ".concat(t.parent,"\n"):"")+"".concat(t.buffer?"buffer length: ".concat(t.buffer,"\n"):"")+"".concat(t.error?"error: ".concat(t.error,"\n"):"")+"".concat(t.event?"event: ".concat(t.event,"\n"):"")+"".concat(t.err?"error message: ".concat(null===(i=t.err)||void 0===i?void 0:i.message,"\n"):"")})};i.on(r.Events.ERROR,m);var f=function(e,t){var i=t.frag,r=i&&i._url||"";o("requestcanceled",{request_event_type:e,request_url:r,request_type:"media",request_hostname:p(r)})};i.on(r.Events.FRAG_LOAD_EMERGENCY_ABORTED,f);var g=function(e,t){var r=t.level,s=i.levels[r];if(s&&s.attrs&&s.attrs.BANDWIDTH){var n,l=s.attrs.BANDWIDTH,d=parseFloat(s.attrs["FRAME-RATE"]);isNaN(d)||(n=d),l?o("renditionchange",{video_source_fps:n,video_source_bitrate:l,video_source_width:s.width,video_source_height:s.height,video_source_rendition_name:s.name,video_source_codec:null==s?void 0:s.videoCodec}):a.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};i.on(r.Events.LEVEL_SWITCHED,g),i._stopMuxMonitor=function(){i.off(r.Events.MANIFEST_LOADED,l),i.off(r.Events.LEVEL_LOADED,d),i.off(r.Events.AUDIO_TRACK_LOADED,u),i.off(r.Events.FRAG_LOADED,h),i.off(r.Events.FRAG_CHANGED,c),i.off(r.Events.ERROR,m),i.off(r.Events.FRAG_LOAD_EMERGENCY_ABORTED,f),i.off(r.Events.LEVEL_SWITCHED,g),i.off(r.Events.DESTROYING,i._stopMuxMonitor),delete i._stopMuxMonitor},i.on(r.Events.DESTROYING,i._stopMuxMonitor)}else a.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,e.hlsjs,{},e.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){var e;this.hlsjs&&((e=this.hlsjs)&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor(),this.hlsjs=void 0)}},{key:"addDashJS",value:function(e){e.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=e.dashjs,function(e,t,i){var r=e.log;if(i&&i.on){var a=function(i,r){return e.emit(t,i,r)},s=function(e){var t=e.type,i=(e.data||{}).url;a("requestcompleted",{request_event_type:t,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:p(i),request_url:i})};i.on("manifestLoaded",s);var n={},o=function(e){var t=e.type,r=e.fragmentModel,s=(e.chunk||{}).mediaInfo||{},o=s.type,l=s.bitrateList,d={};(l=l||[]).forEach(function(e,t){d[t]={},d[t].width=e.width,d[t].height=e.height,d[t].bitrate=e.bandwidth,d[t].attrs={}}),"video"===o?n.video=d:"audio"===o?n.audio=d:n.media=d;var u=D(r,i),h=u.requestStart,c=u.requestResponseStart,m=u.requestResponseEnd,f=u.requestResponseHeaders,p=u.requestMediaDuration,g=u.requestHostname,v=u.requestUrl;a("requestcompleted",{request_event_type:t,request_start:h,request_response_start:c,request_response_end:m,request_bytes_loaded:-1,request_type:o+"_init",request_response_headers:f,request_hostname:g,request_id:u.requestId,request_url:v,request_media_duration:p,request_rendition_lists:n})};i.on("initFragmentLoaded",o);var l=function(e){var t=e.type,r=e.fragmentModel,s=e.chunk||{},n=s.mediaInfo,o=s.start,l=(n||{}).type,d=D(r,i),u=d.requestStart,h=d.requestResponseStart,c=d.requestResponseEnd,m=d.requestBytesLoaded,f=d.requestResponseHeaders,p=d.requestMediaDuration,g=d.requestHostname,v=d.requestUrl,E=d.requestId,b=C(l,i),y=b.currentLevel,T=b.renditionWidth,A=b.renditionHeight;a("requestcompleted",{request_event_type:t,request_start:u,request_response_start:h,request_response_end:c,request_bytes_loaded:m,request_type:l,request_response_headers:f,request_hostname:g,request_id:E,request_url:v,request_media_start_time:o,request_media_duration:p,request_current_level:y,request_labeled_bitrate:b.renditionBitrate,request_video_width:T,request_video_height:A})};i.on("mediaFragmentLoaded",l);var d={video:void 0,audio:void 0,totalBitrate:void 0},u=function(){if(d.video&&"number"==typeof d.video.bitrate){if(d.video.width&&d.video.height){var e=d.video.bitrate;return d.audio&&"number"==typeof d.audio.bitrate&&(e+=d.audio.bitrate),e!==d.totalBitrate?(d.totalBitrate=e,{video_source_bitrate:e,video_source_height:d.video.height,video_source_width:d.video.width,video_source_codec:M(d.video.codec)}):void 0}r.warn("have bitrate info for video but missing width/height")}},h=function(e,t,s){if("number"==typeof e.newQuality){var n=e.mediaType;if("audio"===n||"video"===n){var o=i.getBitrateInfoListFor(n).find(function(t){return t.qualityIndex===e.newQuality});if(o&&"number"==typeof o.bitrate){d[n]=w(w({},o),{},{codec:i.getCurrentTrackFor(n).codec});var l=u();l&&a("renditionchange",l)}else r.warn("missing bitrate info for ".concat(n))}}else r.warn("missing evt.newQuality in qualityChangeRendered event",e)};i.on("qualityChangeRendered",h);var c=function(e){var t=e.request,i=e.mediaType;a("requestcanceled",{request_event_type:(t=t||{}).type+"_"+t.action,request_url:t.url,request_type:i,request_hostname:p(t.url)})};i.on("fragmentLoadingAbandoned",c);var m=function(e){var t,i,r=e.error,s=(null==r||null===(t=r.data)||void 0===t?void 0:t.request)||{},n=(null==r||null===(i=r.data)||void 0===i?void 0:i.response)||{};27===(null==r?void 0:r.code)&&a("requestfailed",{request_error:s.type+"_"+s.action,request_url:s.url,request_hostname:p(s.url),request_type:s.mediaType,request_error_code:n.status,request_error_text:n.statusText});var o="".concat(null!=s&&s.url?"url: ".concat(s.url,"\n"):"")+"".concat(null!=n&&n.status||null!=n&&n.statusText?"response: ".concat(null==n?void 0:n.status,", ").concat(null==n?void 0:n.statusText,"\n"):"");a("error",{player_error_code:null==r?void 0:r.code,player_error_message:null==r?void 0:r.message,player_error_context:o})};i.on("error",m),i._stopMuxMonitor=function(){i.off("manifestLoaded",s),i.off("initFragmentLoaded",o),i.off("mediaFragmentLoaded",l),i.off("qualityChangeRendered",h),i.off("error",m),i.off("fragmentLoadingAbandoned",c),delete i._stopMuxMonitor}}else r.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,e.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){var e;this.dashjs&&((e=this.dashjs)&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor(),this.dashjs=void 0)}}],eq(n.prototype,i),r&&eq(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}(P),eZ=i(153),eJ=i.n(eZ);function e0(e){return(e0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e1(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,a,s=[],n=!0,o=!1;try{for(i=i.call(e);!(n=(r=i.next()).done)&&(s.push(r.value),!t||s.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return e2(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e2(e,t):void 0}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e2(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}var e3,e4,e5,e8,e9,e6,e7,te,tt,ti,tr,ta,ts,tn,to,tl,td,tu,th,tc,tm,tf,tp,tg,tv,tE=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],tb={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};a()&&a().WeakMap&&(tv=new WeakMap);var ty=function(e){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(e),this.manifest};ty.prototype.process=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.processLine(this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},ty.prototype.processLine=function(e){var t=e.indexOf(":"),i=tI(e,t),r=i[0],a=2===i.length?t_(i[1]):void 0;if("#"!==r[0])this.currentUri.uri=r,this.manifest.segments.push(this.currentUri),!this.manifest.targetDuration||"duration"in this.currentUri||(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(r){case"#EXT-X-TARGETDURATION":if(!isFinite(a)||a<0)return;this.manifest.targetDuration=a,this.setHoldBack();break;case"#EXT-X-PART-INF":tT(this.manifest,i),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case"#EXT-X-SERVER-CONTROL":tT(this.manifest,i),this.setHoldBack();break;case"#EXTINF":0===a?this.currentUri.duration=.01:a>0&&(this.currentUri.duration=a);break;case"#EXT-X-PROGRAM-DATE-TIME":var s=new Date(a);this.manifest.dateTimeString||(this.manifest.dateTimeString=a,this.manifest.dateTimeObject=s),this.currentUri.dateTimeString=a,this.currentUri.dateTimeObject=s;break;case"#EXT-X-VERSION":tT(this.manifest,i);break;case"#EXT-X-SESSION-DATA":var n=_(tR(i[1]));Object.assign(this.manifest.sessionData,n)}},ty.prototype.setHoldBack=function(){var e=this.manifest,t=e.serverControl,i=e.targetDuration,r=e.partTargetDuration;if(t){var a="holdBack",s="partHoldBack",n=i&&3*i,o=r&&2*r;i&&!t.hasOwnProperty(a)&&(t[a]=n),n&&t[a]<n&&(t[a]=n),r&&!t.hasOwnProperty(s)&&(t[s]=3*r),r&&t[s]<o&&(t[s]=o)}};var tT=function(e,t){var i,r=tA(t[0].replace("#EXT-X-",""));tL(t[1])?(i={},i=Object.assign(tk(t[1]),i)):i=t_(t[1]),e[r]=i},tA=function(e){return e.toLowerCase().replace(/-(\w)/g,function(e){return e[1].toUpperCase()})},t_=function(e){if("yes"===e.toLowerCase()||"no"===e.toLowerCase())return"yes"===e.toLowerCase();var t=-1!==e.indexOf(":")?e:parseFloat(e);return isNaN(t)?e:t},tS=function(e){var t={},i=e.split("=");return i.length>1&&(t[tA(i[0])]=t_(i[1])),t},tk=function(e){for(var t=e.split(","),i={},r=0;t.length>r;r++)i=Object.assign(tS(t[r]),i);return i},tL=function(e){return e.indexOf("=")>-1},tI=function(e,t){return -1===t?[e]:[e.substring(0,t),e.substring(t+1)]},tR=function(e){var t={};if(e){var i=e.search(",");return[e.slice(0,i),e.slice(i+1)].forEach(function(e,i){for(var r=e.replace(/['"]+/g,"").split("="),a=0;a<r.length;a++)"DATA-ID"===r[a]&&(t["DATA-ID"]=r[1-a]),"VALUE"===r[a]&&(t.VALUE=r[1-a])}),{data:t}}},tw={safeCall:function(e,t,i,r){var a=r;if(e&&"function"==typeof e[t])try{a=e[t].apply(e,i)}catch(e){c.info("safeCall error",e)}return a},safeIncrement:E,getComputedStyle:function(e,t){var i;if(e&&t&&a()&&"function"==typeof a().getComputedStyle)return tv&&tv.has(e)&&(i=tv.get(e)),i||(i=a().getComputedStyle(e,null),tv&&tv.set(e,i)),i.getPropertyValue(t)},secondsToMs:function(e){return Math.floor(1e3*e)},assign:Object.assign,headersStringToObject:T,cdnHeadersToRequestId:A,extractHostnameAndDomain:g,extractHostname:p,manifestParser:ty,generateShortID:n,generateUUID:s,now:f.now};function tD(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}var tC={},tM=function e(t){var i=arguments;"string"==typeof t?e.hasOwnProperty(t)?a().setTimeout(function(){i=Array.prototype.splice.call(i,1),e[t].apply(null,i)},0):c.warn("`"+t+"` is an unknown task"):"function"==typeof t?a().setTimeout(function(){t(e)},0):c.warn("`"+t+"` is invalid.")},tx={loaded:f.now(),NAME:"mux-embed",VERSION:"4.28.1",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(e,t){return function(e,t,i){var r=e1(l(t),3),a=r[0],s=r[1],n=r[2],o=e.log,d=e.utils.getComputedStyle,u=e.utils.secondsToMs;if(!a)return o.error("No element was found with the `"+s+"` query selector.");if("video"!==n&&"audio"!==n)return o.error("The element of `"+s+"` was not a media element.");a.mux&&(a.mux.destroy(),delete a.mux,o.warn("Already monitoring this video element, replacing existing event listeners")),(i=Object.assign({automaticErrorTracking:!0},i)).data=Object.assign({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:e.VERSION},i.data),i.getPlayheadTime=function(){return u(a.currentTime)},i.getStateData=function(){var e,t,r=this.hlsjs&&this.hlsjs.url,s=this.dashjs&&e0("function"===this.dashjs.getSource)&&this.dashjs.getSource(),n={player_is_paused:a.paused,player_playhead_time:u(a.currentTime),player_width:parseInt(d(a,"width")),player_height:parseInt(d(a,"height")),player_autoplay_on:a.autoplay,player_preload_on:a.preload,player_language_code:a.lang,player_is_fullscreen:eJ()&&!!(eJ().fullscreenElement||eJ().webkitFullscreenElement||eJ().mozFullScreenElement||eJ().msFullscreenElement),video_poster_url:a.poster,video_source_url:r||s||a.currentSrc,video_source_duration:u(a.duration),video_source_height:a.videoHeight,video_source_width:a.videoWidth,view_dropped_frame_count:null===(e=a)||void 0===e||null===(t=e.getVideoPlaybackQuality)||void 0===t?void 0:t.call(e).droppedVideoFrames},o=i.getPlayheadTime();if(a.getStartDate&&o>0){var l=a.getStartDate();if(l&&"function"==typeof l.getTime&&l.getTime()){var h=l.getTime();if(n.player_program_time=h+o,a.seekable.length>0){var c=h+a.seekable.end(a.seekable.length-1);n.player_live_edge_program_time=c}}}return n},a.mux=a.mux||{},a.mux.deleted=!1,a.mux.emit=function(t,i){e.emit(s,t,i)};var h=function(){o.error("The monitor for this video element has already been destroyed.")};a.mux.destroy=function(){Object.keys(a.mux.listeners).forEach(function(e){a.removeEventListener(e,a.mux.listeners[e],!1)}),delete a.mux.listeners,a.mux.destroy=h,a.mux.swapElement=h,a.mux.emit=h,a.mux.addHLSJS=h,a.mux.addDashJS=h,a.mux.removeHLSJS=h,a.mux.removeDashJS=h,a.mux.deleted=!0,e.emit(s,"destroy")},a.mux.swapElement=function(t){var i=e1(l(t),3),r=i[0],s=i[1],n=i[2];return r?"video"!==n&&"audio"!==n?e.log.error("The element of `"+s+"` was not a media element."):(r.muxId=a.muxId,delete a.muxId,r.mux=r.mux||{},r.mux.listeners=Object.assign({},a.mux.listeners),delete a.mux.listeners,Object.keys(r.mux.listeners).forEach(function(e){a.removeEventListener(e,r.mux.listeners[e],!1),r.addEventListener(e,r.mux.listeners[e],!1)}),r.mux.swapElement=a.mux.swapElement,r.mux.destroy=a.mux.destroy,delete a.mux,void(a=r)):e.log.error("No element was found with the `"+s+"` query selector.")},a.mux.addHLSJS=function(t){e.addHLSJS(s,t)},a.mux.addDashJS=function(t){e.addDashJS(s,t)},a.mux.removeHLSJS=function(){e.removeHLSJS(s)},a.mux.removeDashJS=function(){e.removeDashJS(s)},e.init(s,i),e.emit(s,"playerready"),a.paused||(e.emit(s,"play"),a.readyState>2&&e.emit(s,"playing")),a.mux.listeners={},tE.forEach(function(t){("error"!==t||i.automaticErrorTracking)&&(a.mux.listeners[t]=function(){var i={};if("error"===t){if(!a.error||1===a.error.code)return;i.player_error_code=a.error.code,i.player_error_message=tb[a.error.code]||a.error.message}e.emit(s,t,i)},a.addEventListener(t,a.mux.listeners[t],!1))})}(tM,e,t)},destroyMonitor:function(e){var t,i=(function(e){if(Array.isArray(e))return e}(t=l(e))||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,a,s=[],n=!0,o=!1;try{for(i=i.call(e);!(n=(r=i.next()).done)&&(s.push(r.value),!t||s.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return s}}(t,1)||function(e,t){if(e){if("string"==typeof e)return tD(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?tD(e,t):void 0}}(t,1)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];i&&i.mux&&"function"==typeof i.mux.destroy?i.mux.destroy():c.error("A video element monitor for `"+e+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(e,t){var i=o(e);tC[i]?tC[i].addHLSJS(t):c.error("A monitor for `"+i+"` has not been initialized.")},addDashJS:function(e,t){var i=o(e);tC[i]?tC[i].addDashJS(t):c.error("A monitor for `"+i+"` has not been initialized.")},removeHLSJS:function(e){var t=o(e);tC[t]?tC[t].removeHLSJS():c.error("A monitor for `"+t+"` has not been initialized.")},removeDashJS:function(e){var t=o(e);tC[t]?tC[t].removeDashJS():c.error("A monitor for `"+t+"` has not been initialized.")},init:function(e,t){m()&&t&&t.respectDoNotTrack&&c.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var i=o(e);tC[i]=new eQ(tM,i,t)},emit:function(e,t,i){var r=o(e);tC[r]?(tC[r].emit(t,i),"destroy"===t&&delete tC[r]):c.error("A monitor for `"+r+"` has not been initialized.")},checkDoNotTrack:m,log:c,utils:tw,events:{PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"},WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(tM,tx),void 0!==a()&&"function"==typeof a().addEventListener&&a().addEventListener("pagehide",function(e){e.persisted||(tM.WINDOW_UNLOADING=!0)},!1);var tO=tM},655:function(e,t,i){var r,a;function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e);/*!
 * JavaScript Cookie v2.1.3
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */}!function(n){var o=!1;if(void 0===(a="function"==typeof(r=n)?r.call(t,i,t,e):r)||(e.exports=a),o=!0,"object"===s(t)&&(e.exports=n(),o=!0),!o){var l=window.Cookies,d=window.Cookies=n();d.noConflict=function(){return window.Cookies=l,d}}}(function(){var e=function(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var r in i)t[r]=i[r]}return t};return function t(i){function r(t,a,s){var n;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(s=e({path:"/"},r.defaults,s)).expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*s.expires),s.expires=o}try{n=JSON.stringify(a),/^[\{\[]/.test(n)&&(a=n)}catch(e){}return a=i.write?i.write(a,t):encodeURIComponent(String(a)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[t,"=",a,s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}t||(n={});for(var l=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,u=0;u<l.length;u++){var h=l[u].split("="),c=h.slice(1).join("=");'"'===c.charAt(0)&&(c=c.slice(1,-1));try{var m=h[0].replace(d,decodeURIComponent);if(c=i.read?i.read(c,m):i(c,m)||c.replace(d,decodeURIComponent),this.json)try{c=JSON.parse(c)}catch(e){}if(t===m){n=c;break}t||(n[m]=c)}catch(e){}}return n}}return r.set=r,r.get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,i){r(t,"",e(i,{expires:-1}))},r.withConverter=t,r}(function(){})})},153:function(e,t,i){var r,a=void 0!==i.g?i.g:"undefined"!=typeof window?window:{},s=i(558);"undefined"!=typeof document?r=document:(r=a["__GLOBAL_DOCUMENT_CACHE@4"])||(r=a["__GLOBAL_DOCUMENT_CACHE@4"]=s),e.exports=r},48:function(e,t,i){var r;r="undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},e.exports=r},640:function(e,t,i){var r,a;void 0===(a="function"==typeof(r=function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function a(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function n(t,i){for(var a=0;a<r.length;a++){var s=r[a];this[s]=a<t?e:this.methodFactory(s,t,i)}this.log=this.debug}function o(e,i,r){return function(){typeof console!==t&&(n.call(this,i,r),this[e].apply(this,arguments))}}function l(r,n,l){var d;return"debug"===(d=r)&&(d="log"),typeof console!==t&&("trace"===d&&i?s:void 0!==console[d]?a(console,d):void 0!==console.log?a(console,"log"):e)||o.apply(this,arguments)}function d(e,i,a){var s,o=this;i=null==i?"WARN":i;var d="loglevel";function u(){var e;if(typeof window!==t&&d){try{e=window.localStorage[d]}catch(e){}if(typeof e===t)try{var i=window.document.cookie,r=i.indexOf(encodeURIComponent(d)+"=");-1!==r&&(e=/^([^;]+)/.exec(i.slice(r))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?d+=":"+e:"symbol"==typeof e&&(d=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=a||l,o.getLevel=function(){return s},o.setLevel=function(i,a){if("string"==typeof i&&void 0!==o.levels[i.toUpperCase()]&&(i=o.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(s=i,!1!==a&&function(e){var i=(r[e]||"silent").toUpperCase();if(typeof window!==t&&d){try{return void(window.localStorage[d]=i)}catch(e){}try{window.document.cookie=encodeURIComponent(d)+"="+i+";"}catch(e){}}}(i),n.call(o,i,e),typeof console===t&&i<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){i=e,u()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(i,!1),function(){if(typeof window!==t&&d){try{return void window.localStorage.removeItem(d)}catch(e){}try{window.document.cookie=encodeURIComponent(d)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var h=u();null==h&&(h=i),o.setLevel(h,!1)}var u=new d,h={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new d(e,u.getLevel(),u.methodFactory)),t};var c=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=c),u},u.getLoggers=function(){return h},u.default=u,u})?r.call(t,i,t,e):r)||(e.exports=a)},375:function(e,t){"use strict";var i=Object.prototype.hasOwnProperty;function r(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function a(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){var r,s,n=[];for(s in"string"!=typeof(t=t||"")&&(t="?"),e)if(i.call(e,s)){if((r=e[s])||null!=r&&!isNaN(r)||(r=""),s=a(s),r=a(r),null===s||null===r)continue;n.push(s+"="+r)}return n.length?t+n.join("&"):""},t.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,a={};t=i.exec(e);){var s=r(t[1]),n=r(t[2]);null===s||null===n||s in a||(a[s]=n)}return a}},558:function(){}},t={};function i(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}return i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i(80)}()},69275:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let r=i(82147);i(9885);let a=r._(i(52919));function s(e){return{default:(null==e?void 0:e.default)||e}}function n(e,t){let i=a.default,r={loading:e=>{let{error:t,isLoading:i,pastDelay:r}=e;return null}};"function"==typeof e&&(r.loader=e),Object.assign(r,t);let n=r.loader;return i({...r,loader:()=>null!=n?n().then(s):Promise.resolve(s(()=>null))})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},52919:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let r=i(82147),a=r._(i(9885)),s=i(42796),n=function(e){let t=Object.assign({loader:null,loading:null,ssr:!0},e);function i(e){let i=t.loading,r=a.default.createElement(i,{isLoading:!0,pastDelay:!0,error:null}),n=t.ssr?a.default.Fragment:s.NoSSR,o=t.lazy;return a.default.createElement(a.default.Suspense,{fallback:r},a.default.createElement(n,null,a.default.createElement(o,e)))}return t.lazy=a.default.lazy(t.loader),i.displayName="LoadableComponent",i}},40978:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(6557);let a=(0,r.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1013:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(6557);let a=(0,r.Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},60438:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(6557);let a=(0,r.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]])},72345:(e,t,i)=>{"use strict";let{createProxy:r}=i(17536);e.exports=r("/home/runner/work/Udemy-Clone/Udemy-Clone/node_modules/next/dist/client/link.js")},44602:(e,t,i)=>{"use strict";e.exports=i(72345)},15168:()=>{},24221:()=>{},68283:(e,t,i)=>{"use strict";let r,a,s,n,o;i.d(t,{Z:()=>f5});var l=i(9885);let d={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_ENTER_CAST_REQUEST:"mediaentercastrequest",MEDIA_EXIT_CAST_REQUEST:"mediaexitcastrequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",MEDIA_RENDITION_REQUEST:"mediarenditionrequest",MEDIA_AUDIO_TRACK_REQUEST:"mediaaudiotrackrequest",MEDIA_SEEK_TO_LIVE_REQUEST:"mediaseektoliverequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},u={MEDIA_CHROME_ATTRIBUTES:"mediachromeattributes",MEDIA_CONTROLLER:"mediacontroller"},h={MEDIA_AIRPLAY_UNAVAILABLE:"mediaAirplayUnavailable",MEDIA_FULLSCREEN_UNAVAILABLE:"mediaFullscreenUnavailable",MEDIA_PIP_UNAVAILABLE:"mediaPipUnavailable",MEDIA_CAST_UNAVAILABLE:"mediaCastUnavailable",MEDIA_RENDITION_UNAVAILABLE:"mediaRenditionUnavailable",MEDIA_AUDIO_TRACK_UNAVAILABLE:"mediaAudioTrackUnavailable",MEDIA_PAUSED:"mediaPaused",MEDIA_HAS_PLAYED:"mediaHasPlayed",MEDIA_ENDED:"mediaEnded",MEDIA_MUTED:"mediaMuted",MEDIA_VOLUME_LEVEL:"mediaVolumeLevel",MEDIA_VOLUME:"mediaVolume",MEDIA_VOLUME_UNAVAILABLE:"mediaVolumeUnavailable",MEDIA_IS_PIP:"mediaIsPip",MEDIA_IS_CASTING:"mediaIsCasting",MEDIA_SUBTITLES_LIST:"mediaSubtitlesList",MEDIA_SUBTITLES_SHOWING:"mediaSubtitlesShowing",MEDIA_IS_FULLSCREEN:"mediaIsFullscreen",MEDIA_PLAYBACK_RATE:"mediaPlaybackRate",MEDIA_CURRENT_TIME:"mediaCurrentTime",MEDIA_DURATION:"mediaDuration",MEDIA_SEEKABLE:"mediaSeekable",MEDIA_PREVIEW_TIME:"mediaPreviewTime",MEDIA_PREVIEW_IMAGE:"mediaPreviewImage",MEDIA_PREVIEW_COORDS:"mediaPreviewCoords",MEDIA_LOADING:"mediaLoading",MEDIA_BUFFERED:"mediaBuffered",MEDIA_STREAM_TYPE:"mediaStreamType",MEDIA_TARGET_LIVE_WINDOW:"mediaTargetLiveWindow",MEDIA_TIME_IS_LIVE:"mediaTimeIsLive",MEDIA_RENDITION_LIST:"mediaRenditionList",MEDIA_RENDITION_SELECTED:"mediaRenditionSelected",MEDIA_AUDIO_TRACK_LIST:"mediaAudioTrackList",MEDIA_AUDIO_TRACK_ENABLED:"mediaAudioTrackEnabled"},c=Object.entries(h),m=c.reduce((e,[t,i])=>(e[t]=`${i.toLowerCase()}`,e),{}),f=c.reduce((e,[t,i])=>(e[t]=`${i.toLowerCase()}`,e),{USER_INACTIVE:"userinactivechange",BREAKPOINTS_CHANGE:"breakpointchange",BREAKPOINTS_COMPUTED:"breakpointscomputed"});Object.entries(f).reduce((e,[t,i])=>{let r=m[t];return r&&(e[i]=r),e},{userinactivechange:"userinactive"});let p=Object.entries(m).reduce((e,[t,i])=>{let r=f[t];return r&&(e[i]=r),e},{userinactive:"userinactivechange"}),g={SUBTITLES:"subtitles",CAPTIONS:"captions",METADATA:"metadata"},v={DISABLED:"disabled",SHOWING:"showing"},E={MOUSE:"mouse",TOUCH:"touch"},b={UNAVAILABLE:"unavailable",UNSUPPORTED:"unsupported"},y={LIVE:"live",ON_DEMAND:"on-demand",UNKNOWN:"unknown"},T={AUDIO_PLAYER:()=>"audio player",VIDEO_PLAYER:()=>"video player",VOLUME:()=>"volume",SEEK:()=>"seek",CLOSED_CAPTIONS:()=>"closed captions",PLAYBACK_RATE:({playbackRate:e=1}={})=>`current playback rate ${e}`,PLAYBACK_TIME:()=>"playback time",MEDIA_LOADING:()=>"media loading"},A={PLAY:()=>"play",PAUSE:()=>"pause",MUTE:()=>"mute",UNMUTE:()=>"unmute",AIRPLAY:()=>"air play",ENTER_CAST:()=>"start casting",EXIT_CAST:()=>"stop casting",ENTER_FULLSCREEN:()=>"enter fullscreen mode",EXIT_FULLSCREEN:()=>"exit fullscreen mode",ENTER_PIP:()=>"enter picture in picture mode",EXIT_PIP:()=>"exit picture in picture mode",SEEK_FORWARD_N_SECS:({seekOffset:e=30}={})=>`seek forward ${e} seconds`,SEEK_BACK_N_SECS:({seekOffset:e=30}={})=>`seek back ${e} seconds`,SEEK_LIVE:()=>"seek to live",PLAYING_LIVE:()=>"playing live"};function _(e){if(e){let{id:t,width:i,height:r}=e;return[t,i,r].filter(e=>null!=e).join(":")}}function S(e){if(e){let[t,i,r]=e.split(":");return{id:t,width:i,height:r}}}function k(e){if(e){let{id:t,kind:i,language:r,label:a}=e;return[t,i,r,a].filter(e=>null!=e).join(":")}}function L(e){if(e){let[t,i,r,a]=e.split(":");return{id:t,kind:i,language:r,label:a}}}function I(e,t=!1){return e.split("_").map(function(e,i){return(i||t?e[0].toUpperCase():e[0].toLowerCase())+e.slice(1).toLowerCase()}).join("")}function R(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}let w=e=>new Promise(t=>setTimeout(t,e)),D=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],C=(e,t)=>{let i=1===e?D[t].singular:D[t].plural;return`${e} ${i}`},M=e=>{if(!function(e){return"number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e)}(e))return"";let t=Math.abs(e),i=t!==e,r=new Date(0,0,0,0,0,t,0),a=[r.getHours(),r.getMinutes(),r.getSeconds()],s=a.map((e,t)=>e&&C(e,t)).filter(e=>e).join(", ");return`${s}${i?" remaining":""}`};function x(e,t){let i=!1;e<0&&(i=!0,e=0-e);let r=Math.floor((e=e<0?0:e)%60),a=Math.floor(e/60%60),s=Math.floor(e/3600);return(isNaN(e)||e===1/0)&&(s=a=r="0"),a=(((s=s>0||Math.floor(t/3600)>0?s+":":"")||Math.floor(t/60%60)>=10)&&a<10?"0"+a:a)+":",(i?"-":"")+s+a+(r=r<10?"0"+r:r)}Object.freeze({length:0,start(e){let t=e>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(e){let t=e>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0}});let O=(e,t,i=".value")=>{let r=e.querySelector(i);r&&(r.textContent=t)},P=(e,t)=>{let i=`slot[name="${t}"]`,r=e.shadowRoot.querySelector(i);return r?r.children:[]},N=(e,t)=>P(e,t)[0],U=(e,t)=>!!e&&!!t&&(!!e.contains(t)||U(e,t.getRootNode().host)),F=(e,t)=>{if(!e)return null;let i=e.closest(t);return i||F(e.getRootNode().host,t)};function B(e,t){var i;let r;for(r of e.querySelectorAll("style")){let e;try{e=null==(i=r.sheet)?void 0:i.cssRules}catch{continue}for(let i of null!=e?e:[])if(i.selectorText===t)return i}return(null==r?void 0:r.sheet)?(r.sheet.insertRule(`${t}{}`,r.sheet.cssRules.length),r.sheet.cssRules[r.sheet.cssRules.length-1]):{style:{setProperty:()=>{},removeProperty:()=>{}}}}function $(e,t,i=Number.NaN){let r=e.getAttribute(t);return null!=r?+r:i}function V(e,t,i){let r=+i;if(null==i||Number.isNaN(r)){e.hasAttribute(t)&&e.removeAttribute(t);return}$(e,t,void 0)!==r&&e.setAttribute(t,`${r}`)}function H(e,t){return e.hasAttribute(t)}function G(e,t,i){if(null==i){e.hasAttribute(t)&&e.removeAttribute(t);return}H(e,t)!=i&&e.toggleAttribute(t,i)}function W(e,t,i=null){var r;return null!=(r=e.getAttribute(t))?r:i}function K(e,t,i){if(null==i){e.hasAttribute(t)&&e.removeAttribute(t);return}let r=`${i}`;W(e,t,void 0)!==r&&e.setAttribute(t,r)}class q{addEventListener(){}removeEventListener(){}dispatchEvent(){return!0}}let j={createElement:function(){return new Y.HTMLElement},addEventListener(){},removeEventListener(){}},Y={ResizeObserver:class{observe(){}unobserve(){}disconnect(){}},document:j,HTMLElement:class extends q{},DocumentFragment:class extends q{},customElements:{get:function(){},define:function(){},whenDefined:function(){}},CustomEvent:function(){},getComputedStyle:function(){}},z="undefined"==typeof window||void 0===window.customElements,X=Object.keys(Y).every(e=>e in globalThis),Q=z&&!X?Y:globalThis,Z=z&&!X?j:globalThis.document;var J=Object.defineProperty,ee=(e,t,i)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,et=(e,t,i)=>(ee(e,"symbol"!=typeof t?t+"":t,i),i),ei=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},er=(e,t,i)=>(ei(e,t,"read from private field"),i?i.call(e):t.get(e)),ea=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},es=(e,t,i,r)=>(ei(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let en=Z.createElement("template");en.innerHTML=`
<style>
  :host {
    font: var(--media-font,
      var(--media-font-weight, bold)
      var(--media-font-size, 14px) /
      var(--media-text-content-height, var(--media-control-height, 24px))
      var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
    color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
    background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));
    padding: var(--media-control-padding, 10px);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    box-sizing: border-box;
    transition: background .15s linear;
    pointer-events: auto;
    cursor: pointer;
  }

  
  :host(:focus-visible) {
    box-shadow: inset 0 0 0 2px rgb(27 127 204 / .9);
    outline: 0;
  }
  
  :host(:where(:focus)) {
    box-shadow: none;
    outline: 0;
  }

  :host(:hover) {
    background: var(--media-control-hover-background, rgba(50 50 70 / .7));
  }

  svg, img, ::slotted(svg), ::slotted(img) {
    width: var(--media-button-icon-width);
    height: var(--media-button-icon-height, var(--media-control-height, 24px));
    transform: var(--media-button-icon-transform);
    transition: var(--media-button-icon-transition);
    fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
    vertical-align: middle;
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
  }
</style>
`;class eo extends Q.HTMLElement{constructor(e={}){if(super(),ea(this,lP,void 0),et(this,"preventClick",!1),ea(this,lN,e=>{this.preventClick||this.handleClick(e)}),ea(this,lU,e=>{let{key:t}=e;if(!this.keysUsed.includes(t)){this.removeEventListener("keyup",er(this,lU));return}this.preventClick||this.handleClick(e)}),ea(this,lF,e=>{let{metaKey:t,altKey:i,key:r}=e;if(t||i||!this.keysUsed.includes(r)){this.removeEventListener("keyup",er(this,lU));return}this.addEventListener("keyup",er(this,lU),{once:!0})}),!this.shadowRoot){this.attachShadow({mode:"open"});let t=en.content.cloneNode(!0);this.nativeEl=t;let i=e.slotTemplate;i||((i=Z.createElement("template")).innerHTML=`<slot>${e.defaultContent||""}</slot>`),this.nativeEl.appendChild(i.content.cloneNode(!0)),this.shadowRoot.appendChild(t)}let{style:t}=B(this.shadowRoot,":host");t.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`)}static get observedAttributes(){return["disabled",u.MEDIA_CONTROLLER]}enable(){this.addEventListener("click",er(this,lN)),this.addEventListener("keydown",er(this,lF)),this.tabIndex=0}disable(){this.removeEventListener("click",er(this,lN)),this.removeEventListener("keydown",er(this,lF)),this.removeEventListener("keyup",er(this,lU)),this.tabIndex=-1}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===u.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=er(this,lP))?void 0:r.unassociateElement)||a.call(r,this),es(this,lP,null)),i&&(es(this,lP,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=er(this,lP))?void 0:n.associateElement)||o.call(n,this))):"disabled"===e&&i!==t&&(null==i?this.enable():this.disable())}connectedCallback(){var e,t,i;this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","button");let r=this.getAttribute(u.MEDIA_CONTROLLER);r&&(es(this,lP,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=er(this,lP))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;this.disable(),null==(t=null==(e=er(this,lP))?void 0:e.unassociateElement)||t.call(e,this),es(this,lP,null)}get keysUsed(){return["Enter"," "]}handleClick(e){}}lP=new WeakMap,lN=new WeakMap,lU=new WeakMap,lF=new WeakMap,Q.customElements.get("media-chrome-button")||Q.customElements.define("media-chrome-button",eo);let el=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.13 3H3.87a.87.87 0 0 0-.87.87v13.26a.87.87 0 0 0 .87.87h3.4L9 16H5V5h16v11h-4l1.72 2h3.4a.87.87 0 0 0 .87-.87V3.87a.87.87 0 0 0-.86-.87Zm-8.75 11.44a.5.5 0 0 0-.76 0l-4.91 5.73a.5.5 0 0 0 .38.83h9.82a.501.501 0 0 0 .38-.83l-4.91-5.73Z"/>
</svg>
`,ed=Z.createElement("template");ed.innerHTML=`
  <slot name="icon">${el}</slot>
`,Q.customElements.get("media-airplay-button")||Q.customElements.define("media-airplay-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_AIRPLAY_UNAVAILABLE]}constructor(e={}){super({slotTemplate:ed,...e})}connectedCallback(){this.setAttribute("aria-label",A.AIRPLAY()),super.connectedCallback()}get mediaAirplayUnavailable(){return W(this,m.MEDIA_AIRPLAY_UNAVAILABLE)}set mediaAirplayUnavailable(e){K(this,m.MEDIA_AIRPLAY_UNAVAILABLE,e)}handleClick(){let e=new Q.CustomEvent(d.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(e)}});let eu=Z.createElement("template");eu.innerHTML=`
  <style>
  :host([${m.MEDIA_IS_CASTING}]) slot:not([name=exit]):not([name=icon]) {
    display: none !important;
  }

  
  :host(:not([${m.MEDIA_IS_CASTING}])) slot:not([name=enter]):not([name=icon]) {
    display: none !important;
  }
  </style>

  <slot name="icon">
    <slot name="enter"><svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/></g></svg></slot>
    <slot name="exit"><svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/><path class="cast_caf_icon_boxfill" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"/></g></svg></slot>
  </slot>
`;let eh=e=>{let t=null!=e.getAttribute(m.MEDIA_IS_CASTING),i=t?A.EXIT_CAST():A.ENTER_CAST();e.setAttribute("aria-label",i)};Q.customElements.get("media-cast-button")||Q.customElements.define("media-cast-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_IS_CASTING,m.MEDIA_CAST_UNAVAILABLE]}constructor(e={}){super({slotTemplate:eu,...e})}connectedCallback(){eh(this),super.connectedCallback()}attributeChangedCallback(e,t,i){e===m.MEDIA_IS_CASTING&&eh(this),super.attributeChangedCallback(e,t,i)}get mediaIsCasting(){return H(this,m.MEDIA_IS_CASTING)}set mediaIsCasting(e){G(this,m.MEDIA_IS_CASTING,e)}get mediaCastUnavailable(){return W(this,m.MEDIA_CAST_UNAVAILABLE)}set mediaCastUnavailable(e){K(this,m.MEDIA_CAST_UNAVAILABLE,e)}handleClick(){let e=this.mediaIsCasting?d.MEDIA_EXIT_CAST_REQUEST:d.MEDIA_ENTER_CAST_REQUEST;this.dispatchEvent(new Q.CustomEvent(e,{composed:!0,bubbles:!0}))}});var ec=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},em=(e,t,i)=>(ec(e,t,"read from private field"),i?i.call(e):t.get(e)),ef=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},ep=(e,t,i,r)=>(ec(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let eg=Z.createElement("template");eg.innerHTML=`
<style>
  :host {
    display: var(--media-control-display, var(--media-gesture-receiver-display, inline-block));
    box-sizing: border-box;
  }
</style>
`;class ev extends Q.HTMLElement{constructor(e={}){if(super(),ef(this,lB,void 0),!this.shadowRoot){let t=this.attachShadow({mode:"open"}),i=eg.content.cloneNode(!0);this.nativeEl=i;let r=e.slotTemplate;r||((r=Z.createElement("template")).innerHTML=`<slot>${e.defaultContent||""}</slot>`),this.nativeEl.appendChild(r.content.cloneNode(!0)),t.appendChild(i)}}static get observedAttributes(){return[u.MEDIA_CONTROLLER,m.MEDIA_PAUSED]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===u.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=em(this,lB))?void 0:r.unassociateElement)||a.call(r,this),ep(this,lB,null)),i&&(ep(this,lB,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=em(this,lB))?void 0:n.associateElement)||o.call(n,this)))}connectedCallback(){var e,t,i,r;this.tabIndex=-1,this.setAttribute("aria-hidden","true"),ep(this,lB,function(e){var t;let i=e.getAttribute(u.MEDIA_CONTROLLER);return i?null==(t=e.getRootNode())?void 0:t.getElementById(i):F(e,"media-controller")}(this)),this.getAttribute(u.MEDIA_CONTROLLER)&&(null==(t=null==(e=em(this,lB))?void 0:e.associateElement)||t.call(e,this)),null==(i=em(this,lB))||i.addEventListener("pointerdown",this),null==(r=em(this,lB))||r.addEventListener("click",this)}disconnectedCallback(){var e,t,i,r;this.getAttribute(u.MEDIA_CONTROLLER)&&(null==(t=null==(e=em(this,lB))?void 0:e.unassociateElement)||t.call(e,this)),null==(i=em(this,lB))||i.removeEventListener("pointerdown",this),null==(r=em(this,lB))||r.removeEventListener("click",this),ep(this,lB,null)}handleEvent(e){var t;let i=null==(t=e.composedPath())?void 0:t[0];if(["video","media-controller"].includes(null==i?void 0:i.localName)){if("pointerdown"===e.type)this._pointerType=e.pointerType;else if("click"===e.type){let{clientX:t,clientY:i}=e,{left:r,top:a,width:s,height:n}=this.getBoundingClientRect(),o=t-r,l=i-a;if(o<0||l<0||o>s||l>n||0===s&&0===n)return;let{pointerType:d=this._pointerType}=e;if(this._pointerType=void 0,d===E.TOUCH){this.handleTap(e);return}if(d===E.MOUSE){this.handleMouseClick(e);return}}}}get mediaPaused(){return H(this,m.MEDIA_PAUSED)}set mediaPaused(e){G(this,m.MEDIA_PAUSED,e)}handleTap(e){}handleMouseClick(e){let t=this.mediaPaused?d.MEDIA_PLAY_REQUEST:d.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new Q.CustomEvent(t,{composed:!0,bubbles:!0}))}}lB=new WeakMap,Q.customElements.get("media-gesture-receiver")||Q.customElements.define("media-gesture-receiver",ev);var eE=Object.defineProperty,eb=(e,t,i)=>t in e?eE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ey=(e,t,i)=>(eb(e,"symbol"!=typeof t?t+"":t,i),i);let eT={AUDIO:"audio",AUTOHIDE:"autohide",BREAKPOINTS:"breakpoints",GESTURES_DISABLED:"gesturesdisabled",KEYBOARD_CONTROL:"keyboardcontrol",NO_AUTOHIDE:"noautohide",USER_INACTIVE:"userinactive"},eA=Z.createElement("template");eA.innerHTML=`
  <style>
    
    :host([${m.MEDIA_IS_FULLSCREEN}]) ::slotted([slot=media]) {
      outline: none;
    }

    :host {
      box-sizing: border-box;
      position: relative;
      display: inline-block;
      line-height: 0;
      background-color: var(--media-background-color, #000);
    }

    :host(:not([${eT.AUDIO}])) [part~=layer]:not([part~=media-layer]) {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      display: flex;
      flex-flow: column nowrap;
      align-items: start;
      pointer-events: none;
      background: none;
    }

    slot[name=media] {
      display: var(--media-slot-display, contents);
    }

    
    :host([${eT.AUDIO}]) slot[name=media] {
      display: var(--media-slot-display, none);
    }

    
    :host([${eT.AUDIO}]) [part~=layer][part~=gesture-layer] {
      height: 0;
      display: block;
    }

    
    :host(:not([${eT.AUDIO}])[${eT.GESTURES_DISABLED}]) ::slotted([slot=gestures-chrome]),
    :host(:not([${eT.AUDIO}])[${eT.GESTURES_DISABLED}]) media-gesture-receiver[slot=gestures-chrome] {
      display: none;
    }

    
    ::slotted(:not([slot=media]):not([slot=poster]):not(media-loading-indicator)) {
      pointer-events: auto;
    }

    :host(:not([${eT.AUDIO}])) *[part~=layer][part~=centered-layer] {
      align-items: center;
      justify-content: center;
    }

    :host(:not([${eT.AUDIO}])) ::slotted(media-gesture-receiver[slot=gestures-chrome]),
    :host(:not([${eT.AUDIO}])) media-gesture-receiver[slot=gestures-chrome] {
      align-self: stretch;
      flex-grow: 1;
    }

    slot[name=middle-chrome] {
      display: inline;
      flex-grow: 1;
      pointer-events: none;
      background: none;
    }

    
    ::slotted([slot=media]),
    ::slotted([slot=poster]) {
      width: 100%;
      height: 100%;
    }

    
    :host(:not([${eT.AUDIO}])) .spacer {
      flex-grow: 1;
    }

    
    :host(:-webkit-full-screen) {
      
      width: 100% !important;
      height: 100% !important;
    }

    
    ::slotted(:not([slot=media]):not([${eT.NO_AUTOHIDE}])) {
      opacity: 1;
      transition: opacity 0.25s;
    }

    
    :host([${eT.USER_INACTIVE}]:not([${m.MEDIA_PAUSED}]):not([${m.MEDIA_IS_CASTING}]):not([${eT.AUDIO}])) ::slotted(:not([slot=media]):not([${eT.NO_AUTOHIDE}])) {
      opacity: 0;
      transition: opacity 1s;
    }

    ::slotted(media-control-bar)  {
      align-self: stretch;
    }

    
    :host(:not([${eT.AUDIO}])[${m.MEDIA_HAS_PLAYED}]) slot[name=poster] {
      display: none;
    }
  </style>

  <slot name="media" part="layer media-layer"></slot>
  <slot name="poster" part="layer poster-layer"></slot>
  <slot name="gestures-chrome" part="layer gesture-layer">
    <media-gesture-receiver slot="gestures-chrome"></media-gesture-receiver>
  </slot>
  <span part="layer vertical-layer">
    <slot name="top-chrome" part="top chrome"></slot>
    <slot name="middle-chrome" part="middle chrome"></slot>
    <slot name="centered-chrome" part="layer centered-layer center centered chrome"></slot>
    
    <slot part="bottom chrome"></slot>
  </span>
`;let e_=Object.values(m);class eS extends Q.HTMLElement{constructor(){super(),ey(this,"breakpointsComputed",!1),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(eA.content.cloneNode(!0)));let e=new MutationObserver(e=>{let t=this.media;for(let i of e)"childList"===i.type&&(i.removedNodes.forEach(e=>{if("media"==e.slot&&i.target==this){let r=i.previousSibling&&i.previousSibling.previousElementSibling;if(r&&t){let t="media"!==r.slot;for(;null!==(r=r.previousSibling);)"media"==r.slot&&(t=!1);t&&this.mediaUnsetCallback(e)}else this.mediaUnsetCallback(e)}}),t&&i.addedNodes.forEach(e=>{e==t&&this.handleMediaUpdated(t).then(e=>this.mediaSetCallback(e))}))});e.observe(this,{childList:!0,subtree:!0});let t=!1,i=new ResizeObserver(e=>{t||(setTimeout(()=>{(function(e){for(let t of e)(function(e,t){var i;if(!e.isConnected)return;let r=null!=(i=e.getAttribute(eT.BREAKPOINTS))?i:"sm:384 md:576 lg:768 xl:960",a=function(e){let t=e.split(/\s+/);return Object.fromEntries(t.map(e=>e.split(":")))}(r),s=function(e,t){return Object.keys(e).filter(i=>t>=e[i])}(a,t),n=!1;if(Object.keys(a).forEach(t=>{if(s.includes(t)){e.hasAttribute(`breakpoint${t}`)||(e.setAttribute(`breakpoint${t}`,""),n=!0);return}e.hasAttribute(`breakpoint${t}`)&&(e.removeAttribute(`breakpoint${t}`),n=!0)}),n){let t=new CustomEvent(f.BREAKPOINTS_CHANGE,{detail:s});e.dispatchEvent(t)}})(t.target,t.contentRect.width)})(e),t=!1,this.breakpointsComputed||(this.breakpointsComputed=!0,this.dispatchEvent(new CustomEvent(f.BREAKPOINTS_COMPUTED,{bubbles:!0,composed:!0})))},0),t=!0)});this.resizeObserver=i,i.observe(this);let r=this.media,a=this.querySelector(":scope > slot[slot=media]");a&&a.addEventListener("slotchange",()=>{let e=a.assignedElements({flatten:!0});if(!e.length){this.mediaUnsetCallback(r);return}this.media&&(r=this.media,this.handleMediaUpdated(this.media).then(e=>this.mediaSetCallback(e)))})}static get observedAttributes(){return[eT.AUTOHIDE,eT.GESTURES_DISABLED].concat(e_).filter(e=>![m.MEDIA_RENDITION_LIST,m.MEDIA_AUDIO_TRACK_LIST].includes(e))}attributeChangedCallback(e,t,i){e.toLowerCase()==eT.AUTOHIDE&&(this.autohide=i)}get media(){let e=this.querySelector(":scope > [slot=media]");return(null==e?void 0:e.nodeName)=="SLOT"&&(e=e.assignedElements({flatten:!0})[0]),e}mediaSetCallback(e){this._mediaClickPlayToggle=()=>{let t=e.paused?d.MEDIA_PLAY_REQUEST:d.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new Q.CustomEvent(t,{composed:!0,bubbles:!0}))}}handleMediaUpdated(e){let t=e=>Promise.resolve(e);if(!e)return console.error('<media-chrome>: Media element set with slot="media" does not appear to be compatible.',e),Promise.reject(e);let i=e.nodeName.toLowerCase();return i.includes("-")?Q.customElements.whenDefined(i).then(()=>t(e)):t(e)}mediaUnsetCallback(e){}connectedCallback(){var e;let t=null!=this.getAttribute(eT.AUDIO),i=t?T.AUDIO_PLAYER():T.VIDEO_PLAYER();this.setAttribute("role","region"),this.setAttribute("aria-label",i),this.media&&this.handleMediaUpdated(this.media).then(e=>this.mediaSetCallback(e)),this.setAttribute(eT.USER_INACTIVE,"");let r=()=>{if(this.autohide<0||this.hasAttribute(eT.USER_INACTIVE))return;this.setAttribute(eT.USER_INACTIVE,"");let e=new Q.CustomEvent(f.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!0});this.dispatchEvent(e)},a=()=>{if(!this.hasAttribute(eT.USER_INACTIVE))return;this.removeAttribute(eT.USER_INACTIVE);let e=new Q.CustomEvent(f.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!1});this.dispatchEvent(e)},s=()=>{a(),clearTimeout(this._inactiveTimeout),this.autohide<0||(this._inactiveTimeout=setTimeout(()=>{r()},1e3*this.autohide))};this.addEventListener("keyup",()=>{s()}),this.addEventListener("pointerup",e=>{"touch"===e.pointerType?[this,this.media].includes(e.target)&&!this.hasAttribute(eT.USER_INACTIVE)?r():s():e.composedPath().some(e=>{var t;return["media-play-button","media-fullscreen-button"].includes(null==(t=null==e?void 0:e.nodeName)?void 0:t.toLowerCase())})&&s()}),this.addEventListener("pointermove",e=>{"mouse"===e.pointerType&&(a(),clearTimeout(this._inactiveTimeout),[this,this.media].includes(e.target)&&s())}),this.addEventListener("mouseleave",()=>{r()}),this.addEventListener("keyup",()=>{this.setAttribute(eT.KEYBOARD_CONTROL,"")}),null==(e=Q.window)||e.addEventListener("mouseup",()=>{this.removeAttribute(eT.KEYBOARD_CONTROL)})}set autohide(e){e=Number(e),this._autohide=isNaN(e)?0:e}get autohide(){return void 0===this._autohide?2:this._autohide}}var ek=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},eL=(e,t,i)=>(ek(e,t,"read from private field"),i?i.call(e):t.get(e)),eI=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},eR=(e,t,i,r)=>(ek(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);class ew{constructor(e,t,{defaultValue:i}={defaultValue:void 0}){eI(this,lW),eI(this,l$,void 0),eI(this,lV,void 0),eI(this,lH,void 0),eI(this,lG,new Set),eR(this,l$,e),eR(this,lV,t),eR(this,lH,new Set(i))}[Symbol.iterator](){return eL(this,lW,lK).values()}get length(){return eL(this,lW,lK).size}get value(){var e;return null!=(e=[...eL(this,lW,lK)].join(" "))?e:""}set value(e){var t;e!==this.value&&(eR(this,lG,new Set),this.add(...null!=(t=null==e?void 0:e.split(" "))?t:[]))}toString(){return this.value}item(e){return[...eL(this,lW,lK)][e]}values(){return eL(this,lW,lK).values()}forEach(e){eL(this,lW,lK).forEach(e)}add(...e){var t,i;e.forEach(e=>eL(this,lG).add(e)),(""!==this.value||(null==(t=eL(this,l$))?void 0:t.hasAttribute(`${eL(this,lV)}`)))&&(null==(i=eL(this,l$))||i.setAttribute(`${eL(this,lV)}`,`${this.value}`))}remove(...e){var t;e.forEach(e=>eL(this,lG).delete(e)),null==(t=eL(this,l$))||t.setAttribute(`${eL(this,lV)}`,`${this.value}`)}contains(e){return eL(this,lW,lK).has(e)}toggle(e,t){return void 0!==t?t?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,t){return this.remove(e),this.add(t),e===t}}l$=new WeakMap,lV=new WeakMap,lH=new WeakMap,lG=new WeakMap,lW=new WeakSet,lK=function(){return eL(this,lG).size?eL(this,lG):eL(this,lH)};let eD=(e="")=>e.split(/\s+/),eC=(e="")=>{let[t,i,r]=e.split(":"),a=r?decodeURIComponent(r):void 0;return{kind:t="cc"===t?"captions":"subtitles",language:i,label:a}},eM=(e="",t={})=>eD(e).map(e=>{let i=eC(e);return{...t,...i}}),ex=e=>Array.isArray(e)?e.map(e=>"string"==typeof e?eC(e):e):"string"==typeof e?eM(e):[e],eO=({kind:e,label:t,language:i}={kind:"subtitles"})=>t?`${"captions"===e?"cc":"sb"}:${i}:${encodeURIComponent(t)}`:i,eP=(e=[])=>Array.prototype.map.call(e,eO).join(" "),eN=(e,t)=>i=>i[e]===t,eU=e=>{let t=Object.entries(e).map(([e,t])=>eN(e,t));return e=>t.every(t=>t(e))},eF=(e,t=[],i=[])=>{let r=ex(i).map(eU);Array.from(t).filter(e=>r.some(t=>t(e))).forEach(t=>{t.mode=e})},eB=(e,t=()=>!0)=>{if(!(null==e?void 0:e.textTracks))return[];let i="function"==typeof t?t:eU(t);return Array.from(e.textTracks).filter(i)},e$=e=>{let t=!!e.getAttribute(m.MEDIA_SUBTITLES_SHOWING);return t},eV=(e,t)=>{var i,r;let a=e$(e);if(a||!1===t){let t=e.getAttribute(m.MEDIA_SUBTITLES_SHOWING);if(t){let i=new Q.CustomEvent(d.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:t});e.dispatchEvent(i)}}else if(a&&!0!==t)console.error("Attempting to enable captions or subtitles but none are available! Please verify your media content if this is unexpected.");else{let[t]=null!=(r=eD(null!=(i=e.getAttribute(m.MEDIA_SUBTITLES_LIST))?i:""))?r:[];if(t){let i=new Q.CustomEvent(d.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:t});e.dispatchEvent(i)}}},eH={enter:"requestFullscreen",exit:"exitFullscreen",rootEvents:["fullscreenchange"],mediaEvents:[],element:"fullscreenElement",error:"fullscreenerror",enabled:"fullscreenEnabled"};void 0===Z.fullscreenElement&&(eH.enter="webkitRequestFullScreen",eH.exit=null!=Z.webkitExitFullscreen?"webkitExitFullscreen":"webkitCancelFullScreen",eH.rootEvents=["webkitfullscreenchange"],eH.mediaEvents=["webkitbeginfullscreen","webkitendfullscreen"],eH.element="webkitFullscreenElement",eH.error="webkitfullscreenerror",eH.enabled="webkitFullscreenEnabled");let eG=()=>{var e;return r||(r=null==(e=null==Z?void 0:Z.createElement)?void 0:e.call(Z,"video"))},eW=async(e=eG())=>{if(!e)return!1;let t=e.volume;return e.volume=t/2+.1,await w(0),e.volume!==t},eK=((e=eG())=>{let t=Z[eH.enabled];return!t&&e&&(t="webkitSupportsFullscreen"in e),t})(),eq=((e=eG())=>"function"==typeof(null==e?void 0:e.requestPictureInPicture))(),ej=!!Q.WebKitPlaybackTargetAvailabilityEvent,eY=!!Q.chrome,ez=eW().then(e=>a=e),eX=Object.values(y),eQ=e=>eB(e.media,e=>[g.SUBTITLES,g.CAPTIONS].includes(e.kind)).sort((e,t)=>e.kind>=t.kind?1:-1),eZ=e=>eB(e.media,e=>e.mode===v.SHOWING&&[g.SUBTITLES,g.CAPTIONS].includes(e.kind)),eJ={MEDIA_PAUSED:{get:function(e){let{media:t}=e;return!t||t.paused},mediaEvents:["play","playing","pause","emptied"]},MEDIA_HAS_PLAYED:{get:function(e){let{media:t}=e;return!!t&&!t.paused},mediaEvents:["playing","emptied"]},MEDIA_ENDED:{get:function(e){let{media:t}=e;return!!t&&t.ended},mediaEvents:["seeked","ended","emptied"]},MEDIA_PLAYBACK_RATE:{get:function(e){let{media:t}=e;return t&&void 0!==t.playbackRate?t.playbackRate:1},mediaEvents:["ratechange","loadstart"]},MEDIA_MUTED:{get:function(e){let{media:t}=e;return!!t&&void 0!==t.muted&&t.muted},mediaEvents:["volumechange"]},MEDIA_VOLUME:{get:function(e){let{media:t}=e;return t&&void 0!==t.volume?Number(t.volume):1},mediaEvents:["volumechange"]},MEDIA_VOLUME_LEVEL:{get:function(e){let{media:t}=e,i="high";if(!t||void 0===t.volume)return i;let{muted:r,volume:a}=t;return 0===a||r?i="off":a<.5?i="low":a<.75&&(i="medium"),i},mediaEvents:["volumechange"]},MEDIA_CURRENT_TIME:{get:function(e){let{media:t}=e;return t&&void 0!==t.currentTime?t.currentTime:0},mediaEvents:["timeupdate","loadedmetadata"]},MEDIA_DURATION:{get:function(e){let{media:t}=e;return t&&Number.isFinite(t.duration)?t.duration:NaN},mediaEvents:["durationchange","loadedmetadata","emptied"]},MEDIA_SEEKABLE:{get:function(e){var t;let{media:i}=e;if(!(null==(t=null==i?void 0:i.seekable)?void 0:t.length))return;let r=i.seekable.start(0),a=i.seekable.end(i.seekable.length-1);if(r||a)return[Number(r.toFixed(3)),Number(a.toFixed(3))]},mediaEvents:["loadedmetadata","emptied","progress"]},MEDIA_LOADING:{get:function(e){var t;return(null==(t=e.media)?void 0:t.readyState)<3},mediaEvents:["waiting","playing","emptied"]},MEDIA_BUFFERED:{get:function(e){var t,i,r;let a=null==(t=e.media)?void 0:t.buffered;return Array.from(null!=(r=null==(i=e.media)?void 0:i.buffered)?r:[]).map((e,t)=>[Number(a.start(t)).toFixed(3),Number(a.end(t)).toFixed(3)])},mediaEvents:["progress","emptied"]},MEDIA_STREAM_TYPE:{get:function(e){let{media:t}=e;if(!t)return;let{streamType:i}=t;if(eX.includes(i)){if(i===y.UNKNOWN){let t=e.getAttribute("defaultstreamtype");return[y.LIVE,y.ON_DEMAND].includes(t)?t:void 0}return i}let r=t.duration;if(r===1/0)return y.LIVE;if(Number.isFinite(r))return y.ON_DEMAND;{let t=e.getAttribute("defaultstreamtype");if([y.LIVE,y.ON_DEMAND].includes(t))return t}},mediaEvents:["emptied","durationchange","loadedmetadata","streamtypechange"]},MEDIA_TARGET_LIVE_WINDOW:{get:function(e){let{media:t}=e;if(!t)return Number.NaN;let{targetLiveWindow:i}=t,r=eJ.MEDIA_STREAM_TYPE.get(e);return(null==i||Number.isNaN(i))&&r===y.LIVE?0:i},mediaEvents:["emptied","durationchange","loadedmetadata","streamtypechange","targetlivewindowchange"]},MEDIA_TIME_IS_LIVE:{get:function(e){let{media:t}=e;if(!t)return!1;if("number"==typeof t.liveEdgeStart)return!Number.isNaN(t.liveEdgeStart)&&t.currentTime>=t.liveEdgeStart;let i="live"===eJ.MEDIA_STREAM_TYPE.get(e);if(!i)return!1;let r=t.seekable;if(!r)return!0;if(!r.length)return!1;let a=e.hasAttribute("liveedgeoffset")?Number(e.getAttribute("liveedgeoffset")):10,s=r.end(r.length-1)-a;return t.currentTime>=s},mediaEvents:["playing","timeupdate","progress","waiting","emptied"]},MEDIA_IS_FULLSCREEN:{get:function(e,t){var i;let r;let a=e.media;if(a&&void 0===Z[eH.element]&&"webkitDisplayingFullscreen"in a)return a.webkitDisplayingFullscreen&&"fullscreen"===a.webkitPresentationMode;if(t){let e=Z[eH.element];r=e?t.target:null}else r=null!=(i=e.getRootNode().fullscreenElement)?i:Z[eH.element];return U(e.fullscreenElement,r)},rootEvents:eH.rootEvents,mediaEvents:eH.mediaEvents},MEDIA_IS_PIP:{get:function(e,t){var i;let r=e.media;if(!r)return!1;if(t)return"enterpictureinpicture"==t.type;{let t=null!=(i=e.getRootNode().pictureInPictureElement)?i:Z.pictureInPictureElement;return U(r,t)}},mediaEvents:["enterpictureinpicture","leavepictureinpicture"]},MEDIA_IS_CASTING:{get:function(e,t){var i;let{media:r}=e;if(!r)return!1;let a=null==(i=Q.CastableVideoElement)?void 0:i.castElement,s=U(r,a);return(null==t?void 0:t.type)==="castchange"&&(null==t?void 0:t.detail)==="CONNECTING"&&(s="connecting"),s},mediaEvents:["entercast","leavecast","castchange"]},MEDIA_AIRPLAY_UNAVAILABLE:{get:function(e,t){if(!ej)return b.UNSUPPORTED;if(t){if("available"===t.availability)return;if("not-available"===t.availability)return b.UNAVAILABLE}},mediaEvents:["webkitplaybacktargetavailabilitychanged"]},MEDIA_CAST_UNAVAILABLE:{get:function(){var e;let t=null==(e=Q.CastableVideoElement)?void 0:e.castState;return eY&&t?t.includes("CONNECT")?void 0:b.UNAVAILABLE:b.UNSUPPORTED},mediaEvents:["castchange"]},MEDIA_FULLSCREEN_UNAVAILABLE:{get:function(){return eK?void 0:b.UNAVAILABLE}},MEDIA_PIP_UNAVAILABLE:{get:function(){return eq?void 0:b.UNSUPPORTED}},MEDIA_RENDITION_UNAVAILABLE:{get:function(e){var t;let{media:i}=e;return(null==i?void 0:i.videoRenditions)?(null==(t=i.videoRenditions)?void 0:t.length)?void 0:b.UNAVAILABLE:b.UNSUPPORTED},mediaEvents:["emptied","loadstart"],videoRenditionsEvents:["addrendition","removerendition"]},MEDIA_AUDIO_TRACK_UNAVAILABLE:{get:function(e){var t,i;let{media:r}=e;return(null==r?void 0:r.audioTracks)?(null!=(i=null==(t=r.audioTracks)?void 0:t.length)?i:0)<=1?b.UNAVAILABLE:void 0:b.UNSUPPORTED},mediaEvents:["emptied","loadstart"],audioTracksEvents:["addtrack","removetrack"]},MEDIA_VOLUME_UNAVAILABLE:{get:function(e){if(void 0!==a&&!a)return b.UNSUPPORTED;let{media:t}=e;if(t&&void 0===t.volume)return b.UNAVAILABLE},mediaEvents:["loadstart"]},MEDIA_SUBTITLES_LIST:{get:function(e){return eQ(e).map(({kind:e,label:t,language:i})=>({kind:e,label:t,language:i}))},mediaEvents:["loadstart"],textTracksEvents:["addtrack","removetrack"]},MEDIA_SUBTITLES_SHOWING:{get:function(e){return!e.hasAttribute("defaultsubtitles")||e.hasAttribute(m.MEDIA_HAS_PLAYED)||e.hasAttribute(m.MEDIA_SUBTITLES_SHOWING)||eV(e,!0),eZ(e).map(({kind:e,label:t,language:i})=>({kind:e,label:t,language:i}))},mediaEvents:["loadstart"],textTracksEvents:["addtrack","removetrack","change"]},MEDIA_RENDITION_LIST:{get:function(e){var t;let{media:i}=e;return[...null!=(t=null==i?void 0:i.videoRenditions)?t:[]]},mediaEvents:["emptied","loadstart"],videoRenditionsEvents:["addrendition","removerendition"]},MEDIA_RENDITION_SELECTED:{get:function(e){var t,i,r;let{media:a}=e;return null==(r=null==(i=null==a?void 0:a.videoRenditions)?void 0:i[null==(t=a.videoRenditions)?void 0:t.selectedIndex])?void 0:r.id},mediaEvents:["emptied"],videoRenditionsEvents:["addrendition","removerendition","change"]},MEDIA_AUDIO_TRACK_LIST:{get:function(e){var t;let{media:i}=e;return[...null!=(t=null==i?void 0:i.audioTracks)?t:[]]},mediaEvents:["emptied","loadstart"],audioTracksEvents:["addtrack","removetrack"]},MEDIA_AUDIO_TRACK_ENABLED:{get:function(e){var t,i;let{media:r}=e;return null==(i=[...null!=(t=null==r?void 0:r.audioTracks)?t:[]].find(e=>e.enabled))?void 0:i.id},mediaEvents:["emptied"],audioTracksEvents:["addtrack","removetrack","change"]}},e0={MEDIA_PLAY_REQUEST:(e,t,i)=>{var r;let a=eJ.MEDIA_STREAM_TYPE.get(i),s=null===i.getAttribute("noautoseektolive");a==y.LIVE&&s&&e0.MEDIA_SEEK_TO_LIVE_REQUEST(e),null==(r=e.play())||r.catch(()=>{})},MEDIA_PAUSE_REQUEST:e=>e.pause(),MEDIA_MUTE_REQUEST:e=>e.muted=!0,MEDIA_UNMUTE_REQUEST:e=>{e.muted=!1,0===e.volume&&(e.volume=.25)},MEDIA_VOLUME_REQUEST:(e,t,i)=>{let r=t.detail;if(e.volume=r,r>0&&e.muted&&(e.muted=!1),!i.hasAttribute("novolumepref"))try{Q.localStorage.setItem("media-chrome-pref-volume",r.toString())}catch(e){}},MEDIA_ENTER_FULLSCREEN_REQUEST:(e,t,i)=>{if(!eK){console.warn("Fullscreen support is unavailable; not entering fullscreen");return}Z.pictureInPictureElement&&Z.exitPictureInPicture(),i[eH.enter]?i.fullscreenElement[eH.enter]():e.webkitEnterFullscreen?e.webkitEnterFullscreen():e.requestFullscreen?e.requestFullscreen():console.warn("MediaChrome: Fullscreen not supported")},MEDIA_EXIT_FULLSCREEN_REQUEST:()=>{Z[eH.exit]()},MEDIA_ENTER_PIP_REQUEST:e=>{if(!Z.pictureInPictureEnabled){console.warn("MediaChrome: Picture-in-picture is not enabled");return}if(!e.requestPictureInPicture){console.warn("MediaChrome: The current media does not support picture-in-picture");return}Z[eH.element]&&Z[eH.exit]();let t=()=>{console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a readyState > 0.")};e.requestPictureInPicture().catch(i=>{if(11===i.code){if(0===e.readyState&&"none"===e.preload){let i=()=>{e.removeEventListener("loadedmetadata",r),e.preload="none"},r=()=>{e.requestPictureInPicture().catch(t),i()};e.addEventListener("loadedmetadata",r),e.preload="metadata",setTimeout(()=>{0===e.readyState&&t(),i()},1e3)}else throw i}else throw i})},MEDIA_EXIT_PIP_REQUEST:()=>{Z.pictureInPictureElement&&Z.exitPictureInPicture()},MEDIA_ENTER_CAST_REQUEST:e=>{var t;(null==(t=Q.CastableVideoElement)?void 0:t.castEnabled)&&(Z[eH.element]&&Z[eH.exit](),e.requestCast())},MEDIA_EXIT_CAST_REQUEST:async()=>{var e;(null==(e=Q.CastableVideoElement)?void 0:e.castElement)&&Q.CastableVideoElement.exitCast()},MEDIA_SEEK_REQUEST:(e,t)=>{let i=t.detail;(e.readyState>0||void 0===e.readyState)&&(e.currentTime=i)},MEDIA_PLAYBACK_RATE_REQUEST:(e,t)=>{e.playbackRate=t.detail},MEDIA_PREVIEW_REQUEST:(e,t,i)=>{var r;if(!e)return;let a=t.detail;null===a&&i.propagateMediaState(m.MEDIA_PREVIEW_TIME,void 0),i.propagateMediaState(m.MEDIA_PREVIEW_TIME,a);let[s]=eB(e,{kind:g.METADATA,label:"thumbnails"});if(!(s&&s.cues))return;if(null===a){i.propagateMediaState(m.MEDIA_PREVIEW_IMAGE,void 0),i.propagateMediaState(m.MEDIA_PREVIEW_COORDS,void 0);return}let n=Array.prototype.find.call(s.cues,e=>e.startTime>=a);if(!n)return;let o=/'^(?:[a-z]+:)?\/\//i.test(n.text)?void 0:null==(r=e.querySelector('track[label="thumbnails"]'))?void 0:r.src,l=new URL(n.text,o),d=new URLSearchParams(l.hash).get("#xywh");i.propagateMediaState(m.MEDIA_PREVIEW_IMAGE,l.href),i.propagateMediaState(m.MEDIA_PREVIEW_COORDS,d.split(","))},MEDIA_SHOW_SUBTITLES_REQUEST:(e,t,i)=>{let r=eQ(i),{detail:a=[]}=t;eF(v.SHOWING,r,a)},MEDIA_DISABLE_SUBTITLES_REQUEST:(e,t,i)=>{let r=eQ(i),{detail:a=[]}=t;eF(v.DISABLED,r,a)},MEDIA_AIRPLAY_REQUEST:e=>{if(e){if(!(e.webkitShowPlaybackTargetPicker&&Q.WebKitPlaybackTargetAvailabilityEvent)){console.warn("received a request to select AirPlay but AirPlay is not supported in this environment");return}e.webkitShowPlaybackTargetPicker()}},MEDIA_SEEK_TO_LIVE_REQUEST:e=>{let t=e.seekable;if(!t){console.warn("MediaController: Media element does not support seeking to live.");return}if(!t.length){console.warn("MediaController: Media is unable to seek to live.");return}e.currentTime=t.end(t.length-1)},MEDIA_RENDITION_REQUEST:(e,t)=>{if(!(null==e?void 0:e.videoRenditions)){console.warn("MediaController: Rendition selection not supported by this media.");return}let i=t.detail,r=[...e.videoRenditions].findIndex(e=>e.id==i);e.videoRenditions.selectedIndex!=r&&(e.videoRenditions.selectedIndex=r)},MEDIA_AUDIO_TRACK_REQUEST:(e,t)=>{if(!(null==e?void 0:e.audioTracks)){console.warn("MediaController: Audio track selection not supported by this media.");return}let i=t.detail;for(let t of e.audioTracks)t.enabled=i==t.id}};var e1=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},e2=(e,t,i)=>(e1(e,t,"read from private field"),i?i.call(e):t.get(e)),e3=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},e4=(e,t,i,r)=>(e1(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),e5=(e,t,i)=>(e1(e,t,"access private method"),i);let e8=["ArrowLeft","ArrowRight","Enter"," ","f","m","k","c"],e9={DEFAULT_SUBTITLES:"defaultsubtitles",DEFAULT_STREAM_TYPE:"defaultstreamtype",FULLSCREEN_ELEMENT:"fullscreenelement",HOTKEYS:"hotkeys",KEYS_USED:"keysused",NO_HOTKEYS:"nohotkeys"};class e6 extends eS{constructor(){super(),e3(this,lY),e3(this,lX),e3(this,lq,new ew(this,e9.HOTKEYS)),e3(this,lj,void 0),void 0===eJ.MEDIA_VOLUME_UNAVAILABLE.get(this)&&ez.then(()=>{this.propagateMediaState(m.MEDIA_VOLUME_UNAVAILABLE,eJ.MEDIA_VOLUME_UNAVAILABLE.get(this))}),this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,this.associateElement(this),Object.keys(e0).forEach(e=>{let t=`_handle${I(e,!0)}`;this[t]=t=>{if(t.stopPropagation(),!this.media){console.warn("MediaController: No media available.");return}e0[e](this.media,t,this)},this.addEventListener(d[e],this[t])}),this._mediaStatePropagators={},Object.keys(eJ).forEach(e=>{this._mediaStatePropagators[e]=t=>{this.propagateMediaState(h[e],eJ[e].get(this,t))}}),this.enableHotkeys()}static get observedAttributes(){return super.observedAttributes.concat(e9.NO_HOTKEYS,e9.HOTKEYS,e9.DEFAULT_STREAM_TYPE,e9.DEFAULT_SUBTITLES)}get fullscreenElement(){var e;return null!=(e=e2(this,lj))?e:this}set fullscreenElement(e){this.hasAttribute(e9.FULLSCREEN_ELEMENT)&&this.removeAttribute(e9.FULLSCREEN_ELEMENT),e4(this,lj,e)}attributeChangedCallback(e,t,i){var r;if(e===e9.NO_HOTKEYS)i!==t&&""===i?(this.hasAttribute(e9.HOTKEYS)&&console.warn("Both `hotkeys` and `nohotkeys` have been set. All hotkeys will be disabled."),this.disableHotkeys()):i!==t&&null===i&&this.enableHotkeys();else if(e===e9.HOTKEYS)e2(this,lq).value=i;else if(e===e9.DEFAULT_SUBTITLES&&i!==t&&""===i)eV(this,!0);else if(e===e9.DEFAULT_STREAM_TYPE)this.propagateMediaState(h.MEDIA_STREAM_TYPE);else if(e===e9.FULLSCREEN_ELEMENT){let e=i?null==(r=this.getRootNode())?void 0:r.getElementById(i):void 0;e4(this,lj,e)}super.attributeChangedCallback(e,t,i)}mediaSetCallback(e){if(super.mediaSetCallback(e),e.hasAttribute("tabindex")||(e.tabIndex=-1),Object.keys(eJ).forEach(t=>{let{mediaEvents:i,rootEvents:r,textTracksEvents:a,videoRenditionsEvents:s,audioTracksEvents:n}=eJ[t],o=this._mediaStatePropagators[t];null==i||i.forEach(t=>{e.addEventListener(t,o),o()}),null==r||r.forEach(e=>{this.getRootNode().addEventListener(e,o),o()}),null==a||a.forEach(t=>{var i;null==(i=e.textTracks)||i.addEventListener(t,o),o()}),null==s||s.forEach(t=>{var i;null==(i=e.videoRenditions)||i.addEventListener(t,o),o()}),null==n||n.forEach(t=>{var i;null==(i=e.audioTracks)||i.addEventListener(t,o),o()})}),!this.hasAttribute("novolumepref"))try{let t=Q.localStorage.getItem("media-chrome-pref-volume");null!==t&&(e.volume=t)}catch(e){console.debug("Error getting volume pref",e)}}mediaUnsetCallback(e){super.mediaUnsetCallback(e),Object.keys(eJ).forEach(t=>{let{mediaEvents:i,rootEvents:r,textTracksEvents:a,videoRenditionsEvents:s,audioTracksEvents:n}=eJ[t],o=this._mediaStatePropagators[t];null==i||i.forEach(t=>{e.removeEventListener(t,o)}),null==r||r.forEach(e=>{this.getRootNode().removeEventListener(e,o)}),null==a||a.forEach(t=>{var i;null==(i=e.textTracks)||i.removeEventListener(t,o)}),null==s||s.forEach(t=>{var i;null==(i=e.videoRenditions)||i.removeEventListener(t,o),o()}),null==n||n.forEach(t=>{var i;null==(i=e.audioTracks)||i.removeEventListener(t,o),o()})}),this.propagateMediaState(h.MEDIA_PAUSED,!0)}propagateMediaState(e,t){let i=tu(this.mediaStateReceivers,e);if(td(this.mediaStateReceivers,e,t),i===tu(this.mediaStateReceivers,e))return;let r=e.toLowerCase(),a=new Q.CustomEvent(p[r],{composed:!0,bubbles:!0,detail:t});this.dispatchEvent(a)}associateElement(e){if(!e)return;let{associatedElementSubscriptions:t}=this;if(t.has(e))return;let i=this.registerMediaStateReceiver.bind(this),r=this.unregisterMediaStateReceiver.bind(this),a=th(e,i,r);Object.keys(d).forEach(t=>{e.addEventListener(d[t],this[`_handle${I(t,!0)}`])}),t.set(e,a)}unassociateElement(e){if(!e)return;let{associatedElementSubscriptions:t}=this;if(!t.has(e))return;let i=t.get(e);i(),t.delete(e),Object.keys(d).forEach(t=>{e.removeEventListener(d[t],this[`_handle${I(t,!0)}`])})}registerMediaStateReceiver(e){if(!e)return;let t=this.mediaStateReceivers,i=t.indexOf(e);i>-1||(t.push(e),Object.keys(eJ).forEach(t=>{let i=eJ[t];td([e],h[t],i.get(this))}))}unregisterMediaStateReceiver(e){let t=this.mediaStateReceivers,i=t.indexOf(e);i<0||t.splice(i,1)}enableHotkeys(){this.addEventListener("keydown",e5(this,lX,lQ))}disableHotkeys(){this.removeEventListener("keydown",e5(this,lX,lQ)),this.removeEventListener("keyup",e5(this,lY,lz))}get hotkeys(){return e2(this,lq)}keyboardShortcutHandler(e){var t,i,r,a;let s,n,o,l;let u=(null!=(a=null!=(r=null==(t=e.target.getAttribute(e9.KEYS_USED))?void 0:t.split(" "))?r:null==(i=e.target)?void 0:i.keysUsed)?a:[]).map(e=>"Space"===e?" ":e).filter(Boolean);if(!u.includes(e.key)&&!e2(this,lq).contains(`no${e.key.toLowerCase()}`)&&!(" "===e.key&&e2(this,lq).contains("nospace")))switch(e.key){case" ":case"k":s=null!=this.getAttribute(m.MEDIA_PAUSED)?d.MEDIA_PLAY_REQUEST:d.MEDIA_PAUSE_REQUEST,this.dispatchEvent(new Q.CustomEvent(s,{composed:!0,bubbles:!0}));break;case"m":s="off"===this.getAttribute(m.MEDIA_VOLUME_LEVEL)?d.MEDIA_UNMUTE_REQUEST:d.MEDIA_MUTE_REQUEST,this.dispatchEvent(new Q.CustomEvent(s,{composed:!0,bubbles:!0}));break;case"f":s=null!=this.getAttribute(m.MEDIA_IS_FULLSCREEN)?d.MEDIA_EXIT_FULLSCREEN_REQUEST:d.MEDIA_ENTER_FULLSCREEN_REQUEST,this.dispatchEvent(new Q.CustomEvent(s,{composed:!0,bubbles:!0}));break;case"c":eV(this);break;case"ArrowLeft":o=Math.max(((n=this.getAttribute(m.MEDIA_CURRENT_TIME))&&!Number.isNaN(+n)?+n:0)-10,0),l=new Q.CustomEvent(d.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:o}),this.dispatchEvent(l);break;case"ArrowRight":o=Math.max(((n=this.getAttribute(m.MEDIA_CURRENT_TIME))&&!Number.isNaN(+n)?+n:0)+10,0),l=new Q.CustomEvent(d.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:o}),this.dispatchEvent(l)}}}lq=new WeakMap,lj=new WeakMap,lY=new WeakSet,lz=function(e){let{key:t}=e;if(!e8.includes(t)){this.removeEventListener("keyup",e5(this,lY,lz));return}this.keyboardShortcutHandler(e)},lX=new WeakSet,lQ=function(e){let{metaKey:t,altKey:i,key:r}=e;if(t||i||!e8.includes(r)){this.removeEventListener("keyup",e5(this,lY,lz));return}[" ","ArrowLeft","ArrowRight"].includes(r)&&!(e2(this,lq).contains(`no${r.toLowerCase()}`)||" "===r&&e2(this,lq).contains("nospace"))&&e.preventDefault(),this.addEventListener("keyup",e5(this,lY,lz),{once:!0})};let e7=Object.values(m),te=Object.values(h),tt=e=>{var t,i,r,a;let{observedAttributes:s}=e.constructor;!s&&(null==(t=e.nodeName)?void 0:t.includes("-"))&&(Q.customElements.upgrade(e),{observedAttributes:s}=e.constructor);let n=null==(a=null==(r=null==(i=null==e?void 0:e.getAttribute)?void 0:i.call(e,u.MEDIA_CHROME_ATTRIBUTES))?void 0:r.split)?void 0:a.call(r,/\s+/);return Array.isArray(s||n)?(s||n).filter(e=>e7.includes(e)):[]},ti=e=>{var t,i;return(null==(t=e.nodeName)?void 0:t.includes("-"))&&Q.customElements.get(null==(i=e.nodeName)?void 0:i.toLowerCase())&&!(e instanceof Q.customElements.get(e.nodeName.toLowerCase()))&&Q.customElements.upgrade(e),te.some(t=>t in e)},tr=e=>ti(e)||!!tt(e).length,ta=e=>{var t;return null==(t=null==e?void 0:e.join)?void 0:t.call(e,":")},ts={[m.MEDIA_SUBTITLES_LIST]:eP,[m.MEDIA_SUBTITLES_SHOWING]:eP,[m.MEDIA_SEEKABLE]:ta,[m.MEDIA_BUFFERED]:e=>null==e?void 0:e.map(ta).join(" "),[m.MEDIA_PREVIEW_COORDS]:e=>null==e?void 0:e.join(" "),[m.MEDIA_RENDITION_LIST]:function(e){return null==e?void 0:e.map(_).join(" ")},[m.MEDIA_AUDIO_TRACK_LIST]:function(e){return null==e?void 0:e.map(k).join(" ")}},tn=async(e,t,i)=>{var r,a;if(e.isConnected||await w(0),"boolean"==typeof i||null==i)return G(e,t,i);if("number"==typeof i)return V(e,t,i);if("string"==typeof i)return K(e,t,i);if(Array.isArray(i)&&!i.length)return e.removeAttribute(t);let s=null!=(a=null==(r=ts[t])?void 0:r.call(ts,i))?a:i;return e.setAttribute(t,s)},to=e=>{var t;return!!(null==(t=e.closest)?void 0:t.call(e,'*[slot="media"]'))},tl=(e,t)=>{if(to(e))return;let i=(e,t)=>{var i,r;tr(e)&&t(e);let{children:a=[]}=null!=e?e:{},s=null!=(r=null==(i=null==e?void 0:e.shadowRoot)?void 0:i.children)?r:[],n=[...a,...s];n.forEach(e=>tl(e,t))},r=null==e?void 0:e.nodeName.toLowerCase();if(r.includes("-")&&!tr(e)){Q.customElements.whenDefined(r).then(()=>{i(e,t)});return}i(e,t)},td=(e,t,i)=>{e.forEach(e=>{if(t in e){e[t]=i;return}let r=tt(e),a=t.toLowerCase();r.includes(a)&&tn(e,a,i)})},tu=(e,t)=>{for(let i of e){if(t in i)return i[t];let e=tt(i),r=t.toLowerCase();if(e.includes(r))return i.getAttribute(r)}},th=(e,t,i)=>{tl(e,t);let r=e=>{var i;let r=null!=(i=null==e?void 0:e.composedPath()[0])?i:e.target;t(r)},a=e=>{var t;let r=null!=(t=null==e?void 0:e.composedPath()[0])?t:e.target;i(r)};e.addEventListener(d.REGISTER_MEDIA_STATE_RECEIVER,r),e.addEventListener(d.UNREGISTER_MEDIA_STATE_RECEIVER,a);let s=[],n=e=>{let r=e.target;"media"!==r.name&&(s.forEach(e=>tl(e,i)),(s=[...r.assignedElements({flatten:!0})]).forEach(e=>tl(e,t)))};e.addEventListener("slotchange",n);let o=new MutationObserver(e=>{e.forEach(e=>{let{addedNodes:r=[],removedNodes:a=[],type:s,target:n,attributeName:o}=e;"childList"===s?(Array.prototype.forEach.call(r,e=>tl(e,t)),Array.prototype.forEach.call(a,e=>tl(e,i))):"attributes"===s&&o===u.MEDIA_CHROME_ATTRIBUTES&&(tr(n)?t(n):i(n))})});return o.observe(e,{childList:!0,attributes:!0,subtree:!0}),()=>{tl(e,i),e.removeEventListener("slotchange",n),o.disconnect(),e.removeEventListener(d.REGISTER_MEDIA_STATE_RECEIVER,r),e.removeEventListener(d.UNREGISTER_MEDIA_STATE_RECEIVER,a)}};Q.customElements.get("media-controller")||Q.customElements.define("media-controller",e6);var tc=Object.defineProperty,tm=(e,t,i)=>t in e?tc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,tf=(e,t,i)=>(tm(e,"symbol"!=typeof t?t+"":t,i),i),tp=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},tg=(e,t,i)=>(tp(e,t,"read from private field"),i?i.call(e):t.get(e)),tv=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},tE=(e,t,i,r)=>(tp(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let tb=Z.createElement("template"),ty=`
  height: var(--thumb-height);
  width: var(--media-range-thumb-width, 10px);
  border: var(--media-range-thumb-border, none);
  border-radius: var(--media-range-thumb-border-radius, 10px);
  background: var(--media-range-thumb-background, var(--media-primary-color, rgb(238 238 238)));
  box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
  cursor: pointer;
  transition: var(--media-range-thumb-transition, none);
  transform: var(--media-range-thumb-transform, none);
  opacity: var(--media-range-thumb-opacity, 1);
`,tT=`
  min-width: 40px;
  height: var(--track-height);
  border: var(--media-range-track-border, none);
  outline: var(--media-range-track-outline);
  outline-offset: var(--media-range-track-outline-offset);
  border-radius: var(--media-range-track-border-radius, 1px);
  background: var(--media-range-track-progress-internal, var(--media-range-track-background, rgb(255 255 255 / .2)));
  backdrop-filter: var(--media-range-track-backdrop-filter);
  box-shadow: var(--media-range-track-box-shadow, none);
  transition: var(--media-range-track-transition, none);
  transform: translate(var(--media-range-track-translate-x, 0), var(--media-range-track-translate-y, 0));
  cursor: pointer;
`;tb.innerHTML=`
  <style>
    :host {
      --thumb-height: var(--media-range-thumb-height, 10px);
      --track-height: var(--media-range-track-height, 4px);
      --_focus-box-shadow: var(--media-focus-box-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));
      --_media-range-padding: var(--media-range-padding, var(--media-control-padding, 10px));

      vertical-align: middle;
      box-sizing: border-box;
      display: inline-block;
      position: relative;
      background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));
      transition: background .15s linear;
      width: 100px;
      height: calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding));
      padding-left: var(--media-range-padding-left, var(--_media-range-padding));
      padding-right: var(--media-range-padding-right, var(--_media-range-padding));
      pointer-events: auto;
      
      font-size: 0;
      box-shadow: var(--_focus-visible-box-shadow, none);
    }

    
    input[type=range]:focus {
      outline: 0;
    }
    input[type=range]:focus::-webkit-slider-runnable-track {
      outline: 0;
    }

    :host(:hover) {
      background: var(--media-control-hover-background, rgb(50 50 70 / .7));
    }

    #container {
      position: relative;
      height: 100%;
    }

    input[type=range] {
      
      -webkit-appearance: none; 
      background: transparent; 

      
      min-height: 100%;
      width: var(--media-range-track-width, 100%); 

      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      ${ty}
      
      margin-top: calc(calc(0px - var(--thumb-height) + var(--track-height)) / 2);
    }

    
    input[type=range]::-moz-range-thumb {
      ${ty}
      translate: var(--media-range-track-translate-x, 0) var(--media-range-track-translate-y, 0);
    }

    input[type=range]::-webkit-slider-runnable-track { ${tT} }
    input[type=range]::-moz-range-track { ${tT} }
    input[type=range]::-ms-track {
      
      width: 100%;
      cursor: pointer;
      
      background: transparent;
      border-color: transparent;
      color: transparent;

      ${tT}
    }

    #background,
    #pointer {
      width: var(--media-range-track-width, 100%);
      height: var(--track-height);
      border-radius: var(--media-range-track-border-radius, 1px);
      position: absolute;
      top: 50%;
      transform: translate(var(--media-range-track-translate-x, 0px), calc(var(--media-range-track-translate-y, 0px) - 50%));
    }

    #background {
      min-width: 40px;
      background: var(--media-range-track-background, rgb(255 255 255 / .2));
      backdrop-filter: var(--media-range-track-background-backdrop-filter);
    }

    #pointer {
      background: var(--media-range-track-pointer-background);
      border-right: var(--media-range-track-pointer-border-right);
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    :host(:hover) #pointer {
      transition: visibility .5s, opacity .5s;
      visibility: visible;
      opacity: 1;
    }

    #hoverzone {
      
      z-index: 1;
      display: var(--media-time-range-hover-display, none);
      position: absolute;
      width: 100%;
      bottom: var(--media-time-range-hover-bottom, -5px);
      height: var(--media-time-range-hover-height, max(calc(100% + 5px), 20px));
    }

    #range {
      z-index: 2;
      position: relative;
      height: var(--media-range-track-height, 4px);
    }

    input[type=range]:disabled::-webkit-slider-thumb {
      background-color: #777;
    }

    input[type=range]:disabled::-webkit-slider-runnable-track {
      background-color: #777;
    }
  </style>
  <div id="container">
    <div id="background"></div>
    <div id="pointer"></div>
    <div id="hoverzone"></div>
    <input id="range" type="range" min="0" max="1000" step="any" value="0">
  </div>
`;class tA extends Q.HTMLElement{constructor(){super(),tf(this,"thumbWidth"),tv(this,lZ,void 0),tv(this,lJ,()=>{if(this.range.matches(":focus-visible")){let{style:e}=B(this.shadowRoot,":host");e.setProperty("--_focus-visible-box-shadow","var(--_focus-box-shadow)")}}),tv(this,l0,()=>{let{style:e}=B(this.shadowRoot,":host");e.removeProperty("--_focus-visible-box-shadow")}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(tb.content.cloneNode(!0)));let{style:e}=B(this.shadowRoot,":host");e.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-block))`),this.container=this.shadowRoot.querySelector("#container"),this.range=this.shadowRoot.querySelector("#range"),this.range.addEventListener("input",this.updateBar.bind(this)),this.thumbWidth=parseInt(getComputedStyle(this).getPropertyValue("--media-range-thumb-width")||"10",10)}static get observedAttributes(){return["disabled","aria-disabled",u.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===u.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=tg(this,lZ))?void 0:r.unassociateElement)||a.call(r,this),tE(this,lZ,null)),i&&(tE(this,lZ,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=tg(this,lZ))?void 0:n.associateElement)||o.call(n,this))):("disabled"===e||"aria-disabled"===e&&t!==i)&&(null==i?this.range.removeAttribute(e):this.range.setAttribute(e,i))}connectedCallback(){var e,t,i;let r=this.getAttribute(u.MEDIA_CONTROLLER);r&&(tE(this,lZ,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=tg(this,lZ))?void 0:t.associateElement)||i.call(t,this)),this.updateBar(),this.shadowRoot.addEventListener("focusin",tg(this,lJ)),this.shadowRoot.addEventListener("focusout",tg(this,l0))}disconnectedCallback(){var e,t;null==(t=null==(e=tg(this,lZ))?void 0:e.unassociateElement)||t.call(e,this),tE(this,lZ,null),this.shadowRoot.removeEventListener("focusin",tg(this,lJ)),this.shadowRoot.removeEventListener("focusout",tg(this,l0))}updatePointerBar(e){let t=this.range.getBoundingClientRect(),i=(e.clientX-t.left)/t.width;i=Math.max(0,Math.min(1,i));let{style:r}=B(this.shadowRoot,"#pointer");r.setProperty("width",`${i*t.width}px`)}updateBar(){let e=this.getBarColors(),t="linear-gradient(to right, ",i=0;e.forEach(e=>{e[1]<i||(t+=`${e[0]} ${i}%, ${e[0]} ${e[1]}%,`,i=e[1])}),t=t.slice(0,t.length-1)+")";let{style:r}=B(this.shadowRoot,"#range");r.setProperty("--media-range-track-progress-internal",t)}getRelativeValues(){let{range:e}=this;return{relativeValue:e.value-e.min,relativeMax:e.max-e.min}}getBarColors(){let e=this.range,{relativeValue:t,relativeMax:i}=this.getRelativeValues(),r=t/i*100,a=0;if(t&&t<i){let t=this.thumbWidth*(.5-r/100);a=t/e.offsetWidth*100}return[["var(--media-range-bar-color, var(--media-primary-color, rgb(238 238 238)))",r+a],["var(--media-range-track-color, transparent)",100]]}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}}lZ=new WeakMap,lJ=new WeakMap,l0=new WeakMap,Q.customElements.get("media-chrome-range")||Q.customElements.define("media-chrome-range",tA);var t_=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},tS=(e,t,i)=>(t_(e,t,"read from private field"),i?i.call(e):t.get(e)),tk=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},tL=(e,t,i,r)=>(t_(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let tI=Z.createElement("template");tI.innerHTML=`
  <style>
    :host {
      
      box-sizing: border-box;
      display: var(--media-control-display, var(--media-control-bar-display, inline-flex));
      color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
      --media-loading-indicator-icon-height: 44px;
    }

    media-time-range,
    ::slotted(media-time-range),
    ::slotted(media-clip-selector) {
      flex-grow: 1;
    }

    media-time-range,
    ::slotted(media-time-range),
    ::slotted(media-clip-selector),
    media-volume-range,
    ::slotted(media-volume-range) {
      height: var(--_range-auto-size, calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding)));
    }
  </style>

  <slot></slot>
`;class tR extends Q.HTMLElement{constructor(){super(),tk(this,l1,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(tI.content.cloneNode(!0))),this.shadowRoot.querySelector("slot").addEventListener("slotchange",({target:e})=>{let t=e.assignedElements({flatten:!0}).every(e=>["media-time-range","media-volume-range"].includes(e.nodeName.toLowerCase())),{style:i}=B(this.shadowRoot,":host");i.setProperty("--_range-auto-size",t?"unset":"initial")})}static get observedAttributes(){return[u.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===u.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=tS(this,l1))?void 0:r.unassociateElement)||a.call(r,this),tL(this,l1,null)),i&&(tL(this,l1,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=tS(this,l1))?void 0:n.associateElement)||o.call(n,this)))}connectedCallback(){var e,t,i;let r=this.getAttribute(u.MEDIA_CONTROLLER);r&&(tL(this,l1,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=tS(this,l1))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=tS(this,l1))?void 0:e.unassociateElement)||t.call(e,this),tL(this,l1,null)}}l1=new WeakMap,Q.customElements.get("media-control-bar")||Q.customElements.define("media-control-bar",tR);var tw=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},tD=(e,t,i)=>(tw(e,t,"read from private field"),i?i.call(e):t.get(e)),tC=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},tM=(e,t,i,r)=>(tw(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let tx=Z.createElement("template");tx.innerHTML=`
  <style>
    :host {
      font: var(--media-font,
        var(--media-font-weight, normal)
        var(--media-font-size, 14px) /
        var(--media-text-content-height, var(--media-control-height, 24px))
        var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
      color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
      background: var(--media-text-background, var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7))));
      padding: var(--media-control-padding, 10px);
      display: inline-flex;
      justify-content: center;
      align-items: center;
      vertical-align: middle;
      box-sizing: border-box;
      text-align: center;
      pointer-events: auto;
    }

    
    :host(:focus-visible) {
      box-shadow: inset 0 0 0 2px rgb(27 127 204 / .9);
      outline: 0;
    }

    
    :host(:where(:focus)) {
      box-shadow: none;
      outline: 0;
    }
  </style>
  <slot></slot>
`;class tO extends Q.HTMLElement{constructor(){super(),tC(this,l2,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(tx.content.cloneNode(!0)));let{style:e}=B(this.shadowRoot,":host");e.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`)}static get observedAttributes(){return[u.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===u.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=tD(this,l2))?void 0:r.unassociateElement)||a.call(r,this),tM(this,l2,null)),i&&(tM(this,l2,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=tD(this,l2))?void 0:n.associateElement)||o.call(n,this)))}connectedCallback(){var e,t,i;let r=this.getAttribute(u.MEDIA_CONTROLLER);r&&(tM(this,l2,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=tD(this,l2))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=tD(this,l2))?void 0:e.unassociateElement)||t.call(e,this),tM(this,l2,null)}}l2=new WeakMap,Q.customElements.get("media-text-display")||Q.customElements.define("media-text-display",tO);var tP=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},tN=(e,t,i)=>(tP(e,t,"read from private field"),i?i.call(e):t.get(e)),tU=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},tF=(e,t,i,r)=>(tP(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);l3=new WeakMap,Q.customElements.get("media-duration-display")||Q.customElements.define("media-duration-display",class extends tO{constructor(){super(),tU(this,l3,void 0),tF(this,l3,this.shadowRoot.querySelector("slot")),tN(this,l3).textContent=x(0)}static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_DURATION]}attributeChangedCallback(e,t,i){e===m.MEDIA_DURATION&&(tN(this,l3).textContent=x(i)),super.attributeChangedCallback(e,t,i)}get mediaDuration(){return $(this,m.MEDIA_DURATION)}set mediaDuration(e){V(this,m.MEDIA_DURATION,e)}});var tB=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},t$=(e,t,i)=>(tB(e,t,"read from private field"),i?i.call(e):t.get(e)),tV=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},tH=(e,t,i,r)=>(tB(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let tG={REMAINING:"remaining",SHOW_DURATION:"showduration",NO_TOGGLE:"notoggle"},tW=[...Object.values(tG),m.MEDIA_CURRENT_TIME,m.MEDIA_DURATION,m.MEDIA_SEEKABLE],tK=["Enter"," "],tq="&nbsp;/&nbsp;",tj=(e,{timesSep:t=tq}={})=>{var i,r,a,s;let n=e.hasAttribute(tG.REMAINING),o=e.hasAttribute(tG.SHOW_DURATION),l=null!=(i=e.mediaCurrentTime)?i:0,[,d]=null!=(r=e.mediaSeekable)?r:[],u=null!=(s=null!=(a=e.mediaDuration)?a:d)?s:0,h=n?x(0-(u-l)):x(l);return o?`${h}${t}${x(u)}`:h},tY=e=>{var t;let i=e.mediaCurrentTime,[,r]=null!=(t=e.mediaSeekable)?t:[],a=e.mediaDuration||r;if(null==i||null==a){e.setAttribute("aria-valuetext","video not loaded, unknown time.");return}let s=e.hasAttribute(tG.REMAINING),n=e.hasAttribute(tG.SHOW_DURATION),o=s?M(0-(a-i)):M(i);if(!n){e.setAttribute("aria-valuetext",o);return}let l=M(a),d=`${o} of ${l}`;e.setAttribute("aria-valuetext",d)};l4=new WeakMap,Q.customElements.get("media-time-display")||Q.customElements.define("media-time-display",class extends tO{constructor(){super(),tV(this,l4,void 0),tH(this,l4,this.shadowRoot.querySelector("slot")),t$(this,l4).innerHTML=`${tj(this)}`;let{style:e}=B(this.shadowRoot,":host:not([notoggle])");e.setProperty("cursor","pointer");let{style:t}=B(this.shadowRoot,":host(:hover:not([notoggle]))");t.setProperty("background","var(--media-control-hover-background, rgba(50 50 70 / .7))")}static get observedAttributes(){return[...super.observedAttributes,...tW,"disabled"]}connectedCallback(){this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","progressbar"),this.setAttribute("aria-label",T.PLAYBACK_TIME());let e=t=>{let{key:i}=t;if(!tK.includes(i)){this.removeEventListener("keyup",e);return}this.toggleTimeDisplay()};this.addEventListener("keydown",t=>{let{metaKey:i,altKey:r,key:a}=t;if(i||r||!tK.includes(a)){this.removeEventListener("keyup",e);return}this.addEventListener("keyup",e)}),this.addEventListener("click",this.toggleTimeDisplay),super.connectedCallback()}toggleTimeDisplay(){this.noToggle||(this.hasAttribute("remaining")?this.removeAttribute("remaining"):this.setAttribute("remaining",""))}disconnectedCallback(){this.disable(),super.disconnectedCallback()}attributeChangedCallback(e,t,i){tW.includes(e)?this.update():"disabled"===e&&i!==t&&(null==i?this.enable():this.disable()),super.attributeChangedCallback(e,t,i)}enable(){this.tabIndex=0}disable(){this.tabIndex=-1}get remaining(){return H(this,tG.REMAINING)}set remaining(e){G(this,tG.REMAINING,e)}get showDuration(){return H(this,tG.SHOW_DURATION)}set showDuration(e){G(this,tG.SHOW_DURATION,e)}get noToggle(){return H(this,tG.NO_TOGGLE)}set noToggle(e){G(this,tG.NO_TOGGLE,e)}get mediaDuration(){return $(this,m.MEDIA_DURATION)}set mediaDuration(e){V(this,m.MEDIA_DURATION,e)}get mediaCurrentTime(){return $(this,m.MEDIA_CURRENT_TIME)}set mediaCurrentTime(e){V(this,m.MEDIA_CURRENT_TIME,e)}get mediaSeekable(){let e=this.getAttribute(m.MEDIA_SEEKABLE);if(e)return e.split(":").map(e=>+e)}set mediaSeekable(e){if(null==e){this.removeAttribute(m.MEDIA_SEEKABLE);return}this.setAttribute(m.MEDIA_SEEKABLE,e.join(":"))}update(){let e=tj(this);tY(this),e!==t$(this,l4).innerHTML&&(t$(this,l4).innerHTML=e)}});let tz=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,tX=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`,tQ=Z.createElement("template");tQ.innerHTML=`
  <style>
    :host([aria-checked="true"]) slot[name=off] {
      display: none !important;
    }

    
    :host(:not([aria-checked="true"])) slot[name=on] {
      display: none !important;
    }
  </style>

  <slot name="icon">
    <slot name="on">${tz}</slot>
    <slot name="off">${tX}</slot>
  </slot>
`;let tZ=e=>{e.setAttribute("aria-checked",e$(e))},tJ=(e,t)=>{let i=e.getAttribute(t);return i?eM(i):[]},t0=(e,t,i)=>{if(!(null==i?void 0:i.length)){e.removeAttribute(t);return}let r=eP(i),a=e.getAttribute(t);a!==r&&e.setAttribute(t,r)};Q.customElements.get("media-captions-button")||Q.customElements.define("media-captions-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_SUBTITLES_LIST,m.MEDIA_SUBTITLES_SHOWING]}constructor(e={}){super({slotTemplate:tQ,...e}),this._captionsReady=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",T.CLOSED_CAPTIONS()),tZ(this)}attributeChangedCallback(e,t,i){e===m.MEDIA_SUBTITLES_SHOWING&&tZ(this),super.attributeChangedCallback(e,t,i)}get mediaSubtitlesList(){return tJ(this,m.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){t0(this,m.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return tJ(this,m.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){t0(this,m.MEDIA_SUBTITLES_SHOWING,e)}handleClick(){eV(this)}});let t1={SEEK_OFFSET:"seekoffset"},t2=Z.createElement("template");t2.innerHTML=`
  <slot name="icon"><svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(8.9 19.87)">30</text><path d="M10 6V3l5.61 4L10 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 10 6Z"/></svg></slot>
`,Q.customElements.get("media-seek-forward-button")||Q.customElements.define("media-seek-forward-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_CURRENT_TIME,t1.SEEK_OFFSET]}constructor(e={}){super({slotTemplate:t2,...e})}connectedCallback(){this.seekOffset=$(this,t1.SEEK_OFFSET,30),super.connectedCallback()}attributeChangedCallback(e,t,i){e===t1.SEEK_OFFSET&&(this.seekOffset=$(this,t1.SEEK_OFFSET,30)),super.attributeChangedCallback(e,t,i)}get seekOffset(){return $(this,t1.SEEK_OFFSET,30)}set seekOffset(e){V(this,t1.SEEK_OFFSET,e),this.setAttribute("aria-label",A.SEEK_FORWARD_N_SECS({seekOffset:this.seekOffset})),O(N(this,"icon"),this.seekOffset)}get mediaCurrentTime(){return $(this,m.MEDIA_CURRENT_TIME,0)}set mediaCurrentTime(e){V(this,m.MEDIA_CURRENT_TIME,e)}handleClick(){let e=this.mediaCurrentTime+this.seekOffset,t=new Q.CustomEvent(d.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}});let t3=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M16 3v2.5h3.5V9H22V3h-6ZM4 9h2.5V5.5H10V3H4v6Zm15.5 9.5H16V21h6v-6h-2.5v3.5ZM6.5 15H4v6h6v-2.5H6.5V15Z"/>
</svg>`,t4=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M18.5 6.5V3H16v6h6V6.5h-3.5ZM16 21h2.5v-3.5H22V15h-6v6ZM4 17.5h3.5V21H10v-6H4v2.5Zm3.5-11H4V9h6V3H7.5v3.5Z"/>
</svg>`,t5=Z.createElement("template");t5.innerHTML=`
  <style>
  :host([${m.MEDIA_IS_FULLSCREEN}]) slot:not([name=exit]):not([name=icon]) {
    display: none !important;
  }

  
  :host(:not([${m.MEDIA_IS_FULLSCREEN}])) slot:not([name=enter]):not([name=icon]) {
    display: none !important;
  }
  </style>

  <slot name="icon">
    <slot name="enter">${t3}</slot>
    <slot name="exit">${t4}</slot>
  </slot>
`;let t8=e=>{let t=e.mediaIsFullscreen?A.EXIT_FULLSCREEN():A.ENTER_FULLSCREEN();e.setAttribute("aria-label",t)};Q.customElements.get("media-fullscreen-button")||Q.customElements.define("media-fullscreen-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_IS_FULLSCREEN,m.MEDIA_FULLSCREEN_UNAVAILABLE]}constructor(e={}){super({slotTemplate:t5,...e})}connectedCallback(){t8(this),super.connectedCallback()}attributeChangedCallback(e,t,i){e===m.MEDIA_IS_FULLSCREEN&&t8(this),super.attributeChangedCallback(e,t,i)}get mediaFullscreenUnavailable(){return W(this,m.MEDIA_FULLSCREEN_UNAVAILABLE)}set mediaFullscreenUnavailable(e){K(this,m.MEDIA_FULLSCREEN_UNAVAILABLE,e)}get mediaIsFullscreen(){return H(this,m.MEDIA_IS_FULLSCREEN)}set mediaIsFullscreen(e){G(this,m.MEDIA_IS_FULLSCREEN,e)}handleClick(){let e=this.mediaIsFullscreen?d.MEDIA_EXIT_FULLSCREEN_REQUEST:d.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new Q.CustomEvent(e,{composed:!0,bubbles:!0}))}});let{MEDIA_TIME_IS_LIVE:t9,MEDIA_PAUSED:t6}=m,{MEDIA_SEEK_TO_LIVE_REQUEST:t7,MEDIA_PLAY_REQUEST:ie}=d,it=Z.createElement("template");it.innerHTML=`
  <style>

  slot[name=indicator] > *,
  :host ::slotted([slot=indicator]) {
    
    min-width: auto;
    fill: var(--media-live-button-icon-color, rgb(140, 140, 140));
    color: var(--media-live-button-icon-color, rgb(140, 140, 140));
  }

  :host([${t9}]:not([${t6}])) slot[name=indicator] > *,
  :host([${t9}]:not([${t6}])) ::slotted([slot=indicator]) {
    fill: var(--media-live-button-indicator-color, rgb(255, 0, 0));
    color: var(--media-live-button-indicator-color, rgb(255, 0, 0));
  }

  :host([${t9}]:not([${t6}])) {
    cursor: not-allowed;
  }

  </style>

  <slot name="indicator"><svg viewBox="0 0 6 12"><circle cx="3" cy="6" r="2"></circle></svg></slot>
  
  <slot name="spacer">&nbsp;</slot><slot name="text">LIVE</slot>
`;let ii=e=>{let t=e.mediaPaused||!e.mediaTimeIsLive,i=t?A.SEEK_LIVE():A.PLAYING_LIVE();e.setAttribute("aria-label",i),t?e.removeAttribute("aria-disabled"):e.setAttribute("aria-disabled","true")};Q.customElements.get("media-live-button")||Q.customElements.define("media-live-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,t6,t9]}constructor(e={}){super({slotTemplate:it,...e})}connectedCallback(){ii(this),super.connectedCallback()}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),ii(this)}get mediaPaused(){return H(this,m.MEDIA_PAUSED)}set mediaPaused(e){G(this,m.MEDIA_PAUSED,e)}get mediaTimeIsLive(){return H(this,m.MEDIA_TIME_IS_LIVE)}set mediaTimeIsLive(e){G(this,m.MEDIA_TIME_IS_LIVE,e)}handleClick(){(this.mediaPaused||!this.mediaTimeIsLive)&&(this.dispatchEvent(new Q.CustomEvent(t7,{composed:!0,bubbles:!0})),this.hasAttribute(t6)&&this.dispatchEvent(new Q.CustomEvent(ie,{composed:!0,bubbles:!0})))}});let{MEDIA_VOLUME_LEVEL:ir}=m,ia=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M16.5 12A4.5 4.5 0 0 0 14 8v2.18l2.45 2.45a4.22 4.22 0 0 0 .05-.63Zm2.5 0a6.84 6.84 0 0 1-.54 2.64L20 16.15A8.8 8.8 0 0 0 21 12a9 9 0 0 0-7-8.77v2.06A7 7 0 0 1 19 12ZM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25A6.92 6.92 0 0 1 14 18.7v2.06A9 9 0 0 0 17.69 19l2 2.05L21 19.73l-9-9L4.27 3ZM12 4 9.91 6.09 12 8.18V4Z"/>
</svg>`,is=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4Z"/>
</svg>`,io=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4ZM14 3.23v2.06a7 7 0 0 1 0 13.42v2.06a9 9 0 0 0 0-17.54Z"/>
</svg>`,il=Z.createElement("template");il.innerHTML=`
  <style>
  
  :host(:not([${ir}])) slot:not([name=high]):not([name=icon]), 
  :host([${ir}=high]) slot:not([name=high]):not([name=icon]) {
    display: none !important;
  }

  :host([${ir}=off]) slot:not([name=off]):not([name=icon]) {
    display: none !important;
  }

  :host([${ir}=low]) slot:not([name=low]):not([name=icon]) {
    display: none !important;
  }

  :host([${ir}=medium]) slot:not([name=medium]):not([name=icon]) {
    display: none !important;
  }
  </style>

  <slot name="icon">
    <slot name="off">${ia}</slot>
    <slot name="low">${is}</slot>
    <slot name="medium">${is}</slot>
    <slot name="high">${io}</slot>
  </slot>
`;let id=e=>{let t="off"===e.mediaVolumeLevel,i=t?A.UNMUTE():A.MUTE();e.setAttribute("aria-label",i)};Q.customElements.get("media-mute-button")||Q.customElements.define("media-mute-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_VOLUME_LEVEL]}constructor(e={}){super({slotTemplate:il,...e})}connectedCallback(){id(this),super.connectedCallback()}attributeChangedCallback(e,t,i){e===m.MEDIA_VOLUME_LEVEL&&id(this),super.attributeChangedCallback(e,t,i)}get mediaVolumeLevel(){return W(this,m.MEDIA_VOLUME_LEVEL)}set mediaVolumeLevel(e){K(this,m.MEDIA_VOLUME_LEVEL,e)}handleClick(){let e="off"===this.mediaVolumeLevel?d.MEDIA_UNMUTE_REQUEST:d.MEDIA_MUTE_REQUEST;this.dispatchEvent(new Q.CustomEvent(e,{composed:!0,bubbles:!0}))}});let iu=`<svg aria-hidden="true" viewBox="0 0 28 24">
  <path d="M24 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Zm-1 16H5V5h18v14Zm-3-8h-7v5h7v-5Z"/>
</svg>`,ih=Z.createElement("template");ih.innerHTML=`
  <style>
  :host([${m.MEDIA_IS_PIP}]) slot:not([name=exit]):not([name=icon]) {
    display: none !important;
  }

  
  :host(:not([${m.MEDIA_IS_PIP}])) slot:not([name=enter]):not([name=icon]) {
    display: none !important;
  }
  </style>

  <slot name="icon">
    <slot name="enter">${iu}</slot>
    <slot name="exit">${iu}</slot>
  </slot>
`;let ic=e=>{let t=e.mediaIsPip?A.EXIT_PIP():A.ENTER_PIP();e.setAttribute("aria-label",t)};Q.customElements.get("media-pip-button")||Q.customElements.define("media-pip-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_IS_PIP,m.MEDIA_PIP_UNAVAILABLE]}constructor(e={}){super({slotTemplate:ih,...e})}connectedCallback(){ic(this),super.connectedCallback()}attributeChangedCallback(e,t,i){e===m.MEDIA_IS_PIP&&ic(this),super.attributeChangedCallback(e,t,i)}get mediaPipUnavailable(){return W(this,m.MEDIA_PIP_UNAVAILABLE)}set mediaPipUnavailable(e){K(this,m.MEDIA_PIP_UNAVAILABLE,e)}get mediaIsPip(){return H(this,m.MEDIA_IS_PIP)}set mediaIsPip(e){G(this,m.MEDIA_IS_PIP,e)}handleClick(){let e=this.mediaIsPip?d.MEDIA_EXIT_PIP_REQUEST:d.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new Q.CustomEvent(e,{composed:!0,bubbles:!0}))}});let im=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="m6 21 15-9L6 3v18Z"/>
</svg>`,ip=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M6 20h4V4H6v16Zm8-16v16h4V4h-4Z"/>
</svg>`,ig=Z.createElement("template");ig.innerHTML=`
  <style>
  :host([${m.MEDIA_PAUSED}]) slot[name=pause] {
    display: none !important;
  }

  :host(:not([${m.MEDIA_PAUSED}])) slot[name=play] {
    display: none !important;
  }
  </style>

  <slot name="icon">
    <slot name="play">${im}</slot>
    <slot name="pause">${ip}</slot>
  </slot>
`;let iv=e=>{let t=e.mediaPaused?A.PLAY():A.PAUSE();e.setAttribute("aria-label",t)};Q.customElements.get("media-play-button")||Q.customElements.define("media-play-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_PAUSED,m.MEDIA_ENDED]}constructor(e={}){super({slotTemplate:ig,...e})}connectedCallback(){iv(this),super.connectedCallback()}attributeChangedCallback(e,t,i){e===m.MEDIA_PAUSED&&iv(this),super.attributeChangedCallback(e,t,i)}get mediaPaused(){return H(this,m.MEDIA_PAUSED)}set mediaPaused(e){G(this,m.MEDIA_PAUSED,e)}handleClick(){let e=this.mediaPaused?d.MEDIA_PLAY_REQUEST:d.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new Q.CustomEvent(e,{composed:!0,bubbles:!0}))}});var iE=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},ib=(e,t,i)=>(iE(e,t,"read from private field"),i?i.call(e):t.get(e)),iy=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)};let iT={RATES:"rates"},iA=[1,1.25,1.5,1.75,2],i_=Z.createElement("template");i_.innerHTML=`
  <span id="container"></span>
`,l5=new WeakMap,Q.customElements.get("media-playback-rate-button")||Q.customElements.define("media-playback-rate-button",class extends eo{constructor(e={}){super({slotTemplate:i_,...e}),iy(this,l5,new ew(this,iT.RATES,{defaultValue:iA})),this.container=this.shadowRoot.querySelector("#container"),this.container.innerHTML="1x"}static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_PLAYBACK_RATE,iT.RATES]}attributeChangedCallback(e,t,i){if(e===iT.RATES&&(ib(this,l5).value=i),e===m.MEDIA_PLAYBACK_RATE){let e=i?+i:Number.NaN,t=Number.isNaN(e)?1:e;this.container.innerHTML=`${t}x`,this.setAttribute("aria-label",T.PLAYBACK_RATE({playbackRate:t}));return}super.attributeChangedCallback(e,t,i)}get rates(){return ib(this,l5)}set rates(e){e?Array.isArray(e)&&(ib(this,l5).value=e.join(" ")):ib(this,l5).value=""}get mediaPlaybackRate(){return $(this,m.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){V(this,m.MEDIA_PLAYBACK_RATE,e)}handleClick(){var e,t;let i=Array.from(this.rates.values(),e=>+e).sort((e,t)=>e-t),r=null!=(t=null!=(e=i.find(e=>e>this.mediaPlaybackRate))?e:i[0])?t:1,a=new Q.CustomEvent(d.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(a)}});let iS={PLACEHOLDER_SRC:"placeholdersrc",SRC:"src"},ik=Z.createElement("template");ik.innerHTML=`
  <style>
    :host {
      pointer-events: none;
      display: var(--media-poster-image-display, inline-block);
      box-sizing: border-box;
    }

    img {
      max-width: 100%;
      max-height: 100%;
      min-width: 100%;
      min-height: 100%;
      background-repeat: no-repeat;
      background-position: var(--media-poster-image-background-position, var(--media-object-position, center));
      background-size: var(--media-poster-image-background-size, var(--media-object-fit, contain));
      object-fit: var(--media-object-fit, contain);
      object-position: var(--media-object-position, center);
    }
  </style>

  <img part="poster img" aria-hidden="true" id="image"/>
`;let iL=e=>{e.style.removeProperty("background-image")},iI=(e,t)=>{e.style["background-image"]=`url('${t}')`};class iR extends Q.HTMLElement{static get observedAttributes(){return[iS.PLACEHOLDER_SRC,iS.SRC]}constructor(){super(),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(ik.content.cloneNode(!0))),this.image=this.shadowRoot.querySelector("#image")}attributeChangedCallback(e,t,i){e===iS.SRC&&(null==i?this.image.removeAttribute(iS.SRC):this.image.setAttribute(iS.SRC,i)),e===iS.PLACEHOLDER_SRC&&(null==i?iL(this.image):iI(this.image,i))}get placeholderSrc(){return W(this,iS.PLACEHOLDER_SRC)}set placeholderSrc(e){K(this,iS.SRC,e)}get src(){return W(this,iS.SRC)}set src(e){K(this,iS.SRC,e)}}Q.customElements.get("media-poster-image")||Q.customElements.define("media-poster-image",iR);let iw={SEEK_OFFSET:"seekoffset"},iD=Z.createElement("template");iD.innerHTML=`
  <slot name="icon"><svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(2.18 19.87)">30</text><path d="M10 6V3L4.37 7 10 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 10 6Z"/></svg></slot>
`,Q.customElements.get("media-seek-backward-button")||Q.customElements.define("media-seek-backward-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_CURRENT_TIME,iw.SEEK_OFFSET]}constructor(e={}){super({slotTemplate:iD,...e})}connectedCallback(){this.seekOffset=$(this,iw.SEEK_OFFSET,30),super.connectedCallback()}attributeChangedCallback(e,t,i){e===iw.SEEK_OFFSET&&(this.seekOffset=$(this,iw.SEEK_OFFSET,30)),super.attributeChangedCallback(e,t,i)}get seekOffset(){return $(this,iw.SEEK_OFFSET,30)}set seekOffset(e){V(this,iw.SEEK_OFFSET,e),this.setAttribute("aria-label",A.SEEK_BACK_N_SECS({seekOffset:this.seekOffset})),O(N(this,"icon"),this.seekOffset)}get mediaCurrentTime(){return $(this,m.MEDIA_CURRENT_TIME,0)}set mediaCurrentTime(e){V(this,m.MEDIA_CURRENT_TIME,e)}handleClick(){let e=Math.max(this.mediaCurrentTime-this.seekOffset,0),t=new Q.CustomEvent(d.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}});var iC=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},iM=(e,t,i)=>(iC(e,t,"read from private field"),i?i.call(e):t.get(e)),ix=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},iO=(e,t,i,r)=>(iC(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);l8=new WeakMap,Q.customElements.get("media-preview-time-display")||Q.customElements.define("media-preview-time-display",class extends tO{constructor(){super(),ix(this,l8,void 0),iO(this,l8,this.shadowRoot.querySelector("slot")),iM(this,l8).textContent=x(0)}static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_PREVIEW_TIME]}attributeChangedCallback(e,t,i){e===m.MEDIA_PREVIEW_TIME&&null!=i&&(iM(this,l8).textContent=x(i)),super.attributeChangedCallback(e,t,i)}get mediaPreviewTime(){return $(this,m.MEDIA_PREVIEW_TIME)}set mediaPreviewTime(e){V(this,m.MEDIA_PREVIEW_TIME,e)}});var iP=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},iN=(e,t,i)=>(iP(e,t,"read from private field"),i?i.call(e):t.get(e)),iU=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},iF=(e,t,i,r)=>(iP(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let iB=Z.createElement("template");iB.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      display: var(--media-control-display, var(--media-preview-thumbnail-display, inline-block));
      overflow: hidden;
    }

    img {
      display: none;
      position: relative;
    }
  </style>
  <img crossorigin loading="eager" decoding="async">
`;class i$ extends Q.HTMLElement{constructor(){super(),iU(this,l9,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(iB.content.cloneNode(!0)))}static get observedAttributes(){return[u.MEDIA_CONTROLLER,m.MEDIA_PREVIEW_IMAGE,m.MEDIA_PREVIEW_COORDS]}connectedCallback(){var e,t,i;let r=this.getAttribute(u.MEDIA_CONTROLLER);r&&(iF(this,l9,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=iN(this,l9))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=iN(this,l9))?void 0:e.unassociateElement)||t.call(e,this),iF(this,l9,null)}attributeChangedCallback(e,t,i){var r,a,s,n,o;[m.MEDIA_PREVIEW_IMAGE,m.MEDIA_PREVIEW_COORDS].includes(e)&&this.update(),e===u.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=iN(this,l9))?void 0:r.unassociateElement)||a.call(r,this),iF(this,l9,null)),i&&(iF(this,l9,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=iN(this,l9))?void 0:n.associateElement)||o.call(n,this)))}get mediaPreviewImage(){return W(this,m.MEDIA_PREVIEW_IMAGE)}set mediaPreviewImage(e){K(this,m.MEDIA_PREVIEW_IMAGE,e)}get mediaPreviewCoords(){let e=this.getAttribute(m.MEDIA_PREVIEW_COORDS);if(e)return e.split(/\s+/).map(e=>+e)}set mediaPreviewCoords(e){if(!e){this.removeAttribute(m.MEDIA_PREVIEW_COORDS);return}this.setAttribute(m.MEDIA_PREVIEW_COORDS,e.join(" "))}update(){let e=this.mediaPreviewCoords,t=this.mediaPreviewImage;if(!(e&&t))return;let[i,r,a,s]=e,n=t.split("#")[0],o=getComputedStyle(this),{maxWidth:l,maxHeight:d,minWidth:u,minHeight:h}=o,c=Math.min(parseInt(l)/a,parseInt(d)/s),m=Math.max(parseInt(u)/a,parseInt(h)/s),f=c<1,p=f?c:m>1?m:1,{style:g}=B(this.shadowRoot,":host"),v=B(this.shadowRoot,"img").style,E=this.shadowRoot.querySelector("img"),b=f?"min":"max";g.setProperty(`${b}-width`,"initial","important"),g.setProperty(`${b}-height`,"initial","important"),g.width=`${a*p}px`,g.height=`${s*p}px`;let y=()=>{v.width=`${this.imgWidth*p}px`,v.height=`${this.imgHeight*p}px`,v.display="block"};E.src!==n&&(E.onload=()=>{this.imgWidth=E.naturalWidth,this.imgHeight=E.naturalHeight,y()},E.src=n,y()),y(),v.transform=`translate(-${i*p}px, -${r*p}px)`}}l9=new WeakMap,Q.customElements.get("media-preview-thumbnail")||Q.customElements.define("media-preview-thumbnail",i$);var iV=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},iH=(e,t,i)=>(iV(e,t,"read from private field"),i?i.call(e):t.get(e)),iG=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},iW=(e,t,i,r)=>(iV(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),iK=(e,t,i)=>(iV(e,t,"access private method"),i);let iq=e=>{let t=e.range,i=M(+t.value),r=M(+t.max),a=i&&r?`${i} of ${r}`:"video not loaded, unknown time.";t.setAttribute("aria-valuetext",a)},ij=Z.createElement("template");ij.innerHTML=`
  <style>
    :host {
      --media-preview-border-radius: 3px;
      --media-box-padding-left: 10px;
      --media-box-padding-right: 10px;
    }

    #preview-rail,
    #current-rail {
      
      width: 1%;
      position: absolute;
      left: 0;
      bottom: 100%;
      pointer-events: none;
    }

    [part~="box"] {
      
      position: absolute;
      bottom: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translateX(-50%);
    }

    [part~="preview-box"] {
      transition-property: var(--media-preview-transition-property, visibility, opacity);
      transition-duration: var(--media-preview-transition-duration-out, .25s);
      transition-delay: var(--media-preview-transition-delay-out, 0s);
      visibility: hidden;
      opacity: 0;
    }

    :host([${m.MEDIA_PREVIEW_IMAGE}]:hover) [part~="preview-box"],
    :host([${m.MEDIA_PREVIEW_TIME}]:hover) [part~="preview-box"] {
      transition-duration: var(--media-preview-transition-duration-in, .5s);
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      visibility: visible;
      opacity: 1;
    }

    media-preview-thumbnail,
    ::slotted(media-preview-thumbnail) {
      visibility: hidden;
      
      transition: visibility 0s .25s;
      transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
      background: var(--media-preview-thumbnail-background, var(--media-preview-background, var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)))));
      box-shadow: var(--media-preview-thumbnail-box-shadow, 0 0 4px rgb(0 0 0 / .2));
      max-width: var(--media-preview-thumbnail-max-width, 180px);
      max-height: var(--media-preview-thumbnail-max-height, 160px);
      min-width: var(--media-preview-thumbnail-min-width, 120px);
      min-height: var(--media-preview-thumbnail-min-height, 80px);
      border: var(--media-preview-thumbnail-border);
      border-radius: var(--media-preview-thumbnail-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius) 0 0);
    }

    :host([${m.MEDIA_PREVIEW_IMAGE}]:hover) media-preview-thumbnail,
    :host([${m.MEDIA_PREVIEW_IMAGE}]:hover) ::slotted(media-preview-thumbnail) {
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      visibility: visible;
    }

    media-preview-time-display,
    ::slotted(media-preview-time-display) {
      min-width: 0;
      
      transition: min-width 0s, border-radius 0s;
      transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
      background: var(--media-preview-time-background, var(--media-preview-background, var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)))));
      border-radius: var(--media-preview-time-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius)
        var(--media-preview-border-radius) var(--media-preview-border-radius));
      padding: var(--media-preview-time-padding, 1px 10px 0);
      margin: var(--media-preview-time-margin, 0 0 10px);
      text-shadow: var(--media-preview-time-text-shadow, 0 0 4px rgb(0 0 0 / .75));
    }

    :host([${m.MEDIA_PREVIEW_IMAGE}]) media-preview-time-display,
    :host([${m.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-time-display) {
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      min-width: 100%;
      border-radius: var(--media-preview-time-border-radius,
        0 0 var(--media-preview-border-radius) var(--media-preview-border-radius));
    }

    :host([${m.MEDIA_PREVIEW_TIME}]:hover) {
      --media-time-range-hover-display: block;
    }
  </style>
  <div id="preview-rail">
    <slot name="preview" part="box preview-box">
      <media-preview-thumbnail></media-preview-thumbnail>
      <media-preview-time-display></media-preview-time-display>
    </slot>
  </div>
  <div id="current-rail">
    <slot name="current" part="box current-box">
      
    </slot>
  </div>
`,l6=new WeakMap,l7=new WeakMap,de=new WeakMap,dt=new WeakMap,di=new WeakMap,dr=new WeakSet,da=function(){var e;let[,t]=null!=(e=this.mediaSeekable)?e:[];return t},ds=new WeakSet,dn=function(){var e;let[t]=null!=(e=this.mediaSeekable)?e:[];return t},dl=new WeakSet,dd=function(e,t){var i;let r=`${1e4*t}%`,a=e.offsetWidth;if(!a)return r;let s=null!=(i=this.getAttribute("bounds")?F(this,`#${this.getAttribute("bounds")}`):this.parentElement)?i:this,n=this.range.getBoundingClientRect(),o=s.getBoundingClientRect(),l=(iH(this,dt)-(n.left-o.left-a/2))/n.width*100,d=(o.right-n.left-a/2-iH(this,di))/n.width*100;return Number.isNaN(l)||(r=`max(${100*l}%, ${r})`),Number.isNaN(d)||(r=`min(${r}, ${100*d}%)`),r},du=new WeakMap,dh=new WeakMap,dc=new WeakMap,dm=new WeakMap,df=new WeakMap,dp=new WeakMap,dg=new WeakSet,dv=function(){this.addEventListener("pointermove",iH(this,dp),!1)},dE=new WeakSet,db=function(){var e;null==(e=Q.window)||e.removeEventListener("pointermove",iH(this,dc)),this.removeEventListener("pointermove",iH(this,dp)),iW(this,dh,!1),iH(this,df).call(this)},Q.customElements.get("media-time-range")||Q.customElements.define("media-time-range",class extends tA{constructor(){super(),iG(this,dr),iG(this,ds),iG(this,dl),iG(this,dg),iG(this,dE),iG(this,l6,void 0),iG(this,l7,void 0),iG(this,de,void 0),iG(this,dt,void 0),iG(this,di,void 0),iG(this,du,e=>{if([...iH(this,l6)].some(t=>e.composedPath().includes(t)))return;this.updatePointerBar(e);let t=this.mediaDuration;if(!t)return;let i=this.range.getBoundingClientRect(),r=(e.clientX-i.left-this.thumbWidth/2)/(i.width-this.thumbWidth);r=Math.max(0,Math.min(1,r));let a=iK(this,dl,dd).call(this,iH(this,l7),r),{style:s}=B(this.shadowRoot,"#preview-rail");s.transform=`translateX(${a})`;let n=r*t,o=new Q.CustomEvent(d.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:n});this.dispatchEvent(o)}),iG(this,dh,!1),iG(this,dc,e=>{var t;(!e.composedPath().includes(this)||[...iH(this,l6)].some(t=>e.composedPath().includes(t)))&&(null==(t=Q.window)||t.removeEventListener("pointermove",iH(this,dc)),iW(this,dh,!1),iH(this,df).call(this))}),iG(this,dm,()=>{var e;null==(e=Q.window)||e.addEventListener("pointermove",iH(this,du),!1)}),iG(this,df,()=>{var e;null==(e=Q.window)||e.removeEventListener("pointermove",iH(this,du));let t=new Q.CustomEvent(d.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:null});this.dispatchEvent(t)}),iG(this,dp,()=>{var e;let t=this.getAttribute(m.MEDIA_DURATION);!iH(this,dh)&&t&&(iW(this,dh,!0),iH(this,dm).call(this),null==(e=Q.window)||e.addEventListener("pointermove",iH(this,dc),!1))}),this.container.appendChild(ij.content.cloneNode(!0)),this.range.addEventListener("input",()=>{cancelAnimationFrame(this._refreshId);let e=this.range.value,t=new Q.CustomEvent(d.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}),this._refreshBar=()=>{let e=(performance.now()-this._updateTimestamp)/1e3;this.range.value=this.mediaCurrentTime+e*this.mediaPlaybackRate,this.updateBar(),this.updateCurrentBox(),this._refreshId=requestAnimationFrame(this._refreshBar)},iW(this,l6,this.shadowRoot.querySelectorAll('[part~="box"]')),iW(this,l7,this.shadowRoot.querySelector('[part~="preview-box"]')),iW(this,de,this.shadowRoot.querySelector('[part~="current-box"]'));let e=getComputedStyle(this);iW(this,dt,parseInt(e.getPropertyValue("--media-box-padding-left"))),iW(this,di,parseInt(e.getPropertyValue("--media-box-padding-right"))),iK(this,dg,dv).call(this)}static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_PAUSED,m.MEDIA_DURATION,m.MEDIA_SEEKABLE,m.MEDIA_CURRENT_TIME,m.MEDIA_PREVIEW_IMAGE,m.MEDIA_PREVIEW_TIME,m.MEDIA_BUFFERED,m.MEDIA_PLAYBACK_RATE,m.MEDIA_LOADING,m.MEDIA_ENDED]}connectedCallback(){this.range.setAttribute("aria-label",T.SEEK()),super.connectedCallback()}disconnectedCallback(){cancelAnimationFrame(this._refreshId),super.disconnectedCallback()}attributeChangedCallback(e,t,i){var r,a,s,n,o;e!==m.MEDIA_CURRENT_TIME&&e!==m.MEDIA_PAUSED&&e!==m.MEDIA_ENDED&&e!==m.MEDIA_LOADING||(this._updateTimestamp=performance.now(),this.range.value=this.mediaCurrentTime,iq(this),this.updateBar(),this.updateCurrentBox(),cancelAnimationFrame(this._refreshId),this.mediaPaused||this.mediaLoading||(this._refreshId=requestAnimationFrame(this._refreshBar))),e===m.MEDIA_DURATION&&(this.range.max=null!=(a=null!=(r=iH(this,dr,da))?r:this.mediaDuration)?a:1e3,iq(this),this.updateBar(),this.updateCurrentBox()),e===m.MEDIA_SEEKABLE&&(this.range.min=null!=(s=iH(this,ds,dn))?s:0,this.range.max=null!=(o=null!=(n=iH(this,dr,da))?n:this.mediaDuration)?o:1e3,iq(this),this.updateBar()),e===m.MEDIA_BUFFERED&&this.updateBar(),"disabled"===e&&(null==i?iK(this,dg,dv).call(this):iK(this,dE,db).call(this)),super.attributeChangedCallback(e,t,i)}get mediaPaused(){return H(this,m.MEDIA_PAUSED)}set mediaPaused(e){G(this,m.MEDIA_PAUSED,e)}get mediaLoading(){return H(this,m.MEDIA_LOADING)}set mediaLoading(e){G(this,m.MEDIA_LOADING,e)}get mediaDuration(){return $(this,m.MEDIA_DURATION)}set mediaDuration(e){V(this,m.MEDIA_DURATION,e)}get mediaCurrentTime(){return $(this,m.MEDIA_CURRENT_TIME)}set mediaCurrentTime(e){V(this,m.MEDIA_CURRENT_TIME,e)}get mediaPlaybackRate(){return $(this,m.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){V(this,m.MEDIA_PLAYBACK_RATE,e)}get mediaBuffered(){let e=this.getAttribute(m.MEDIA_BUFFERED);return e?e.split(" ").map(e=>e.split(":").map(e=>+e)):[]}set mediaBuffered(e){if(!e){this.removeAttribute(m.MEDIA_BUFFERED);return}let t=e.map(e=>e.join(":")).join(" ");this.setAttribute(m.MEDIA_BUFFERED,t)}get mediaSeekable(){let e=this.getAttribute(m.MEDIA_SEEKABLE);if(e)return e.split(":").map(e=>+e)}set mediaSeekable(e){if(null==e){this.removeAttribute(m.MEDIA_SEEKABLE);return}this.setAttribute(m.MEDIA_SEEKABLE,e.join(":"))}get mediaPreviewImage(){return W(this,m.MEDIA_PREVIEW_IMAGE)}set mediaPreviewImage(e){K(this,m.MEDIA_PREVIEW_IMAGE,e)}get mediaPreviewTime(){return $(this,m.MEDIA_PREVIEW_TIME)}set mediaPreviewTime(e){V(this,m.MEDIA_PREVIEW_TIME,e)}get mediaEnded(){return H(this,m.MEDIA_ENDED)}set mediaEnded(e){G(this,m.MEDIA_ENDED,e)}getRelativeValues(){let e=super.getRelativeValues();return this.mediaEnded?{...e,relativeValue:e.relativeMax}:e}getBarColors(){var e;let t;let i=super.getBarColors(),{range:r}=this,a=r.max-r.min,s=this.mediaBuffered;if(!s.length||!Number.isFinite(a)||a<=0)return i;if(this.mediaEnded)t=a;else{let i=this.mediaCurrentTime,[,a=r.min]=null!=(e=s.find(([e,t])=>e<=i&&i<=t))?e:[];t=a-r.min}let n=t/a*100;return i.splice(1,0,["var(--media-time-range-buffered-color, rgb(255 255 255 / .4))",n]),i}updateCurrentBox(){if(!iH(this,de).assignedElements().length)return;let e=this.range.value/(this.range.max-this.range.min),t=iK(this,dl,dd).call(this,iH(this,de),e),{style:i}=B(this.shadowRoot,"#current-rail");i.transform=`translateX(${t})`}});var iY=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},iz=(e,t,i)=>(iY(e,t,"read from private field"),i?i.call(e):t.get(e)),iX=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},iQ=(e,t,i,r)=>(iY(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let iZ={LOADING_DELAY:"loadingdelay"},iJ=Z.createElement("template"),i0=`
<svg aria-hidden="true" viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;iJ.innerHTML=`
<style>
:host {
  display: var(--media-control-display, var(--media-loading-indicator-display, inline-block));
  vertical-align: middle;
  box-sizing: border-box;
  --_loading-indicator-delay: var(--media-loading-indicator-transition-delay, 500ms);
}

#status {
  color: rgba(0,0,0,0);
  width: 0px;
  height: 0px;
}

:host slot[name=icon] > *,
:host ::slotted([slot=icon]) {
  opacity: var(--media-loading-indicator-opacity, 0);
  transition: opacity 0.15s;
}

:host([${m.MEDIA_LOADING}]:not([${m.MEDIA_PAUSED}])) slot[name=icon] > *,
:host([${m.MEDIA_LOADING}]:not([${m.MEDIA_PAUSED}])) ::slotted([slot=icon]) {
  opacity: var(--media-loading-indicator-opacity, 1);
  transition: opacity 0.15s var(--_loading-indicator-delay);
}

:host #status {
  visibility: var(--media-loading-indicator-opacity, hidden);
  transition: visibility 0.15s;
}

:host([${m.MEDIA_LOADING}]:not([${m.MEDIA_PAUSED}])) #status {
  visibility: var(--media-loading-indicator-opacity, visible);
  transition: visibility 0.15s var(--_loading-indicator-delay);
}

svg, img, ::slotted(svg), ::slotted(img) {
  width: var(--media-loading-indicator-icon-width);
  height: var(--media-loading-indicator-icon-height, 100px);
  fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
  vertical-align: middle;
}
</style>

<slot name="icon">${i0}</slot>
<div id="status" role="status" aria-live="polite">${T.MEDIA_LOADING()}</div>
`;class i1 extends Q.HTMLElement{constructor(){if(super(),iX(this,dy,void 0),iX(this,dT,500),iX(this,dA,void 0),!this.shadowRoot){let e=this.attachShadow({mode:"open"}),t=iJ.content.cloneNode(!0);e.appendChild(t)}let{style:e}=B(this.shadowRoot,":host");iQ(this,dA,e)}static get observedAttributes(){return[u.MEDIA_CONTROLLER,m.MEDIA_PAUSED,m.MEDIA_LOADING,iZ.LOADING_DELAY]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===iZ.LOADING_DELAY&&t!==i?this.loadingDelay=Number(i):e===u.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=iz(this,dy))?void 0:r.unassociateElement)||a.call(r,this),iQ(this,dy,null)),i&&(iQ(this,dy,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=iz(this,dy))?void 0:n.associateElement)||o.call(n,this)))}connectedCallback(){var e,t,i;let r=this.getAttribute(u.MEDIA_CONTROLLER);r&&(iQ(this,dy,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=iz(this,dy))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=iz(this,dy))?void 0:e.unassociateElement)||t.call(e,this),iQ(this,dy,null)}get loadingDelay(){return iz(this,dT)}set loadingDelay(e){iQ(this,dT,e),iz(this,dA).setProperty("--_loading-indicator-delay",`var(--media-loading-indicator-transition-delay, ${e}ms)`)}get mediaPaused(){return H(this,m.MEDIA_PAUSED)}set mediaPaused(e){G(this,m.MEDIA_PAUSED,e)}get mediaLoading(){return H(this,m.MEDIA_LOADING)}set mediaLoading(e){G(this,m.MEDIA_LOADING,e)}}dy=new WeakMap,dT=new WeakMap,dA=new WeakMap,Q.customElements.get("media-loading-indicator")||Q.customElements.define("media-loading-indicator",i1);let i2=e=>e.mediaMuted?0:Math.round(e.mediaVolume*e.range.max),i3=({value:e,max:t})=>`${Math.round(e/t*100)}%`;Q.customElements.get("media-volume-range")||Q.customElements.define("media-volume-range",class extends tA{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_VOLUME,m.MEDIA_MUTED,m.MEDIA_VOLUME_UNAVAILABLE]}constructor(){super(),this.range.max=100,this.range.addEventListener("input",()=>{let e=this.range.value/this.range.max,t=new Q.CustomEvent(d.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)})}connectedCallback(){this.range.setAttribute("aria-label",T.VOLUME()),super.connectedCallback()}attributeChangedCallback(e,t,i){if(e===m.MEDIA_VOLUME||e===m.MEDIA_MUTED){let e=i2(this);this.range.value=e,this.range.setAttribute("aria-valuetext",i3(this.range)),this.updateBar()}super.attributeChangedCallback(e,t,i)}get mediaVolume(){return $(this,m.MEDIA_VOLUME,1)}set mediaVolume(e){V(this,m.MEDIA_VOLUME,e)}get mediaMuted(){return H(this,m.MEDIA_MUTED)}set mediaMuted(e){G(this,m.MEDIA_MUTED,e)}get mediaVolumeUnavailable(){return W(this,m.MEDIA_VOLUME_UNAVAILABLE)}set mediaVolumeUnavailable(e){K(this,m.MEDIA_VOLUME_UNAVAILABLE,e)}});var i4=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},i5=(e,t,i)=>(i4(e,t,"read from private field"),i?i.call(e):t.get(e)),i8=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},i9=(e,t,i,r)=>(i4(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),i6=(e,t,i)=>(i4(e,t,"access private method"),i);let i7=`
<svg aria-hidden="true" viewBox="0 1 24 24" part="select-indicator indicator">
  <path d="m10 15.17 9.193-9.191 1.414 1.414-10.606 10.606-6.364-6.364 1.414-1.414 4.95 4.95Z"/>
</svg>`;function re(e,t,i){let r=Z.createElement("media-chrome-option");r.part.add("option"),r.value=t,r.selected=i;let a=Z.createElement("span");return a.textContent=e,r.append(a),r}function rt(e,t){let i=e.querySelector(`:scope > [slot="${t}"]`);return((null==i?void 0:i.nodeName)=="SLOT"&&(i=i.assignedElements({flatten:!0})[0]),i)?((i=i.cloneNode(!0)).removeAttribute("slot"),i):e.shadowRoot.querySelector(`[name="${t}"] > svg`).cloneNode(!0)}let ri=Z.createElement("template");ri.innerHTML=`
<style>
  :host {
    font: var(--media-font,
      var(--media-font-weight, normal)
      var(--media-font-size, 15px) /
      var(--media-text-content-height, var(--media-control-height, 24px))
      var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
    color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
    background: var(--media-listbox-background, var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .8))));
    border-radius: var(--media-listbox-border-radius);
    display: inline-flex;
    flex-direction: column;
    position: relative;
    box-sizing: border-box;
  }

  ::slotted([slot="header"]) {
    padding: .4em 1.4em;
    border-bottom: 1px solid rgb(255 255 255 / .25);
  }

  #container {
    display: block;
    overflow: hidden auto;
    padding-block: .5em;
  }

  media-chrome-option {
    padding-inline: .7em 1.4em;
  }

  media-chrome-option > span {
    margin-inline: .5ch;
  }

  [part~="indicator"] {
    fill: var(--media-option-indicator-fill, var(--media-icon-color, var(--media-primary-color, rgb(238 238 238))));
    height: var(--media-option-indicator-height, 1.25em);
    vertical-align: var(--media-option-indicator-vertical-align, text-top);
  }

  [part~="select-indicator"] {
    visibility: hidden;
  }

  [aria-selected="true"] > [part~="select-indicator"] {
    visibility: visible;
  }
</style>
<slot name="header"></slot>
<slot id="container"></slot>
<slot name="select-indicator" hidden>${i7}</slot>
`;class rr extends Q.HTMLElement{constructor(e={}){super(),i8(this,dR),i8(this,dM),i8(this,dO),i8(this,dN),i8(this,dF),i8(this,d_,void 0),i8(this,dS,""),i8(this,dk,null),i8(this,dL,!1),i8(this,dI,e=>{this.handleClick(e)}),i8(this,dD,e=>{let{key:t}=e;if("Escape"===t){this.removeEventListener("keyup",i5(this,dD));return}if("Meta"===t){i9(this,dL,!1);return}i6(this,dR,dw).call(this,e)}),i8(this,dC,e=>{let{key:t,altKey:i}=e;if(i){this.removeEventListener("keyup",i5(this,dD));return}if("Meta"===t){i9(this,dL,!0);return}if(this.keysUsed.includes(t)&&e.preventDefault(),i5(this,dL)&&this.keysUsed.includes(t)){i6(this,dR,dw).call(this,e);return}this.addEventListener("keyup",i5(this,dD),{once:!0})}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.nativeEl=ri.content.cloneNode(!0),e.slotTemplate&&this.nativeEl.append(e.slotTemplate.content.cloneNode(!0)),this.shadowRoot.append(this.nativeEl)),this.container=this.shadowRoot.querySelector("#container"),this.container.addEventListener("slotchange",e=>{for(let t of e.target.assignedNodes({flatten:!0}))3===t.nodeType&&""===t.textContent.trim()&&t.remove()})}static get observedAttributes(){return["disabled",u.MEDIA_CONTROLLER]}static formatOptionText(e){return e}formatOptionText(e,t){return this.constructor.formatOptionText(e,t)}get options(){var e;let t=this.querySelectorAll("media-chrome-option");return t.length||(t=null==(e=this.container)?void 0:e.querySelectorAll("media-chrome-option")),Array.from(t)}get selectedOptions(){return this.options.filter(e=>e.selected)}get value(){var e,t;return null!=(t=null==(e=this.selectedOptions[0])?void 0:e.value)?t:""}set value(e){let t=this.options.find(t=>t.value===e);t&&i6(this,dO,dP).call(this,t)}focus(){var e;null==(e=this.selectedOptions[0])||e.focus()}enable(){this.addEventListener("click",i5(this,dI)),this.addEventListener("keydown",i5(this,dC))}disable(){this.removeEventListener("click",i5(this,dI)),this.removeEventListener("keyup",i5(this,dD))}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===u.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=i5(this,d_))?void 0:r.unassociateElement)||a.call(r,this),i9(this,d_,null)),i&&(i9(this,d_,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=i5(this,d_))?void 0:n.associateElement)||o.call(n,this))):"disabled"===e&&i!==t&&(null==i?this.enable():this.disable())}connectedCallback(){var e,t,i;this.hasAttribute("disabled")||this.enable(),this.hasAttribute("role")||this.setAttribute("role","listbox");let r=this.getAttribute(u.MEDIA_CONTROLLER);r&&(i9(this,d_,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=i5(this,d_))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;this.disable(),null==(t=null==(e=i5(this,d_))?void 0:e.unassociateElement)||t.call(e,this),i9(this,d_,null)}get keysUsed(){return["Enter"," ","ArrowDown","ArrowUp","Home","End"]}handleSelection(e,t){let i=i6(this,dM,dx).call(this,e);i&&i6(this,dO,dP).call(this,i,t)}handleMovement(e){let t;let{key:i}=e,r=this.options,a=i6(this,dM,dx).call(this,e);switch(a||(a=r.filter(e=>"0"===e.getAttribute("tabindex"))[0]),i){case"ArrowDown":(null==(t=a.nextElementSibling)?void 0:t.hasAttribute("disabled"))&&(t=t.nextElementSibling);break;case"ArrowUp":(null==(t=a.previousElementSibling)?void 0:t.hasAttribute("disabled"))&&(t=t.previousElementSibling);break;case"Home":t=r[0];break;case"End":t=r[r.length-1];break;default:t=i6(this,dN,dU).call(this,i)}t&&(r.forEach(e=>e.setAttribute("tabindex","-1")),t.setAttribute("tabindex","0"),t.focus())}handleClick(e){let t=i6(this,dM,dx).call(this,e);!t||t.hasAttribute("disabled")||(this.options.forEach(e=>e.setAttribute("tabindex","-1")),t.setAttribute("tabindex","0"),this.handleSelection(e,this.hasAttribute("aria-multiselectable")&&"true"===this.getAttribute("aria-multiselectable")))}}d_=new WeakMap,dS=new WeakMap,dk=new WeakMap,dL=new WeakMap,dI=new WeakMap,dR=new WeakSet,dw=function(e){let{key:t}=e;"Enter"===t||" "===t?this.handleSelection(e,this.hasAttribute("aria-multiselectable")&&"true"===this.getAttribute("aria-multiselectable")):this.handleMovement(e)},dD=new WeakMap,dC=new WeakMap,dM=new WeakSet,dx=function(e){let t=e.composedPath(),i=t.findIndex(e=>"MEDIA-CHROME-OPTION"===e.nodeName);return t[i]},dO=new WeakSet,dP=function(e,t){let i=[...this.selectedOptions];this.hasAttribute("aria-multiselectable")&&"true"===this.getAttribute("aria-multiselectable")||this.options.forEach(e=>e.selected=!1),t?e.selected=!e.selected:e.selected=!0,this.selectedOptions.some((e,t)=>e!=i[t])&&this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))},dN=new WeakSet,dU=function(e){i6(this,dF,dB).call(this);let t=this.options,i=t.findIndex(e=>"0"===e.getAttribute("tabindex"));i9(this,dS,i5(this,dS)+e);let r=i5(this,dS).split("").every(t=>t===e),a=t.slice(i+(r?1:0)).filter(e=>e.textContent.toLowerCase().startsWith(i5(this,dS))),s=t.slice(0,i-(r?1:0)).filter(e=>e.textContent.toLowerCase().startsWith(i5(this,dS))),n=[],o=[];r&&(n=t.slice(i+(r?1:0)).filter(t=>t.textContent.startsWith(e)),o=t.slice(0,i-(r?1:0)).filter(t=>t.textContent.startsWith(e)));let l=[...a,...s,...n,...o];return l[0]},dF=new WeakSet,dB=function(){clearTimeout(i5(this,dk)),i9(this,dk,null),i9(this,dk,setTimeout(()=>{i9(this,dS,""),i9(this,dk,null)},500))},Q.customElements.get("media-chrome-listbox")||Q.customElements.define("media-chrome-listbox",rr);var ra=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},rs=(e,t,i)=>(ra(e,t,"read from private field"),i?i.call(e):t.get(e)),rn=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},ro=(e,t,i,r)=>(ra(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),rl=(e,t,i)=>(ra(e,t,"access private method"),i);let rd=Z.createElement("template");rd.innerHTML=`
<style>
  :host {
    cursor: pointer;
    display: block;
    line-height: revert;
    white-space: nowrap;
    white-space-collapse: collapse;
    text-wrap: nowrap;
    min-height: 1.2em;
    padding: .4em .5em;
    transition: var(--media-option-transition);
    outline: var(--media-option-outline, 0);
    outline-offset: var(--media-option-outline-offset, -1px);
  }

  :host(:focus-visible) {
    box-shadow: var(--media-option-focus-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));
    outline: var(--media-option-hover-outline, 0);
    outline-offset: var(--media-option-hover-outline-offset,  var(--media-option-outline-offset, -1px));
  }

  :host(:hover) {
    cursor: pointer;
    background: var(--media-option-hover-background, rgb(82 82 122 / .8));
    outline: var(--media-option-hover-outline);
    outline-offset: var(--media-option-hover-outline-offset,  var(--media-option-outline-offset, -1px));
  }

  :host([aria-selected="true"]) {
    background: var(--media-option-selected-background);
  }

  :host([disabled]) {
    pointer-events: none;
    color: rgba(255, 255, 255, .3);
  }
</style>
<slot></slot>
`;let ru={VALUE:"value",SELECTED:"selected",DISABLED:"disabled"};class rh extends Q.HTMLElement{constructor(){super(),rn(this,dH),rn(this,d$,!1),rn(this,dV,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(rd.content.cloneNode(!0)))}static get observedAttributes(){return[ru.DISABLED,ru.SELECTED,ru.VALUE]}get value(){var e;return null!=(e=this.getAttribute(ru.VALUE))?e:this.text}set value(e){this.setAttribute(ru.VALUE,e)}get text(){var e;return(null!=(e=this.textContent)?e:"").trim()}get selected(){return"true"===this.getAttribute("aria-selected")}set selected(e){ro(this,d$,!0),this.setAttribute("aria-selected",e?"true":"false"),e?this.part.add("option-selected"):this.part.remove("option-selected")}enable(){this.hasAttribute("tabindex")||this.setAttribute("tabindex",-1),this.hasAttribute("aria-selected")||this.setAttribute("aria-selected","false")}disable(){this.removeAttribute("tabindex")}attributeChangedCallback(e,t,i){e!==ru.SELECTED||rs(this,d$)?e===ru.DISABLED&&i!==t&&(null==i?this.enable():this.disable()):this.setAttribute("aria-selected",null!=i?"true":"false")}connectedCallback(){this.hasAttribute(ru.DISABLED)||this.enable(),this.setAttribute("role","option"),ro(this,dV,function e(t,i){if(!t)return null;let{host:r}=t.getRootNode();return!i&&r?e(t,r):(null==i?void 0:i.options)?i:e(i,null==i?void 0:i.parentNode)}(this,this.parentNode)),rl(this,dH,dG).call(this)}disconnectedCallback(){this.disable(),rl(this,dH,dG).call(this),ro(this,dV,null)}handleClick(){}}d$=new WeakMap,dV=new WeakMap,dH=new WeakSet,dG=function(){var e;let t=null==(e=rs(this,dV))?void 0:e.options;if(!t)return;let i=t.filter(e=>"true"===e.getAttribute("aria-selected")).pop();i||(i=t[0]),"true"!==rs(this,dV).getAttribute("aria-multiselectable")&&t.forEach(e=>{e.setAttribute("tabindex","-1"),e.setAttribute("aria-selected","false")}),null==i||i.setAttribute("tabindex","0"),null==i||i.setAttribute("aria-selected","true")},Q.customElements.get("media-chrome-option")||Q.customElements.define("media-chrome-option",rh);let rc=new WeakMap,rm=e=>{let t=rc.get(e);return t||rc.set(e,t=new Set),t},rf=new Q.ResizeObserver(e=>{for(let t of e)for(let e of rm(t.target))e(t)});function rp(e,t){rm(e).add(t),rf.observe(e)}function rg(e,t){let i=rm(e);i.delete(t),i.size||rf.unobserve(e)}var rv=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},rE=(e,t,i)=>(rv(e,t,"read from private field"),i?i.call(e):t.get(e)),rb=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},ry=(e,t,i,r)=>(rv(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),rT=(e,t,i)=>(rv(e,t,"access private method"),i);let rA=Z.createElement("template");rA.innerHTML=`
  <style>
  :host {
    font: var(--media-font,
      var(--media-font-weight, normal)
      var(--media-font-size, 15px) /
      var(--media-text-content-height, var(--media-control-height, 24px))
      var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
    color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
    display: inline-flex;
    position: relative;
    flex-shrink: .5;
  }

  [name=listbox]::slotted(*),
  [part=listbox] {
    position: absolute;
    left: 0;
    bottom: 100%;
    max-height: 300px;
    transition: var(--media-selectmenu-transition-in,
      visibility 0s, transform .15s ease-out, opacity .15s ease-out);
    transform: var(--media-listbox-transform-in, translateY(0) scale(1));
    visibility: visible;
    opacity: 1;
  }

  [name=listbox][hidden]::slotted(*),
  [hidden] [part=listbox] {
    transition: var(--media-selectmenu-transition-out,
      visibility .15s ease-out, transform .15s ease-out, opacity .15s ease-out);
    transform: var(--media-listbox-transform-out, translateY(2px) scale(.99));
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
  }

  slot[name=listbox][hidden] {
    display: block;
  }
  </style>

  <slot name="button">
    <media-chrome-button aria-haspopup="listbox" part="button">
      <slot name="button-content"></slot>
    </media-chrome-button>
  </slot>
  <slot name="listbox" hidden>
    <media-chrome-listbox id="listbox" part="listbox">
      <slot></slot>
    </media-chrome-listbox>
  </slot>
`;class r_ extends Q.HTMLElement{constructor(){var e;super(),rb(this,d0),rb(this,d2),rb(this,d4),rb(this,dW,void 0),rb(this,dK,void 0),rb(this,dq,void 0),rb(this,dj,void 0),rb(this,dY,void 0),rb(this,dz,e=>{let{key:t}=e;if(!this.keysUsed.includes(t)){this.removeEventListener("keyup",rE(this,dz));return}let i=e.composedPath().includes(rE(this,dK));i&&("Enter"===t||" "===t)?rT(this,d0,d1).call(this):"Escape"===t&&rT(this,d4,d5).call(this)}),rb(this,dX,e=>{let{metaKey:t,altKey:i,key:r}=e;if(t||i||!this.keysUsed.includes(r)){this.removeEventListener("keyup",rE(this,dz));return}e.preventDefault(),this.addEventListener("keyup",rE(this,dz),{once:!0})}),rb(this,dQ,e=>{e.composedPath().includes(this)||rT(this,d4,d5).call(this)}),rb(this,dZ,e=>{e.composedPath().includes(rE(this,dK))&&rT(this,d0,d1).call(this)}),rb(this,dJ,()=>{rT(this,d4,d5).call(this)}),rb(this,d8,()=>{if(0===rE(this,dj).offsetWidth)return;let e=rE(this,dK).getBoundingClientRect();if(this.hasAttribute("mediacontroller")||rE(this,dK).hasAttribute("mediacontroller")||rE(this,dj).hasAttribute("mediacontroller")){rE(this,dj).style.zIndex="1",rE(this,dj).style.bottom="unset",rE(this,dj).style.top=e.height+"px";return}let t=rS(this),i=rE(this,dj).offsetWidth,r=t.getBoundingClientRect(),a=-Math.max(e.x+i-r.right,0);rE(this,dj).style.left=`${a}px`,rE(this,dj).style.maxHeight=`${r.height-e.height}px`}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(rA.content.cloneNode(!0)));let{style:t}=B(this.shadowRoot,":host");t.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`),null==(e=this.init)||e.call(this),ry(this,dK,this.shadowRoot.querySelector("[part=button]")),ry(this,dj,this.shadowRoot.querySelector("[part=listbox]")),ry(this,dq,this.shadowRoot.querySelector("slot[name=button]")),rE(this,dq).addEventListener("slotchange",()=>{let e=rE(this,dq).assignedElements()[0];if(!e)return;ry(this,dK,e),rE(this,dK).preventClick=!0;let t=this.hasAttribute("disabled")||rE(this,dK).hasAttribute("disabled");t?this.disable():(this.enable(),rE(this,dK).setAttribute("aria-haspopup","listbox"))}),ry(this,dY,this.shadowRoot.querySelector("slot[name=listbox]")),rE(this,dY).addEventListener("slotchange",()=>{ry(this,dj,rE(this,dY).assignedElements()[0]||rE(this,dj))})}static get observedAttributes(){return["disabled",u.MEDIA_CONTROLLER]}enable(){rE(this,dK).toggleAttribute("disabled",!1),this.addEventListener("change",rE(this,dJ)),this.addEventListener("keydown",rE(this,dX)),this.addEventListener("click",rE(this,dZ)),Z.addEventListener("click",rE(this,dQ))}disable(){rE(this,dK).toggleAttribute("disabled",!0),this.removeEventListener("change",rE(this,dJ)),this.removeEventListener("keydown",rE(this,dX)),this.removeEventListener("keyup",rE(this,dz)),this.removeEventListener("click",rE(this,dZ)),Z.removeEventListener("click",rE(this,dQ))}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===u.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=rE(this,dW))?void 0:r.unassociateElement)||a.call(r,this),ry(this,dW,null),rE(this,dj).removeAttribute(u.MEDIA_CONTROLLER)),i&&(ry(this,dW,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=rE(this,dW))?void 0:n.associateElement)||o.call(n,this),rE(this,dj).setAttribute(u.MEDIA_CONTROLLER,i))):"disabled"===e&&i!==t&&(null==i?this.enable():this.disable())}connectedCallback(){var e,t,i;let r=this.getAttribute(u.MEDIA_CONTROLLER);r&&(ry(this,dW,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=rE(this,dW))?void 0:t.associateElement)||i.call(t,this),rE(this,dj).setAttribute(u.MEDIA_CONTROLLER,r)),this.hasAttribute("disabled")||this.enable(),rE(this,dY).hidden||rp(rS(this),rE(this,d8))}disconnectedCallback(){var e,t;rg(rS(this),rE(this,d8)),this.disable(),null==(t=null==(e=rE(this,dW))?void 0:e.unassociateElement)||t.call(e,this),ry(this,dW,null),rE(this,dj).removeAttribute(u.MEDIA_CONTROLLER)}get keysUsed(){return["Enter","Escape"," ","ArrowUp","ArrowDown","f","c","k","m"]}}function rS(e){var t;return null!=(t=e.getAttribute("bounds")?F(e,`#${e.getAttribute("bounds")}`):function(e){var t;let i=e.getAttribute(u.MEDIA_CONTROLLER);return i?null==(t=e.getRootNode())?void 0:t.getElementById(i):F(e,"media-controller")}(e)||e.parentElement)?t:e}dW=new WeakMap,dK=new WeakMap,dq=new WeakMap,dj=new WeakMap,dY=new WeakMap,dz=new WeakMap,dX=new WeakMap,dQ=new WeakMap,dZ=new WeakMap,dJ=new WeakMap,d0=new WeakSet,d1=function(){rE(this,dY).hidden?rT(this,d2,d3).call(this):rT(this,d4,d5).call(this)},d2=new WeakSet,d3=function(){rE(this,dY).hidden&&(rE(this,dY).hidden=!1,rE(this,dK).setAttribute("aria-expanded","true"),rE(this,d8).call(this),rE(this,dj).focus(),rp(rS(this),rE(this,d8)))},d4=new WeakSet,d5=function(){if(rE(this,dY).hidden)return;let e=function e(t=document){var i;let r=null==t?void 0:t.activeElement;return r?null!=(i=e(r.shadowRoot))?i:r:null}();rE(this,dY).hidden=!0,rE(this,dK).setAttribute("aria-expanded","false"),U(rE(this,dj),e)&&rE(this,dK).focus(),rg(rS(this),rE(this,d8))},d8=new WeakMap,Q.customElements.get("media-chrome-selectmenu")||Q.customElements.define("media-chrome-selectmenu",r_);var rk=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},rL=(e,t,i)=>(rk(e,t,"read from private field"),i?i.call(e):t.get(e)),rI=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},rR=(e,t,i,r)=>(rk(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),rw=(e,t,i)=>(rk(e,t,"access private method"),i);let rD=`
<svg aria-hidden="true" viewBox="0 0 26 24" part="captions-indicator indicator">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,rC=Z.createElement("template");rC.innerHTML=`
  <slot name="captions-indicator" hidden>${rD}</slot>
`,d9=new WeakMap,d6=new WeakSet,d7=function(){var e;if(rL(this,d9)===JSON.stringify(this.mediaSubtitlesList))return;rR(this,d9,JSON.stringify(this.mediaSubtitlesList));let t=this.shadowRoot.querySelector("#container");t.textContent="";let i=!this.value,r=re(this.formatOptionText("Off"),"off",i);r.prepend(rt(this,"select-indicator")),t.append(r);let a=this.mediaSubtitlesList;for(let i of a){let r=re(this.formatOptionText(i.label,i),eO(i),this.value==eO(i));r.prepend(rt(this,"select-indicator"));let a=null!=(e=i.kind)?e:"subs";"captions"===a&&r.append(rt(this,"captions-indicator")),t.append(r)}},ue=new WeakSet,ut=function(){if(eV(this,!1),!this.value)return;let e=new Q.CustomEvent(d.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)};let rM=(e,t)=>{let i=e.getAttribute(t);return i?eM(i):[]},rx=(e,t,i)=>{if(!(null==i?void 0:i.length)){e.removeAttribute(t);return}let r=eP(i),a=e.getAttribute(t);a!==r&&e.setAttribute(t,r)};Q.customElements.get("media-captions-listbox")||Q.customElements.define("media-captions-listbox",class extends rr{constructor(){super({slotTemplate:rC}),rI(this,d6),rI(this,ue),rI(this,d9,void 0)}static get observedAttributes(){return[...super.observedAttributes,"aria-multiselectable",m.MEDIA_SUBTITLES_LIST,m.MEDIA_SUBTITLES_SHOWING]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===m.MEDIA_SUBTITLES_LIST&&t!==i?rw(this,d6,d7).call(this):e===m.MEDIA_SUBTITLES_SHOWING&&t!==i?this.value=i:"aria-multiselectable"===e&&(this.removeAttribute("aria-multiselectable"),console.warn("Captions List doesn't currently support multiple selections. You can enable multiple items via the media.textTrack API."))}connectedCallback(){super.connectedCallback(),this.addEventListener("change",rw(this,ue,ut))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",rw(this,ue,ut))}get mediaSubtitlesList(){return rM(this,m.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){rx(this,m.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return rM(this,m.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){rx(this,m.MEDIA_SUBTITLES_SHOWING,e)}}),Q.customElements.get("media-captions-selectmenu")||Q.customElements.define("media-captions-selectmenu",class extends r_{init(){let e=Z.createElement("media-captions-button");e.part.add("button"),e.preventClick=!0;let t=Z.createElement("media-captions-listbox");t.part.add("listbox"),t.setAttribute("exportparts","option, option-selected, indicator");let i=this.shadowRoot.querySelector("slot[name=button]"),r=this.shadowRoot.querySelector("slot[name=listbox]");i.textContent="",r.textContent="",i.append(e),r.append(t)}});var rO=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},rP=(e,t,i)=>(rO(e,t,"read from private field"),i?i.call(e):t.get(e)),rN=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},rU=(e,t,i)=>(rO(e,t,"access private method"),i);let rF={RATES:"rates"};ui=new WeakMap,ur=new WeakSet,ua=function(){let e=this.shadowRoot.querySelector("#container");for(let t of(e.textContent="",this.rates)){let i=re(this.formatOptionText(`${t}x`,t),t,this.mediaPlaybackRate==t);i.prepend(rt(this,"select-indicator")),e.append(i)}},us=new WeakSet,un=function(){if(!this.value)return;let e=new Q.CustomEvent(d.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},Q.customElements.get("media-playback-rate-listbox")||Q.customElements.define("media-playback-rate-listbox",class extends rr{constructor(){super(),rN(this,ur),rN(this,us),rN(this,ui,new ew(this,rF.RATES,{defaultValue:iA})),rU(this,ur,ua).call(this)}static get observedAttributes(){return[...super.observedAttributes,"aria-multiselectable",m.MEDIA_PLAYBACK_RATE,rF.RATES]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===m.MEDIA_PLAYBACK_RATE&&t!=i?this.value=i:e===rF.RATES&&t!=i&&(rP(this,ui).value=i,rU(this,ur,ua).call(this))}get rates(){return rP(this,ui)}set rates(e){e?Array.isArray(e)&&(rP(this,ui).value=e.join(" ")):rP(this,ui).value="",rU(this,ur,ua).call(this)}get mediaPlaybackRate(){return $(this,m.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){V(this,m.MEDIA_PLAYBACK_RATE,e)}connectedCallback(){super.connectedCallback(),this.addEventListener("change",rU(this,us,un))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",rU(this,us,un))}}),Q.customElements.get("media-playback-rate-selectmenu")||Q.customElements.define("media-playback-rate-selectmenu",class extends r_{init(){let e=Z.createElement("media-playback-rate-button");e.part.add("button"),e.preventClick=!0;let t=Z.createElement("media-playback-rate-listbox");t.part.add("listbox"),t.setAttribute("exportparts","option, option-selected, indicator");let i=this.shadowRoot.querySelector("slot[name=button]"),r=this.shadowRoot.querySelector("slot[name=listbox]");i.textContent="",r.textContent="",i.append(e),r.append(t)}});var rB=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},r$=(e,t,i)=>(rB(e,t,"read from private field"),i?i.call(e):t.get(e)),rV=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},rH=(e,t,i,r)=>(rB(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),rG=(e,t,i)=>(rB(e,t,"access private method"),i);uo=new WeakMap,ul=new WeakMap,ud=new WeakSet,uu=function(){if(r$(this,ul)===JSON.stringify(this.mediaRenditionList))return;rH(this,ul,JSON.stringify(this.mediaRenditionList));let e=this.mediaRenditionList.sort((e,t)=>t.height-e.height),t=this.shadowRoot.querySelector("#container");t.textContent="";let i=!this.mediaRenditionSelected;for(let r of e){let e=this.formatOptionText(`${Math.min(r.width,r.height)}p`,r),a=re(e,`${r.id}`,r.selected&&!i);a.prepend(rt(this,"select-indicator")),t.append(a)}let r=re(this.formatOptionText("Auto"),"auto",i);r.prepend(rt(this,"select-indicator")),t.append(r)},uh=new WeakSet,uc=function(){if(null==this.value)return;let e=new Q.CustomEvent(d.MEDIA_RENDITION_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},Q.customElements.get("media-rendition-listbox")||Q.customElements.define("media-rendition-listbox",class extends rr{constructor(){super(...arguments),rV(this,ud),rV(this,uh),rV(this,uo,[]),rV(this,ul,void 0)}static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_RENDITION_LIST,m.MEDIA_RENDITION_SELECTED]}attributeChangedCallback(e,t,i){(super.attributeChangedCallback(e,t,i),e===m.MEDIA_RENDITION_SELECTED&&t!==i)?this.value=null!=i?i:"auto":e===m.MEDIA_RENDITION_LIST&&t!==i&&(rH(this,uo,null==i?void 0:i.split(/\s+/).map(S)),rG(this,ud,uu).call(this))}connectedCallback(){super.connectedCallback(),this.addEventListener("change",rG(this,uh,uc))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",rG(this,uh,uc))}get mediaRenditionList(){return r$(this,uo)}set mediaRenditionList(e){rH(this,uo,e),rG(this,ud,uu).call(this)}get mediaRenditionSelected(){return W(this,m.MEDIA_RENDITION_SELECTED)}set mediaRenditionSelected(e){K(this,m.MEDIA_RENDITION_SELECTED,e)}});let rW=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M13.5 2.5h2v6h-2v-2h-11v-2h11v-2Zm4 2h4v2h-4v-2Zm-12 4h2v6h-2v-2h-3v-2h3v-2Zm4 2h12v2h-12v-2Zm1 4h2v6h-2v-2h-8v-2h8v-2Zm4 2h7v2h-7v-2Z" />
</svg>`,rK=Z.createElement("template");rK.innerHTML=`
  <slot name="icon">${rW}</slot>
`,Q.customElements.get("media-rendition-button")||Q.customElements.define("media-rendition-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_RENDITION_SELECTED,m.MEDIA_RENDITION_UNAVAILABLE]}constructor(){super({slotTemplate:rK})}get mediaRenditionSelected(){return W(this,m.MEDIA_RENDITION_SELECTED)}set mediaRenditionSelected(e){K(this,m.MEDIA_RENDITION_SELECTED,e)}}),Q.customElements.get("media-rendition-selectmenu")||Q.customElements.define("media-rendition-selectmenu",class extends r_{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_RENDITION_SELECTED,m.MEDIA_RENDITION_UNAVAILABLE]}init(){let e=Z.createElement("media-rendition-button");e.part.add("button"),e.preventClick=!0;let t=Z.createElement("media-rendition-listbox");t.part.add("listbox"),t.setAttribute("exportparts","option, option-selected, indicator");let i=this.shadowRoot.querySelector("slot[name=button]"),r=this.shadowRoot.querySelector("slot[name=listbox]");i.textContent="",r.textContent="",i.append(e),r.append(t)}});var rq=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},rj=(e,t,i)=>(rq(e,t,"read from private field"),i?i.call(e):t.get(e)),rY=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},rz=(e,t,i,r)=>(rq(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),rX=(e,t,i)=>(rq(e,t,"access private method"),i);um=new WeakMap,uf=new WeakMap,up=new WeakSet,ug=function(){if(rj(this,uf)===JSON.stringify(this.mediaAudioTrackList))return;rz(this,uf,JSON.stringify(this.mediaAudioTrackList));let e=this.mediaAudioTrackList,t=this.shadowRoot.querySelector("#container");for(let i of(t.textContent="",e)){let e=this.formatOptionText(i.label,i),r=re(e,`${i.id}`,i.enabled);r.prepend(rt(this,"select-indicator")),t.append(r)}},uv=new WeakSet,uE=function(){if(null==this.value)return;let e=new Q.CustomEvent(d.MEDIA_AUDIO_TRACK_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},Q.customElements.get("media-audio-track-listbox")||Q.customElements.define("media-audio-track-listbox",class extends rr{constructor(){super(...arguments),rY(this,up),rY(this,uv),rY(this,um,[]),rY(this,uf,void 0)}static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_AUDIO_TRACK_LIST,m.MEDIA_AUDIO_TRACK_ENABLED]}attributeChangedCallback(e,t,i){(super.attributeChangedCallback(e,t,i),e===m.MEDIA_AUDIO_TRACK_ENABLED&&t!==i)?this.value=i:e===m.MEDIA_AUDIO_TRACK_LIST&&t!==i&&(rz(this,um,null==i?void 0:i.split(/\s+/).map(L)),rX(this,up,ug).call(this))}connectedCallback(){super.connectedCallback(),this.addEventListener("change",rX(this,uv,uE))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",rX(this,uv,uE))}get mediaAudioTrackList(){return rj(this,um)}set mediaAudioTrackList(e){rz(this,um,e),rX(this,up,ug).call(this)}get mediaAudioTrackEnabled(){return W(this,m.MEDIA_AUDIO_TRACK_ENABLED)}set mediaAudioTrackEnabled(e){K(this,m.MEDIA_AUDIO_TRACK_ENABLED,e)}});let rQ=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M11 17H9.5V7H11v10Zm-3-3H6.5v-4H8v4Zm6-5h-1.5v6H14V9Zm3 7h-1.5V8H17v8Z"/>
  <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"/>
</svg>`,rZ=Z.createElement("template");rZ.innerHTML=`
  <slot name="icon">${rQ}</slot>
`,Q.customElements.get("media-audio-track-button")||Q.customElements.define("media-audio-track-button",class extends eo{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_AUDIO_TRACK_ENABLED,m.MEDIA_AUDIO_TRACK_UNAVAILABLE]}constructor(){super({slotTemplate:rZ})}get mediaAudioTrackEnabled(){return W(this,m.MEDIA_AUDIO_TRACK_ENABLED)}set mediaAudioTrackEnabled(e){K(this,m.MEDIA_AUDIO_TRACK_ENABLED,e)}}),Q.customElements.get("media-audio-track-selectmenu")||Q.customElements.define("media-audio-track-selectmenu",class extends r_{static get observedAttributes(){return[...super.observedAttributes,m.MEDIA_AUDIO_TRACK_ENABLED,m.MEDIA_AUDIO_TRACK_UNAVAILABLE]}init(){let e=Z.createElement("media-audio-track-button");e.part.add("button"),e.preventClick=!0;let t=Z.createElement("media-audio-track-listbox");t.part.add("listbox"),t.setAttribute("exportparts","option, option-selected, indicator");let i=this.shadowRoot.querySelector("slot[name=button]"),r=this.shadowRoot.querySelector("slot[name=listbox]");i.textContent="",r.textContent="",i.append(e),r.append(t)}});var rJ=i(25757),r0={exports:{}};!function(e,t){var i,r,a,s,n;i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,n={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var a=n.parseURL(e);if(!a)throw Error("Error trying to parse base URL.");return a.path=n.normalizePath(a.path),n.buildURLFromParts(a)}var s=n.parseURL(t);if(!s)throw Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=n.normalizePath(s.path),n.buildURLFromParts(s)):t;var o=n.parseURL(e);if(!o)throw Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=r.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(d.netLoc=o.netLoc,"/"!==s.path[0])){if(s.path){var u=o.path,h=u.substring(0,u.lastIndexOf("/")+1)+s.path;d.path=n.normalizePath(h)}else d.path=o.path,s.params||(d.params=o.params,s.query||(d.query=o.query))}return null===d.path&&(d.path=i.alwaysNormalize?n.normalizePath(s.path):s.path),n.buildURLFromParts(d)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=n}(r0);var r1=r0.exports;function r2(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function r3(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r2(Object(i),!0).forEach(function(t){var r,a;r=t,a=i[t],(r=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(r))in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r2(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function r4(){return(r4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}let r5=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},r8=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e}({}),r9=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),r6=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({}),r7=function(){},ae={trace:r7,debug:r7,log:r7,warn:r7,info:r7,error:r7},at=ae,ai=at,ar=/^(\d+)x(\d+)$/,aa=/(.+?)=(".*?"|.*?)(?:,|$)/g;class as{constructor(e){for(let t in"string"==typeof e&&(e=as.parseAttrList(e)),e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){let t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(!this[e])return null;{let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;let i=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)i[e]=parseInt(t.slice(2*e,2*e+2),16);return i}}hexadecimalIntegerAsNumber(e){let t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){let i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){let t=ar.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;let i={};for(aa.lastIndex=0;null!==(t=aa.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1));let r=t[1].trim();i[r]=e}return i}}class an{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){let i=t.attr;for(let t in i)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==i[t]){ai.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=r4(new as({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let e=new Date(this.attr["END-DATE"]);r5(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;let e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(r5(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&r5(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class ao{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var al={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class ad{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[al.AUDIO]:null,[al.VIDEO]:null,[al.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){let i=e.split("@",2),r=[];1===i.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(i[1]),r[1]=parseInt(i[0])+r[0],this._byteRange=r}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=r1.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class au extends ad{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new ao,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){let{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){let e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{let e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime||!r5(this.programDateTime))return null;let e=r5(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){let e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){let t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,i,r,a,s=!1){let{elementaryStreams:n}=this,o=n[e];if(!o){n[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:a,partial:s};return}o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,a)}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[al.AUDIO]=null,e[al.VIDEO]=null,e[al.AUDIOVIDEO]=null}}class ah extends ad{constructor(e,t,i,r,a){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new ao,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;let s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class ac{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&r5(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){let e=this.driftEndTime-this.driftStartTime;if(e>0){let t=this.driftEnd-this.driftStart;return 1e3*t/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function am(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function af(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}var ap={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ag={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function av(e){switch(e){case ag.FAIRPLAY:return ap.FAIRPLAY;case ag.PLAYREADY:return ap.PLAYREADY;case ag.WIDEVINE:return ap.WIDEVINE;case ag.CLEARKEY:return ap.CLEARKEY}}var aE={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function ab(e){switch(e){case ap.FAIRPLAY:return ag.FAIRPLAY;case ap.PLAYREADY:return ag.PLAYREADY;case ap.WIDEVINE:return ag.WIDEVINE;case ap.CLEARKEY:return ag.CLEARKEY}}function ay(e){let{drmSystems:t,widevineLicenseUrl:i}=e,r=t?[ap.FAIRPLAY,ap.WIDEVINE,ap.PLAYREADY,ap.CLEARKEY].filter(e=>!!t[e]):[];return!r[ap.WIDEVINE]&&i&&r.push(ap.WIDEVINE),r}let aT="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function aA(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}let a_=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,aS=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,ak=(e,t)=>{let i=t,r=0;for(;a_(e,t);){r+=10;let i=aL(e,t+6);r+=i,aS(e,t+10)&&(r+=10),t+=r}if(r>0)return e.subarray(i,i+r)},aL=(e,t)=>(127&e[t])<<21|(127&e[t+1])<<14|(127&e[t+2])<<7|127&e[t+3],aI=(e,t)=>a_(e,t)&&aL(e,t+6)+10<=e.length-t,aR=e=>{let t=aC(e);for(let e=0;e<t.length;e++){let i=t[e];if(aw(i))return aN(i)}},aw=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,aD=e=>{let t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=aL(e,4);return{type:t,size:i,data:e.subarray(10,10+i)}},aC=e=>{let t=0,i=[];for(;a_(e,t);){let r=aL(e,t+6);t+=10;let a=t+r;for(;t+8<a;){let r=aD(e.subarray(t)),a=aM(r);a&&i.push(a),t+=r.size+10}aS(e,t)&&(t+=10)}return i},aM=e=>"PRIV"===e.type?ax(e):"W"===e.type[0]?aP(e):aO(e),ax=e=>{if(e.size<2)return;let t=aU(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}},aO=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1,i=aU(e.data.subarray(t),!0);t+=i.length+1;let r=aU(e.data.subarray(t));return{key:e.type,info:i,data:r}}let t=aU(e.data.subarray(1));return{key:e.type,data:t}},aP=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1,i=aU(e.data.subarray(t),!0);t+=i.length+1;let r=aU(e.data.subarray(t));return{key:e.type,info:i,data:r}}let t=aU(e.data);return{key:e.type,data:t}},aN=e=>{if(8===e.data.byteLength){let t=new Uint8Array(e.data),i=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,i&&(r+=47721858.84),Math.round(r)}},aU=(e,t=!1)=>{let i,r;let a=(s||void 0===self.TextDecoder||(s=new self.TextDecoder("utf-8")),s);if(a){let i=a.decode(e);if(t){let e=i.indexOf("\x00");return -1!==e?i.substring(0,e):i}return i.replace(/\0/g,"")}let n=e.length,o="",l=0;for(;l<n&&(0!==(i=e[l++])||!t);)if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:o+=String.fromCharCode((31&i)<<6|63&e[l++]);break;case 14:o+=String.fromCharCode((15&i)<<12|(63&e[l++])<<6|(63&e[l++])<<0)}return o},aF={hexDump:function(e){let t="";for(let i=0;i<e.length;i++){let r=e[i].toString(16);r.length<2&&(r="0"+r),t+=r}return t}},aB=[].push,a$={video:1,audio:2,id3:3,text:4};function aV(e){return String.fromCharCode.apply(null,e)}function aH(e,t){let i=e[t]<<8|e[t+1];return i<0?65536+i:i}function aG(e,t){let i=aW(e,t);return i<0?4294967296+i:i}function aW(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function aK(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function aq(e,t){let i=[];if(!t.length)return i;let r=e.byteLength;for(let a=0;a<r;){let s=aG(e,a),n=aV(e.subarray(a+4,a+8)),o=s>1?a+s:r;if(n===t[0]){if(1===t.length)i.push(e.subarray(a+8,o));else{let r=aq(e.subarray(a+8,o),t.slice(1));r.length&&aB.apply(i,r)}}a=o}return i}function aj(e){let t=[],i=aq(e,["moov","trak"]);for(let e=0;e<i.length;e++){let r=i[e],a=aq(r,["tkhd"])[0];if(a){let e=a[0],i=0===e?12:20,s=aG(a,i),n=aq(r,["mdia","mdhd"])[0];if(n){i=0===(e=n[0])?12:20;let a=aG(n,i),o=aq(r,["mdia","hdlr"])[0];if(o){let e=aV(o.subarray(8,12)),i={soun:al.AUDIO,vide:al.VIDEO}[e];if(i){let e;let n=aq(r,["mdia","minf","stbl","stsd"])[0];n&&(e=aV(n.subarray(12,16))),t[s]={timescale:a,type:i},t[i]={timescale:a,id:s,codec:e}}}}}}let r=aq(e,["moov","mvex","trex"]);return r.forEach(e=>{let i=aG(e,4),r=t[i];r&&(r.default={duration:aG(e,12),flags:aG(e,20)})}),t}function aY(e){let t=aq(e,["schm"])[0];if(t){let i=aV(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return aq(e,["schi","tenc"])[0]}return ai.error("[eme] missing 'schm' box"),null}function az(e,t){let i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function aX(e,t){let i=[],r=t.samples,a=t.timescale,s=t.id,n=!1,o=aq(r,["moof"]);return o.map(o=>{let l=o.byteOffset-8,d=aq(o,["traf"]);d.map(o=>{let d=aq(o,["tfdt"]).map(e=>{let t=e[0],i=aG(e,4);return 1===t&&(i*=4294967296,i+=aG(e,8)),i/a})[0];return void 0!==d&&(e=d),aq(o,["tfhd"]).map(d=>{let u=aG(d,4),h=16777215&aG(d,0),c=0,m=0,f=8;u===s&&((1&h)!=0&&(f+=8),(2&h)!=0&&(f+=4),(8&h)!=0&&(c=aG(d,f),f+=4),(16&h)!=0&&(m=aG(d,f),f+=4),(32&h)!=0&&(f+=4),"video"===t.type&&(n=function(e){if(!e)return!1;let t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}(t.codec)),aq(o,["trun"]).map(s=>{let o=s[0],d=16777215&aG(s,0),u=0,h=(256&d)!=0,f=0,p=(512&d)!=0,g=0,v=(1024&d)!=0,E=(2048&d)!=0,b=0,y=aG(s,4),T=8;(1&d)!=0&&(u=aG(s,T),T+=4),(4&d)!=0&&(T+=4);let A=u+l;for(let l=0;l<y;l++){if(h?(f=aG(s,T),T+=4):f=c,p?(g=aG(s,T),T+=4):g=m,v&&(T+=4),E&&(b=0===o?aG(s,T):aW(s,T),T+=4),t.type===al.VIDEO){let t=0;for(;t<g;){let s=aG(r,A);if(A+=4,function(e,t){if(!e)return 6==(31&t);{let e=t>>1&63;return 39===e||40===e}}(n,r[A])){let t=r.subarray(A,A+s);aQ(t,n?2:1,e+b/a,i)}A+=s,t+=s+4}}e+=f/a}}))})})}),i}function aQ(e,t,i,r){let a;let s=aZ(e);a=0+t;let n=0,o=0,l=!1,d=0;for(;a<s.length;){n=0;do{if(a>=s.length)break;n+=d=s[a++]}while(255===d);o=0;do{if(a>=s.length)break;o+=d=s[a++]}while(255===d);let e=s.length-a;if(!l&&4===n&&a<s.length){l=!0;let e=s[a++];if(181===e){let e=aH(s,a);if(a+=2,49===e){let e=aG(s,a);if(a+=4,1195456820===e){let e=s[a++];if(3===e){let t=s[a++],o=31&t,l=64&t,d=l?2+3*o:0,u=new Uint8Array(d);if(l){u[0]=t;for(let e=1;e<d;e++)u[e]=s[a++]}r.push({type:e,payloadType:n,pts:i,bytes:u})}}}}}else if(5===n&&o<e){if(l=!0,o>16){let e=[];for(let t=0;t<16;t++){let i=s[a++].toString(16);e.push(1==i.length?"0"+i:i),(3===t||5===t||7===t||9===t)&&e.push("-")}let t=o-16,l=new Uint8Array(t);for(let e=0;e<t;e++)l[e]=s[a++];r.push({payloadType:n,pts:i,uuid:e.join(""),userData:aU(l),userDataBytes:l})}}else if(o<e)a+=o;else if(o>e)break}}function aZ(e){let t=e.byteLength,i=[],r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(i.push(r+2),r+=2):r++;if(0===i.length)return e;let a=t-i.length,s=new Uint8Array(a),n=0;for(r=0;r<a;n++,r++)n===i[0]&&(n++,i.shift()),s[r]=e[n];return s}let aJ={};class a0{static clearKeyUriToKeyIdMap(){aJ={}}constructor(e,t,i,r=[1],a=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=a,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case ag.FAIRPLAY:case ag.WIDEVINE:case ag.PLAYREADY:case ag.CLEARKEY:return -1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||ai.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);let t=function(e){let t=new Uint8Array(16);for(let i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}(e),i=new a0(this.method,this.uri,"identity",this.keyFormatVersions,t);return i}let t=function(e){let t=e.split(":"),i=null;if("data"===t[0]&&2===t.length){let e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){let t="base64"===r[0],a=r[1];t?(e.splice(-1,1),i=am(a)):i=function(e){let t=af(e).subarray(0,16),i=new Uint8Array(16);return i.set(t,16-t.length),i}(a)}}return i}(this.uri);if(t)switch(this.keyFormat){case ag.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case ag.PLAYREADY:{let e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,i){let r,a,s;if(16!==e.byteLength)throw RangeError("Invalid system id");if(t){r=1,a=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){let i=t[e];if(16!==i.byteLength)throw RangeError("Invalid key");a.set(i,16*e)}}else r=0,a=new Uint8Array;r>0?(s=new Uint8Array(4),t.length>0&&new DataView(s.buffer).setUint32(0,t.length,!1)):s=new Uint8Array;let n=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(n.buffer).setUint32(0,i.byteLength,!1),function(e,...t){let i=t.length,r=8,a=i;for(;a--;)r+=t[a].byteLength;let s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(e,4),a=0,r=8;a<i;a++)s.set(t[a],r),r+=t[a].byteLength;return s}([112,115,115,104],new Uint8Array([r,0,0,0]),e,s,a,n,i||new Uint8Array)}(e,null,t);let i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),r=String.fromCharCode.apply(null,Array.from(i)),a=r.substring(r.indexOf("<"),r.length),s=new DOMParser,n=s.parseFromString(a,"text/xml"),o=n.getElementsByTagName("KID")[0];if(o){let e=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(e){let t=am(e).subarray(0,16);(function(e){let t=function(e,t,i){let r=e[t];e[t]=e[i],e[i]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)})(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){let t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e}}if(!this.keyId||16!==this.keyId.byteLength){let e=aJ[this.uri];if(!e){let t=Object.keys(aJ).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);let i=new DataView(e.buffer,12,4);i.setUint32(0,t),aJ[this.uri]=e}this.keyId=e}return this}}let a1=/\{\$([a-zA-Z0-9-_]+)\}/g;function a2(e,t,i){if(null!==e.variableList||e.hasVariableRefs)for(let r=i.length;r--;){let a=i[r],s=t[a];s&&(t[a]=a3(e,s))}}function a3(e,t){if(null!==e.variableList||e.hasVariableRefs){let i=e.variableList;return t.replace(a1,t=>{let r=t.substring(2,t.length-1),a=null==i?void 0:i[r];return void 0===a?(e.playlistParsingError||(e.playlistParsingError=Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),t):a})}return t}function a4(e,t,i){let r,a,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{let e=new self.URL(i).searchParams;if(e.has(r))a=e.get(r);else throw Error(`"${r}" does not match any query parameter in URI: "${i}"`)}catch(t){e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else r=t.NAME,a=t.VALUE;r in s?e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=a||""}function a5(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}let a8={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},a9=a5();function a6(e,t){var i;return null!=(i=null==a9?void 0:a9.isTypeSupported(`${t||"video"}/mp4;codecs="${e}"`))&&i}let a7=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,se=/#EXT-X-MEDIA:(.*)/g,st=/^#EXT(?:INF|-X-TARGETDURATION):/m,si=RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),sr=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class sa{static findGroup(e,t){for(let i=0;i<e.length;i++){let r=e[i];if(r.id===t)return r}}static convertAVC1ToAVCOTI(e){let t=e.split(".");return t.length>2?t.shift()+"."+(parseInt(t.shift()).toString(16)+("000"+parseInt(t.shift()).toString(16)).slice(-4)):e}static resolve(e,t){return r1.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return st.test(e)}static parseMasterPlaylist(e,t){var i;let r;let a=a1.test(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:a},n=[];for(a7.lastIndex=0;null!=(r=a7.exec(e));)if(r[1]){let e=new as(r[1]);a2(s,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);let a=a3(s,r[2]),o={attrs:e,bitrate:e.decimalInteger("AVERAGE-BANDWIDTH")||e.decimalInteger("BANDWIDTH"),name:e.NAME,url:sa.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),function(e,t){["video","audio","text"].forEach(i=>{let r=e.filter(e=>(function(e,t){let i=a8[t];return!!i&&!0===i[e.slice(0,4)]})(e,i));if(r.length){let a=r.filter(e=>0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0));t[`${i}Codec`]=a.length>0?a[0]:r[0],e=e.filter(e=>-1===r.indexOf(e))}}),t.unknownCodecs=e}((e.CODECS||"").split(/[ ,]+/).filter(e=>e),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=sa.convertAVC1ToAVCOTI(o.videoCodec)),null!=(i=o.unknownCodecs)&&i.length||n.push(o),s.levels.push(o)}else if(r[3]){let e=r[3],i=r[4];switch(e){case"SESSION-DATA":{let e=new as(i);a2(s,e,["DATA-ID","LANGUAGE","VALUE","URI"]);let t=e["DATA-ID"];t&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[t]=e);break}case"SESSION-KEY":{let e=ss(i,t,s);e.encrypted&&e.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(e)):ai.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":{let e=new as(i);a2(s,e,["NAME","VALUE","QUERYPARAM"]),a4(s,e,t)}break;case"CONTENT-STEERING":{let e=new as(i);a2(s,e,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:sa.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=sn(i)}}let o=n.length>0&&n.length<s.levels.length;return s.levels=o?n:s.levels,0===s.levels.length&&(s.playlistParsingError=Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,i){let r;let a={},s=i.levels,n={AUDIO:s.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:s.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]},o=0;for(se.lastIndex=0;null!==(r=se.exec(e));){let e=new as(r[1]),s=e.TYPE;if(s){let r=n[s],l=a[s]||[];a[s]=l,a2(i,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);let d={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",instreamId:e["INSTREAM-ID"],name:e.NAME||e.LANGUAGE||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:e.LANGUAGE,url:e.URI?sa.resolve(e.URI,t):""};if(null!=r&&r.length){let e=sa.findGroup(r,d.groupId)||r[0];so(d,e,"audioCodec"),so(d,e,"textCodec")}l.push(d)}}return a}static parseLevelPlaylist(e,t,i,r,a,s){let n,o,l;let d=new ac(t),u=d.fragments,h=null,c=0,m=0,f=0,p=0,g=null,v=new au(r,t),E=-1,b=!1;for(si.lastIndex=0,d.m3u8=e,d.hasVariableRefs=a1.test(e);null!==(n=si.exec(e));){b&&(b=!1,(v=new au(r,t)).start=f,v.sn=c,v.cc=p,v.level=i,h&&(v.initSegment=h,v.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null));let e=n[1];if(e){v.duration=parseFloat(e);let t=(" "+n[2]).slice(1);v.title=t||null,v.tagList.push(t?["INF",e,t]:["INF",e])}else if(n[3]){if(r5(v.duration)){v.start=f,l&&su(v,l,d),v.sn=c,v.level=i,v.cc=p,v.urlId=a,u.push(v);let e=(" "+n[3]).slice(1);v.relurl=a3(d,e),sl(v,g),g=v,f+=v.duration,c++,m=0,b=!0}}else if(n[4]){let e=(" "+n[4]).slice(1);g?v.setByteRange(e,g):v.setByteRange(e)}else if(n[5])v.rawProgramDateTime=(" "+n[5]).slice(1),v.tagList.push(["PROGRAM-DATE-TIME",v.rawProgramDateTime]),-1===E&&(E=u.length);else{if(!(n=n[0].match(sr))){ai.warn("No matches on slow regex match for level playlist!");continue}for(o=1;o<n.length&&void 0===n[o];o++);let e=(" "+n[o]).slice(1),a=(" "+n[o+1]).slice(1),f=n[o+2]?(" "+n[o+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":d.type=a.toUpperCase();break;case"MEDIA-SEQUENCE":c=d.startSN=parseInt(a);break;case"SKIP":{let e=new as(a);a2(d,e,["RECENTLY-REMOVED-DATERANGES"]);let t=e.decimalInteger("SKIPPED-SEGMENTS");if(r5(t)){d.skippedSegments=t;for(let e=t;e--;)u.unshift(null);c+=t}let i=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(d.recentlyRemovedDateranges=i.split("	"));break}case"TARGETDURATION":d.targetduration=Math.max(parseInt(a),1);break;case"VERSION":d.version=parseInt(a);break;case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"#":(a||f)&&v.tagList.push(f?[a,f]:[a]);break;case"DISCONTINUITY":p++,v.tagList.push(["DIS"]);break;case"GAP":v.gap=!0,v.tagList.push([e]);break;case"BITRATE":v.tagList.push([e,a]);break;case"DATERANGE":{let e=new as(a);a2(d,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),a2(d,e,e.clientAttrs);let t=new an(e,d.dateRanges[e.ID]);t.isValid||d.skippedSegments?d.dateRanges[t.id]=t:ai.warn(`Ignoring invalid DATERANGE tag: "${a}"`),v.tagList.push(["EXT-X-DATERANGE",a]);break}case"DEFINE":{let e=new as(a);a2(d,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?function(e,t,i){let r=t.IMPORT;if(i&&r in i){let t=e.variableList;t||(e.variableList=t={}),t[r]=i[r]}else e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}(d,e,s):a4(d,e,t)}break;case"DISCONTINUITY-SEQUENCE":p=parseInt(a);break;case"KEY":{let e=ss(a,t,d);if(e.isSupported()){if("NONE"===e.method){l=void 0;break}l||(l={}),l[e.keyFormat]&&(l=r4({},l)),l[e.keyFormat]=e}else ai.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${a}"`);break}case"START":d.startTimeOffset=sn(a);break;case"MAP":{let e=new as(a);if(a2(d,e,["BYTERANGE","URI"]),v.duration){let a=new au(r,t);sd(a,e,i,l),h=a,v.initSegment=h,h.rawProgramDateTime&&!v.rawProgramDateTime&&(v.rawProgramDateTime=h.rawProgramDateTime)}else sd(v,e,i,l),h=v,b=!0;break}case"SERVER-CONTROL":{let e=new as(a);d.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),d.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{let e=new as(a);d.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=d.partList;e||(e=d.partList=[]);let i=m>0?e[e.length-1]:void 0,r=m++,s=new as(a);a2(d,s,["BYTERANGE","URI"]);let n=new ah(s,v,t,r,i);e.push(n),v.duration+=n.duration;break}case"PRELOAD-HINT":{let e=new as(a);a2(d,e,["URI"]),d.preloadHint=e;break}case"RENDITION-REPORT":{let e=new as(a);a2(d,e,["URI"]),d.renditionReports=d.renditionReports||[],d.renditionReports.push(e);break}default:ai.warn(`line parsed but not handled: ${n}`)}}}g&&!g.relurl?(u.pop(),f-=g.duration,d.partList&&(d.fragmentHint=g)):d.partList&&(sl(v,g),v.cc=p,d.fragmentHint=v,l&&su(v,l,d));let y=u.length,T=u[0],A=u[y-1];if((f+=d.skippedSegments*d.targetduration)>0&&y&&A){d.averagetargetduration=f/y;let e=A.sn;d.endSN="initSegment"!==e?e:0,d.live||(A.endList=!0),T&&(d.startCC=T.cc)}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(f+=d.fragmentHint.duration),d.totalduration=f,d.endCC=p,E>0&&function(e,t){let i=e[t];for(let r=t;r--;){let t=e[r];if(!t)return;t.programDateTime=i.programDateTime-1e3*t.duration,i=t}}(u,E),d}}function ss(e,t,i){var r,a;let s=new as(e);a2(i,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);let n=null!=(r=s.METHOD)?r:"",o=s.URI,l=s.hexadecimalInteger("IV"),d=s.KEYFORMATVERSIONS,u=null!=(a=s.KEYFORMAT)?a:"identity";o&&s.IV&&!l&&ai.error(`Invalid IV: ${s.IV}`);let h=o?sa.resolve(o,t):"",c=(d||"1").split("/").map(Number).filter(Number.isFinite);return new a0(n,h,u,c,l)}function sn(e){let t=new as(e),i=t.decimalFloatingPoint("TIME-OFFSET");return r5(i)?i:null}function so(e,t,i){let r=t[i];r&&(e[i]=r)}function sl(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),r5(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function sd(e,t,i,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function su(e,t,i){e.levelkeys=t;let{encryptedFragments:r}=i;(!r.length||r[r.length-1].levelkeys!==t)&&Object.keys(t).some(e=>t[e].isCommonEncryption)&&r.push(e)}var sh={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},sc={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function sm(e){let{type:t}=e;switch(t){case sh.AUDIO_TRACK:return sc.AUDIO;case sh.SUBTITLE_TRACK:return sc.SUBTITLE;default:return sc.MAIN}}function sf(e,t){let i=e.url;return(void 0===i||0===i.indexOf("data:"))&&(i=t.url),i}class sp{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.LEVEL_LOADING,this.onLevelLoading,this),e.on(r8.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(r8.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){let{hls:e}=this;e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.LEVEL_LOADING,this.onLevelLoading,this),e.off(r8.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(r8.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){let t=this.hls.config,i=t.pLoader,r=t.loader,a=new(i||r)(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:sh.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(e,t){let{id:i,level:r,url:a,deliveryDirectives:s}=t;this.load({id:i,level:r,responseType:"text",type:sh.LEVEL,url:a,deliveryDirectives:s})}onAudioTrackLoading(e,t){let{id:i,groupId:r,url:a,deliveryDirectives:s}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:sh.AUDIO_TRACK,url:a,deliveryDirectives:s})}onSubtitleTrackLoading(e,t){let{id:i,groupId:r,url:a,deliveryDirectives:s}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:sh.SUBTITLE_TRACK,url:a,deliveryDirectives:s})}load(e){var t;let i;let r=this.hls.config,a=this.getInternalLoader(e);if(a){let t=a.context;if(t&&t.url===e.url){ai.trace("[playlist-loader]: playlist request ongoing");return}ai.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),a.abort()}if(i=e.type===sh.MANIFEST?r.manifestLoadPolicy.default:r4({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part){let t;if(e.type===sh.LEVEL&&null!==e.level?t=this.hls.levels[e.level].details:e.type===sh.AUDIO_TRACK&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===sh.SUBTITLE_TRACK&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){let e=t.partTarget,r=t.targetduration;if(e&&r){let t=1e3*Math.max(3*e,.8*r);i=r4({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}let s=i.errorRetry||i.timeoutRetry||{},n={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0};a.load(e,n,{onSuccess:(e,t,i,r)=>{let a=this.getInternalLoader(i);this.resetInternalLoader(i.type);let s=e.data;if(0!==s.indexOf("#EXTM3U")){this.handleManifestParsingError(e,i,Error("no EXTM3U delimiter"),r||null,t);return}t.parsing.start=performance.now(),sa.isMediaPlaylist(s)?this.handleTrackOrLevelPlaylist(e,t,i,r||null,a):this.handleMasterPlaylist(e,t,i,r)},onError:(e,t,i,r)=>{this.handleNetworkError(t,i,!1,e,r)},onTimeout:(e,t,i)=>{this.handleNetworkError(t,i,!0,void 0,e)}})}handleMasterPlaylist(e,t,i,r){let a=this.hls,s=e.data,n=sf(e,i),o=sa.parseMasterPlaylist(s,n);if(o.playlistParsingError){this.handleManifestParsingError(e,i,o.playlistParsingError,r,t);return}let{contentSteering:l,levels:d,sessionData:u,sessionKeys:h,startTimeOffset:c,variableList:m}=o;this.variableList=m;let{AUDIO:f=[],SUBTITLES:p,"CLOSED-CAPTIONS":g}=sa.parseMasterPlaylistMedia(s,n,o);if(f.length){let e=f.some(e=>!e.url);e||!d[0].audioCodec||d[0].attrs.AUDIO||(ai.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new as({}),bitrate:0,url:""}))}a.trigger(r8.MANIFEST_LOADED,{levels:d,audioTracks:f,subtitles:p,captions:g,contentSteering:l,url:n,stats:t,networkDetails:r,sessionData:u,sessionKeys:h,startTimeOffset:c,variableList:m})}handleTrackOrLevelPlaylist(e,t,i,r,a){let s=this.hls,{id:n,level:o,type:l}=i,d=sf(e,i),u=r5(n)?n:0,h=r5(o)?o:u,c=sm(i),m=sa.parseLevelPlaylist(e.data,d,h,c,u,this.variableList);if(l===sh.MANIFEST){let e={attrs:new as({}),bitrate:0,details:m,name:"",url:d};s.trigger(r8.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=m,this.handlePlaylistLoaded(m,e,t,i,r,a)}handleManifestParsingError(e,t,i,r,a){this.hls.trigger(r8.ERROR,{type:r9.NETWORK_ERROR,details:r6.MANIFEST_PARSING_ERROR,fatal:t.type===sh.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:a})}handleNetworkError(e,t,i=!1,r,a){let s=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===sh.LEVEL?s+=`: ${e.level} id: ${e.id}`:(e.type===sh.AUDIO_TRACK||e.type===sh.SUBTITLE_TRACK)&&(s+=` id: ${e.id} group-id: "${e.groupId}"`);let n=Error(s);ai.warn(`[playlist-loader]: ${s}`);let o=r6.UNKNOWN,l=!1,d=this.getInternalLoader(e);switch(e.type){case sh.MANIFEST:o=i?r6.MANIFEST_LOAD_TIMEOUT:r6.MANIFEST_LOAD_ERROR,l=!0;break;case sh.LEVEL:o=i?r6.LEVEL_LOAD_TIMEOUT:r6.LEVEL_LOAD_ERROR,l=!1;break;case sh.AUDIO_TRACK:o=i?r6.AUDIO_TRACK_LOAD_TIMEOUT:r6.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case sh.SUBTITLE_TRACK:o=i?r6.SUBTITLE_TRACK_LOAD_TIMEOUT:r6.SUBTITLE_LOAD_ERROR,l=!1}d&&this.resetInternalLoader(e.type);let u={type:r9.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:d,context:e,error:n,networkDetails:t,stats:a};if(r){let i=(null==t?void 0:t.url)||e.url;u.response=r3({url:i,data:void 0},r)}this.hls.trigger(r8.ERROR,u)}handlePlaylistLoaded(e,t,i,r,a,s){let n=this.hls,{type:o,level:l,id:d,groupId:u,deliveryDirectives:h}=r,c=sf(t,r),m=sm(r),f="number"==typeof r.level&&m===sc.MAIN?l:void 0;if(!e.fragments.length){let e=Error("No Segments found in Playlist");n.trigger(r8.ERROR,{type:r9.NETWORK_ERROR,details:r6.LEVEL_EMPTY_ERROR,fatal:!1,url:c,error:e,reason:e.message,response:t,context:r,level:f,parent:m,networkDetails:a,stats:i});return}e.targetduration||(e.playlistParsingError=Error("Missing Target Duration"));let p=e.playlistParsingError;if(p){n.trigger(r8.ERROR,{type:r9.NETWORK_ERROR,details:r6.LEVEL_PARSING_ERROR,fatal:!1,url:c,error:p,reason:p.message,response:t,context:r,level:f,parent:m,networkDetails:a,stats:i});return}switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),(!s.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),o){case sh.MANIFEST:case sh.LEVEL:n.trigger(r8.LEVEL_LOADED,{details:e,level:f||0,id:d||0,stats:i,networkDetails:a,deliveryDirectives:h});break;case sh.AUDIO_TRACK:n.trigger(r8.AUDIO_TRACK_LOADED,{details:e,id:d||0,groupId:u||"",stats:i,networkDetails:a,deliveryDirectives:h});break;case sh.SUBTITLE_TRACK:n.trigger(r8.SUBTITLE_TRACK_LOADED,{details:e,id:d||0,groupId:u||"",stats:i,networkDetails:a,deliveryDirectives:h})}}}function sg(e,t){let i;try{i=new Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function sv(e,t){let i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw Error(`addCue is failed for: ${t}`)}catch(i){ai.debug(`[texttrack-utils]: ${i}`);try{let i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}catch(e){ai.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===i&&(e.mode=i)}function sE(e){let t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let t=e.cues.length;t--;)e.removeCue(e.cues[t]);"disabled"===t&&(e.mode=t)}function sb(e,t,i,r){let a=e.mode;if("disabled"===a&&(e.mode="hidden"),e.cues&&e.cues.length>0){let a=function(e,t,i){let r=[],a=function(e,t){if(t<e[0].startTime)return 0;let i=e.length-1;if(t>e[i].endTime)return -1;let r=0,a=i;for(;r<=a;){let s=Math.floor((a+r)/2);if(t<e[s].startTime)a=s-1;else{if(!(t>e[s].startTime)||!(r<i))return s;r=s+1}}return e[r].startTime-t<t-e[a].startTime?r:a}(e,t);if(a>-1)for(let s=a,n=e.length;s<n;s++){let a=e[s];if(a.startTime>=t&&a.endTime<=i)r.push(a);else if(a.startTime>i)break}return r}(e.cues,t,i);for(let t=0;t<a.length;t++)(!r||r(a[t]))&&e.removeCue(a[t])}"disabled"===a&&(e.mode=a)}var sy={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};function sT(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}let sA=(()=>{let e=sT();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function s_(e,t){return e.getTime()/1e3-t}class sS{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){let{hls:e}=this;e.on(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(r8.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(r8.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){let{hls:e}=this;e.off(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(r8.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(r8.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(sE(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){let i=e[t];if("metadata"===i.kind&&"id3"===i.label)return sg(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;let{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;let{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let s=sT();for(let e=0;e<a.length;e++){let t=a[e].type;if(t===sy.emsg&&!i||!r)continue;let n=aC(a[e].data);if(n){let i=a[e].pts,r=i+a[e].duration;r>sA&&(r=sA);let o=r-i;o<=0&&(r=i+.25);for(let e=0;e<n.length;e++){let a=n[e];if(!aw(a)){this.updateId3CueEnds(i,t);let e=new s(i,r,"");e.value=a,t&&(e.type=t),this.id3Track.addCue(e)}}}}}updateId3CueEnds(e,t){var i;let r=null==(i=this.id3Track)?void 0:i.cues;if(r)for(let i=r.length;i--;){let a=r[i];a.type===t&&a.startTime<e&&a.endTime===sA&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){let{id3Track:a,hls:s}=this;if(!s)return;let{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:o}}=s;a&&(n||o)&&sb(a,t,i,"audio"===r?e=>e.type===sy.audioId3&&o:"video"===r?e=>e.type===sy.emsg&&n:e=>e.type===sy.audioId3&&o||e.type===sy.emsg&&n)}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;let{dateRangeCuesAppended:i,id3Track:r}=this,{dateRanges:a}=t,s=Object.keys(a);if(r){let e=Object.keys(i).filter(e=>!s.includes(e));for(let t=e.length;t--;){let a=e[t];Object.keys(i[a].cues).forEach(e=>{r.removeCue(i[a].cues[e])}),delete i[a]}}let n=t.fragments[t.fragments.length-1];if(0===s.length||!r5(null==n?void 0:n.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));let o=n.programDateTime/1e3-n.start,l=sT();for(let e=0;e<s.length;e++){let t=s[e],r=a[t],n=i[t],u=(null==n?void 0:n.cues)||{},h=(null==n?void 0:n.durationKnown)||!1,c=s_(r.startDate,o),m=sA,f=r.endDate;if(f)m=s_(f,o),h=!0;else if(r.endOnNext&&!h){let e=s.reduce((e,t)=>{let i=a[t];return i.class===r.class&&i.id!==t&&i.startDate>r.startDate&&e.push(i),e},[]).sort((e,t)=>e.startDate.getTime()-t.startDate.getTime())[0];e&&(m=s_(e.startDate,o),h=!0)}let p=Object.keys(r.attr);for(let e=0;e<p.length;e++){var d;let i=p[e];if(!("ID"!==i&&"CLASS"!==i&&"START-DATE"!==i&&"DURATION"!==i&&"END-DATE"!==i&&"END-ON-NEXT"!==i))continue;let a=u[i];if(a)h&&!n.durationKnown&&(a.endTime=m);else{let e=r.attr[i];a=new l(c,m,""),("SCTE35-OUT"===i||"SCTE35-IN"===i)&&(d=e,e=Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),a.value={key:i,data:e},a.type=sy.dateRange,a.id=t,this.id3Track.addCue(a),u[i]=a}}i[t]={cues:u,dateRange:r,durationKnown:h}}}}class sk{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){let{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let{levelDetails:e}=this;if(null===e)return null;let{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:a,liveSyncDurationCount:s,lowLatencyMode:n}=this.config,o=this.hls.userConfig,l=n&&i||t;return(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==a?a:s*r),l+Math.min(1*this.stallCount,r)}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(null===e||null===t||null===i)return null;let r=i.edge,a=e-t-this.edgeStalled,s=r-i.totalduration,n=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(s,a),n)}get drift(){let{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){let{levelDetails:e}=this;if(null===e)return 0;let t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e,levelDetails:t}=this;if(!e||!t)return 0;let i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(r8.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(r8.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(r8.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(r8.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(r8.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(r8.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var i;t.details===r6.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(i=this.levelDetails)&&i.live&&ai.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){let{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;let i=this.computeLatency();if(null===i)return;this._latency=i;let{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||1===a)return;let s=this.targetLatency;if(null===s)return;let n=i-s,o=Math.min(this.maxLatency,s+t.targetduration);if(t.live&&n<o&&n>.05&&this.forwardBufferLength>1){let t=Math.round(2/(1+Math.exp(-.75*n-this.edgeStalled))*20)/20;e.playbackRate=Math.min(Math.min(2,Math.max(1,a)),Math.max(1,t))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){let{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}let sL=["NONE","TYPE-0","TYPE-1",null];var sI={No:"",Yes:"YES",v2:"v2"};class sR{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){let t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class sw{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>e).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){let t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function sD(e,t){let i=t.startPTS;if(r5(i)){let r,a=0;t.sn>e.sn?(a=i-e.start,r=e):(a=e.start-i,r=t),r.duration!==a&&(r.duration=a)}else if(t.sn>e.sn){let i=e.cc===t.cc;i&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function sC(e,t,i,r,a,s){let n;let o=r-i;o<=0&&(ai.warn("Fragment should have a positive duration",t),r=i+t.duration,s=a+t.duration);let l=i,d=r,u=t.startPTS,h=t.endPTS;if(r5(u)){let e=Math.abs(u-i);r5(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,l=Math.max(i,u),i=Math.min(i,u),a=Math.min(a,t.startDTS),d=Math.min(r,h),r=Math.max(r,h),s=Math.max(s,t.endDTS)}let c=i-t.start;0!==t.start&&(t.start=i),t.duration=r-t.start,t.startPTS=i,t.maxStartPTS=l,t.startDTS=a,t.endPTS=r,t.minEndPTS=d,t.endDTS=s;let m=t.sn;if(!e||m<e.startSN||m>e.endSN)return 0;let f=m-e.startSN,p=e.fragments;for(p[f]=t,n=f;n>0;n--)sD(p[n],p[n-1]);for(n=f;n<p.length-1;n++)sD(p[n],p[n+1]);return e.fragmentHint&&sD(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,c}function sM(e,t){let i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments;i<0||i>=r.length||sx(t,r[i].start)}function sx(e,t){if(t){let i=e.fragments;for(let r=e.skippedSegments;r<i.length;r++)i[r].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function sO(e,t,i){var r;return null!=e&&e.details?sP(null==(r=e.details)?void 0:r.partList,t,i):null}function sP(e,t,i){if(e)for(let r=e.length;r--;){let a=e[r];if(a.index===i&&a.fragment.sn===t)return a}return null}function sN(e){switch(e.details){case r6.FRAG_LOAD_TIMEOUT:case r6.KEY_LOAD_TIMEOUT:case r6.LEVEL_LOAD_TIMEOUT:case r6.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function sU(e,t){let i=sN(t);return e.default[`${i?"timeout":"error"}Retry`]}function sF(e,t){let i="linear"===e.backoff?1:Math.pow(2,t);return Math.min(i*e.retryDelayMs,e.maxRetryDelayMs)}function sB(e){return r3(r3({},e),{errorRetry:null,timeoutRetry:null})}function s$(e,t,i,r){return!!e&&t<e.maxNumRetry&&(0===r&&!1===navigator.onLine||!!r&&(r<400||r>499)||!!i)}let sV={search:function(e,t){let i=0,r=e.length-1,a=null,s=null;for(;i<=r;){s=e[a=(i+r)/2|0];let n=t(s);if(n>0)i=a+1;else{if(!(n<0))return s;r=a-1}}return null}};function sH(e,t,i=0,r=0){let a=null;if(e?a=t[e.sn-t[0].sn+1]||null:0===i&&0===t[0].start&&(a=t[0]),a&&0===sG(i,r,a))return a;let s=sV.search(t,sG.bind(null,i,r));return s&&(s!==e||!a)?s:a}function sG(e=0,t=0,i){if(i.start<=e&&i.start+i.duration>e)return 0;let r=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=e?1:i.start-r>e&&i.start?-1:0}var sW={DoNothing:0,SendAlternateToPenaltyBox:2,RetryRequest:5},sK={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class sq{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=ai.log.bind(ai,`${t}:`),this.warn=ai.warn.bind(ai,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){let i=null==t?void 0:t.renditionReports;if(i){let r=-1;for(let a=0;a<i.length;a++){let s;let n=i[a];try{s=new self.URL(n.URI,t.url).href}catch(e){ai.warn(`Could not construct new URL for Rendition Report: ${e}`),s=n.URI||""}if(s===e){r=a;break}s===e.substring(0,s.length)&&(r=a)}if(-1!==r){let e=i[r],a=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn),s=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){let e=Math.min(t.age-t.partTarget,t.targetduration);s>=0&&e>t.partTarget&&(s+=1)}return new sR(a,s>=0?s:void 0,sI.No)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return -1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,i){let{details:r,stats:a}=t,s=self.performance.now(),n=a.loading.first?Math.max(0,s-a.loading.first):0;if(r.advancedDateTime=Date.now()-n,r.live||null!=i&&i.live){let n,o,l;if(r.reloaded(i),i&&this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),i&&r.fragments.length>0&&function(e,t){let i,r=null,a=e.fragments;for(let e=a.length-1;e>=0;e--){let t=a[e].initSegment;if(t){r=t;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let s=0;if(function(e,t,i){let r=t.skippedSegments,a=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,n=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let e=a;e<=s;e++){let a=l[n+e],s=o[e];r&&!s&&e<r&&(s=t.fragments[e]=a),a&&s&&i(a,s)}}(e,t,(e,a)=>{e.relurl&&(s=e.cc-a.cc),r5(e.startPTS)&&r5(e.endPTS)&&(a.start=a.startPTS=e.startPTS,a.startDTS=e.startDTS,a.maxStartPTS=e.maxStartPTS,a.endPTS=e.endPTS,a.endDTS=e.endDTS,a.minEndPTS=e.minEndPTS,a.duration=e.endPTS-e.startPTS,a.duration&&(i=a),t.PTSKnown=t.alignedSliding=!0),a.elementaryStreams=e.elementaryStreams,a.loader=e.loader,a.stats=e.stats,a.urlId=e.urlId,e.initSegment&&(a.initSegment=e.initSegment,r=e.initSegment)}),r){let e=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;e.forEach(e=>{var t;e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)})}if(t.skippedSegments){if(t.deltaUpdateFailed=t.fragments.some(e=>!e),t.deltaUpdateFailed){ai.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,i){let r=r4({},e);return i&&i.forEach(e=>{delete r[e]}),Object.keys(t).forEach(e=>{let i=new an(t[e].attr,r[e]);i.isValid?r[e]=i:ai.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)}),r}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges))}let n=t.fragments;if(s){ai.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<n.length;e++)n[e].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,i){if(e&&t){let r=0;for(let a=0,s=e.length;a<=s;a++){let s=e[a],n=t[a+r];s&&n&&s.index===n.index&&s.fragment.sn===n.fragment.sn?i(s,n):r--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),i?sC(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):sM(e,t),n.length&&(t.totalduration=t.edge-n[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;let o=t.advancedDateTime;if(t.advanced&&o){let e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}(i,r),!this.canLoad||!r.live)return;if(r.canBlockReload&&r.endSN&&r.advanced){let e=this.hls.config.lowLatencyMode,a=r.lastPartSn,s=r.endSN,d=r.lastPartIndex,u=a===s;-1!==d?(o=u?s+1:a,l=u?e?0:d:d+1):o=s+1;let h=r.age,c=h+r.ageHeader,m=Math.min(c-r.partTarget,1.5*r.targetduration);if(m>0){if(i&&m>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${m} with playlist age: ${r.age}`),m=0;else{let e=Math.floor(m/r.targetduration);if(o+=e,void 0!==l){let e=Math.round(m%r.targetduration/r.partTarget);l+=e}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${h.toFixed(2)}s goal: ${m} skip sn ${e} to part ${l}`)}r.tuneInGoal=m}if(n=this.getDeliveryDirectives(r,t.deliveryDirectives,o,l),e||!u){this.loadPlaylist(n);return}}else(r.canBlockReload||r.canSkipUntil)&&(n=this.getDeliveryDirectives(r,t.deliveryDirectives,o,l));let d=this.hls.mainForwardBufferInfo,u=d?d.end-d.len:0,h=(r.edge-u)*1e3,c=function(e,t=1/0){let i=1e3*e.targetduration;if(e.updated){let r=e.fragments;if(r.length&&4*i>t){let e=1e3*r[r.length-1].duration;e<i&&(i=e)}}else i/=2;return Math.round(i)}(r,h);r.updated&&s>this.requestScheduled+c&&(this.requestScheduled=a.loading.start),void 0!==o&&r.canBlockReload?this.requestScheduled=a.loading.first+c-(1e3*r.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+c<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=c);let m=this.requestScheduled-s;m=Math.max(0,m),this.log(`reload live playlist ${e} in ${Math.round(m)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(n),m)}else this.clearTimer()}getDeliveryDirectives(e,t,i,r){let a=function(e,t){let{canSkipUntil:i,canSkipDateRanges:r,endSN:a}=e;return i&&(void 0!==t?t-a:0)<i?r?sI.v2:sI.Yes:sI.No}(e,i);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,a=sI.No),new sR(i,r,a)}checkRetry(e){let t=e.details,i=sN(e),r=e.errorAction,{action:a,retryCount:s=0,retryConfig:n}=r||{},o=!!r&&!!n&&(a===sW.RetryRequest||!r.resolved&&a===sW.SendAlternateToPenaltyBox);if(o){var l;if(this.requestScheduled=-1,s>=n.maxNumRetry)return!1;if(i&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${n.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let e=sF(n,s);this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${s+1}/${n.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,r.resolved=!0}return o}}class sj extends sq{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(r8.LEVEL_LOADED,this.onLevelLoaded,this),e.on(r8.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(r8.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(r8.FRAG_LOADED,this.onFragLoaded,this),e.on(r8.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(r8.LEVEL_LOADED,this.onLevelLoaded,this),e.off(r8.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(r8.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(r8.FRAG_LOADED,this.onFragLoaded,this),e.off(r8.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){let e=this._levels;e.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let i;let r=[],a={};t.levels.forEach(e=>{var t;let s=e.attrs;(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))!==-1&&(n||(n=/chrome|firefox/i.test(navigator.userAgent)),n&&(e.audioCodec=void 0));let{AUDIO:o,CODECS:l,"FRAME-RATE":d,"PATHWAY-ID":u,RESOLUTION:h,SUBTITLES:c}=s,m=`${u||"."}-`,f=`${m}${e.bitrate}-${h}-${d}-${l}`;(i=a[f])?i.addFallback(e):(i=new sw(e),a[f]=i,r.push(i)),sY(i,"audio",o),sY(i,"text",c)}),this.filterAndSortMediaOptions(r,t)}filterAndSortMediaOptions(e,t){let i=[],r=[],a=!1,s=!1,n=!1,o=e.filter(({audioCodec:e,videoCodec:t,width:i,height:r,unknownCodecs:o})=>(a||(a=!!(i&&r)),s||(s=!!t),n||(n=!!e),!(null!=o&&o.length)&&(!e||a6(e,"audio"))&&(!t||a6(t,"video"))));if((a||s)&&n&&(o=o.filter(({videoCodec:e,width:t,height:i})=>!!e||!!(t&&i))),0===o.length){Promise.resolve().then(()=>{if(this.hls){let e=Error("no level with compatible codecs found in manifest");this.hls.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}});return}t.audioTracks&&sz(i=t.audioTracks.filter(e=>!e.audioCodec||a6(e.audioCodec,"audio"))),t.subtitles&&sz(r=t.subtitles);let l=o.slice(0);o.sort((e,t)=>e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):a&&e.height!==t.height?e.height-t.height:0);let d=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o)).length!==l.length){for(let e=0;e<l.length;e++)if(l[e].pathwayId===o[0].pathwayId){d=l[e];break}}this._levels=o;for(let e=0;e<o.length;e++)if(o[e]===d){this._firstLevel=e,this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${d.bitrate}`);break}let u=n&&!s,h={levels:o,audioTracks:i,subtitleTracks:r,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:s,altAudio:!u&&i.some(e=>!!e.url)};this.hls.trigger(r8.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){let i=Error("invalid level idx"),r=e<0;if(this.hls.trigger(r8.ERROR,{type:r9.OTHER_ERROR,details:r6.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:i,reason:i.message}),r)return;e=Math.min(e,t.length-1)}let i=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,s=t[e],n=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,i===e&&s.details&&r&&a===n)return;this.log(`Switching to level ${e}${n?" with Pathway "+n:""} from level ${i}${a?" with Pathway "+a:""}`);let o=r4({},s,{level:e,maxBitrate:s.maxBitrate,attrs:s.attrs,uri:s.uri,urlId:s.urlId});delete o._attrs,delete o._urlId,this.hls.trigger(r8.LEVEL_SWITCHING,o);let l=s.details;if(!l||l.live){let e=this.switchParams(s.uri,null==r?void 0:r.details);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0!==this._startLevel)return this._startLevel;{let e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===sh.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&t.type===sc.MAIN){let e=this._levels[t.level];void 0!==e&&(e.loadError=0)}}onLevelLoaded(e,t){var i,r;let{level:a,details:s}=t,n=this._levels[a];if(!n){this.warn(`Invalid level index ${a}`),null!=(r=t.deliveryDirectives)&&r.skip&&(s.deltaUpdateFailed=!0);return}a===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0),this.playlistLoaded(a,t,n.details)):null!=(i=t.deliveryDirectives)&&i.skip&&(s.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){let i=this.currentLevel;if(!i)return;let r=this.hls.audioTracks[t.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==r){let e=-1;for(let t=0;t<i.audioGroupIds.length;t++)if(i.audioGroupIds[t]===r){e=t;break}-1!==e&&e!==i.urlId&&(i.urlId=e,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();let t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){let r=i.urlId,a=i.uri;if(e)try{a=e.addDirectives(a)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}let s=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(null==e?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${s?" Pathway "+s:""} URI ${r+1}/${i.url.length} ${a}`),this.clearTimer(),this.hls.trigger(r8.LEVEL_LOADING,{url:a,level:t,id:r,deliveryDirectives:e||null})}}get nextLoadLevel(){return -1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){let i=(e,i)=>i!==t,r=this._levels.filter((r,a)=>a!==e||(r.url.length>1&&void 0!==t?(r.url=r.url.filter(i),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(i)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(i)),r.urlId=0,!0):(this.steering&&this.steering.removeLevel(r),!1)));this.hls.trigger(r8.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){t.forEach((e,t)=>{let{details:i}=e;null!=i&&i.fragments&&i.fragments.forEach(e=>{e.level=t})}),this._levels=t}}function sY(e,t,i){i&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=i):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=i))}function sz(e){let t={};e.forEach(e=>{let i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}var sX={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class sQ{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(r8.BUFFER_APPENDED,this.onBufferAppended,this),e.on(r8.FRAG_BUFFERED,this.onFragBuffered,this),e.on(r8.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){let{hls:e}=this;e.off(r8.BUFFER_APPENDED,this.onBufferAppended,this),e.off(r8.FRAG_BUFFERED,this.onFragBuffered,this),e.off(r8.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){let i=this.activePartLists[t];if(i)for(let t=i.length;t--;){let r=i[t];if(!r)break;let a=r.end;if(r.start<=e&&null!==a&&e<=a)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){let{fragments:i}=this,r=Object.keys(i);for(let a=r.length;a--;){let s=i[r[a]];if((null==s?void 0:s.body.type)===t&&s.buffered){let t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,i,r){this.timeRanges&&(this.timeRanges[e]=t);let a=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{let s=this.fragments[r];if(!s||a>=s.body.sn)return;if(!s.buffered&&!s.loaded){s.body.type===i&&this.removeFragment(s.body);return}let n=s.range[e];n&&n.time.some(e=>{let i=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&this.removeFragment(s.body),i})})}detectPartialFragments(e){let t=this.timeRanges,{frag:i,part:r}=e;if(!t||"initSegment"===i.sn)return;let a=sJ(i),s=this.fragments[a];if(!s||s.buffered&&i.gap)return;let n=!i.relurl;if(Object.keys(t).forEach(e=>{let a=i.elementaryStreams[e];if(!a)return;let o=t[e],l=n||!0===a.partial;s.range[e]=this.getBufferedTimes(i,r,l,o)}),s.loaded=null,Object.keys(s.range).length){s.buffered=!0;let e=s.body.endList=i.endList||s.body.endList;e&&(this.endListFragments[s.body.type]=s),sZ(s)||this.removeParts(i.sn-1,i.type)}else this.removeFragment(s.body)}removeParts(e,t){let i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter(t=>t.fragment.sn>=e))}fragBuffered(e,t){let i=sJ(e),r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){let a={time:[],partial:i},s=e.start,n=e.end,o=e.minEndPTS||n,l=e.maxStartPTS||s;for(let e=0;e<r.length;e++){let t=r.start(e)-this.bufferPadding,i=r.end(e)+this.bufferPadding;if(l>=t&&o<=i){a.time.push({startPTS:Math.max(s,r.start(e)),endPTS:Math.min(n,r.end(e))});break}if(s<i&&n>t)a.partial=!0,a.time.push({startPTS:Math.max(s,r.start(e)),endPTS:Math.min(n,r.end(e))});else if(n<=t)break}return a}getPartialFragment(e){let t,i,r,a=null,s=0,{bufferPadding:n,fragments:o}=this;return Object.keys(o).forEach(l=>{let d=o[l];d&&sZ(d)&&(i=d.body.start-n,r=d.body.end+n,e>=i&&e<=r&&s<=(t=Math.min(e-i,r-e))&&(a=d.body,s=t))}),a}isEndListAppended(e){let t=this.endListFragments[e];return void 0!==t&&(t.buffered||sZ(t))}getState(e){let t=sJ(e),i=this.fragments[t];return i?i.buffered?sZ(i)?sX.PARTIAL:sX.OK:sX.APPENDING:sX.NOT_LOADED}isTimeBuffered(e,t,i){let r,a;for(let s=0;s<i.length;s++){if(r=i.start(s)-this.bufferPadding,a=i.end(s)+this.bufferPadding,e>=r&&t<=a)return!0;if(t<=r)break}return!1}onFragLoaded(e,t){let{frag:i,part:r}=t;if("initSegment"===i.sn||i.bitrateTest)return;let a=sJ(i);this.fragments[a]={body:i,appendedPTS:null,loaded:r?null:t,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:i,part:r,timeRanges:a}=t;if("initSegment"===i.sn)return;let s=i.type;if(r){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(r)}this.timeRanges=a,Object.keys(a).forEach(e=>{let t=a[e];this.detectEvictedFragments(e,t,s,r)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=sJ(e);return!!this.fragments[t]}hasParts(e){var t;return!!(null!=(t=this.activePartLists[e])&&t.length)}removeFragmentsInRange(e,t,i,r,a){(!r||this.hasGaps)&&Object.keys(this.fragments).forEach(s=>{let n=this.fragments[s];if(!n)return;let o=n.body;o.type===i&&(!r||o.gap)&&o.start<t&&o.end>e&&(n.buffered||a)&&this.removeFragment(o)})}removeFragment(e){let t=sJ(e);e.stats.loaded=0,e.clearElementaryStreamInfo();let i=this.activePartLists[e.type];if(i){let t=e.sn;this.activePartLists[e.type]=i.filter(e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function sZ(e){var t,i,r;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(i=e.range.audio)?void 0:i.partial)||(null==(r=e.range.audiovideo)?void 0:r.partial))}function sJ(e){return`${e.type}_${e.level}_${e.urlId}_${e.sn}`}class s0{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let i=e.url;if(!i)return Promise.reject(new s3({type:r9.NETWORK_ERROR,details:r6.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();let r=this.config,a=r.fLoader,s=r.loader;return new Promise((n,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0])){o(s2(e));return}e.gap=!1}let l=this.loader=e.loader=a?new a(r):new s(r),d=s1(e),u=sB(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:131072};e.stats=l.stats,l.load(d,h,{onSuccess:(t,i,r,a)=>{this.resetLoader(e,l);let s=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),n({frag:e,part:null,payload:s,networkDetails:a})},onError:(t,r,a,s)=>{this.resetLoader(e,l),o(new s3({type:r9.NETWORK_ERROR,details:r6.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:r3({url:i,data:void 0},t),error:Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:a,stats:s}))},onAbort:(t,i,r)=>{this.resetLoader(e,l),o(new s3({type:r9.NETWORK_ERROR,details:r6.INTERNAL_ABORTED,fatal:!1,frag:e,error:Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,i,r)=>{this.resetLoader(e,l),o(new s3({type:r9.NETWORK_ERROR,details:r6.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:t}))},onProgress:(i,r,a,s)=>{t&&t({frag:e,part:null,payload:a,networkDetails:s})}})})}loadPart(e,t,i){this.abort();let r=this.config,a=r.fLoader,s=r.loader;return new Promise((n,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){o(s2(e,t));return}let l=this.loader=e.loader=a?new a(r):new s(r),d=s1(e,t),u=sB(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:131072};t.stats=l.stats,l.load(d,h,{onSuccess:(r,a,s,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);let d={frag:e,part:t,payload:r.data,networkDetails:o};i(d),n(d)},onError:(i,r,a,s)=>{this.resetLoader(e,l),o(new s3({type:r9.NETWORK_ERROR,details:r6.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:r3({url:d.url,data:void 0},i),error:Error(`HTTP Error ${i.code} ${i.text}`),networkDetails:a,stats:s}))},onAbort:(i,r,a)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new s3({type:r9.NETWORK_ERROR,details:r6.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:Error("Aborted"),networkDetails:a,stats:i}))},onTimeout:(i,r,a)=>{this.resetLoader(e,l),o(new s3({type:r9.NETWORK_ERROR,details:r6.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:Error(`Timeout after ${h.timeout}ms`),networkDetails:a,stats:i}))}})})}updateStatsFromPart(e,t){let i=e.stats,r=t.stats,a=r.total;if(i.loaded+=r.loaded,a){let r=Math.round(e.duration/t.duration),s=Math.min(Math.round(i.loaded/a),r),n=(r-s)*Math.round(i.loaded/s);i.total=i.loaded+n}else i.total=Math.max(i.loaded,i.total);let s=i.loading,n=r.loading;s.start?s.first+=n.first-n.start:(s.start=n.start,s.first=n.first),s.end=n.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function s1(e,t=null){let i=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},a=i.byteRangeStartOffset,s=i.byteRangeEndOffset;if(r5(a)&&r5(s)){var n;let t=a,i=s;if("initSegment"===e.sn&&(null==(n=e.decryptdata)?void 0:n.method)==="AES-128"){let e=s-a;e%16&&(i=s+(16-e%16)),0!==a&&(r.resetIV=!0,t=a-16)}r.rangeStart=t,r.rangeEnd=i}return r}function s2(e,t){let i=Error(`GAP ${e.gap?"tag":"attribute"} found`),r={type:r9.MEDIA_ERROR,details:r6.FRAG_GAP,fatal:!1,frag:e,error:i,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new s3(r)}class s3 extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class s4{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(let t in this.keyUriToKeyInfo){let i=this.keyUriToKeyInfo[t].loader;if(i){if(e&&e!==i.context.frag.type)return;i.abort()}}}detach(){for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){for(let e in this.detach(),this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=r6.KEY_LOAD_ERROR,i,r,a){return new s3({type:r9.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:i,networkDetails:r})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){let{sn:i,cc:r}=e;for(let e=0;e<t.length;e++){let a=t[e];if(r<=a.cc&&("initSegment"===i||"initSegment"===a.sn||i<a.sn)){this.emeController.selectKeySystemFormat(a).then(e=>{a.setKeyFormat(e)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r,a;t&&e.setKeyFormat(t);let s=e.decryptdata;if(!s){let i=Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,r6.KEY_LOAD_ERROR,i))}let n=s.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,r6.KEY_LOAD_ERROR,Error(`Invalid key URI: "${n}"`)));let o=this.keyUriToKeyInfo[n];if(null!=(i=o)&&i.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(null!=(r=o)&&r.keyLoadPromise)switch(null==(a=o.mediaKeySessionContext)?void 0:a.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>(s.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}switch(o=this.keyUriToKeyInfo[n]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":if("identity"===s.keyFormat)return this.loadKeyHTTP(o,e);return this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,r6.KEY_LOAD_ERROR,Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){let i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){let t=this.emeController.loadKey(i);if(t)return(e.keyLoadPromise=t.then(t=>(e.mediaKeySessionContext=t,i))).catch(t=>{throw e.keyLoadPromise=null,t})}return Promise.resolve(i)}loadKeyHTTP(e,t){let i=this.config,r=i.loader,a=new r(i);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((r,s)=>{let n={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=i.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};a.load(n,l,{onSuccess:(e,t,i,a)=>{let{frag:n,keyInfo:o,url:l}=i;if(!n.decryptdata||o!==this.keyUriToKeyInfo[l])return s(this.createKeyLoadError(n,r6.KEY_LOAD_ERROR,Error("after key load, decryptdata unset or changed"),a));o.decryptdata.key=n.decryptdata.key=new Uint8Array(e.data),n.keyLoader=null,o.loader=null,r({frag:n,keyInfo:o})},onError:(e,i,r,a)=>{this.resetLoader(i),s(this.createKeyLoadError(t,r6.KEY_LOAD_ERROR,Error(`HTTP Error ${e.code} loading key ${e.text}`),r,r3({url:n.url,data:void 0},e)))},onTimeout:(e,i,r)=>{this.resetLoader(i),s(this.createKeyLoadError(t,r6.KEY_LOAD_TIMEOUT,Error("key loading timed out"),r))},onAbort:(e,i,r)=>{this.resetLoader(i),s(this.createKeyLoadError(t,r6.INTERNAL_ABORTED,Error("key loading aborted"),r))}})})}resetLoader(e){let{frag:t,keyInfo:i,url:r}=e,a=i.loader;t.keyLoader===a&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],a&&a.destroy()}}class s5{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}let s8={length:0,start:()=>0,end:()=>0};class s9{static isBuffered(e,t){try{if(e){let i=s9.getBuffered(e);for(let e=0;e<i.length;e++)if(t>=i.start(e)&&t<=i.end(e))return!0}}catch(e){}return!1}static bufferInfo(e,t,i){try{if(e){let r;let a=s9.getBuffered(e),s=[];for(r=0;r<a.length;r++)s.push({start:a.start(r),end:a.end(r)});return this.bufferedInfo(s,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,i){let r;t=Math.max(0,t),e.sort(function(e,t){let i=e.start-t.start;return i||t.end-e.end});let a=[];if(i)for(let t=0;t<e.length;t++){let r=a.length;if(r){let s=a[r-1].end;e[t].start-s<i?e[t].end>s&&(a[r-1].end=e[t].end):a.push(e[t])}else a.push(e[t])}else a=e;let s=0,n=t,o=t;for(let e=0;e<a.length;e++){let l=a[e].start,d=a[e].end;if(t+i>=l&&t<d)n=l,s=(o=d)-t;else if(t+i<l){r=l;break}}return{len:s,start:n||0,end:o||0,nextStart:r}}static getBuffered(e){try{return e.buffered}catch(e){return ai.log("failed to get media.buffered",e),s8}}}class s6{constructor(e,t,i,r=0,a=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=s7(),this.buffering={audio:s7(),video:s7(),audiovideo:s7()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=a,this.partial=s}}function s7(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ne(e,t){let i=null;for(let r=0,a=e.length;r<a;r++){let a=e[r];if(a&&a.cc===t){i=a;break}}return i}function nt(e,t){if(e){let i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function ni(e,t){let i=t.fragments;for(let t=0,r=i.length;t<r;t++)nt(i[t],e);t.fragmentHint&&nt(t.fragmentHint,e),t.alignedSliding=!0}function nr(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;let i=e.fragments,r=t.fragments;if(!i.length||!r.length)return;let a=Math.round(r.length/2)-1,s=r[a],n=ne(i,s.cc)||i[Math.round(i.length/2)-1],o=s.programDateTime,l=n.programDateTime;if(null===o||null===l)return;let d=(l-o)/1e3-(n.start-s.start);ni(d,e)}class na{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class ns{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class nn{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){let t=new DataView(e),i=new Uint32Array(4);for(let e=0;e<4;e++)i[e]=t.getUint32(4*e);return i}initTable(){let e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],a=i[1],s=i[2],n=i[3],o=this.invSubMix,l=o[0],d=o[1],u=o[2],h=o[3],c=new Uint32Array(256),m=0,f=0,p=0;for(p=0;p<256;p++)p<128?c[p]=p<<1:c[p]=p<<1^283;for(p=0;p<256;p++){let i=f^f<<1^f<<2^f<<3^f<<4;i=i>>>8^255&i^99,e[m]=i,t[i]=m;let o=c[m],p=c[o],g=c[p],v=257*c[i]^16843008*i;r[m]=v<<24|v>>>8,a[m]=v<<16|v>>>16,s[m]=v<<8|v>>>24,n[m]=v,v=16843009*g^65537*p^257*o^16843008*m,l[i]=v<<24|v>>>8,d[i]=v<<16|v>>>16,u[i]=v<<8|v>>>24,h[i]=v,m?(m=o^c[c[c[g^o]]],f^=c[c[f]]):m=f=1}}expandKey(e){let t,i,r,a;let s=this.uint8ArrayToUint32Array_(e),n=!0,o=0;for(;o<s.length&&n;)n=s[o]===this.key[o],o++;if(n)return;this.key=s;let l=this.keySize=s.length;if(4!==l&&6!==l&&8!==l)throw Error("Invalid aes key size="+l);let d=this.ksRows=(l+6+1)*4,u=this.keySchedule=new Uint32Array(d),h=this.invKeySchedule=new Uint32Array(d),c=this.sBox,m=this.rcon,f=this.invSubMix,p=f[0],g=f[1],v=f[2],E=f[3];for(t=0;t<d;t++){if(t<l){r=u[t]=s[t];continue}a=r,t%l==0?a=(c[(a=a<<8|a>>>24)>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[255&a])^m[t/l|0]<<24:l>6&&t%l==4&&(a=c[a>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[255&a]),u[t]=r=(u[t-l]^a)>>>0}for(i=0;i<d;i++)t=d-i,a=3&i?u[t]:u[t-4],i<4||t<=4?h[i]=a:h[i]=p[c[a>>>24]]^g[c[a>>>16&255]]^v[c[a>>>8&255]]^E[c[255&a]],h[i]=h[i]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,i){let r,a,s,n,o,l,d,u,h,c,m,f,p,g;let v=this.keySize+6,E=this.invKeySchedule,b=this.invSBox,y=this.invSubMix,T=y[0],A=y[1],_=y[2],S=y[3],k=this.uint8ArrayToUint32Array_(i),L=k[0],I=k[1],R=k[2],w=k[3],D=new Int32Array(e),C=new Int32Array(D.length),M=this.networkToHostOrderSwap;for(;t<D.length;){for(g=1,h=M(D[t]),c=M(D[t+1]),m=M(D[t+2]),f=M(D[t+3]),o=h^E[0],l=f^E[1],d=m^E[2],u=c^E[3],p=4;g<v;g++)r=T[o>>>24]^A[l>>16&255]^_[d>>8&255]^S[255&u]^E[p],a=T[l>>>24]^A[d>>16&255]^_[u>>8&255]^S[255&o]^E[p+1],s=T[d>>>24]^A[u>>16&255]^_[o>>8&255]^S[255&l]^E[p+2],n=T[u>>>24]^A[o>>16&255]^_[l>>8&255]^S[255&d]^E[p+3],o=r,l=a,d=s,u=n,p+=4;r=b[o>>>24]<<24^b[l>>16&255]<<16^b[d>>8&255]<<8^b[255&u]^E[p],a=b[l>>>24]<<24^b[d>>16&255]<<16^b[u>>8&255]<<8^b[255&o]^E[p+1],s=b[d>>>24]<<24^b[u>>16&255]<<16^b[o>>8&255]<<8^b[255&l]^E[p+2],n=b[u>>>24]<<24^b[o>>16&255]<<16^b[l>>8&255]<<8^b[255&d]^E[p+3],C[t]=M(r^L),C[t+1]=M(n^I),C[t+2]=M(s^R),C[t+3]=M(a^w),L=h,I=c,R=m,w=f,t+=4}return C.buffer}}class no{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let i=new Uint8Array(e);return(this.reset(),this.removePKCS7Padding)?function(e){let t=e.byteLength,i=t&&new DataView(e.buffer).getUint8(t-1);return i?aA(e,0,t-i):e}(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i){return this.useSoftware?new Promise((r,a)=>{this.softwareDecrypt(new Uint8Array(e),t,i);let s=this.flush();s?r(s.buffer):a(Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i)}softwareDecrypt(e,t,i){let{currentIV:r,currentResult:a,remainderData:s}=this;this.logOnce("JS AES decrypt"),s&&(e=az(s,e),this.remainderData=null);let n=this.getValidChunk(e);if(!n.length)return null;r&&(i=r);let o=this.softwareDecrypter;return(o||(o=this.softwareDecrypter=new nn),o.expandKey(t),this.currentResult=o.decrypt(n.buffer,0,i),this.currentIV=aA(n,-16).buffer,a)?a:null}webCryptoDecrypt(e,t,i){let r=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new ns(r,t)),this.fastAesKey.expandKey().then(t=>{if(!r)return Promise.reject(Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");let a=new na(r,new Uint8Array(i));return a.decrypt(e.buffer,t)}).catch(r=>(ai.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,i)))}onWebCryptoError(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);let r=this.flush();if(r)return r.buffer;throw Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e,i=e.length-e.length%16;return i!==e.length&&(t=aA(e,0,i),this.remainderData=aA(e,i)),t}logOnce(e){this.logEnabled&&(ai.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}let nl={toString:function(e){let t="",i=e.length;for(let r=0;r<i;r++)t+=`[${e.start(r).toFixed(3)}-${e.end(r).toFixed(3)}]`;return t}},nd={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class nu extends s5{constructor(e,t,i,r,a){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=nd.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=a,this.logPrefix=r,this.log=ai.log.bind(ai,`${r}:`),this.warn=ai.warn.bind(ai,`${r}:`),this.hls=e,this.fragmentLoader=new s0(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new no(e.config),e.on(r8.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);let e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=nd.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;let i=t.partList;if(null!=i&&i.length){let e=i[i.length-1],t=s9.isBuffered(this.media,e.start+e.duration/2);return t}let r=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded){var e;return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}}onMediaAttached(e,t){let i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);let r=this.config;this.levels&&r.autoStartLoad&&this.state===nd.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(){let e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){let{config:e,fragCurrent:t,media:i,mediaBuffer:r,state:a}=this,s=i?i.currentTime:0,n=s9.bufferInfo(r||i,s,e.maxBufferHole);if(this.log(`media seeking to ${r5(s)?s.toFixed(3):s}, state: ${a}`),this.state===nd.ENDED)this.resetLoadingState();else if(t){let i=e.maxFragLookUpTolerance,r=t.start-i,a=t.start+t.duration+i;if(!n.len||a<n.start||r>n.end){let e=s>a;(s<r||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),this.lastCurrentTime=s),this.loadedmetadata||n.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=nd.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){this._doFragLoad(e,t,i,t=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(t)}).then(t=>{if(!t)return;let i=this.state;if(this.fragContextChanged(e)){i!==nd.FRAG_LOADING&&(this.fragCurrent||i!==nd.PARSING)||(this.fragmentTracker.removeFragment(e),this.state=nd.IDLE);return}"payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(r8.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t)}).catch(t=>{this.state!==nd.STOPPED&&this.state!==nd.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;let{fragmentTracker:i}=this,r=i.getState(e);if(r===sX.APPENDING){let t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),a=Math.max(e.duration,r?r.len:this.config.maxBufferLength);this.reduceMaxBufferLength(a)&&i.removeFragment(e)}else(null==(t=this.mediaBuffer)?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===sX.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){let t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,i=null){e-t&&this.hls.trigger(r8.BUFFER_FLUSHING,{startOffset:e,endOffset:t,type:i})}_loadInitSegment(e,t){this._doFragLoad(e,t).then(t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw Error("init load aborted");return t}).then(t=>{let{hls:i}=this,{payload:r}=t,a=e.decryptdata;if(r&&r.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){let s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),a.key.buffer,a.iv.buffer).catch(t=>{throw i.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t}).then(r=>{let a=self.performance.now();return i.trigger(r8.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:s,tdecrypt:a}}),t.payload=r,t})}return t}).then(i=>{let{fragCurrent:r,hls:a,levels:s}=this;if(!s)throw Error("init load aborted, missing levels");let n=e.stats;this.state=nd.IDLE,t.fragmentError=0,e.data=new Uint8Array(i.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),i.frag===r&&a.trigger(r8.FRAG_BUFFERED,{stats:n,frag:r,part:null,id:e.type}),this.tick()}).catch(t=>{this.state!==nd.STOPPED&&this.state!==nd.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var i,r,a,s;let n=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===sc.MAIN?"level":"track"} ${e.level} (frag:[${(null!=(i=e.startPTS)?i:NaN).toFixed(3)}-${(null!=(r=e.endPTS)?r:NaN).toFixed(3)}] > buffer:${n?nl.toString(s9.getBuffered(n)):"(detached)"})`),this.state=nd.IDLE,n&&(!this.loadedmetadata&&e.type==sc.MAIN&&n.buffered.length&&(null==(a=this.fragCurrent)?void 0:a.sn)===(null==(s=this.fragPrevious)?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:i,part:r,partsLoaded:a}=e,s=!a||0===a.length||a.some(e=>!e),n=new s6(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!s);t.flush(n)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var a;let s;let n=null==t?void 0:t.details;if(!this.levels||!n)throw Error(`frag load aborted, missing level${n?"":" detail"}s`);let o=null;if(e.encrypted&&!(null!=(a=e.decryptdata)&&a.key)?(this.log(`Loading key for ${e.sn} of [${n.startSN}-${n.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=nd.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(r8.KEY_LOADED,e),this.state===nd.KEY_LOADING&&(this.state=nd.IDLE),e}),this.hls.trigger(r8.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(o=Promise.reject(Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(e,n.encryptedFragments),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){let a=n.partList;if(a&&r){i>e.end&&n.fragmentHint&&(e=n.fragmentHint);let s=this.getNextPart(a,e,i);if(s>-1){let l;let d=a[s];return(this.log(`Loading part sn: ${e.sn} p: ${d.index} cc: ${e.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${s}-${a.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=d.start+d.duration,this.state=nd.FRAG_LOADING,l=o?o.then(i=>!i||this.fragContextChanged(i.frag)?null:this.doFragPartsLoad(e,d,t,r)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,d,t,r).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(r8.FRAG_LOADING,{frag:e,part:d,targetBufferTime:i}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING parts")):l}if(!e.url||this.loadedEndOfParts(a,i))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),r5(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=nd.FRAG_LOADING;let l=this.config.progressive;return(s=l&&o?o.then(t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,r)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,l?r:void 0),o]).then(([e])=>(!l&&e&&r&&r(e),e)).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(r8.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING")):s}doFragPartsLoad(e,t,i,r){return new Promise((a,s)=>{var n;let o=[],l=null==(n=i.details)?void 0:n.partList,d=t=>{this.fragmentLoader.loadPart(e,t,r).then(r=>{o[t.index]=r;let s=r.part;this.hls.trigger(r8.FRAG_LOADED,r);let n=sO(i,e.sn,t.index+1)||sP(l,e.sn,t.index+1);if(!n)return a({frag:e,part:s,partsLoaded:o});d(n)}).catch(s)};d(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;e.data&&t.details===r6.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(r8.ERROR,t)}else this.hls.trigger(r8.ERROR,{type:r9.OTHER_ERROR,details:r6.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==nd.PARSING){this.fragCurrent||this.state===nd.STOPPED||this.state===nd.ERROR||(this.state=nd.IDLE);return}let{frag:i,part:r,level:a}=t,s=self.performance.now();i.stats.parsing.end=s,r&&(r.stats.parsing.end=s),this.updateLevelTiming(i,r,a,e.partial)}getCurrentContext(e){let{levels:t,fragCurrent:i}=this,{level:r,sn:a,part:s}=e;if(!(null!=t&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${a} of level ${r}. The current chunk will not be buffered.`),null;let n=t[r],o=s>-1?sO(n,a,s):null,l=o?o.fragment:function(e,t,i){if(!(null!=e&&e.details))return null;let r=e.details,a=r.fragments[t-r.startSN];return a||(a=r.fragmentHint)&&a.sn===t?a:t<r.startSN&&i&&i.sn===t?i:null}(n,a,i);return l?(i&&i!==l&&(l.stats=i.stats),{frag:l,part:o,level:n}):null}bufferFragmentData(e,t,i,r,a){var s;if(!e||this.state!==nd.PARSING)return;let{data1:n,data2:o}=e,l=n;if(n&&o&&(l=az(n,o)),!(null!=(s=l)&&s.length))return;let d={type:e.type,frag:t,part:i,chunkMeta:r,parent:t.type,data:l};if(this.hls.trigger(r8.BUFFER_APPENDING,d),e.dropped&&e.independent&&!i){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){let t=this.media;if(!t)return;if(!s9.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}let i=t.currentTime,r=s9.bufferInfo(t,i,0),a=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*a),n=Math.max(Math.min(e.start-s,r.end-s),i+s);e.start-n>s&&this.flushMainBuffer(n,e.start)}getFwdBufferInfo(e,t){let i=this.getLoadPosition();return r5(i)?this.getFwdBufferInfoAtPos(e,i,t):null}getFwdBufferInfoAtPos(e,t,i){let{config:{maxBufferHole:r}}=this,a=s9.bufferInfo(e,t,r);if(0===a.len&&void 0!==a.nextStart){let s=this.fragmentTracker.getBufferedFrag(t,i);if(s&&a.nextStart<s.end)return s9.bufferInfo(e,t,Math.max(a.nextStart,r))}return a}getMaxBufferLength(e){let{config:t}=this;return Math.min(e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,t.maxMaxBufferLength)}reduceMaxBufferLength(e){let t=this.config,i=e||t.maxBufferLength;return t.maxMaxBufferLength>=i&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=sc.MAIN){let i=this.fragmentTracker.getAppendedFrag(e,sc.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){let i;let r=t.fragments,a=r.length;if(!a)return null;let{config:s}=this,n=r[0].start;if(t.live){let n=s.initialLiveManifestSize;if(a<n)return this.warn(`Not enough fragments to start playback (have: ${a}, need: ${n})`),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(i=this.getInitialLiveFragment(t,r),this.startPosition=i?this.hls.liveSyncPosition||i.start:e)}else e<=n&&(i=r[0]);if(!i){let r=s.lowLatencyMode?t.partEnd:t.fragmentEnd;i=this.getFragmentAtPosition(e,r,t)}return this.mapToInitFragWhenRequired(i)}isLoopLoading(e,t){let i=this.fragmentTracker.getState(e);return(i===sX.OK||i===sX.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,a){let s=e.gap,n=this.getNextFragment(this.nextLoadPosition,t);if(null===n)return n;if(e=n,s&&e&&!e.gap&&i.nextStart){let t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r);if(null!==t&&i.len+t.len>=a)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,i){let r=-1,a=!1,s=!0;for(let n=0,o=e.length;n<o;n++){let o=e[n];if(s=s&&!o.independent,r>-1&&i<o.start)break;let l=o.loaded;l?r=-1:(a||o.independent||s)&&o.fragment===t&&(r=n),a=l}return r}loadedEndOfParts(e,t){let i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){let i=this.fragPrevious,r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=function(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!r5(t))return null;let r=e[0].programDateTime;if(t<(r||0))return null;let a=e[e.length-1].endProgramDateTime;if(t>=(a||0))return null;i=i||0;for(let r=0;r<e.length;++r){let a=e[r];if(function(e,t,i){let r=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0)),a=i.endProgramDateTime||0;return a-r>e}(t,i,a))return a}return null}(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){let s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){let a=t[s-e.startSN];i.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}if(!r){var a;a=i.cc,(r=sV.search(t,e=>e.cc<a?1:e.cc>a?-1:0))&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`)}}}else{let t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){let r;let{config:a}=this,{fragPrevious:s}=this,{fragments:n,endSN:o}=i,{fragmentHint:l}=i,d=a.maxFragLookUpTolerance,u=i.partList,h=!!(a.lowLatencyMode&&null!=u&&u.length&&l);if(h&&l&&!this.bitrateTest&&(n=n.concat(l),o=l.sn),e<t){let i=e>t-d?0:d;r=sH(s,n,e,i)}else r=n[n.length-1];if(r){let e=r.sn-i.startSN,t=this.fragmentTracker.getState(r);if((t===sX.OK||t===sX.PARTIAL&&r.gap)&&(s=r),s&&r.sn===s.sn&&(!h||u[0].fragment.sn>r.sn)){let t=s&&r.level===s.level;if(t){let t=n[e+1];r=r.sn<o&&this.fragmentTracker.getState(t)!==sX.OK?t:null}}}return r}synchronizeToLiveEdge(e){let{config:t,media:i}=this;if(!i)return;let r=this.hls.liveSyncPosition,a=i.currentTime,s=e.fragments[0].start,n=e.edge,o=a>=s-t.maxFragLookUpTolerance&&a<=n;if(null!==r&&i.duration>r&&(a<r||!o)){let s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&i.readyState<4||a<n-s)&&(this.loadedmetadata||(this.nextLoadPosition=r),i.readyState&&(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${n}, reset currentTime to : ${r.toFixed(3)}`),i.currentTime=r))}}alignPlaylists(e,t){let{levels:i,levelLastLoaded:r,fragPrevious:a}=this,s=null!==r?i[r]:null,n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;let o=e.fragments[0].start,l=!t,d=e.alignedSliding&&r5(o);if(l||!d&&!o){s&&(function(e,t,i){if(i.details&&(t.endCC>t.startCC||e&&e.cc<t.startCC)){let e=function(e,t,i=0){let r=e.fragments,a=t.fragments;if(!a.length||!r.length){ai.log("No fragments to align");return}let s=ne(r,a[0].cc);if(!s||s&&!s.startPTS){ai.log("No frag in previous level to align on");return}return s}(i.details,t);e&&r5(e.start)&&(ai.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),ni(e.start,t))}}(a,e,s),!e.alignedSliding&&s.details&&function(e,t){if(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime)return;let i=t.fragments[0].programDateTime,r=e.fragments[0].programDateTime,a=(r-i)/1e3+t.fragments[0].start;a&&r5(a)&&(ai.log(`Adjusting PTS using programDateTime delta ${r-i}ms, sliding:${a.toFixed(3)} ${e.url} `),ni(a,e))}(e,s.details),e.alignedSliding||!s.details||e.skippedSegments||sM(s.details,e));let i=e.fragments[0].start;return this.log(`Live playlist sliding: ${i.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${a?a.sn:"na"} fragments: ${n}`),i}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let i=this.startPosition;if(i<t&&(i=-1),-1===i||-1===this.lastCurrentTime){let r=null!==this.startTimeOffset,a=r?this.startTimeOffset:e.startTimeOffset;null!==a&&r5(a)?(i=t+a,a<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Start time offset ${a} found in ${r?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){let{media:e}=this,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===nd.FRAG_LOADING_WAITING_RETRY)||(this.state=nd.IDLE)}onFragmentOrKeyLoadError(e,t){var i,r;if(t.chunkMeta&&!t.frag){let e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}let a=t.frag;if(!a||a.type!==e||!this.levels)return;if(this.fragContextChanged(a)){this.warn(`Frag load error must match current frag to retry ${a.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);return}let s=t.details===r6.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(a,!0);let n=t.errorAction,{action:o,retryCount:l=0,retryConfig:d}=n||{};if(n&&o===sW.RetryRequest&&d){this.resetStartWhenNotLoaded(null!=(r=this.levelLastLoaded)?r:a.level);let i=sF(d,l);this.warn(`Fragment ${a.sn} of ${e} ${a.level} errored with ${t.details}, retrying loading ${l+1}/${d.maxNumRetry} in ${i}ms`),n.resolved=!0,this.retryDate=self.performance.now()+i,this.state=nd.FRAG_LOADING_WAITING_RETRY}else d&&n?(this.resetFragmentErrors(e),l<d.maxNumRetry?s||(n.resolved=!0):ai.warn(`${t.details} reached or exceeded max retry (${l})`)):(null==n?void 0:n.action)===sW.SendAlternateToPenaltyBox?this.state=nd.WAITING_LEVEL:this.state=nd.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===nd.PARSING||this.state===nd.PARSED){let t=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len);let a=!r;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===sc.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==nd.STOPPED&&(this.state=nd.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;let r=s9.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===nd.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=nd.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;let t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){var a;let s=i.details;if(!s){this.warn("level.details undefined");return}let n=Object.keys(e.elementaryStreams).reduce((t,a)=>{let n=e.elementaryStreams[a];if(n){let o=n.endPTS-n.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${a} duration reliably (${o})`),t||!1;let l=r?0:sC(s,e,n.startPTS,n.endPTS,n.startDTS,n.endDTS);return this.hls.trigger(r8.LEVEL_PTS_UPDATED,{details:s,level:i,drift:l,type:a,frag:e,start:n.startPTS,end:n.endPTS}),!0}return t},!1);if(n)i.fragmentError=0;else if((null==(a=this.transmuxer)?void 0:a.error)===null){let t=Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===i.fragmentError&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=nd.PARSED,this.hls.trigger(r8.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){if("demuxerWorker"===e.event){var t,i,r;this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(t=null!=(i=this.levelLastLoaded)?i:null==(r=this.fragCurrent)?void 0:r.level)?t:0),this.resetLoadingState()}}set state(e){let t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function nh(){return self.SourceBuffer||self.WebKitSourceBuffer}function nc(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class nm{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){let i;this.cachedData&&(e=az(this.cachedData,e),this.cachedData=null);let r=ak(e,0),a=r?r.length:0,s=this._audioTrack,n=this._id3Track,o=r?aR(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&r5(o))&&(this.basePTS=nf(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:sy.audioId3,duration:Number.POSITIVE_INFINITY});a<l;){if(this.canParse(e,a)){let t=this.appendFrame(s,e,a);t?(this.frameIndex++,this.lastPTS=t.sample.pts,a+=t.length,i=a):a=l}else aI(e,a)?(r=ak(e,a),n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:sy.audioId3,duration:Number.POSITIVE_INFINITY}),a+=r.length,i=a):a++;if(a===l&&i!==l){let t=aA(e,i);this.cachedData?this.cachedData=az(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:nc(),id3Track:n,textTrack:nc()}}demuxSampleAes(e,t,i){return Promise.reject(Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:nc(),id3Track:this._id3Track,textTrack:nc()}}destroy(){}}let nf=(e,t,i)=>{if(r5(e))return 90*e;let r=i?9e4*i.baseTime/i.timescale:0;return 9e4*t+r};function np(e,t){return 255===e[t]&&(246&e[t+1])==240}function ng(e,t){return 1&e[t+1]?7:9}function nv(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function nE(e,t){return t+1<e.length&&np(e,t)}function nb(e,t,i,r,a){if(!e.samplerate){let s=function(e,t,i,r){let a,s,n,o;let l=navigator.userAgent.toLowerCase(),d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((192&t[i+2])>>>6)+1;let u=(60&t[i+2])>>>2;if(u>d.length-1){e.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${u}`});return}return n=(1&t[i+2])<<2|(192&t[i+3])>>>6,ai.log(`manifest codec:${r}, ADTS type:${a}, samplingIndex:${u}`),/firefox/i.test(l)?u>=6?(a=5,o=[,,,,],s=u-3):(a=2,o=[,,],s=u):-1!==l.indexOf("android")?(a=2,o=[,,],s=u):(a=5,o=[,,,,],r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&u>=6?s=u-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(u>=6&&1===n||/vivaldi/i.test(l))||!r&&1===n)&&(a=2,o=[,,]),s=u)),o[0]=a<<3,o[0]|=(14&u)>>1,o[1]|=(1&u)<<7,o[1]|=n<<3,5===a&&(o[1]|=(14&s)>>1,o[2]=(1&s)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:d[u],channelCount:n,codec:"mp4a.40."+a,manifestCodec:r}}(t,i,r,a);s&&(e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,ai.log(`parsed codec:${e.codec}, rate:${s.samplerate}, channels:${s.channelCount}`))}}function ny(e,t,i,r,a){let s;let n=9216e4/e.samplerate,o=r+a*n,l=function(e,t){let i=ng(e,t);if(t+i<=e.length){let r=nv(e,t)-i;if(r>0)return{headerLength:i,frameLength:r}}}(t,i);if(l){let{frameLength:r,headerLength:a}=l,n=a+r,d=Math.max(0,i+n-t.length);d?(s=new Uint8Array(n-a)).set(t.subarray(i+a,t.length),0):s=t.subarray(i+a,i+n);let u={unit:s,pts:o};return d||e.samples.push(u),{sample:u,length:n,missing:d}}let d=t.length-i;(s=new Uint8Array(d)).set(t.subarray(i,t.length),0);let u={unit:s,pts:o};return{sample:u,length:d,missing:-1}}let nT=/\/emsg[-/]ID3/i,nA=null,n_=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],nS=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],nk=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],nL=[0,1,1,4];function nI(e,t,i,r,a){if(i+24>t.length)return;let s=nR(t,i);if(s&&i+s.frameLength<=t.length){let n=9e4*s.samplesPerFrame/s.sampleRate,o=r+a*n,l={unit:t.subarray(i,i+s.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function nR(e,t){let i=e[t+1]>>3&3,r=e[t+1]>>1&3,a=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==i&&0!==a&&15!==a&&3!==s){let n=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*n_[14*(3===i?3-r:3===r?3:4)+a-1],d=nS[3*(3===i?0:2===i?1:2)+s],u=nk[i][r],h=nL[r];if(null===nA){let e=navigator.userAgent||"",t=e.match(/Chrome\/(\d+)/i);nA=t?parseInt(t[1]):0}let c=!!nA&&nA<=87;return c&&2===r&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:3===o?1:2,frameLength:Math.floor(u*l/d+n)*h,samplesPerFrame:8*u*h}}}function nw(e,t){return 255===e[t]&&(224&e[t+1])==224&&(6&e[t+1])!=0}function nD(e,t){return t+1<e.length&&nw(e,t)}class nC{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw Error("no bytes available");r.set(e.subarray(i,i+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e||(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e}readBits(e){let t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&ai.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw Error("no bits available");return(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!=0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,i=8;for(let r=0;r<e;r++)0!==i&&(i=(t+this.readEG()+256)%256),t=0===i?t:i}readSPS(){let e,t,i,r=0,a=0,s=0,n=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),c=this.skipEG.bind(this),m=this.skipUEG.bind(this),f=this.skipScalingList.bind(this);o();let p=o();if(l(5),h(3),o(),m(),100===p||110===p||122===p||244===p||44===p||83===p||86===p||118===p||128===p){let e=d();if(3===e&&h(1),m(),m(),h(1),u())for(i=0,t=3!==e?8:12;i<t;i++)u()&&f(i<6?16:64)}m();let g=d();if(0===g)d();else if(1===g)for(h(1),c(),c(),e=d(),i=0;i<e;i++)c();m(),h(1);let v=d(),E=d(),b=l(1);0===b&&h(1),h(1),u()&&(r=d(),a=d(),s=d(),n=d());let y=[1,1];if(u()&&u()){let e=o();switch(e){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[o()<<8|o(),o()<<8|o()]}}return{width:Math.ceil((v+1)*16-2*r-2*a),height:(2-b)*(E+1)*16-(b?2:4)*(s+n),pixelRatio:y}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class nM{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new no(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,i){let r=e[t].unit;if(r.length<=16)return;let a=r.subarray(16,r.length-r.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(s).then(a=>{let s=new Uint8Array(a);r.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),r=0;for(let t=32;t<e.length-16;t+=160,r+=16)i.set(e.subarray(t,t+16),r);return i}getAvcDecryptedUnit(e,t){let i=new Uint8Array(t),r=0;for(let t=32;t<e.length-16;t+=160,r+=16)e.set(i.subarray(r,r+16),t);return e}decryptAvcSample(e,t,i,r,a){let s=aZ(a.data),n=this.getAvcEncryptedData(s);this.decryptBuffer(n.buffer).then(n=>{a.data=this.getAvcDecryptedUnit(s,n),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)})}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}let a=e[t].units;for(;!(i>=a.length);i++){let s=a[i];if(!(s.data.length<=48)&&(1===s.type||5===s.type)&&(this.decryptAvcSample(e,t,i,r,s),!this.decrypter.isSync()))return}}}}class nx{constructor(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=i}static probe(e){let t=nx.syncOffset(e);return t>0&&ai.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){let t=e.length,i=Math.min(940,e.length-188)+1,r=0;for(;r<i;){let a=!1,s=-1,n=0;for(let o=r;o<t;o+=188)if(71===e[o]){if(n++,-1===s&&0!==(s=o)&&(i=Math.min(s+18612,e.length-188)+1),a||(a=0===nP(e,o)),a&&n>1&&(0===s&&n>2||o+188>i))return s}else if(n)return -1;else break;r++}return -1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:a$[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=nx.createTrack("video"),this._audioTrack=nx.createTrack("audio",r),this._id3Track=nx.createTrack("id3"),this._txtTrack=nx.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i,this._duration=r}resetTimeStamp(){}resetContiguity(){let{_audioTrack:e,_avcTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,i=!1,r=!1){let a;i||(this.sampleAes=null);let s=this._avcTrack,n=this._audioTrack,o=this._id3Track,l=this._txtTrack,d=s.pid,u=s.pesData,h=n.pid,c=o.pid,m=n.pesData,f=o.pesData,p=null,g=this.pmtParsed,v=this._pmtId,E=e.length;if(this.remainderData&&(E=(e=az(this.remainderData,e)).length,this.remainderData=null),E<188&&!r)return this.remainderData=e,{audioTrack:n,videoTrack:s,id3Track:o,textTrack:l};let b=Math.max(0,nx.syncOffset(e));(E-=(E-b)%188)<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let y=0;for(let t=b;t<E;t+=188)if(71===e[t]){let r;let E=!!(64&e[t+1]),y=nP(e,t),_=(48&e[t+3])>>4;if(_>1){if((r=t+5+e[t+4])===t+188)continue}else r=t+4;switch(y){case d:E&&(u&&(a=nN(u))&&this.parseAVCPES(s,l,a,!1),u={data:[],size:0}),u&&(u.data.push(e.subarray(r,t+188)),u.size+=t+188-r);break;case h:if(E){if(m&&(a=nN(m)))switch(n.segmentCodec){case"aac":this.parseAACPES(n,a);break;case"mp3":this.parseMPEGPES(n,a)}m={data:[],size:0}}m&&(m.data.push(e.subarray(r,t+188)),m.size+=t+188-r);break;case c:E&&(f&&(a=nN(f))&&this.parseID3PES(o,a),f={data:[],size:0}),f&&(f.data.push(e.subarray(r,t+188)),f.size+=t+188-r);break;case 0:var T,A;E&&(r+=e[r]+1),v=this._pmtId=(31&(T=e)[(A=r)+10])<<8|T[A+11];break;case v:{E&&(r+=e[r]+1);let a=function(e,t,i,r){let a={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=(15&e[t+1])<<8|e[t+2],n=t+3+s-4,o=(15&e[t+10])<<8|e[t+11];for(t+=12+o;t<n;){let s=nP(e,t);switch(e[t]){case 207:if(!r){ai.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===a.audio&&(a.audio=s);break;case 21:-1===a.id3&&(a.id3=s);break;case 219:if(!r){ai.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===a.avc&&(a.avc=s);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?ai.log("MPEG audio found, not supported in this browser"):-1===a.audio&&(a.audio=s,a.segmentCodec="mp3");break;case 36:ai.warn("Unsupported HEVC stream type found")}t+=((15&e[t+3])<<8|e[t+4])+5}return a}(e,r,this.typeSupported,i);(d=a.avc)>0&&(s.pid=d),(h=a.audio)>0&&(n.pid=h,n.segmentCodec=a.segmentCodec),(c=a.id3)>0&&(o.pid=c),null===p||g||(ai.warn(`MPEG-TS PMT found at ${t} after unknown PID '${p}'. Backtracking to sync byte @${b} to parse all TS packets.`),p=null,t=b-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=y}}else y++;if(y>0){let e=Error(`Found ${y} TS packet/s that do not start with 0x47`);this.observer.emit(r8.ERROR,r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message})}s.pesData=u,n.pesData=m,o.pesData=f;let _={audioTrack:n,videoTrack:s,id3Track:o,textTrack:l};return r&&this.extractRemainingSamples(_),_}flush(){let e;let{remainderData:t}=this;return(this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes)?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(e){let t;let{audioTrack:i,videoTrack:r,id3Track:a,textTrack:s}=e,n=r.pesData,o=i.pesData,l=a.pesData;if(n&&(t=nN(n))?(this.parseAVCPES(r,s,t,!0),r.pesData=null):r.pesData=n,o&&(t=nN(o))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,t);break;case"mp3":this.parseMPEGPES(i,t)}i.pesData=null}else null!=o&&o.size&&ai.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=o;l&&(t=nN(l))?(this.parseID3PES(a,t),a.pesData=null):a.pesData=l}demuxSampleAes(e,t,i){let r=this.demux(e,i,!0,!this.config.progressive),a=this.sampleAes=new nM(this.observer,this.config,t);return this.decrypt(r,a)}decrypt(e,t){return new Promise(i=>{let{audioTrack:r,videoTrack:a}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{i(e)}):i(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{i(e)})})}destroy(){this._duration=0}parseAVCPES(e,t,i,r){let a;let s=this.parseAVCNALu(e,i.data),n=this.avcSample,o=!1;i.data=null,n&&s.length&&!e.audFound&&(nU(n,e),n=this.avcSample=nO(!1,i.pts,i.dts,"")),s.forEach(r=>{var s,l;switch(r.type){case 1:{let t=!1;a=!0;let s=r.data;if(o&&s.length>4){let e=new nC(s).readSliceType();(2===e||4===e||7===e||9===e)&&(t=!0)}t&&null!=(l=n)&&l.frame&&!n.key&&(nU(n,e),n=this.avcSample=null),n||(n=this.avcSample=nO(!0,i.pts,i.dts,"")),n.frame=!0,n.key=t;break}case 5:a=!0,null!=(s=n)&&s.frame&&!n.key&&(nU(n,e),n=this.avcSample=null),n||(n=this.avcSample=nO(!0,i.pts,i.dts,"")),n.key=!0,n.frame=!0;break;case 6:a=!0,aQ(r.data,1,i.pts,t.samples);break;case 7:if(a=!0,o=!0,!e.sps){let t=r.data,i=new nC(t),a=i.readSPS();e.width=a.width,e.height=a.height,e.pixelRatio=a.pixelRatio,e.sps=[t],e.duration=this._duration;let s=t.subarray(1,4),n="avc1.";for(let e=0;e<3;e++){let t=s[e].toString(16);t.length<2&&(t="0"+t),n+=t}e.codec=n}break;case 8:a=!0,e.pps||(e.pps=[r.data]);break;case 9:a=!1,e.audFound=!0,n&&nU(n,e),n=this.avcSample=nO(!1,i.pts,i.dts,"");break;case 12:a=!0;break;default:a=!1,n&&(n.debug+="unknown NAL "+r.type+" ")}if(n&&a){let e=n.units;e.push(r)}}),r&&n&&(nU(n,e),this.avcSample=null)}getLastNalUnit(e){var t;let i;let r=this.avcSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){let e=r.units;i=e[e.length-1]}return i}parseAVCNALu(e,t){let i,r,a;let s=t.byteLength,n=e.naluState||0,o=n,l=[],d=0,u=-1,h=0;for(-1===n&&(u=0,h=31&t[0],n=0,d=1);d<s;){if(i=t[d++],!n){n=i?0:1;continue}if(1===n){n=i?0:2;continue}if(i){if(1===i){if(u>=0){let e={data:t.subarray(u,d-n-1),type:h};l.push(e)}else{let i=this.getLastNalUnit(e.samples);if(i&&(o&&d<=4-o&&i.state&&(i.data=i.data.subarray(0,i.data.byteLength-o)),(r=d-n-1)>0)){let e=new Uint8Array(i.data.byteLength+r);e.set(i.data,0),e.set(t.subarray(0,r),i.data.byteLength),i.data=e,i.state=0}}d<s?(a=31&t[d],u=d,h=a,n=0):n=-1}else n=0}else n=3}if(u>=0&&n>=0){let e={data:t.subarray(u,s),type:h,state:n};l.push(e)}if(0===l.length){let i=this.getLastNalUnit(e.samples);if(i){let e=new Uint8Array(i.data.byteLength+t.byteLength);e.set(i.data,0),e.set(t,i.data.byteLength),i.data=e}}return e.naluState=n,l}parseAACPES(e,t){let i,r,a,s,n=0,o=this.aacOverFlow,l=t.data;if(o){this.aacOverFlow=null;let t=o.missing,i=o.sample.unit.byteLength;if(-1===t){let e=new Uint8Array(i+l.byteLength);e.set(o.sample.unit,0),e.set(l,i),l=e}else{let r=i-t;o.sample.unit.set(l.subarray(0,t),r),e.samples.push(o.sample),n=o.missing}}for(i=n,r=l.length;i<r-1&&!nE(l,i);i++);if(i!==n){let e;let t=i<r-1;e=t?`AAC PES did not start with ADTS header,offset:${i}`:"No ADTS header found in AAC PES";let a=Error(e);if(ai.warn(`parsing error: ${e}`),this.observer.emit(r8.ERROR,r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:a,reason:e}),!t)return}if(nb(e,this.observer,l,i,this.audioCodec),void 0!==t.pts)a=t.pts;else if(o){let t=9216e4/e.samplerate;a=o.sample.pts+t}else{ai.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0;for(;i<r;){if(s=ny(e,l,i,a,d),i+=s.length,s.missing){this.aacOverFlow=s;break}for(d++;i<r-1&&!nE(l,i);i++);}}parseMPEGPES(e,t){let i=t.data,r=i.length,a=0,s=0,n=t.pts;if(void 0===n){ai.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;s<r;)if(nD(i,s)){let t=nI(e,i,s,n,a);if(t)s+=t.length,a++;else break}else s++}parseID3PES(e,t){if(void 0===t.pts){ai.warn("[tsdemuxer]: ID3 PES unknown PTS");return}let i=r4({},t,{type:this._avcTrack?sy.emsg:sy.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function nO(e,t,i,r){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:r,length:0}}function nP(e,t){return((31&e[t+1])<<8)+e[t+2]}function nN(e){let t,i,r,a,s,n=0,o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){let e=new Uint8Array(o[0].length+o[1].length);e.set(o[0]),e.set(o[1],o[0].length),o[0]=e,o.splice(1,1)}t=o[0];let l=(t[0]<<16)+(t[1]<<8)+t[2];if(1===l){if((i=(t[4]<<8)+t[5])&&i>e.size-6)return null;let l=t[7];192&l&&(a=(14&t[9])*536870912+(255&t[10])*4194304+(254&t[11])*16384+(255&t[12])*128+(254&t[13])/2,64&l?a-(s=(14&t[14])*536870912+(255&t[15])*4194304+(254&t[16])*16384+(255&t[17])*128+(254&t[18])/2)>54e5&&(ai.warn(`${Math.round((a-s)/9e4)}s delta between PTS and DTS, align them`),a=s):s=a);let d=(r=t[8])+9;if(e.size<=d)return null;e.size-=d;let u=new Uint8Array(e.size);for(let e=0,i=o.length;e<i;e++){let i=(t=o[e]).byteLength;if(d){if(d>i){d-=i;continue}t=t.subarray(d),i-=d,d=0}u.set(t,n),n+=i}return i&&(i-=r+3),{data:u,pts:a,dts:s,len:i}}return null}function nU(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){let i=t.samples,r=i.length;if(r){let t=i[r-1];e.pts=t.pts,e.dts=t.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&ai.log(e.pts+"/"+e.dts+":"+e.debug)}class nF{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);else if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);else if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t||3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}class nB{static init(){let e;for(e in nB.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},nB.types)nB.types.hasOwnProperty(e)&&(nB.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);let t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);nB.HDLR_TYPES={video:t,audio:i};let r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);nB.STTS=nB.STSC=nB.STCO=a,nB.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),nB.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),nB.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),nB.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let s=new Uint8Array([105,115,111,109]),n=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);nB.FTYP=nB.box(nB.types.ftyp,s,o,s,n),nB.DINF=nB.box(nB.types.dinf,nB.box(nB.types.dref,r))}static box(e,...t){let i=8,r=t.length,a=r;for(;r--;)i+=t[r].byteLength;let s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(e,4),r=0,i=8;r<a;r++)s.set(t[r],i),i+=t[r].byteLength;return s}static hdlr(e){return nB.box(nB.types.hdlr,nB.HDLR_TYPES[e])}static mdat(e){return nB.box(nB.types.mdat,e)}static mdhd(e,t){t*=e;let i=Math.floor(t/4294967296),r=Math.floor(t%4294967296);return nB.box(nB.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return nB.box(nB.types.mdia,nB.mdhd(e.timescale,e.duration),nB.hdlr(e.type),nB.minf(e))}static mfhd(e){return nB.box(nB.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?nB.box(nB.types.minf,nB.box(nB.types.smhd,nB.SMHD),nB.DINF,nB.stbl(e)):nB.box(nB.types.minf,nB.box(nB.types.vmhd,nB.VMHD),nB.DINF,nB.stbl(e))}static moof(e,t,i){return nB.box(nB.types.moof,nB.mfhd(e),nB.traf(i,t))}static moov(e){let t=e.length,i=[];for(;t--;)i[t]=nB.trak(e[t]);return nB.box.apply(null,[nB.types.moov,nB.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(nB.mvex(e)))}static mvex(e){let t=e.length,i=[];for(;t--;)i[t]=nB.trex(e[t]);return nB.box.apply(null,[nB.types.mvex,...i])}static mvhd(e,t){t*=e;let i=Math.floor(t/4294967296),r=Math.floor(t%4294967296),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return nB.box(nB.types.mvhd,a)}static sdtp(e){let t,i;let r=e.samples||[],a=new Uint8Array(4+r.length);for(t=0;t<r.length;t++)i=r[t].flags,a[t+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return nB.box(nB.types.sdtp,a)}static stbl(e){return nB.box(nB.types.stbl,nB.stsd(e),nB.box(nB.types.stts,nB.STTS),nB.box(nB.types.stsc,nB.STSC),nB.box(nB.types.stsz,nB.STSZ),nB.box(nB.types.stco,nB.STCO))}static avc1(e){let t,i,r,a=[],s=[];for(t=0;t<e.sps.length;t++)r=(i=e.sps[t]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(i));for(t=0;t<e.pps.length;t++)r=(i=e.pps[t]).byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(i));let n=nB.box(nB.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|e.sps.length].concat(a).concat([e.pps.length]).concat(s))),o=e.width,l=e.height,d=e.pixelRatio[0],u=e.pixelRatio[1];return nB.box(nB.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n,nB.box(nB.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),nB.box(nB.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){let t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){let t=e.samplerate;return nB.box(nB.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),nB.box(nB.types.esds,nB.esds(e)))}static mp3(e){let t=e.samplerate;return nB.box(nB.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))}static stsd(e){return"audio"!==e.type?nB.box(nB.types.stsd,nB.STSD,nB.avc1(e)):"mp3"===e.segmentCodec&&"mp3"===e.codec?nB.box(nB.types.stsd,nB.STSD,nB.mp3(e)):nB.box(nB.types.stsd,nB.STSD,nB.mp4a(e))}static tkhd(e){let t=e.id,i=e.duration*e.timescale,r=e.width,a=e.height,s=Math.floor(i/4294967296),n=Math.floor(i%4294967296);return nB.box(nB.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))}static traf(e,t){let i=nB.sdtp(e),r=e.id,a=Math.floor(t/4294967296),s=Math.floor(t%4294967296);return nB.box(nB.types.traf,nB.box(nB.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),nB.box(nB.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),nB.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,nB.box(nB.types.trak,nB.tkhd(e),nB.mdia(e))}static trex(e){let t=e.id;return nB.box(nB.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){let i,r,a,s,n,o;let l=e.samples||[],d=l.length,u=12+16*d,h=new Uint8Array(u);for(t+=8+u,h.set(["video"===e.type?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),i=0;i<d;i++)a=(r=l[i]).duration,s=r.size,n=r.flags,o=r.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,n.isLeading<<2|n.dependsOn,n.isDependedOn<<6|n.hasRedundancy<<4|n.paddingValue<<1|n.isNonSync,61440&n.degradPrio,15&n.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*i);return nB.box(nB.types.trun,h)}static initSegment(e){nB.types||nB.init();let t=nB.moov(e),i=new Uint8Array(nB.FTYP.byteLength+t.byteLength);return i.set(nB.FTYP),i.set(t,nB.FTYP.byteLength),i}}function n$(e,t,i=1,r=!1){let a=e*t*i;return r?Math.round(a):a}function nV(e,t=!1){return n$(e,1e3,11111111111111112e-21,t)}nB.types=void 0,nB.HDLR_TYPES=void 0,nB.STTS=void 0,nB.STSC=void 0,nB.STCO=void 0,nB.STSZ=void 0,nB.VMHD=void 0,nB.SMHD=void 0,nB.STSD=void 0,nB.FTYP=void 0,nB.DINF=void 0;let nH=null,nG=null;class nW{constructor(e,t,i,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===nH){let e=navigator.userAgent||"",t=e.match(/Chrome\/(\d+)/i);nH=t?parseInt(t[1]):0}if(null===nG){let e=navigator.userAgent.match(/Safari\/(\d+)/i);nG=e?parseInt(e[1]):0}}destroy(){}resetTimeStamp(e){ai.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){ai.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){ai.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1,i=e.reduce((e,i)=>{let r=i.pts-e;return r<-4294967296?(t=!0,nK(e,i.pts)):r>0?e:i.pts},e[0].pts);return t&&ai.debug("PTS rollover detected"),i}remux(e,t,i,r,a,s,n,o){let l,d,u,h,c,m;let f=a,p=a,g=e.pid>-1,v=t.pid>-1,E=t.samples.length,b=e.samples.length>0,y=n&&E>0||E>1,T=(!g||b)&&(!v||y)||this.ISGenerated||n;if(T){let i;this.ISGenerated||(u=this.generateIS(e,t,a,s));let r=this.isVideoContiguous,n=-1;if(y&&(n=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return -1}(t.samples),!r&&this.config.forceKeyFrameOnDiscontinuity)){if(m=!0,n>0){ai.warn(`[mp4-remuxer]: Dropped ${n} out of ${E} video samples due to a missing keyframe`);let e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(n),t.dropped+=n,p+=(t.samples[0].pts-e)/t.inputTimeScale,i=p}else -1===n&&(ai.warn(`[mp4-remuxer]: No keyframe found out of ${E} video samples`),m=!1)}if(this.ISGenerated){if(b&&y){let i=this.getVideoStartPts(t.samples),r=nK(e.samples[0].pts,i)-i,a=r/t.inputTimeScale;f+=Math.max(0,a),p+=Math.max(0,-a)}if(b){if(e.samplerate||(ai.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(e,t,a,s)),d=this.remuxAudio(e,f,this.isAudioContiguous,s,v||y||o===sc.AUDIO?p:void 0),y){let i=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(ai.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(e,t,a,s)),l=this.remuxVideo(t,p,r,i)}}else y&&(l=this.remuxVideo(t,p,r,0));l&&(l.firstKeyFrame=n,l.independent=-1!==n,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(c=nq(i,a,this._initPTS,this._initDTS)),r.samples.length&&(h=nj(r,a,this._initPTS))),{audio:d,video:l,initSegment:u,independent:m,text:h,id3:c}}generateIS(e,t,i,r){let a,s,n;let o=e.samples,l=t.samples,d=this.typeSupported,u={},h=this._initPTS,c=!h||r,m="audio/mp4";if(c&&(a=s=1/0),e.config&&o.length&&(e.timescale=e.samplerate,"mp3"===e.segmentCodec&&(d.mpeg?(m="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3")),u.audio={id:"audio",container:m,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&d.mpeg?new Uint8Array(0):nB.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(n=e.inputTimeScale,h&&n===h.timescale?c=!1:a=s=o[0].pts-Math.round(n*i))),t.sps&&t.pps&&l.length&&(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:nB.initSegment([t]),metadata:{width:t.width,height:t.height}},c)){if(n=t.inputTimeScale,h&&n===h.timescale)c=!1;else{let e=this.getVideoStartPts(l),t=Math.round(n*i);s=Math.min(s,nK(l[0].dts,e)-t),a=Math.min(a,e-t)}}if(Object.keys(u).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:a,timescale:n},this._initDTS={baseTime:s,timescale:n}):a=n=void 0,{tracks:u,initPTS:a,timescale:n}}remuxVideo(e,t,i,r){let a,s,n;let o=e.inputTimeScale,l=e.samples,d=[],u=l.length,h=this._initPTS,c=this.nextAvcDts,m=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;if(!i||null===c){let e=l[0].pts-nK(l[0].dts,l[0].pts);c=t*o-e}let E=h.baseTime*o/h.timescale;for(let e=0;e<u;e++){let t=l[e];t.pts=nK(t.pts-E,c),t.dts=nK(t.dts-E,c),t.dts<l[e>0?e-1:e].dts&&(v=!0)}v&&l.sort(function(e,t){let i=e.dts-t.dts,r=e.pts-t.pts;return i||r}),a=l[0].dts,s=l[l.length-1].dts;let b=s-a,y=b?Math.round(b/(u-1)):f||e.inputTimeScale/30;if(i){let e=a-c,t=e>y,i=e<-1;if((t||i)&&(t?ai.warn(`AVC: ${nV(e,!0)} ms (${e}dts) hole between fragments detected, filling it`):ai.warn(`AVC: ${nV(-e,!0)} ms (${e}dts) overlapping between fragments detected`),!i||c>=l[0].pts)){a=c;let t=l[0].pts-e;l[0].dts=a,l[0].pts=t,ai.log(`Video: First PTS/DTS adjusted: ${nV(t,!0)}/${nV(a,!0)}, delta: ${nV(e,!0)} ms`)}}a=Math.max(0,a);let T=0,A=0;for(let e=0;e<u;e++){let t=l[e],i=t.units,r=i.length,s=0;for(let e=0;e<r;e++)s+=i[e].data.length;A+=s,T+=r,t.length=s,t.dts=Math.max(t.dts,a),p=Math.min(t.pts,p),g=Math.max(t.pts,g)}s=l[u-1].dts;let _=A+4*T+8;try{n=new Uint8Array(_)}catch(e){this.observer.emit(r8.ERROR,r8.ERROR,{type:r9.MUX_ERROR,details:r6.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:_,reason:`fail allocating video mdat ${_}`});return}let S=new DataView(n.buffer);S.setUint32(0,_),n.set(nB.types.mdat,4);let k=!1,L=Number.POSITIVE_INFINITY,I=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY,w=Number.NEGATIVE_INFINITY;for(let e=0;e<u;e++){let t;let i=l[e],a=i.units,s=0;for(let e=0,t=a.length;e<t;e++){let t=a[e],i=t.data,r=t.data.byteLength;S.setUint32(m,r),m+=4,n.set(i,m),m+=r,s+=4+r}if(e<u-1)f=l[e+1].dts-i.dts,t=l[e+1].pts-i.pts;else{let a=this.config,s=e>0?i.dts-l[e-1].dts:y;if(t=e>0?i.pts-l[e-1].pts:y,a.stretchShortVideoTrack&&null!==this.nextAudioPts){let e=Math.floor(a.maxBufferHole*o),t=(r?p+r*o:this.nextAudioPts)-i.pts;t>e?((f=t-s)<0?f=s:k=!0,ai.log(`[mp4-remuxer]: It is approximately ${t/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=s}else f=s}let h=Math.round(i.pts-i.dts);L=Math.min(L,f),R=Math.max(R,f),I=Math.min(I,t),w=Math.max(w,t),d.push(new nY(i.key,f,s,h))}if(d.length){if(nH){if(nH<70){let e=d[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(nG&&w-I<R-L&&y/R<.025&&0===d[0].cts){ai.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=a;for(let t=0,i=d.length;t<i;t++){let r=e+d[t].duration,a=e+d[t].cts;if(t<i-1){let e=r+d[t+1].cts;d[t].duration=e-a}else d[t].duration=t?d[t-1].duration:y;d[t].cts=0,e=r}}}f=k||!f?y:f,this.nextAvcDts=c=s+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;let D=nB.moof(e.sequenceNumber++,a,r4({},e,{samples:d})),C={data1:D,data2:n,startPTS:p/o,endPTS:(g+f)/o,startDTS:a/o,endDTS:c/o,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,C}remuxAudio(e,t,i,r,a){let s;let n=e.inputTimeScale,o=e.samplerate?e.samplerate:n,l=n/o,d="aac"===e.segmentCodec?1024:1152,u=d*l,h=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,m=[],f=void 0!==a,p=e.samples,g=c?0:8,v=this.nextAudioPts||-1,E=t*n,b=h.baseTime*n/h.timescale;if(this.isAudioContiguous=i=i||p.length&&v>0&&(r&&9e3>Math.abs(E-v)||Math.abs(nK(p[0].pts-b,E)-v)<20*u),p.forEach(function(e){e.pts=nK(e.pts-b,E)}),!i||v<0){if(!(p=p.filter(e=>e.pts>=0)).length)return;v=0===a?0:r&&!f?Math.max(0,E):p[0].pts}if("aac"===e.segmentCodec){let t=this.config.maxAudioFramesDrift;for(let i=0,r=v;i<p.length;i++){let a=p[i],s=a.pts,o=s-r,l=Math.abs(1e3*o/n);if(o<=-t*u&&f)0===i&&(ai.warn(`Audio frame @ ${(s/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/n)} ms.`),this.nextAudioPts=v=r=s);else if(o>=t*u&&l<1e4&&f){let t=Math.round(o/u);(r=s-t*u)<0&&(t--,r+=u),0===i&&(this.nextAudioPts=v=r),ai.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(r/n).toFixed(3)}s due to ${Math.round(1e3*o/n)} ms gap.`);for(let s=0;s<t;s++){let t=Math.max(r,0),s=nF.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);s||(ai.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),s=a.unit.subarray()),p.splice(i,0,{unit:s,pts:t}),r+=u,i++}}a.pts=r,r+=u}}let y=null,T=null,A=0,_=p.length;for(;_--;)A+=p[_].unit.byteLength;for(let t=0,r=p.length;t<r;t++){let r=p[t],a=r.unit,n=r.pts;if(null!==T){let e=m[t-1];e.duration=Math.round((n-T)/l)}else{if(i&&"aac"===e.segmentCodec&&(n=v),y=n,!(A>0))return;A+=g;try{s=new Uint8Array(A)}catch(e){this.observer.emit(r8.ERROR,r8.ERROR,{type:r9.MUX_ERROR,details:r6.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:A,reason:`fail allocating audio mdat ${A}`});return}if(!c){let e=new DataView(s.buffer);e.setUint32(0,A),s.set(nB.types.mdat,4)}}s.set(a,g);let o=a.byteLength;g+=o,m.push(new nY(!0,d,o,0)),T=n}let S=m.length;if(!S)return;let k=m[m.length-1];this.nextAudioPts=v=T+l*k.duration;let L=c?new Uint8Array(0):nB.moof(e.sequenceNumber++,y/l,r4({},e,{samples:m}));e.samples=[];let I=y/n,R=v/n,w={data1:L,data2:s,startPTS:I,endPTS:R,startDTS:I,endDTS:R,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,w}remuxEmptyAudio(e,t,i,r){let a=e.inputTimeScale,s=e.samplerate?e.samplerate:a,n=this.nextAudioPts,o=this._initDTS,l=9e4*o.baseTime/o.timescale,d=(null!==n?n:r.startDTS*a)+l,u=r.endDTS*a+l,h=a/s*1024,c=Math.ceil((u-d)/h),m=nF.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(ai.warn("[mp4-remuxer]: remux empty Audio"),!m){ai.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}let f=[];for(let e=0;e<c;e++){let t=d+e*h;f.push({unit:m,pts:t,dts:t})}return e.samples=f,this.remuxAudio(e,t,i,!1)}}function nK(e,t){let i;if(null===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}function nq(e,t,i,r){let a=e.samples.length;if(!a)return;let s=e.inputTimeScale;for(let n=0;n<a;n++){let a=e.samples[n];a.pts=nK(a.pts-i.baseTime*s/i.timescale,t*s)/s,a.dts=nK(a.dts-r.baseTime*s/r.timescale,t*s)/s}let n=e.samples;return e.samples=[],{samples:n}}function nj(e,t,i){let r=e.samples.length;if(!r)return;let a=e.inputTimeScale;for(let s=0;s<r;s++){let r=e.samples[s];r.pts=nK(r.pts-i.baseTime*a/i.timescale,t*a)/a}e.samples.sort((e,t)=>e.pts-t.pts);let s=e.samples;return e.samples=[],{samples:s}}class nY{constructor(e,t,i,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=r,this.flags=new nz(e)}}class nz{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function nX(e,t){let i=null==e?void 0:e.codec;return i&&i.length>4?i:"hvc1"===i||"hev1"===i?"hvc1.1.6.L120.90":"av01"===i?"av01.0.04M.08":"avc1"===i||t===al.VIDEO?"avc1.42e01e":"mp4a.40.5"}try{o=self.performance.now.bind(self.performance)}catch(e){ai.debug("Unable to use Performance API on this environment"),o="undefined"!=typeof self&&self.Date.now}let nQ=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){let a=this.videoTrack=nc("video",1),s=this.audioTrack=nc("audio",1),n=this.txtTrack=nc("text",1);if(this.id3Track=nc("id3",1),this.timeOffset=0,!(null!=e&&e.byteLength))return;let o=aj(e);if(o.video){let{id:e,timescale:t,codec:i}=o.video;a.id=e,a.timescale=n.timescale=t,a.codec=i}if(o.audio){let{id:e,timescale:t,codec:i}=o.audio;s.id=e,s.timescale=t,s.codec=i}n.id=4,a.sampleDuration=0,a.duration=s.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return aq(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let i=e,r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=az(this.remainderData,e));let t=function(e){let t={valid:null,remainder:null},i=aq(e,["moof"]);if(!i)return t;if(i.length<2)return t.remainder=e,t;let r=i[i.length-1];return t.valid=aA(e,0,r.byteOffset-8),t.remainder=aA(e,r.byteOffset-8),t}(i);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=i;let s=this.extractID3Track(r,t);return a.samples=aX(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let r=this.extractID3Track(t,this.timeOffset);return i.samples=aX(e,t),{videoTrack:t,audioTrack:nc(),id3Track:r,textTrack:nc()}}extractID3Track(e,t){let i=this.id3Track;if(e.samples.length){let r=aq(e.samples,["emsg"]);r&&r.forEach(e=>{let r=function(e){let t=e[0],i="",r="",a=0,s=0,n=0,o=0,l=0,d=0;if(0===t){for(;"\x00"!==aV(e.subarray(d,d+1));)i+=aV(e.subarray(d,d+1)),d+=1;for(i+=aV(e.subarray(d,d+1)),d+=1;"\x00"!==aV(e.subarray(d,d+1));)r+=aV(e.subarray(d,d+1)),d+=1;r+=aV(e.subarray(d,d+1)),d+=1,a=aG(e,12),s=aG(e,16),o=aG(e,20),l=aG(e,24),d=28}else if(1===t){d+=4,a=aG(e,d),d+=4;let t=aG(e,d);d+=4;let s=aG(e,d);for(d+=4,Number.isSafeInteger(n=4294967296*t+s)||(n=Number.MAX_SAFE_INTEGER,ai.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=aG(e,d),d+=4,l=aG(e,d),d+=4;"\x00"!==aV(e.subarray(d,d+1));)i+=aV(e.subarray(d,d+1)),d+=1;for(i+=aV(e.subarray(d,d+1)),d+=1;"\x00"!==aV(e.subarray(d,d+1));)r+=aV(e.subarray(d,d+1)),d+=1;r+=aV(e.subarray(d,d+1)),d+=1}let u=e.subarray(d,e.byteLength);return{schemeIdUri:i,value:r,timeScale:a,presentationTime:n,presentationTimeDelta:s,eventDuration:o,id:l,payload:u}}(e);if(nT.test(r.schemeIdUri)){let e=r5(r.presentationTime)?r.presentationTime/r.timeScale:t+r.presentationTimeDelta/r.timeScale,a=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);let s=r.payload;i.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:sy.emsg,duration:a})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(function(e,t){if(!e||!t)return e;let i=t.keyId;if(i&&t.isCommonEncryption){let t=aq(e,["moov","trak"]);t.forEach(e=>{let t=aq(e,["mdia","minf","stbl","stsd"])[0],r=t.subarray(8),a=aq(r,["enca"]),s=a.length>0;s||(a=aq(r,["encv"])),a.forEach(e=>{let t=s?e.subarray(28):e.subarray(78),r=aq(t,["sinf"]);r.forEach(e=>{let t=aY(e);if(t){let e=t.subarray(8,24);e.some(e=>0!==e)||(ai.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${aF.hexDump(e)} -> ${aF.hexDump(i)}`),t.set(i,8))}})})})}return e}(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(null!=e&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let r=this.initData=aj(e);t||(t=nX(r.audio,al.AUDIO)),i||(i=nX(r.video,al.VIDEO));let a={};r.audio&&r.video?a.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:r.audio?a.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?a.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:ai.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,i,r,a,s){var n,o,l;let{initPTS:d,lastEndTime:u}=this,h={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};r5(u)||(u=this.lastEndTime=a||0);let c=t.samples;if(!(null!=c&&c.length))return h;let m={initPTS:void 0,timescale:1},f=this.initData;if(null!=(n=f)&&n.length||(this.generateInitSegment(c),f=this.initData),!(null!=(o=f)&&o.length))return ai.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);let p=function(e,t){let i=0,r=0,a=0,s=aq(e,["moof","traf"]);for(let e=0;e<s.length;e++){let n=s[e],o=aq(n,["tfhd"])[0],l=aG(o,4),d=t[l];if(!d)continue;let u=d.default,h=aG(o,0)|(null==u?void 0:u.flags),c=null==u?void 0:u.duration;8&h&&(c=2&h?aG(o,12):aG(o,8));let m=d.timescale||9e4,f=aq(n,["trun"]);for(let e=0;e<f.length;e++){if(!(i=function(e){let t=aG(e,0),i=8;1&t&&(i+=4),4&t&&(i+=4);let r=0,a=aG(e,4);for(let s=0;s<a;s++){if(256&t){let t=aG(e,i);r+=t,i+=4}512&t&&(i+=4),1024&t&&(i+=4),2048&t&&(i+=4)}return r}(f[e]))&&c){let t=aG(f[e],4);i=c*t}d.type===al.VIDEO?r+=i/m:d.type===al.AUDIO&&(a+=i/m)}}if(0===r&&0===a){let t=0,i=aq(e,["sidx"]);for(let e=0;e<i.length;e++){let r=function(e){let t=[],i=e[0],r=8,a=aG(e,r);r+=4,0===i?r+=8:r+=16,r+=2;let s=e.length+0,n=aH(e,r);r+=2;for(let i=0;i<n;i++){let i=r,n=aG(e,i);i+=4;let o=2147483647&n,l=(2147483648&n)>>>31;if(1===l)return ai.warn("SIDX has hierarchical references (not supported)"),null;let d=aG(e,i);i+=4,t.push({referenceSize:o,subsegmentDuration:d,info:{duration:d/a,start:s,end:s+o-1}}),s+=o,i+=4,r=i}return{earliestPresentationTime:0,timescale:a,version:i,referencesCount:n,references:t}}(i[e]);null!=r&&r.references&&(t+=r.references.reduce((e,t)=>e+t.info.duration||0,0))}return t}return r||a}(c,f),g=(l=f,aq(c,["moof","traf"]).reduce((e,t)=>{let i=aq(t,["tfdt"])[0],r=i[0],a=aq(t,["tfhd"]).reduce((e,t)=>{let a=aG(t,4),s=l[a];if(s){let t=aG(i,4);if(1===r){if(4294967295===t)return ai.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),e;t*=4294967296,t+=aG(i,8)}let a=s.timescale||9e4,n=t/a;if(isFinite(n)&&(null===e||n<e))return n}return e},null);return null!==a&&isFinite(a)&&(null===e||a<e)?a:e},null)),v=null===g?a:g;((function(e,t,i,r){if(null===e)return!0;let a=t-e.baseTime/e.timescale;return Math.abs(a-i)>Math.max(r,1)})(d,v,a,p)||m.timescale!==d.timescale&&s)&&(m.initPTS=v-a,d&&1===d.timescale&&ai.warn(`Adjusting initPTS by ${m.initPTS-d.baseTime}`),this.initPTS=d={baseTime:m.initPTS,timescale:1});let E=e?v-d.baseTime/d.timescale:u,b=E+p;(function(e,t,i){aq(t,["moof","traf"]).forEach(t=>{aq(t,["tfhd"]).forEach(r=>{let a=aG(r,4),s=e[a];if(!s)return;let n=s.timescale||9e4;aq(t,["tfdt"]).forEach(e=>{let t=e[0],r=aG(e,4);if(0===t)r-=i*n,aK(e,4,r=Math.max(r,0));else{r*=4294967296,r+=aG(e,8),r-=i*n,r=Math.max(r,0);let t=Math.floor(r/4294967296),a=Math.floor(r%4294967296);aK(e,4,t),aK(e,8,a)}})})})})(f,c,d.baseTime/d.timescale),p>0?this.lastEndTime=b:(ai.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let y=!!f.audio,T=!!f.video,A="";y&&(A+="audio"),T&&(A+="video");let _={data1:c,startPTS:E,startDTS:E,endPTS:b,endDTS:b,type:A,hasAudio:y,hasVideo:T,nb:1,dropped:0};return h.audio="audio"===_.type?_:void 0,h.video="audio"!==_.type?_:void 0,h.initSegment=m,h.id3=nq(i,a,d,d),r.samples.length&&(h.text=nj(r,a,d)),h}}},{demux:nx,remux:nW},{demux:class extends nm{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=ak(e,0)||[],i=t.length;for(let t=e.length;i<t;i++)if(function(e,t){if(nE(e,t)){let i=ng(e,t);if(t+i>=e.length)return!1;let r=nv(e,t);if(r<=i)return!1;let a=t+r;return a===e.length||nE(e,a)}return!1}(e,i))return ai.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return t+5<e.length&&np(e,t)&&nv(e,t)<=e.length-t}appendFrame(e,t,i){nb(e,this.observer,t,i,e.manifestCodec);let r=ny(e,t,i,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:nW},{demux:class extends nm{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=ak(e,0)||[],i=t.length;for(let t=e.length;i<t;i++)if(function(e,t){if(t+1<e.length&&nw(e,t)){let i=nR(e,t),r=4;null!=i&&i.frameLength&&(r=i.frameLength);let a=t+r;return a===e.length||nD(e,a)}return!1}(e,i))return ai.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return nw(e,t)&&4<=e.length-t}appendFrame(e,t,i){if(null!==this.basePTS)return nI(e,t,i,this.basePTS,this.frameIndex)}},remux:nW}];class nZ{constructor(e,t,i,r,a){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=r,this.id=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){let a;let s=i.transmuxing;s.executeStart=o();let n=new Uint8Array(e),{currentTransmuxState:l,transmuxConfig:d}=this;r&&(this.currentTransmuxState=r);let{contiguous:u,discontinuity:h,trackSwitch:c,accurateTimeOffset:m,timeOffset:f,initSegmentChange:p}=r||l,{audioCodec:g,videoCodec:v,defaultInitPts:E,duration:b,initSegmentData:y}=d,T=(a=null,n.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(a=t),a);if(T&&"AES-128"===T.method){let e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(n,T.key.buffer,T.iv.buffer).then(e=>{let t=this.push(e,null,i);return this.decryptionPromise=null,t}),this.decryptionPromise;{let t=e.softwareDecrypt(n,T.key.buffer,T.iv.buffer),r=i.part>-1;if(r&&(t=e.flush()),!t)return s.executeEnd=o(),nJ(i);n=new Uint8Array(t)}}let A=this.needsProbing(h,c);if(A){let e=this.configureTransmuxer(n);if(e)return ai.warn(`[transmuxer] ${e.message}`),this.observer.emit(r8.ERROR,r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),s.executeEnd=o(),nJ(i)}(h||c||p||A)&&this.resetInitSegment(y,g,v,b,t),(h||p||A)&&this.resetInitialTimestamp(E),u||this.resetContiguity();let _=this.transmux(n,T,f,m,i),S=this.currentTransmuxState;return S.contiguous=!0,S.discontinuity=!1,S.trackSwitch=!1,s.executeEnd=o(),_}flush(e){let t=e.transmuxing;t.executeStart=o();let{decrypter:i,currentTransmuxState:r,decryptionPromise:a}=this;if(a)return a.then(()=>this.flush(e));let s=[],{timeOffset:n}=r;if(i){let t=i.flush();t&&s.push(this.push(t,null,e))}let{demuxer:l,remuxer:d}=this;if(!l||!d)return t.executeEnd=o(),[nJ(e)];let u=l.flush(n);return n0(u)?u.then(t=>(this.flushRemux(s,t,e),s)):(this.flushRemux(s,u,e),s)}flushRemux(e,t,i){let{audioTrack:r,videoTrack:a,id3Track:s,textTrack:n}=t,{accurateTimeOffset:l,timeOffset:d}=this.currentTransmuxState;ai.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);let u=this.remuxer.remux(r,a,s,n,d,l,!0,this.id);e.push({remuxResult:u,chunkMeta:i}),i.transmuxing.executeEnd=o()}resetInitialTimestamp(e){let{demuxer:t,remuxer:i}=this;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,a){let{demuxer:s,remuxer:n}=this;s&&n&&(s.resetInitSegment(e,t,i,r),n.resetInitSegment(e,t,i,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,a){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,r,a):this.transmuxUnencrypted(e,i,r,a)}transmuxUnencrypted(e,t,i,r){let{audioTrack:a,videoTrack:s,id3Track:n,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive),l=this.remuxer.remux(a,s,n,o,t,i,!1,this.id);return{remuxResult:l,chunkMeta:r}}transmuxSampleAes(e,t,i,r,a){return this.demuxer.demuxSampleAes(e,t,i).then(e=>{let t=this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,r,!1,this.id);return{remuxResult:t,chunkMeta:a}})}configureTransmuxer(e){let t;let{config:i,observer:r,typeSupported:a,vendor:s}=this;for(let i=0,r=nQ.length;i<r;i++)if(nQ[i].demux.probe(e)){t=nQ[i];break}if(!t)return Error("Failed to find demuxer by probing fragment data");let n=this.demuxer,o=this.remuxer,l=t.remux,d=t.demux;o&&o instanceof l||(this.remuxer=new l(r,i,a,s)),n&&n instanceof d||(this.demuxer=new d(r,i,a),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new no(this.config)),e}}let nJ=e=>({remuxResult:{},chunkMeta:e});function n0(e){return"then"in e&&e.then instanceof Function}class n1{constructor(e,t,i,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=a||null}}class n2{constructor(e,t,i,r,a,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=s}}var n3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function a(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,r,s,n){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new a(r,s||e,n),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function n(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),o.prototype.eventNames=function(){var e,r,a=[];if(0===this._eventsCount)return a;for(r in e=this._events)t.call(e,r)&&a.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,s=r.length,n=Array(s);a<s;a++)n[a]=r[a].fn;return n},o.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,a,s,n){var o=i?i+e:e;if(!this._events[o])return!1;var l,d,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,a),!0;case 5:return u.fn.call(u.context,t,r,a,s),!0;case 6:return u.fn.call(u.context,t,r,a,s,n),!0}for(d=1,l=Array(h-1);d<h;d++)l[d-1]=arguments[d];u.fn.apply(u.context,l)}else{var c,m=u.length;for(d=0;d<m;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),h){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,r);break;case 4:u[d].fn.call(u[d].context,t,r,a);break;default:if(!l)for(c=1,l=Array(h-1);c<h;c++)l[c-1]=arguments[c];u[d].fn.apply(u[d].context,l)}}return!0},o.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,r,a){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return n(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||a&&!o.once||r&&o.context!==r||n(this,s);else{for(var l=0,d=[],u=o.length;l<u;l++)(o[l].fn!==t||a&&!o[l].once||r&&o[l].context!==r)&&d.push(o[l]);d.length?this._events[s]=1===d.length?d[0]:d:n(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&n(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o}(n3);var n4=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(n3.exports);let n5=a5()||{isTypeSupported:()=>!1};class n8{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;let a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;let s=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===r8.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new n4,this.observer.on(r8.FRAG_DECRYPTED,s),this.observer.on(r8.ERROR,s);let n={mp4:n5.isTypeSupported("video/mp4"),mpeg:n5.isTypeSupported("audio/mpeg"),mp3:n5.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){let e=a.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__;if(e){try{a.workerPath?(ai.log(`loading Web Worker ${a.workerPath} for "${t}"`),this.workerContext=function(e){let t=new self.URL(e,self.location.href).href,i=new self.Worker(t);return{worker:i,scriptURL:t}}(a.workerPath)):(ai.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){let e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i=new self.Worker(t);return{worker:i,objectURL:t}}()),this.onwmsg=e=>this.onWorkerMessage(e);let{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{let i=Error(`${e.message}  (${e.filename}:${e.lineno})`);a.enableWorker=!1,ai.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(r8.ERROR,{type:r9.OTHER_ERROR,details:r6.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:i})},e.postMessage({cmd:"init",typeSupported:n,vendor:o,id:t,config:JSON.stringify(a)})}catch(e){ai.warn(`Error setting up "${t}" Web Worker, fallback to inline`,e),this.resetWorker(),this.error=null,this.transmuxer=new nZ(this.observer,n,a,o,t)}return}}this.transmuxer=new nZ(this.observer,n,a,o,t)}resetWorker(){if(this.workerContext){let{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{let e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,i,r,a,s,n,o,l,d){var u,h;l.transmuxing.start=self.performance.now();let{transmuxer:c}=this,m=s?s.start:a.start,f=a.decryptdata,p=this.frag,g=!(p&&a.cc===p.cc),v=!(p&&l.level===p.level),E=p?l.sn-p.sn:-1,b=this.part?l.part-this.part.index:-1,y=0===E&&l.id>1&&l.id===(null==p?void 0:p.stats.chunkCount),T=!v&&(1===E||0===E&&(1===b||y&&b<=0)),A=self.performance.now();(v||E||0===a.stats.parsing.start)&&(a.stats.parsing.start=A),s&&(b||!T)&&(s.stats.parsing.start=A);let _=!(p&&(null==(u=a.initSegment)?void 0:u.url)===(null==(h=p.initSegment)?void 0:h.url)),S=new n2(g,T,o,v,m,_);if(!T||g||_){ai.log(`[transmuxer-interface, ${a.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}
        discontinuity: ${g}
        trackSwitch: ${v}
        contiguous: ${T}
        accurateTimeOffset: ${o}
        timeOffset: ${m}
        initSegmentChange: ${_}`);let e=new n1(i,r,t,n,d);this.configureTransmuxer(e)}if(this.frag=a,this.part=s,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:f,chunkMeta:l,state:S},e instanceof ArrayBuffer?[e]:[]);else if(c){let t=c.push(e,f,l,S);n0(t)?(c.async=!0,t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):(c.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();let{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let i=t.flush(e),r=n0(i);r||t.async?(n0(i)||(i=Promise.resolve(i)),i.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}onWorkerMessage(e){let t=e.data,i=this.hls;switch(t.event){case"init":{var r;let e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":ai[t.data.logType]&&ai[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}}configureTransmuxer(e){let{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class n9{constructor(e,t,i,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){let{config:i,media:r,stalled:a}=this;if(null===r)return;let{currentTime:s,seeking:n}=r,o=this.seeking&&!n,l=!this.seeking&&n;if(this.seeking=n,s!==e){if(this.moved=!0,null!==a){if(this.stallReported){let e=self.performance.now()-a;ai.warn(`playback not stuck anymore @${s}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(l||o){this.stalled=null;return}if(r.paused&&!n||r.ended||0===r.playbackRate||!s9.getBuffered(r).length)return;let d=s9.bufferInfo(r,s,0),u=d.len>0,h=d.nextStart||0;if(!u&&!h)return;if(n){let e=d.len>2,i=!h||t&&t.start<=s||h-s>2&&!this.fragmentTracker.getPartialFragment(s);if(e||i)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var c;let e=Math.max(h,d.start||0)-s,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,i=null==t?void 0:null==(c=t.details)?void 0:c.live,r=i?2*t.details.targetduration:2,a=this.fragmentTracker.getPartialFragment(s);if(e>0&&(e<=r||a)){this._trySkipBufferHole(a);return}}let m=self.performance.now();if(null===a){this.stalled=m;return}let f=m-a;if(!n&&f>=250&&(this._reportStall(d),!this.media))return;let p=s9.bufferInfo(r,s,i.maxBufferHole);this._tryFixBufferStall(p,f)}_tryFixBufferStall(e,t){let{config:i,fragmentTracker:r,media:a}=this;if(null===a)return;let s=a.currentTime,n=r.getPartialFragment(s);if(n){let e=this._trySkipBufferHole(n);if(e||!this.media)return}(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-s<i.maxBufferHole)&&t>1e3*i.highBufferWatchdogPeriod&&(ai.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){let{hls:t,media:i,stallReported:r}=this;if(!r&&i){this.stallReported=!0;let r=Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(e)})`);ai.warn(r.message),t.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len})}}_trySkipBufferHole(e){let{config:t,hls:i,media:r}=this;if(null===r)return 0;let a=r.currentTime,s=s9.bufferInfo(r,a,0),n=a<s.start?s.start:s.nextStart;if(n){let o=s.len<=t.maxBufferHole,l=s.len>0&&s.len<1&&r.readyState<3,d=n-a;if(d>0&&(o||l)){if(d>t.maxBufferHole){let{fragmentTracker:t}=this,i=!1;if(0===a){let e=t.getAppendedFrag(0,sc.MAIN);e&&n<e.end&&(i=!0)}if(!i){let i=e||t.getAppendedFrag(a,sc.MAIN);if(i){let e=!1,r=i.end;for(;r<n;){let i=t.getPartialFragment(r);if(i)r+=i.duration;else{e=!0;break}}if(e)return 0}}}let s=Math.max(n+.05,a+.1);if(ai.warn(`skipping hole, adjusting currentTime from ${a} to ${s}`),this.moved=!0,this.stalled=null,r.currentTime=s,e&&!e.gap){let t=Error(`fragment loaded with buffer holes, seeking from ${a} to ${s}`);i.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return s}}return 0}_tryNudgeBuffer(){let{config:e,hls:t,media:i,nudgeRetry:r}=this;if(null===i)return;let a=i.currentTime;if(this.nudgeRetry++,r<e.nudgeMaxRetry){let s=a+(r+1)*e.nudgeOffset,n=Error(`Nudging 'currentTime' from ${a} to ${s}`);ai.warn(n.message),i.currentTime=s,t.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.BUFFER_NUDGE_ON_STALL,error:n,fatal:!1})}else{let i=Error(`Playhead still not moving while enough data buffered @${a} after ${e.nudgeMaxRetry} nudges`);ai.error(i.message),t.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.BUFFER_STALLED_ERROR,error:i,fatal:!0})}}}class n6 extends nu{constructor(e,t,i){super(e,t,i,"[stream-controller]",sc.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r8.LEVEL_LOADING,this.onLevelLoading,this),e.on(r8.LEVEL_LOADED,this.onLevelLoaded,this),e.on(r8.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(r8.ERROR,this.onError,this),e.on(r8.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(r8.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(r8.BUFFER_CREATED,this.onBufferCreated,this),e.on(r8.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(r8.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(r8.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r8.LEVEL_LOADED,this.onLevelLoaded,this),e.off(r8.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(r8.ERROR,this.onError,this),e.off(r8.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(r8.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(r8.BUFFER_CREATED,this.onBufferCreated,this),e.off(r8.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(r8.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(r8.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){let{lastCurrentTime:t,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.nextAutoLevel),this.level=i.nextLoadLevel=e,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=nd.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=nd.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){var e,t;switch(this.state){case nd.WAITING_LEVEL:{let{levels:t,level:i}=this,r=null==t?void 0:null==(e=t[i])?void 0:e.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=nd.IDLE}else this.hls.nextLoadLevel!==this.level&&(this.state=nd.IDLE);break}case nd.FRAG_LOADING_WAITING_RETRY:{let e=self.performance.now(),i=this.retryDate;(!i||e>=i||null!=(t=this.media)&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=nd.IDLE)}}this.state===nd.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:i,media:r}=this,{config:a,nextLoadLevel:s}=e;if(null===t||!r&&(this.startFragRequested||!a.startFragPrefetch)||this.altAudio&&this.audioOnly||!(null!=i&&i[s]))return;let n=i[s],o=this.getMainFwdBufferInfo();if(null===o)return;let l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){let e={};this.altAudio&&(e.type="video"),this.hls.trigger(r8.BUFFER_EOS,e),this.state=nd.ENDED;return}e.loadLevel!==s&&-1===e.manualLevel&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;let d=n.details;if(!d||this.state===nd.WAITING_LEVEL||d.live&&this.levelLastLoaded!==s){this.level=s,this.state=nd.WAITING_LEVEL;return}let u=o.len,h=this.getMaxBufferLength(n.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);let c=this.backtrackFragment?this.backtrackFragment.start:o.end,m=this.getNextFragment(c,d);if(this.couldBacktrack&&!this.fragPrevious&&m&&"initSegment"!==m.sn&&this.fragmentTracker.getState(m)!==sX.OK){var f;let e=(null!=(f=this.backtrackFragment)?f:m).sn,t=e-d.startSN,i=d.fragments[t-1];i&&m.cc===i.cc&&(m=i,this.fragmentTracker.removeFragment(i))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,c)){let e=m.gap;if(!e){let e=this.audioOnly&&!this.altAudio?al.AUDIO:al.VIDEO,t=(e===al.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,sc.MAIN)}m=this.getNextFragmentLoopLoading(m,d,o,sc.MAIN,h)}m&&(!m.initSegment||m.initSegment.data||this.bitrateTest||(m=m.initSegment),this.loadFragment(m,n,c))}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);this.fragCurrent=e,r===sX.NOT_LOADED||r===sX.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,sc.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:e,media:t}=this;if(null!=t&&t.readyState){let i;let r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);let a=this.getLevelDetails();if(null!=a&&a.live){let e=this.getMainFwdBufferInfo();if(!e||e.len<2*a.targetduration)return}if(!t.paused&&e){let t=this.hls.nextLoadLevel,r=e[t],a=this.fragLastKbps;i=a&&this.fragCurrent?this.fragCurrent.duration*r.maxBitrate/(1e3*a)+1:0}else i=0;let s=this.getBufferedFrag(t.currentTime+i);if(s){let e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();let t=e.maxStartPTS?e.maxStartPTS:e.start,i=e.duration,r=Math.max(s.end,t+Math.min(Math.max(i-this.config.maxFragLookUpTolerance,.5*i),.75*i));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case nd.KEY_LOADING:case nd.FRAG_LOADING:case nd.FRAG_LOADING_WAITING_RETRY:case nd.PARSING:case nd.PARSED:this.state=nd.IDLE}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new n9(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){let{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){let e=this.media,t=e?e.currentTime:null;r5(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);let i=this.getMainFwdBufferInfo();if(null===i||0===i.len){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(r8.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let i,r=!1,a=!1;t.levels.forEach(e=>{(i=e.audioCodec)&&(-1!==i.indexOf("mp4a.40.2")&&(r=!0),-1!==i.indexOf("mp4a.40.5")&&(a=!0))}),this.audioCodecSwitch=r&&a&&!function(){var e;let t=nh();return"function"==typeof(null==t?void 0:null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:i}=this;if(!i||this.state!==nd.IDLE)return;let r=i[t.level];(!r.details||r.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(r.details))&&(this.state=nd.WAITING_LEVEL)}onLevelLoaded(e,t){var i;let{levels:r}=this,a=t.level,s=t.details,n=s.totalduration;if(!r){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""}, cc [${s.startCC}, ${s.endCC}] duration:${n}`);let o=r[a],l=this.fragCurrent;l&&(this.state===nd.FRAG_LOADING||this.state===nd.FRAG_LOADING_WAITING_RETRY)&&(l.level!==t.level||l.urlId!==o.urlId)&&l.loader&&this.abortCurrentFrag();let d=0;if(s.live||null!=(i=o.details)&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;d=this.alignPlaylists(s,o.details)}if(o.details=s,this.levelLastLoaded=a,this.hls.trigger(r8.LEVEL_UPDATED,{details:s,level:a}),this.state===nd.WAITING_LEVEL){if(this.waitForCdnTuneIn(s))return;this.state=nd.IDLE}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,d),this.tick()}_handleFragmentLoadProgress(e){var t;let{frag:i,part:r,payload:a}=e,{levels:s}=this;if(!s){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let n=s[i.level],o=n.details;if(!o){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}let l=n.videoCodec,d=o.PTSKnown||!o.live,u=null==(t=i.initSegment)?void 0:t.data,h=this._getAudioCodec(n),c=this.transmuxer=this.transmuxer||new n8(this.hls,sc.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=r?r.index:-1,f=-1!==m,p=new s6(i.level,i.sn,i.stats.chunkCount,a.byteLength,m,f),g=this.initPTS[i.cc];c.push(a,u,h,l,i,r,o.totalduration,d,p,g)}onAudioTrackSwitching(e,t){let i=this.altAudio,r=!!t.url;if(!r){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();let e=this.hls;i&&(e.trigger(r8.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(r8.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let i=t.id,r=!!this.hls.audioTracks[i].url;if(r){let e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=r,this.tick()}onBufferCreated(e,t){let i,r;let a=t.tracks,s=!1;for(let e in a){let t=a[e];if("main"===t.id){if(r=e,i=t,"video"===e){let t=a[e];t&&(this.videoBuffer=t.buffer)}}else s=!0}s&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:i,part:r}=t;if(i&&i.type!==sc.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===nd.PARSED&&(this.state=nd.IDLE);return}let a=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}onError(e,t){var i;if(t.fatal){this.state=nd.ERROR;return}switch(t.details){case r6.FRAG_GAP:case r6.FRAG_PARSING_ERROR:case r6.FRAG_DECRYPT_ERROR:case r6.FRAG_LOAD_ERROR:case r6.FRAG_LOAD_TIMEOUT:case r6.KEY_LOAD_ERROR:case r6.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(sc.MAIN,t);break;case r6.LEVEL_LOAD_ERROR:case r6.LEVEL_LOAD_TIMEOUT:case r6.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==nd.WAITING_LEVEL||(null==(i=t.context)?void 0:i.type)!==sh.LEVEL||(this.state=nd.IDLE);break;case r6.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case r6.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){let{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!s9.getBuffered(e).length){let e=this.state!==nd.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=nd.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==al.AUDIO||this.audioOnly&&!this.altAudio){let e=(t===al.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,sc.MAIN)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}let r=s9.getBuffered(e),a=r.length?r.start(0):0,s=a-i;s>0&&(s<this.config.maxBufferHole||s<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${s} to match buffer start`),i+=s,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${t}`),e.currentTime=i}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{let{hls:r}=this;if(!i||this.fragContextChanged(e))return;t.fragmentError=0,this.state=nd.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(r8.FRAG_LOADED,i),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;let i="main",{hls:r}=this,{remuxResult:a,chunkMeta:s}=e,n=this.getCurrentContext(s);if(!n){this.resetWhenMissingContext(s);return}let{frag:o,part:l,level:d}=n,{video:u,text:h,id3:c,initSegment:m}=a,{details:f}=d,p=this.altAudio?void 0:a.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=nd.PARSING,m){if(null!=m&&m.tracks){let e=o.initSegment||o;this._bufferInitSegment(d,m.tracks,e,s),r.trigger(r8.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:m.tracks})}let e=m.initPTS,t=m.timescale;r5(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},r.trigger(r8.INIT_PTS_FOUND,{frag:o,id:i,initPTS:e,timescale:t}))}if(u&&f&&"initSegment"!==o.sn){let e=f.fragments[o.sn-1-f.startSN],t=o.sn===f.startSN,i=!e||o.cc>e.cc;if(!1!==a.independent){let{startPTS:e,endPTS:r,startDTS:a,endDTS:n}=u;if(l)l.elementaryStreams[u.type]={startPTS:e,endPTS:r,startDTS:a,endDTS:n};else if(u.firstKeyFrame&&u.independent&&1===s.id&&!i&&(this.couldBacktrack=!0),u.dropped&&u.independent){let a=this.getMainFwdBufferInfo(),s=(a?a.end:this.getLoadPosition())+this.config.maxBufferHole,l=u.firstKeyFramePTS?u.firstKeyFramePTS:e;if(t||!(s<l-this.config.maxBufferHole)||i)i&&(o.gap=!0);else{this.backtrack(o);return}o.setElementaryStreamInfo(u.type,o.start,r,o.start,n,!0)}o.setElementaryStreamInfo(u.type,e,r,a,n),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(u,o,l,s,t||i)}else if(t||i)o.gap=!0;else{this.backtrack(o);return}}if(p){let{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=p;l&&(l.elementaryStreams[al.AUDIO]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),o.setElementaryStreamInfo(al.AUDIO,e,t,i,r),this.bufferFragmentData(p,o,l,s)}if(f&&null!=c&&null!=(t=c.samples)&&t.length){let e={id:i,frag:o,details:f,samples:c.samples};r.trigger(r8.FRAG_PARSING_METADATA,e)}if(f&&h){let e={id:i,frag:o,details:f,samples:h.samples};r.trigger(r8.FRAG_PARSING_USERDATA,e)}}_bufferInitSegment(e,t,i,r){if(this.state!==nd.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;let{audio:a,video:s,audiovideo:n}=t;if(a){let t=e.audioCodec,i=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==a.metadata.channelCount&&-1===i.indexOf("firefox")&&(t="mp4a.40.5")),-1!==i.indexOf("android")&&"audio/mpeg"!==a.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),a.levelCodec=t,a.id="main",this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${a.codec}]`)}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s.codec}]`)),n&&this.log(`Init audiovideo buffer, container:${n.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${n.codec}]`),this.hls.trigger(r8.BUFFER_CODECS,t),Object.keys(t).forEach(e=>{let a=t[e],s=a.initSegment;null!=s&&s.byteLength&&this.hls.trigger(r8.BUFFER_APPENDING,{type:e,data:s,frag:i,part:null,chunkMeta:r,parent:i.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,sc.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=nd.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){let i=e.currentTime;if(s9.isBuffered(e,i)?t=this.getAppendedFrag(i):s9.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;let e=this.fragPlaying,i=t.level;e&&t.sn===e.sn&&e.level===i&&t.urlId===e.urlId||(this.fragPlaying=t,this.hls.trigger(r8.FRAG_CHANGED,{frag:t}),e&&e.level===i||this.hls.trigger(r8.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){let e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){let e=this.media;if(e){let t=e.currentTime,i=this.currentFrag;if(i&&r5(t)&&r5(i.programDateTime)){let e=i.programDateTime+(t-i.start)*1e3;return new Date(e)}}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class n7{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){let i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class oe{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n7(e),this.fast_=new n7(t),this.defaultTTFB_=r,this.ttfb_=new n7(e)}update(e,t){let{slow_:i,fast_:r,ttfb_:a}=this;i.halfLife!==e&&(this.slow_=new n7(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new n7(t,r.getEstimate(),r.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new n7(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);let i=e/1e3,r=8*t/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){this.ttfb_.sample(Math.sqrt(2)*Math.exp(-Math.pow(e/1e3,2)/2),Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class ot{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let e;let{chunks:t,dataLength:i}=this;return t.length?(e=1===t.length?t[0]:function(e,t){let i=new Uint8Array(t),r=0;for(let t=0;t<e.length;t++){let a=e[t];i.set(a,r),r+=a.length}return i}(t,i),this.reset(),e):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function oi(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!function(e,t){let i=e["STABLE-RENDITION-ID"];return i?i===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(i=>e[i]!==t[i])}(e[i].attrs,t[i].attrs))return!1;return!0}class or{constructor(e){this.buffered=void 0;let t=(t,i,r)=>{if((i>>>=0)>r-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${r})`);return e[i][t]};this.buffered={get length(){return e.length},end:i=>t("end",i,e.length),start:i=>t("start",i,e.length)}}}function oa(e){let t=[];for(let i=0;i<e.length;i++){let r=e[i];("subtitles"===r.kind||"captions"===r.kind)&&r.label&&t.push(e[i])}return t}class os{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){let i=this.queues[t];i.push(e),1===i.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){let i=this.queues[t];i.unshift(e),this.executeNext(t)}appendBlocker(e){let t;let i=new Promise(e=>{t=e}),r={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,e),i}executeNext(e){let{buffers:t,queues:i}=this,r=t[e],a=i[e];if(a.length){let t=a[0];try{t.execute()}catch(i){ai.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),t.onError(i),null!=r&&r.updating||(a.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}let on=a5(),oo=/([ha]vc.)(?:\.[^.,]+)+/,ol={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},od=function(e){let t=e;return ol.hasOwnProperty(e)&&(t=ol[e]),String.fromCharCode(t)},ou={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},oh={17:2,18:4,21:6,22:8,23:10,19:13,20:15},oc={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},om={25:2,26:4,29:6,30:8,31:10,27:13,28:15},of=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class op{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){let i="function"==typeof t?t():t;ai.log(`${this.time} [${e}] ${i}`)}}}let og=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class ov{constructor(e,t,i,r,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=r||"black",this.flash=a||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){let r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class oE{constructor(e,t,i,r,a,s){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new ov(t,i,r,a,s)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class ob{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let e=0;e<100;e++)this.chars.push(new oE);this.logger=e,this.pos=0,this.currPenState=new ov}equals(e){let t=!0;for(let i=0;i<100;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t}copy(e){for(let t=0;t<100;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=100)}moveCursor(e){let t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=od(e);if(this.pos>=100){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<100;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let i=0;i<100;i++){let r=this.chars[i].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);let t=this.chars[this.pos];t.setPenState(this.currPenState)}}class oy{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<15;t++)this.rows.push(new ob(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let i=0;i<15;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<15;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){let e=this.rows[this.currRow];e.backSpace()}clearToEndOfRow(){let e=this.rows[this.currRow];e.clearToEndOfRow()}insertChar(e){let t=this.rows[this.currRow];t.insertChar(e)}setPen(e){let t=this.rows[this.currRow];t.setPenStyles(e)}moveCursor(e){let t=this.rows[this.currRow];t.moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);let t=this.rows[this.currRow];t.setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<15;e++)this.rows[e].clear();let e=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){let r=i.rows[e].cueStartTime,a=this.logger.time;if(r&&null!==a&&r<a)for(let r=0;r<this.nrRollUpRows;r++)this.rows[t-this.nrRollUpRows+r+1].copy(i.rows[e+r])}}this.currRow=t;let i=this.rows[this.currRow];if(null!==e.indent){let t=e.indent;i.setCursor(e.indent),e.color=i.chars[Math.max(t-1,0)].penState.foreground}let r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],i="",r=-1;for(let i=0;i<15;i++){let a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i}getTextAndFormat(){return this.rows}}class oT{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new oy(i),this.nonDisplayedMemory=new oy(i),this.lastOutputScreen=new oy(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};t.underline=e%2==1,t.italics=e>=46,t.italics?t.foreground="white":t.foreground=["white","green","blue","cyan","red","yellow","magenta"][Math.floor(e/2)-16],this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){let t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e)}}class oA{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;let r=new op;this.channels=[null,new oT(e,t,r),new oT(e+1,i,r)],this.cmdHistory=ok(),this.logger=r}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let i,r,a;let s=!1;this.logger.time=e;for(let e=0;e<t.length;e+=2)if(r=127&t[e],a=127&t[e+1],0!==r||0!==a){if(this.logger.log(3,"["+og([t[e],t[e+1]])+"] -> ("+og([r,a])+")"),(i=this.parseCmd(r,a))||(i=this.parseMidrow(r,a)),i||(i=this.parsePAC(r,a)),i||(i=this.parseBackgroundAttributes(r,a)),!i&&(s=this.parseChars(r,a))){let e=this.currentChannel;if(e&&e>0){let t=this.channels[e];t.insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||s||this.logger.log(2,"Couldn't parse cleaned data "+og([r,a])+" orig: "+og([t[e],t[e+1]]))}}parseCmd(e,t){let{cmdHistory:i}=this,r=(20===e||28===e||21===e||29===e)&&t>=32&&t<=47,a=(23===e||31===e)&&t>=33&&t<=35;if(!(r||a))return!1;if(oS(e,t,i))return o_(null,null,i),this.logger.log(3,"Repeated command ("+og([e,t])+") is dropped"),!0;let s=20===e||21===e||23===e?1:2,n=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),o_(e,t,i),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((17===e||25===e)&&t>=32&&t<=47){if((i=17===e?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let r=this.channels[i];return!!r&&(r.ccMIDROW(t),this.logger.log(3,"MIDROW ("+og([e,t])+")"),!0)}return!1}parsePAC(e,t){let i;let r=this.cmdHistory,a=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(16===e||24===e)&&t>=64&&t<=95;if(!(a||s))return!1;if(oS(e,t,r))return o_(null,null,r),!0;let n=e<=23?1:2;i=t>=64&&t<=95?1===n?ou[e]:oc[e]:1===n?oh[e]:om[e];let o=this.channels[n];return!!o&&(o.setPAC(this.interpretPAC(i,t)),o_(e,t,r),this.currentChannel=n,!0)}interpretPAC(e,t){let i;let r={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,r.underline=(1&i)==1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r}parseChars(e,t){let i;let r=null,a=null;if(e>=25?(i=2,a=e-8):(i=1,a=e),a>=17&&a<=19){let e;e=17===a?t+80:18===a?t+112:t+144,this.logger.log(2,"Special char '"+od(e)+"' in channel "+i),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){let i=og(r);this.logger.log(3,"Char codes =  "+i.join(",")),o_(e,t,this.cmdHistory)}return r}parseBackgroundAttributes(e,t){let i;let r=(16===e||24===e)&&t>=32&&t<=47,a=(23===e||31===e)&&t>=45&&t<=47;if(!(r||a))return!1;let s={};16===e||24===e?(i=Math.floor((t-32)/2),s.background=of[i],t%2==1&&(s.background=s.background+"_semi")):45===t?s.background="transparent":(s.foreground="black",47===t&&(s.underline=!0));let n=e<=23?1:2,o=this.channels[n];return o.setBkgData(s),o_(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}this.cmdHistory=ok()}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function o_(e,t,i){i.a=e,i.b=t}function oS(e,t,i){return i.a===e&&i.b===t}function ok(){return{a:null,b:null}}class oL{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var oI=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;let e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t||!Array.isArray(e))return!1;let i=t.toLowerCase();return!!~e.indexOf(i)&&i}function r(e,...t){let i=1;for(;i<arguments.length;i++){let t=arguments[i];for(let i in t)e[i]=t[i]}return e}function a(a,s,n){let o={enumerable:!0};this.hasBeenReset=!1;let l="",d=!1,u=a,h=s,c=n,m=null,f="",p=!0,g="auto",v="start",E=50,b="middle",y=50,T="middle";Object.defineProperty(this,"id",r({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(this,"pauseOnExit",r({},o,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(this,"startTime",r({},o,{get:function(){return u},set:function(e){if("number"!=typeof e)throw TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"endTime",r({},o,{get:function(){return h},set:function(e){if("number"!=typeof e)throw TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"text",r({},o,{get:function(){return c},set:function(e){c=""+e,this.hasBeenReset=!0}})),Object.defineProperty(this,"region",r({},o,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"vertical",r({},o,{get:function(){return f},set:function(t){let r=i(e,t);if(!1===r)throw SyntaxError("An invalid or illegal string was specified.");f=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"snapToLines",r({},o,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(this,"line",r({},o,{get:function(){return g},set:function(e){if("number"!=typeof e&&"auto"!==e)throw SyntaxError("An invalid number or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"lineAlign",r({},o,{get:function(){return v},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");v=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"position",r({},o,{get:function(){return E},set:function(e){if(e<0||e>100)throw Error("Position must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"positionAlign",r({},o,{get:function(){return b},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");b=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"size",r({},o,{get:function(){return y},set:function(e){if(e<0||e>100)throw Error("Size must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"align",r({},o,{get:function(){return T},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");T=r,this.hasBeenReset=!0}})),this.displayState=void 0}return a.prototype.getCueAsHTML=function(){let e=self.WebVTT;return e.convertCueToDOMTree(self,this.text)},a}();class oR{decode(e,t){if(!e)return"";if("string"!=typeof e)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ow(e){function t(e,t,i,r){return(0|e)*3600+(0|t)*60+(0|i)+parseFloat(r||0)}let i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}class oD{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function oC(e,t,i,r){let a=r?e.split(r):[e];for(let e in a){if("string"!=typeof a[e])continue;let r=a[e].split(i);if(2!==r.length)continue;let s=r[0],n=r[1];t(s,n)}}let oM=new oI(0,0,""),ox="middle"===oM.align?"middle":"center";function oO(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class oP{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new oR,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let t=this;function i(){let e=t.buffer,i=0;for(e=oO(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;let r=e.slice(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.slice(i),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=i();let r=e.match(/^()?WEBVTT([ \t].*)?$/);if(!(null!=r&&r[0]))throw Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer&&/\r\n|\n/.test(t.buffer);)switch(a?a=!1:e=i(),t.state){case"HEADER":if(/:/.test(e)){var r;r=e,oC(r,function(e,t){},/:/)}else e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new oI(0,0,""),t.state="CUE",-1===e.indexOf("-->")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{!function(e,t,i){let r=e;function a(){let t=ow(e);if(null===t)throw Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=a(),s(),"-->"!==e.slice(0,3))throw Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);e=e.slice(3),s(),t.endTime=a(),s(),function(e,t){let r=new oD;oC(e,function(e,t){let a;switch(e){case"region":for(let a=i.length-1;a>=0;a--)if(i[a].id===t){r.set(e,i[a].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":a=t.split(","),r.integer(e,a[0]),r.percent(e,a[0])&&r.set("snapToLines",!1),r.alt(e,a[0],["auto"]),2===a.length&&r.alt("lineAlign",a[1],["start",ox,"end"]);break;case"position":a=t.split(","),r.percent(e,a[0]),2===a.length&&r.alt("positionAlign",a[1],["start",ox,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",ox,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");let a=r.get("line","auto");"auto"===a&&-1===oM.line&&(a=-1),t.line=a,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",ox);let s=r.get("position","auto");"auto"===s&&50===oM.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let i=-1!==e.indexOf("-->");if(!e||i&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this}}let oN=/\r\n|\n\r|\n|\r/g,oU=function(e,t,i=0){return e.slice(i,i+t.length)===t},oF=function(e){let t=parseInt(e.slice(-3)),i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!r5(t)||!r5(i)||!r5(r)||!r5(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+(1e3*i+6e4*r+36e5*a)},oB=function(e){let t=5381,i=e.length;for(;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()};function o$(e,t,i){return oB(e.toString())+oB(t.toString())+oB(i)}let oV=function(e,t,i){let r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;null!=(s=a)&&s.new;){var s;e.ccOffset+=r.start-a.start,r.new=!1,a=e[(r=a).prevCC]}e.presentationOffset=i},oH="stpp.ttml.im1t",oG=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,oW=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,oK={left:"start",center:"center",right:"end",start:"start",end:"end"};function oq(e,t,i,r){let a=aq(new Uint8Array(e),["mdat"]);if(0===a.length){r(Error("Could not parse IMSC1 mdat"));return}let s=a.map(e=>aU(e)),n=function(e,t,i=1,r=!1){return n$(e,1,1/i,r)}(t.baseTime,0,t.timescale);try{s.forEach(e=>i(function(e,t){let i=new DOMParser,r=i.parseFromString(e,"text/xml"),a=r.getElementsByTagName("tt")[0];if(!a)throw Error("Invalid ttml");let s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(s).reduce((e,t)=>(e[t]=a.getAttribute(`ttp:${t}`)||s[t],e),{}),o="preserve"!==a.getAttribute("xml:space"),l=oY(oj(a,"styling","style")),d=oY(oj(a,"layout","region")),u=oj(a,"body","[begin]");return[].map.call(u,e=>{let i=function e(t,i){return[].slice.call(t.childNodes).reduce((t,r,a)=>{var s;return"br"===r.nodeName&&a?t+"\n":null!=(s=r.childNodes)&&s.length?e(r,i):i?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}(e,o);if(!i||!e.hasAttribute("begin"))return null;let r=oQ(e.getAttribute("begin"),n),a=oQ(e.getAttribute("dur"),n),s=oQ(e.getAttribute("end"),n);if(null===r)throw oX(e);if(null===s){if(null===a)throw oX(e);s=r+a}let u=new oI(r-t,s-t,i);u.id=o$(u.startTime,u.endTime,u.text);let h=d[e.getAttribute("region")],c=l[e.getAttribute("style")],m=function(e,t,i){let r="http://www.w3.org/ns/ttml#styling",a=null,s=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return s&&i.hasOwnProperty(s)&&(a=i[s]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((i,s)=>{let n=oz(t,r,s)||oz(e,r,s)||oz(a,r,s);return n&&(i[s]=n),i},{})}(h,c,l),{textAlign:f}=m;if(f){let e=oK[f];e&&(u.lineAlign=e),u.align=f}return r4(u,m),u}).filter(e=>null!==e)}(e,n)))}catch(e){r(e)}}function oj(e,t,i){let r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(i)):[]}function oY(e){return e.reduce((e,t)=>{let i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function oz(e,t,i){return e&&e.hasAttributeNS(t,i)?e.getAttributeNS(t,i):null}function oX(e){return Error(`Could not parse ttml timestamp ${e}`)}function oQ(e,t){if(!e)return null;let i=ow(e);return null===i&&(oG.test(e)?i=function(e,t){let i=oG.exec(e),r=(0|i[4])+(0|i[5])/t.subFrameRate;return(0|i[1])*3600+(0|i[2])*60+(0|i[3])+r/t.frameRate}(e,t):oW.test(e)&&(i=function(e,t){let i=oW.exec(e),r=Number(i[1]),a=i[2];switch(a){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),i}function oZ(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class oJ{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:e}=this;e.on(r8.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(r8.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r8.BUFFER_CODECS,this.onBufferCodecs,this),e.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:e}=this;e.off(r8.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(r8.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r8.BUFFER_CODECS,this.onBufferCodecs,this),e.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){let i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){let i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){let i=this.hls;i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){let e=this.hls.levels;if(e.length){let t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){let t=this.hls.levels;if(!t.length)return -1;let i=t.filter((t,i)=>this.isLevelAllowed(t)&&i<=e);return this.clientRect=null,oJ.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}isLevelAllowed(e){let t=this.restrictedLevels;return!t.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,i){if(!(null!=e&&e.length))return -1;let r=(e,t)=>!t||e.width!==t.width||e.height!==t.height,a=e.length-1;for(let s=0;s<e.length;s+=1){let n=e[s];if((n.width>=t||n.height>=i)&&r(n,e[s+1])){a=s;break}}return a}}let o0="[eme]";class o1{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=o1.CDMCleanupPromise?[o1.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=ai.debug.bind(ai,o0),this.log=ai.log.bind(ai,o0),this.warn=ai.warn.bind(ai,o0),this.error=ai.error.bind(ai,o0),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();let e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(r8.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(r8.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(r8.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(r8.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(r8.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(r8.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){let{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===ap.WIDEVINE&&i)return i;throw Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){let{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){let t=this.hls.levels,i=(e,t,i)=>!!e&&i.indexOf(e)===t,r=t.map(e=>e.audioCodec).filter(i),a=t.map(e=>e.videoCodec).filter(i);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((t,i)=>{let s=e=>{let n=e.shift();this.getMediaKeysPromise(n,r,a).then(e=>t({keySystem:n,mediaKeys:e})).catch(t=>{e.length?s(e):t instanceof o2?i(t):i(new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};s(e)})}requestMediaKeySystemAccess(e,t){let{requestMediaKeySystemAccessFunc:i}=this.config;if("function"!=typeof i){let e=`Configured requestMediaKeySystemAccess is not a function ${i}`;return null===aT&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(Error(e))}return i(e,t)}getMediaKeysPromise(e,t,i){let r=function(e,t,i,r){let a;switch(e){case ap.FAIRPLAY:a=["cenc","sinf"];break;case ap.WIDEVINE:case ap.PLAYREADY:a=["cenc"];break;case ap.CLEARKEY:a=["cenc","keyids"];break;default:throw Error(`Unknown key-system: ${e}`)}return function(e,t,i,r){let a={initDataTypes:e,persistentState:r.persistentState||"not-allowed",distinctiveIdentifier:r.distinctiveIdentifier||"not-allowed",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:i.map(e=>({contentType:`video/mp4; codecs="${e}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))};return[a]}(a,t,i,r)}(e,t,i,this.config.drmSystemOptions),a=this.keySystemAccessPromises[e],s=null==a?void 0:a.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(r)}`),s=this.requestMediaKeySystemAccess(e,r);let t=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch(t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)}),s.then(i=>{this.log(`Access for key-system "${i.keySystem}" obtained`);let r=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=i.createMediaKeys().then(t=>(this.log(`Media-keys created for "${e}"`),r.then(i=>i?this.setMediaKeysServerCertificate(t,e,i):t))),t.mediaKeys.catch(t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)}),t.mediaKeys})}return s.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${aF.hexDump(e.keyId||[])}`);let r=i.createSession(),a={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){let t=e.decryptdata;if(t.pssh){let i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t);this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw Error("keyId is null");return aF.hexDump(e.keyId)}updateKeySession(e,t){var i;let r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${aF.hexDump((null==(i=e.decryptdata)?void 0:i.keyId)||[])}
      } (data length: ${t?t.byteLength:t})`),r.update(t)}selectKeySystemFormat(e){let t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,i)=>{let r=ay(this.config),a=e.map(av).filter(e=>!!e&&-1!==r.indexOf(e));return this.getKeySystemSelectionPromise(a).then(({keySystem:e})=>{let r=ab(e);r?t(r):i(Error(`Unable to find format for key-system "${e}"`))}).catch(i)})}loadKey(e){let t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let a=this.keyIdToKeySessionPromise[i];return a||(a=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(t).then(({keySystem:i,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(i,a).then(()=>{this.throwIfDestroyed();let e=this.createMediaKeySessionContext({keySystem:i,mediaKeys:a,decryptdata:t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")})))).catch(e=>this.handleError(e)),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof o2?this.hls.trigger(r8.ERROR,e.data):this.hls.trigger(r8.ERROR,{type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){let t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){let t=av(e.keyFormat),i=t?[t]:ay(this.config);return this.attemptKeySystemAccess(i)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=ay(this.config)),0===e.length)throw new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){let t,i;let{initDataType:r,initData:a}=e;if(this.debug(`"${e.type}" event: init data type: "${r}"`),null===a)return;if("sinf"===r&&this.config.drmSystems[ap.FAIRPLAY]){let e=aV(new Uint8Array(a));try{let r=am(JSON.parse(e).sinf),a=aY(new Uint8Array(r));if(!a)return;t=a.subarray(8,24),i=ap.FAIRPLAY}catch(e){this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{let e=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;let t={version:0,systemId:"",kids:null,data:null},i=new DataView(e),r=i.getUint32(0);if(e.byteLength!==r&&r>44)return null;let a=i.getUint32(4);if(1886614376!==a||(t.version=i.getUint32(8)>>>24,t.version>1))return null;t.systemId=aF.hexDump(new Uint8Array(e,12,16));let s=i.getUint32(28);if(0===t.version){if(r-32<s)return null;t.data=new Uint8Array(e,32,s)}else if(1===t.version){t.kids=[];for(let i=0;i<s;i++)t.kids.push(new Uint8Array(e,32+16*i,16))}return t}(a);if(null===e)return;0===e.version&&e.systemId===aE.WIDEVINE&&e.data&&(t=e.data.subarray(8,24)),i=function(e){if(e===aE.WIDEVINE)return ap.WIDEVINE}(e.systemId)}if(!i||!t)return;let s=aF.hexDump(t),{keyIdToKeySessionPromise:n,mediaKeySessions:o}=this,l=n[s];for(let e=0;e<o.length;e++){let i=o[e],d=i.decryptdata;if(d.pssh||!d.keyId)continue;let u=aF.hexDump(d.keyId);if(s===u||-1!==d.uri.replace(/-/g,"").indexOf(s)){l=n[u],delete n[u],d.pssh=new Uint8Array(a),d.keyId=t,l=n[s]=l.then(()=>this.generateRequestWithPreferredKeySession(i,r,a,"encrypted-event-key-match"));break}}l||(l=n[s]=this.getKeySystemSelectionPromise([i]).then(({keySystem:e,mediaKeys:i})=>{var n;this.throwIfDestroyed();let o=new a0("ISO-23001-7",s,null!=(n=ab(e))?n:"");return o.pssh=new Uint8Array(a),o.keyId=t,this.attemptSetMediaKeys(e,i).then(()=>{this.throwIfDestroyed();let t=this.createMediaKeySessionContext({decryptdata:o,keySystem:e,mediaKeys:i});return this.generateRequestWithPreferredKeySession(t,r,a,"encrypted-event-no-match")})})),l.catch(e=>this.handleError(e))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){let i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);let r=Promise.all(i).then(()=>{if(!this.media)throw Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===i.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,i,r){var a,s,n;let o=null==(a=this.config.drmSystems)?void 0:null==(s=a[e.keySystem])?void 0:s.generateRequest;if(o)try{let r=o.call(this.hls,t,i,e);if(!r)throw Error("Invalid response from configured generateRequest filter");t=r.initDataType,i=e.decryptdata.pssh=r.initData?new Uint8Array(r.initData):null}catch(e){if(this.warn(e.message),null!=(n=this.hls)&&n.config.debug)throw e}if(null===i)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);let l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${l} (init data type: ${t} length: ${i?i.byteLength:null})`);let d=new n4;e.mediaKeysSession.onmessage=t=>{let i=e.mediaKeysSession;if(!i){d.emit("error",Error("invalid state"));return}let{messageType:r,message:a}=t;this.log(`"${r}" message event for session "${i.sessionId}" message size: ${a.byteLength}`),"license-request"===r||"license-renewal"===r?this.renewLicense(e,a).catch(e=>{this.handleError(e),d.emit("error",e)}):"license-release"===r?e.keySystem===ap.FAIRPLAY&&(this.updateKeySession(e,af("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${r}"`)},e.mediaKeysSession.onkeystatuseschange=t=>{let i=e.mediaKeysSession;if(!i){d.emit("error",Error("invalid state"));return}this.onKeyStatusChange(e);let r=e.keyStatus;d.emit("keyStatus",r),"expired"===r&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};let u=new Promise((e,t)=>{d.on("error",t),d.on("keyStatus",i=>{i.startsWith("usable")?e():"output-restricted"===i?t(new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===i?t(new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${i}"`)):"expired"===i?t(Error("key expired while generating request")):this.warn(`unhandled key status change "${i}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)}).catch(e=>{throw new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)}).then(()=>u).catch(t=>{throw d.removeAllListeners(),this.removeSession(e),t}).then(()=>(d.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${aF.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${aF.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){let t=this.config,i=t.loader,r=new i(t),a=this.getServerCertificateUrl(e);return a?(this.log(`Fetching serverCertificate for "${e}"`),new Promise((i,s)=>{let n={responseType:"arraybuffer",url:a},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};r.load(n,l,{onSuccess:(e,t,r,a)=>{i(e.data)},onError:(t,i,r,o)=>{s(new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:r3({url:n.url,data:void 0},t)},`"${e}" certificate request failed (${a}). Status: ${t.code} (${t.text})`))},onTimeout:(t,i,r)=>{s(new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:n.url,data:void 0}},`"${e}" certificate request timed out (${a})`))},onAbort:(e,t,i)=>{s(Error("aborted"))}})})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,a)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${null==i?void 0:i.byteLength}) on "${t}"`),r(e)}).catch(e=>{a(new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(e=>{throw new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}setupLicenseXHR(e,t,i,r){let a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!i.decryptdata)throw Error("Key removed");return a.call(this.hls,e,t,i,r)}).catch(s=>{if(!i.decryptdata)throw s;return e.open("POST",t,!0),a.call(this.hls,e,t,i,r)}).then(i=>{e.readyState||e.open("POST",t,!0);let a=i||r;return{xhr:e,licenseChallenge:a}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){let i=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{let s=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${s}`);let n=new XMLHttpRequest;n.responseType="arraybuffer",n.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(Error("invalid state"));if(4===n.readyState){if(200===n.status){this._requestLicenseFailureCount=0;let t=n.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);let i=this.config.licenseResponseCallback;if(i)try{t=i.call(this.hls,n,s,e)}catch(e){this.error(e)}r(t)}else{let o=i.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||n.status>=400&&n.status<500)a(new o2({type:r9.KEY_SYSTEM_ERROR,details:r6.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:{url:s,data:void 0,code:n.status,text:n.statusText}},`License Request XHR failed (${s}). Status: ${n.status} (${n.statusText})`));else{let i=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${i} attempts left`),this.requestLicense(e,t).then(r,a)}}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=n,this.setupLicenseXHR(n,s,e,t).then(({xhr:e,licenseChallenge:t})=>{e.send(t)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;let i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){let e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},a0.clearKeyUriToKeyIdMap();let i=t.length;o1.CDMCleanupPromise=Promise.all(t.map(e=>this.removeSession(e)).concat(null==e?void 0:e.setMediaKeys(null).catch(t=>{this.log(`Could not clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(t=>{this.log(`Could not close sessions and clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){let e=t.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){let{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;let r=this.mediaKeySessions.indexOf(e);return r>-1&&this.mediaKeySessions.splice(r,1),t.remove().catch(e=>{this.log(`Could not remove session: ${e}`)}).then(()=>t.close()).catch(e=>{this.log(`Could not close session: ${e}`)})}}}o1.CDMCleanupPromise=void 0;class o2 extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=Error(t)),this.data=e,e.err=e.error}}var o3={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",TIMED_TEXT:"tt"};class o4{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:o3.MANIFEST,su:!this.initialized})}catch(e){ai.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{let t=e.frag,i=this.hls.levels[t.level],r=this.getObjectType(t),a={d:1e3*t.duration,ot:r};(r===o3.VIDEO||r===o3.AUDIO||r==o3.MUXED)&&(a.br=i.bitrate/1e3,a.tb=this.getTopBandwidth(r)/1e3,a.bl=this.getBufferLength(r)),this.apply(e,a)}catch(e){ai.warn("Could not generate segment CMCD data.",e)}},this.hls=e;let t=this.config=e.config,{cmcd:i}=t;null!=i&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||o4.uuid(),this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.registerListeners())}registerListeners(){let e=this.hls;e.on(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r8.MEDIA_DETACHED,this.onMediaDetached,this),e.on(r8.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r8.MEDIA_DETACHED,this.onMediaDetached,this),e.off(r8.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=null==(i=t.tracks.audio)?void 0:i.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){r4(t,this.createData());let i=t.ot===o3.INIT||t.ot===o3.VIDEO||t.ot===o3.MUXED;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders){let i=o4.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),r4(e.headers,i)}else{let i=o4.toQuery(t);if(!i)return;e.url=o4.appendQueryToUri(e.url,i)}}getObjectType(e){let{type:t}=e;return"subtitle"===t?o3.TIMED_TEXT:"initSegment"===e.sn?o3.INIT:"audio"===t?o3.AUDIO:"main"===t?this.hls.audioTracks.length?o3.VIDEO:o3.MUXED:void 0}getTopBandwidth(e){let t,i=0,r=this.hls;if(e===o3.AUDIO)t=r.audioTracks;else{let e=r.maxAutoLevel,i=e>-1?e+1:r.levels.length;t=r.levels.slice(0,i)}for(let e of t)e.bitrate>i&&(i=e.bitrate);return i>0?i:NaN}getBufferLength(e){let t=this.hls.media,i=e===o3.AUDIO?this.audioBuffer:this.videoBuffer;if(!i||!t)return NaN;let r=s9.bufferInfo(i,t.currentTime,this.config.maxBufferHole);return 1e3*r.len}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}}}static uuid(){let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){let t=[],i=e=>!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e,r=e=>Math.round(e),a=e=>100*r(e/100),s={br:r,d:r,bl:a,dl:a,mtp:a,nor:e=>encodeURIComponent(e),rtp:a,tb:r},n=Object.keys(e||{}).sort();for(let r of n){let a,n=e[r];if(!i(n)||"v"===r&&1===n||"pr"==r&&1===n)continue;let o=s[r];o&&(n=o(n));let l=typeof n;a="ot"===r||"sf"===r||"st"===r?`${r}=${n}`:"boolean"===l?r:"number"===l?`${r}=${n}`:`${r}=${JSON.stringify(n)}`,t.push(a)}return t.join(",")}static toHeaders(e){let t=Object.keys(e),i={},r=["Object","Request","Session","Status"],a=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(let i of t){let t=null!=s[i]?s[i]:1;a[t][i]=e[i]}for(let e=0;e<a.length;e++){let t=o4.serialize(a[e]);t&&(i[`CMCD-${r[e]}`]=t)}return i}static toQuery(e){return`CMCD=${encodeURIComponent(o4.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;let i=e.includes("?")?"&":"?";return`${e}${i}${t}`}}function o5(e,t,i,r){e&&Object.keys(t).forEach(a=>{let s=e.filter(e=>e.groupId===a).map(e=>{let s=r4({},e);return s.details=void 0,s.attrs=new as(s.attrs),s.url=s.attrs.URI=o8(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),s.groupId=s.attrs["GROUP-ID"]=t[a],s.attrs["PATHWAY-ID"]=r,s});e.push(...s)})}function o8(e,t,i,r){let a;let{HOST:s,PARAMS:n,[i]:o}=r;t&&(a=null==o?void 0:o[t])&&(e=a);let l=new self.URL(e);return s&&!a&&(l.host=s),n&&Object.keys(n).sort().forEach(e=>{e&&l.searchParams.set(e,n[e])}),l.href}let o9=/^age:\s*[\d.]+\s*$/im;class o6{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ao,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e)return;let i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;let a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!this.stats.aborted)return a(i,t.url)}).catch(e=>(i.open("GET",t.url,!0),a(i,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(e=>{this.callbacks.onError({code:i.status,text:e.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);let r=this.context.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:s}=i.loadPolicy;if(r)for(let t in r)e.setRequestHeader(t,r[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&r5(a)?a:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:i}=this;if(!e||!t)return;let r=t.readyState,a=this.config;if(!i.aborted&&r>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let r=t.status,s="text"!==t.responseType;if(r>=200&&r<300&&(s&&t.response||null!==t.responseText)){i.loading.end=Math.max(self.performance.now(),i.loading.first);let a=s?t.response:t.responseText,n="arraybuffer"===t.responseType?a.byteLength:a.length;if(i.loaded=i.total=n,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first),!this.callbacks)return;let o=this.callbacks.onProgress;if(o&&o(i,e,a,t),!this.callbacks)return;let l={url:t.responseURL,data:a,code:r};this.callbacks.onSuccess(l,i,e,t)}else{let s=a.loadPolicy.errorRetry,n=i.retry;s$(s,n,!1,r)?this.retry(s):(ai.error(`${r} while loading ${e.url}`),this.callbacks.onError({code:r,text:t.statusText},e,t,i))}}}loadtimeout(){var e;let t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry,i=this.stats.retry;if(s$(t,i,!0))this.retry(t);else{ai.warn(`timeout while loading ${this.context.url}`);let e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:i}=this;this.retryDelay=sF(e,i.retry),i.retry++,ai.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&o9.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}let o7=/(\d+)-(\d+)\/(\d+)/;class le{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||lt,this.controller=new self.AbortController,this.stats=new ao}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){let e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){let r=this.stats;if(r.loading.start)throw Error("Loader can only be used once.");r.loading.start=self.performance.now();let a=function(e,t){let i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(r4({},e.headers))};return e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),i}(e,this.controller.signal),s=i.onProgress,n="arraybuffer"===e.responseType,o=n?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=l&&r5(l)?l:d,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(r,e,this.response)},t.timeout),self.fetch(this.request).then(a=>{this.response=this.loader=a;let o=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(r,e,this.response)},d-(o-r.loading.start)),!a.ok){let{status:e,statusText:t}=a;throw new li(t||"fetch, bad network response",e,a)}return(r.loading.first=o,r.total=function(e){let t=e.get("Content-Range");if(t){let e=function(e){let t=o7.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(r5(e))return e}let i=e.get("Content-Length");if(i)return parseInt(i)}(a.headers)||r.total,s&&r5(t.highWaterMark))?this.loadProgressively(a,r,e,t.highWaterMark,s):n?a.arrayBuffer():"json"===e.responseType?a.json():a.text()}).then(a=>{let{response:n}=this;self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);let l=a[o];l&&(r.loaded=r.total=l);let d={url:n.url,data:a,code:n.status};s&&!r5(t.highWaterMark)&&s(r,e,a,n),i.onSuccess(d,r,e,n)}).catch(t=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;let a=t&&t.code||0,s=t?t.message:null;i.onError({code:a,text:s},e,t?t.details:null,r)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,a){let s=new ot,n=e.body.getReader(),o=()=>n.read().then(n=>{if(n.done)return s.dataLength&&a(t,i,s.flush(),e),Promise.resolve(new ArrayBuffer(0));let l=n.value,d=l.length;return t.loaded+=d,d<r||s.dataLength?(s.push(l),s.dataLength>=r&&a(t,i,s.flush(),e)):a(t,i,l,e),o()}).catch(()=>Promise.reject());return o()}}function lt(e,t){return new self.Request(e.url,t)}class li extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}let lr=/\s/,la=r3(r3({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:o6,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;let t=e.config;this.bwEstimator=new oe(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(r8.FRAG_LOADING,this.onFragLoading,this),e.on(r8.FRAG_LOADED,this.onFragLoaded,this),e.on(r8.FRAG_BUFFERED,this.onFragBuffered,this),e.on(r8.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(r8.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){let{hls:e}=this;e.off(r8.FRAG_LOADING,this.onFragLoading,this),e.off(r8.FRAG_LOADED,this.onFragLoaded,this),e.off(r8.FRAG_BUFFERED,this.onFragBuffered,this),e.off(r8.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(r8.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var i;let r=t.frag;this.ignoreFragment(r)||(this.fragCurrent=r,this.partCurrent=null!=(i=t.part)?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,i,r){let a=r?this.lastLevelLoadSec:0;return e+i/t+a}onLevelLoaded(e,t){let i=this.hls.config,{total:r,bwEstimate:a}=t.stats;r5(r)&&r5(a)&&(this.lastLevelLoadSec=8*r/a),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){let e;let{fragCurrent:t,partCurrent:i,hls:r}=this,{autoLevelEnabled:a,media:s}=r;if(!t||!s)return;let n=performance.now(),o=i?i.stats:t.stats,l=i?i.duration:t.duration,d=n-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||0===t.level){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a||s.paused||!s.playbackRate||!s.readyState)return;let u=r.mainForwardBufferInfo;if(null===u)return;let h=this.bwEstimator.getEstimateTTFB(),c=Math.abs(s.playbackRate);if(d<=Math.max(h,1e3*(l/(2*c))))return;let m=u.len/c;if(m>=2*l/c)return;let f=o.loading.first?o.loading.first-o.loading.start:-1,p=o.loaded&&f>-1,g=this.bwEstimator.getEstimate(),{levels:v,minAutoLevel:E}=r,b=v[t.level],y=o.total||Math.max(o.loaded,Math.round(l*b.maxBitrate/8)),T=d-f;T<1&&p&&(T=Math.min(d,8*o.loaded/g));let A=p?1e3*o.loaded/T:0,_=A?(y-o.loaded)/A:8*y/g+h/1e3;if(_<=m)return;let S=A?8*A:g,k=Number.POSITIVE_INFINITY;for(e=t.level-1;e>E;e--){let t=v[e].maxBitrate;if((k=this.getTimeToLoadFrag(h/1e3,S,l*t,!v[e].details))<m)break}k>=_||k>10*l||(r.nextLoadLevel=e,p?this.bwEstimator.sample(d-Math.min(h,f),o.loaded):this.bwEstimator.sampleTTFB(d),this.clearTimer(),ai.warn(`[abr] Fragment ${t.sn}${i?" part "+i.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${m.toFixed(3)} s
      Estimated load time for current fragment: ${_.toFixed(3)} s
      Estimated load time for down switch fragment: ${k.toFixed(3)} s
      TTFB estimate: ${f}
      Current BW estimate: ${r5(g)?(g/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${e}`),t.loader&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),r.trigger(r8.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:i,stats:o}))}onFragLoaded(e,{frag:t,part:i}){let r=i?i.stats:t.stats;if(t.type===sc.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){let e=i?i.duration:t.duration,a=this.hls.levels[t.level],s=(a.loaded?a.loaded.bytes:0)+r.loaded,n=(a.loaded?a.loaded.duration:0)+e;a.loaded={bytes:s,duration:n},a.realBitrate=Math.round(8*s/n)}if(t.bitrateTest){let e={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(r8.FRAG_BUFFERED,e),t.bitrateTest=!1}}}onFragBuffered(e,t){let{frag:i,part:r}=t,a=null!=r&&r.stats.loaded?r.stats:i.stats;if(a.aborted||this.ignoreFragment(i))return;let s=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==sc.MAIN||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){let e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;let i=this.getNextABRAutoLevel();if(-1!==e){let t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return -1!==e&&(i=Math.min(e,i)),i}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:i}=this,{maxAutoLevel:r,config:a,minAutoLevel:s,media:n}=i,o=t?t.duration:e?e.duration:0,l=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,u=i.mainForwardBufferInfo,h=(u?u.len:0)/l,c=this.findBestLevel(d,s,r,h,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(c>=0)return c;ai.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let m=o?Math.min(o,a.maxStarvationDelay):a.maxStarvationDelay,f=a.abrBandWidthFactor,p=a.abrBandWidthUpFactor;if(!h){let e=this.bitrateTestDelay;if(e){let t=o?Math.min(o,a.maxLoadingDelay):a.maxLoadingDelay;m=t-e,ai.trace(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),f=p=1}}return Math.max(c=this.findBestLevel(d,s,r,h+m,f,p),0)}findBestLevel(e,t,i,r,a,s){var n;let{fragCurrent:o,partCurrent:l,lastLoadedFragLevel:d}=this,{levels:u}=this.hls,h=u[d],c=!!(null!=h&&null!=(n=h.details)&&n.live),m=null==h?void 0:h.codecSet,f=l?l.duration:o?o.duration:0,p=this.bwEstimator.getEstimateTTFB()/1e3,g=t,v=-1;for(let n=i;n>=t;n--){let t;let i=u[n];if(!i||m&&i.codecSet!==m){i&&(g=Math.min(n,g),v=Math.max(n,v));continue}-1!==v&&ai.trace(`[abr] Skipped level(s) ${g}-${v} with CODECS:"${u[v].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);let o=i.details,E=(l?null==o?void 0:o.partTarget:null==o?void 0:o.averagetargetduration)||f;t=n<=d?a*e:s*e;let b=u[n].maxBitrate,y=this.getTimeToLoadFrag(p,t,b*E,void 0===o);if(ai.trace(`[abr] level:${n} adjustedbw-bitrate:${Math.round(t-b)} avgDuration:${E.toFixed(1)} maxFetchDuration:${r.toFixed(1)} fetchDuration:${y.toFixed(1)}`),t>b&&(0===y||!r5(y)||c&&!this.bitrateTestDelay||y<r))return n}return -1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{let{media:e,mediaSource:t}=this;ai.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(r8.MEDIA_ATTACHED,{media:e})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{ai.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{ai.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{let{media:e,_objectUrl:t}=this;e&&e.src!==t&&ai.error(`Media element src was set while attaching MediaSource (${t} > ${e.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){let{hls:e}=this;e.on(r8.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r8.BUFFER_RESET,this.onBufferReset,this),e.on(r8.BUFFER_APPENDING,this.onBufferAppending,this),e.on(r8.BUFFER_CODECS,this.onBufferCodecs,this),e.on(r8.BUFFER_EOS,this.onBufferEos,this),e.on(r8.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(r8.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(r8.FRAG_PARSED,this.onFragParsed,this),e.on(r8.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){let{hls:e}=this;e.off(r8.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r8.BUFFER_RESET,this.onBufferReset,this),e.off(r8.BUFFER_APPENDING,this.onBufferAppending,this),e.off(r8.BUFFER_CODECS,this.onBufferCodecs,this),e.off(r8.BUFFER_EOS,this.onBufferEos,this),e.off(r8.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(r8.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(r8.FRAG_PARSED,this.onFragParsed,this),e.off(r8.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new os(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let i=2;(!t.audio||t.video)&&t.altAudio||(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,ai.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){let i=this.media=t.media;if(i&&on){let e=this.mediaSource=new on;e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(e),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){let{media:e,mediaSource:t,_objectUrl:i}=this;if(t){if(ai.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){ai.warn(`[buffer-controller]: onMediaDetaching: ${e.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):ai.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(r8.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{let t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(t){ai.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,t)}}),this._initSourceBuffer()}onBufferCodecs(e,t){let i=this.getSourceBufferTypes().length;Object.keys(t).forEach(e=>{if(i){let i=this.tracks[e];if(i&&"function"==typeof i.buffer.changeType){let{id:r,codec:a,levelCodec:s,container:n,metadata:o}=t[e],l=(i.levelCodec||i.codec).replace(oo,"$1"),d=(s||a).replace(oo,"$1");if(l!==d){let t=`${n};codecs=${s||a}`;this.appendChangeType(e,t),ai.log(`[buffer-controller]: switching codec ${l} to ${d}`),this.tracks[e]={buffer:i.buffer,codec:a,container:n,levelCodec:s,metadata:o,id:r}}}}else this.pendingTracks[e]=t[e]}),!i&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(e,t){let{operationQueue:i}=this;i.append({execute:()=>{let r=this.sourceBuffer[e];r&&(ai.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),r.changeType(t)),i.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{ai.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,t)}},e)}onBufferAppending(e,t){let{hls:i,operationQueue:r,tracks:a}=this,{data:s,type:n,frag:o,part:l,chunkMeta:d}=t,u=d.buffering[n],h=self.performance.now();u.start=h;let c=o.stats.buffering,m=l?l.stats.buffering:null;0===c.start&&(c.start=h),m&&0===m.start&&(m.start=h);let f=a.audio,p=!1;"audio"===n&&(null==f?void 0:f.container)==="audio/mpeg"&&(p=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);let g=o.start;r.append({execute:()=>{if(u.executeStart=self.performance.now(),p){let e=this.sourceBuffer[n];if(e){let t=g-e.timestampOffset;Math.abs(t)>=.1&&(ai.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${g} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=g)}}this.appendExecutor(s,n)},onStart:()=>{},onComplete:()=>{let e=self.performance.now();u.executeEnd=u.end=e,0===c.first&&(c.first=e),m&&0===m.first&&(m.first=e);let{sourceBuffer:t}=this,i={};for(let e in t)i[e]=s9.getBuffered(t[e]);this.appendError=0,this.hls.trigger(r8.BUFFER_APPENDED,{type:n,frag:o,part:l,chunkMeta:d,parent:o.type,timeRanges:i})},onError:e=>{ai.error(`[buffer-controller]: Error encountered while trying to append to the ${n} SourceBuffer`,e);let t={type:r9.MEDIA_ERROR,parent:o.type,details:r6.BUFFER_APPEND_ERROR,frag:o,part:l,chunkMeta:d,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=r6.BUFFER_FULL_ERROR:(this.appendError++,t.details=r6.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&(ai.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),t.fatal=!0)),i.trigger(r8.ERROR,t)}},n)}onBufferFlushing(e,t){let{operationQueue:i}=this,r=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(r8.BUFFER_FLUSHED,{type:e})},onError:t=>{ai.warn(`[buffer-controller]: Failed to remove from ${e} SourceBuffer`,t)}});t.type?i.append(r(t.type),t.type):this.getSourceBufferTypes().forEach(e=>{i.append(r(e),e)})}onFragParsed(e,t){let{frag:i,part:r}=t,a=[],s=r?r.elementaryStreams:i.elementaryStreams;s[al.AUDIOVIDEO]?a.push("audiovideo"):(s[al.AUDIO]&&a.push("audio"),s[al.VIDEO]&&a.push("video")),0===a.length&&ai.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(()=>{let e=self.performance.now();i.stats.buffering.end=e,r&&(r.stats.buffering.end=e);let t=r?r.stats:i.stats;this.hls.trigger(r8.FRAG_BUFFERED,{frag:i,part:r,stats:t,id:i.type})},a)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){let i=this.getSourceBufferTypes().reduce((e,i)=>{let r=this.sourceBuffer[i];return!r||t.type&&t.type!==i||(r.ending=!0,r.ended||(r.ended=!0,ai.log(`[buffer-controller]: ${i} sourceBuffer now EOS`))),e&&!!(!r||r.ended)},!0);i&&(ai.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(e=>{let t=this.sourceBuffer[e];t&&(t.ending=!1)});let{mediaSource:e}=this;if(!e||"open"!==e.readyState){e&&ai.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`);return}ai.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){let{hls:e,details:t,media:i,sourceBuffer:r}=this;if(!i||null===t)return;let a=this.getSourceBufferTypes();if(!a.length)return;let s=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(!r5(s)||s<0)return;let n=i.currentTime,o=t.levelTargetDuration,l=Math.max(s,o),d=Math.floor(n/o)*o-l;a.forEach(i=>{let a=r[i];if(a){let r=s9.getBuffered(a);if(r.length>0&&d>r.start(0)){if(e.trigger(r8.BACK_BUFFER_REACHED,{bufferEnd:d}),t.live)e.trigger(r8.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d});else if(a.ended&&r.end(r.length-1)-n<2*o){ai.info(`[buffer-controller]: Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}e.trigger(r8.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:i})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;let{details:e,hls:t,media:i,mediaSource:r}=this,a=e.fragments[0].start+e.totalduration,s=i.duration,n=r5(r.duration)?r.duration:0;e.live&&t.config.liveDurationInfinity?(ai.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(e)):(a>n&&a>s||!r5(s))&&(ai.log(`[buffer-controller]: Updating Media Source duration to ${a.toFixed(3)}`),r.duration=a)}updateSeekableRange(e){let t=this.mediaSource,i=e.fragments,r=i.length;if(r&&e.live&&null!=t&&t.setLiveSeekableRange){let r=Math.max(0,i[0].start),a=Math.max(r,r+e.totalduration);t.setLiveSeekableRange(r,a)}}checkPendingTracks(){let{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:i}=this,r=Object.keys(i).length;if(r&&!e||2===r){this.createSourceBuffers(i),this.pendingTracks={};let e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(r8.BUFFER_CREATED,{tracks:this.tracks}),e.forEach(e=>{t.executeNext(e)});else{let e=Error("could not create source buffer for media codec(s)");this.hls.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){let{sourceBuffer:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(let r in e)if(!t[r]){let a=e[r];if(!a)throw Error(`source buffer exists for track ${r}, however track does not`);let s=a.levelCodec||a.codec,n=`${a.container};codecs=${s}`;ai.log(`[buffer-controller]: creating sourceBuffer(${n})`);try{let e=t[r]=i.addSourceBuffer(n);this.addBufferListener(r,"updatestart",this._onSBUpdateStart),this.addBufferListener(r,"updateend",this._onSBUpdateEnd),this.addBufferListener(r,"error",this._onSBUpdateError),this.tracks[r]={buffer:e,codec:s,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(e){ai.error(`[buffer-controller]: error while trying to add sourceBuffer: ${e.message}`),this.hls.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:n})}}}_onSBUpdateStart(e){let{operationQueue:t}=this,i=t.current(e);i.onStart()}_onSBUpdateEnd(e){let{operationQueue:t}=this,i=t.current(e);i.onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){let i=Error(`${e} SourceBuffer error`);ai.error(`[buffer-controller]: ${i}`,t),this.hls.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.BUFFER_APPENDING_ERROR,error:i,fatal:!1});let r=this.operationQueue.current(e);r&&r.onError(t)}removeExecutor(e,t,i){let{media:r,mediaSource:a,operationQueue:s,sourceBuffer:n}=this,o=n[e];if(!r||!a||!o){ai.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),s.shiftAndExecuteNext(e);return}let l=r5(r.duration)?r.duration:1/0,d=r5(a.duration)?a.duration:1/0,u=Math.max(0,t),h=Math.min(i,l,d);h>u&&!o.ending?(o.ended=!1,ai.log(`[buffer-controller]: Removing [${u},${h}] from the ${e} SourceBuffer`),o.remove(u,h)):s.shiftAndExecuteNext(e)}appendExecutor(e,t){let{operationQueue:i,sourceBuffer:r}=this,a=r[t];if(!a){ai.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),i.shiftAndExecuteNext(t);return}a.ended=!1,a.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){ai.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}let{operationQueue:i}=this,r=t.map(e=>i.appendBlocker(e));Promise.all(r).then(()=>{e(),t.forEach(e=>{let t=this.sourceBuffer[e];null!=t&&t.updating||i.shiftAndExecuteNext(e)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,i){let r=this.sourceBuffer[e];if(!r)return;let a=i.bind(this,e);this.listeners[e].push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){let t=this.sourceBuffer[e];t&&this.listeners[e].forEach(e=>{t.removeEventListener(e.event,e.listener)})}},capLevelController:oJ,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=ai.log.bind(ai,"[info]:"),this.warn=ai.warn.bind(ai,"[warning]:"),this.error=ai.error.bind(ai,"[error]:"),this.registerListeners()}registerListeners(){let e=this.hls;e.on(r8.ERROR,this.onError,this),e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){let e=this.hls;e&&(e.off(r8.ERROR,this.onError,this),e.off(r8.ERROR,this.onErrorOut,this),e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(null==e?void 0:e.type)===sc.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i,r,a,s;if(t.fatal)return;let n=this.hls,o=t.context;switch(t.details){case r6.FRAG_LOAD_ERROR:case r6.FRAG_LOAD_TIMEOUT:case r6.KEY_LOAD_ERROR:case r6.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case r6.FRAG_PARSING_ERROR:if(null!=(i=t.frag)&&i.gap){t.errorAction={action:sW.DoNothing,flags:sK.None};return}case r6.FRAG_GAP:case r6.FRAG_DECRYPT_ERROR:t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=sW.SendAlternateToPenaltyBox;return;case r6.LEVEL_EMPTY_ERROR:case r6.LEVEL_PARSING_ERROR:{let e=t.parent===sc.MAIN?t.level:n.loadLevel;t.details===r6.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(s=a.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case r6.LEVEL_LOAD_ERROR:case r6.LEVEL_LOAD_TIMEOUT:"number"==typeof(null==o?void 0:o.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level));return;case r6.AUDIO_TRACK_LOAD_ERROR:case r6.AUDIO_TRACK_LOAD_TIMEOUT:case r6.SUBTITLE_LOAD_ERROR:case r6.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){let e=n.levels[n.loadLevel];e&&(o.type===sh.AUDIO_TRACK&&o.groupId===e.audioGroupId||o.type===sh.SUBTITLE_TRACK&&o.groupId===e.textGroupId)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=sW.SendAlternateToPenaltyBox,t.errorAction.flags=sK.MoveAllAlternatesMatchingHost)}return;case r6.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{let e=n.levels[n.loadLevel],i=null==e?void 0:e.attrs["HDCP-LEVEL"];i&&(t.errorAction={action:sW.SendAlternateToPenaltyBox,flags:sK.MoveAllAlternatesMatchingHDCP,hdcpLevel:i})}return;case r6.BUFFER_ADD_CODEC_ERROR:case r6.REMUX_ALLOC_ERROR:t.errorAction=this.getLevelSwitchAction(t,null!=(r=t.level)?r:n.loadLevel);return;case r6.INTERNAL_EXCEPTION:case r6.BUFFER_APPENDING_ERROR:case r6.BUFFER_APPEND_ERROR:case r6.BUFFER_FULL_ERROR:case r6.LEVEL_SWITCH_ERROR:case r6.BUFFER_STALLED_ERROR:case r6.BUFFER_SEEK_OVER_HOLE:case r6.BUFFER_NUDGE_ON_STALL:t.errorAction={action:sW.DoNothing,flags:sK.None};return}if(t.type===r9.KEY_SYSTEM_ERROR){let e=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e);return}}getPlaylistRetryOrSwitchAction(e,t){var i;let r=this.hls,a=sU(r.config.playlistLoadPolicy,e),s=this.playlistError++,n=null==(i=e.response)?void 0:i.code,o=s$(a,s,sN(e),n);if(o)return{action:sW.RetryRequest,flags:sK.None,retryConfig:a,retryCount:s};let l=this.getLevelSwitchAction(e,t);return a&&(l.retryConfig=a,l.retryCount=s),l}getFragRetryOrSwitchAction(e){let t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:a,keyLoadPolicy:s}=t.config,n=sU(e.details.startsWith("key")?s:a,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(r){var l;e.details!==r6.FRAG_GAP&&r.fragmentError++;let t=null==(l=e.response)?void 0:l.code,i=s$(n,o,sN(e),t);if(i)return{action:sW.RetryRequest,flags:sK.None,retryConfig:n,retryCount:o}}let d=this.getLevelSwitchAction(e,i);return n&&(d.retryConfig=n,d.retryCount=o),d}getLevelSwitchAction(e,t){let i=this.hls;null==t&&(t=i.loadLevel);let r=this.hls.levels[t];if(r&&(r.loadError++,i.autoLevelEnabled)){var a,s;let t=-1,{levels:n,loadLevel:o,minAutoLevel:l,maxAutoLevel:d}=i,u=null==(a=e.frag)?void 0:a.type,{type:h,groupId:c}=null!=(s=e.context)?s:{};for(let i=n.length;i--;){let a=(i+o)%n.length;if(a!==o&&a>=l&&a<=d&&0===n[a].loadError){let i=n[a];if(e.details===r6.FRAG_GAP&&e.frag){let t=n[a].details;if(t){let i=sH(e.frag,t.fragments,e.frag.start);if(null!=i&&i.gap)continue}}else if(h===sh.AUDIO_TRACK&&c===i.audioGroupId||h===sh.SUBTITLE_TRACK&&c===i.textGroupId)continue;else if(u===sc.AUDIO&&r.audioGroupId===i.audioGroupId||u===sc.SUBTITLE&&r.textGroupId===i.textGroupId)continue;t=a;break}}if(t>-1&&i.loadLevel!==t)return e.levelRetry=!0,this.playlistError=0,{action:sW.SendAlternateToPenaltyBox,flags:sK.None,nextAutoLevel:t}}return{action:sW.SendAlternateToPenaltyBox,flags:sK.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch(null==(i=t.errorAction)?void 0:i.action){case sW.DoNothing:break;case sW.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===r6.FRAG_GAP||(t.fatal=!0)}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){let t=this.hls,i=e.errorAction;if(!i)return;let{flags:r,hdcpLevel:a,nextAutoLevel:s}=i;switch(r){case sK.None:this.switchLevel(e,s);break;case sK.MoveAllAlternatesMatchingHost:i.resolved||(i.resolved=this.redundantFailover(e));break;case sK.MoveAllAlternatesMatchingHDCP:a&&(t.maxHdcpLevel=sL[sL.indexOf(a)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}i.resolved||this.switchLevel(e,s)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){let{hls:t,penalizedRenditions:i}=this,r=e.parent===sc.MAIN?e.level:t.loadLevel,a=t.levels[r],s=a.url.length,n=e.frag?e.frag.urlId:a.urlId;a.urlId===n&&(!e.frag||a.details)&&this.penalizeRendition(a,e);for(let o=1;o<s;o++){let l=(n+o)%s,d=i[l];if(!d||function(e,t,i){if(performance.now()-e.lastErrorPerfMs>3e5)return!0;let r=e.details;if(t.details===r6.FRAG_GAP&&r&&t.frag){let e=t.frag.start,i=sH(null,r.fragments,e);if(i&&!i.gap)return!0}if(i&&e.errors.length<i.errors.length){let i=e.errors[e.errors.length-1];if(r&&i.frag&&t.frag&&Math.abs(i.frag.start-t.frag.start)>3*r.targetduration)return!0}return!1}(d,e,i[n]))return this.warn(`Switching to Redundant Stream ${l+1}/${s}: "${a.url[l]}" after ${e.details}`),this.playlistError=0,t.levels.forEach(e=>{e.urlId=l}),t.nextLoadLevel=r,!0}return!1}penalizeRendition(e,t){let{penalizedRenditions:i}=this,r=i[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};r.lastErrorPerfMs=performance.now(),r.errors.push(t),r.details=e.details,i[e.urlId]=r}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(r8.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(r8.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let i=this.hls.config;if(i.capLevelOnFPSDrop){let e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,i){let r=performance.now();if(t){if(this.lastTime){let e=r-this.lastTime,a=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,n=this.hls;if(n.trigger(r8.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:i}),1e3*a/e>0&&a>n.config.fpsDroppedMonitoringThreshold*s){let e=n.currentLevel;ai.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===n.autoLevelCapping||n.autoLevelCapping>=e)&&(e-=1,n.trigger(r8.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:n.currentLevel}),n.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e){if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:aT,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue(e,t,i,r){let a,s,n,o,l;let d=[],u=self.VTTCue||self.TextTrackCue;for(let c=0;c<r.rows.length;c++)if(a=r.rows[c],n=!0,o=0,l="",!a.isEmpty()){var h;for(let e=0;e<a.chars.length;e++)lr.test(a.chars[e].uchar)&&n?o++:(l+=a.chars[e].uchar,n=!1);a.cueStartTime=t,t===i&&(i+=1e-4),o>=16?o--:o++;let r=oO(l.trim()),m=o$(t,i,r);null!=e&&null!=(h=e.cues)&&h.getCueById(m)||((s=new u(t,i,r)).id=m,s.line=c+1,s.align="left",s.position=10+Math.min(80,10*Math.floor(8*o/32)),d.push(s))}return e&&d.length&&(d.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),d.forEach(t=>sv(e,t))),d}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends nu{constructor(e,t,i){super(e,t,i,"[subtitle-stream-controller]",sc.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){let{hls:e}=this;e.on(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.LEVEL_LOADED,this.onLevelLoaded,this),e.on(r8.ERROR,this.onError,this),e.on(r8.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(r8.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(r8.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(r8.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(r8.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(r8.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.LEVEL_LOADED,this.onLevelLoaded,this),e.off(r8.ERROR,this.onError,this),e.off(r8.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(r8.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(r8.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(r8.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(r8.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(r8.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=nd.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let i;let{frag:r,success:a}=t;if(this.fragPrevious=r,this.state=nd.IDLE,!a)return;let s=this.tracksBuffered[this.currentTrackId];if(!s)return;let n=r.start;for(let e=0;e<s.length;e++)if(n>=s[e].start&&n<=s[e].end){i=s[e];break}let o=r.start+r.duration;i?i.end=o:(i={start:n,end:o},s.push(i)),this.fragmentTracker.fragBuffered(r)}onBufferFlushing(e,t){let{startOffset:i,endOffset:r}=t;if(0===i&&r!==Number.POSITIVE_INFINITY){let e=r-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let i=0;i<t.length;){if(t[i].end<=e){t.shift();continue}if(t[i].start<e)t[i].start=e;else break;i++}}),this.fragmentTracker.removeFragmentsInRange(i,e,sc.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===sc.MAIN){var i;null!=(i=this.media)&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){let i=t.frag;(null==i?void 0:i.type)===sc.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==nd.STOPPED&&(this.state=nd.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(oi(this.levels,t)){this.levels=t.map(e=>new sw(e));return}this.tracksBuffered=[],this.levels=t.map(e=>{let t=new sw(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,sc.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||-1===this.currentTrackId){this.clearInterval();return}let i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var i;let{details:r,id:a}=t,{currentTrackId:s,levels:n}=this;if(!n.length)return;let o=n[s];if(a>=n.length||a!==s||!o)return;this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(r.live||null!=(i=o.details)&&i.live){let e=this.mainDetails;if(r.deltaUpdateFailed||!e)return;let t=e.fragments[0];o.details?0===(l=this.alignPlaylists(r,o.details))&&t&&sx(r,l=t.start):r.hasProgramDateTime&&e.hasProgramDateTime?(nr(r,e),l=r.fragments[0].start):t&&sx(r,l=t.start)}if(o.details=r,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(o.details,l),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===nd.IDLE){let e=sH(null,r.fragments,this.media.currentTime,0);e||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){let{frag:t,payload:i}=e,r=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r&&r.key&&r.iv&&"AES-128"===r.method){let e=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch(e=>{throw a.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(i=>{let r=performance.now();a.trigger(r8.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:e,tdecrypt:r}})}).catch(e=>{this.warn(`${e.name}: ${e.message}`),this.state=nd.IDLE})}}doTick(){if(!this.media){this.state=nd.IDLE;return}if(this.state===nd.IDLE){let{currentTrackId:e,levels:t}=this,i=t[e];if(!t.length||!i||!i.details)return;let{config:r}=this,a=this.getLoadPosition(),s=s9.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),{end:n,len:o}=s,l=this.getFwdBufferInfo(this.media,sc.MAIN),d=i.details,u=this.getMaxBufferLength(null==l?void 0:l.len)+d.levelTargetDuration;if(o>u)return;let h=d.fragments,c=h.length,m=d.edge,f=null,p=this.fragPrevious;if(n<m){let e=r.maxFragLookUpTolerance,t=n>m-e?0:e;(f=sH(p,h,Math.max(h[0].start,n),t))||!p||!(p.start<h[0].start)||(f=h[0])}else f=h[c-1];if(!f)return;if("initSegment"!==(f=this.mapToInitFragWhenRequired(f)).sn){let e=f.sn-d.startSN,t=h[e-1];t&&t.cc===f.cc&&this.fragmentTracker.getState(t)===sX.NOT_LOADED&&(f=t)}this.fragmentTracker.getState(f)===sX.NOT_LOADED&&this.loadFragment(f,i,n)}}getMaxBufferLength(e){let t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,i){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,i))}get mediaBufferTimeRanges(){return new or(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends sq{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){let{hls:e}=this;e.on(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r8.LEVEL_LOADING,this.onLevelLoading,this),e.on(r8.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(r8.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(r8.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r8.LEVEL_LOADING,this.onLevelLoading,this),e.off(r8.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(r8.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(r8.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);let e=oa(this.media.textTracks);e.forEach(e=>{sE(e)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:i,details:r}=t,{trackId:a}=this,s=this.tracksInGroup[a];if(!s){this.warn(`Invalid subtitle track id ${i}`);return}let n=s.details;s.details=t.details,this.log(`subtitle track ${i} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,n)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!(null!=t&&t.textGroupIds))return;let i=t.textGroupIds[t.urlId],r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){let e=this.tracks.filter(e=>!i||e.groupId===i);this.tracksInGroup=e;let t=this.findTrackId(null==r?void 0:r.name)||this.findTrackId();this.groupId=i||null,this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${i}" group-id`),this.hls.trigger(r8.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:e}),-1!==t&&this.setSubtitleTrack(t,r)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId,r)}findTrackId(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let r=t[i];if((!this.selectDefaultTrack||r.default)&&(!e||e===r.name))return r.id}return -1}onError(e,t){!t.fatal&&t.context&&t.context.type===sh.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;let t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();let t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){let i=t.id,r=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(r8.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:e||null})}}toggleTrackModes(e){let{media:t,trackId:i}=this;if(!t)return;let r=oa(t.textTracks),a=r.filter(e=>e.groupId===this.groupId);if(-1===e)[].slice.call(r).forEach(e=>{e.mode="disabled"});else{let e=a[i];e&&(e.mode="disabled")}let s=a[e];s&&(s.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var i;let r=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(-1===e||null!=(i=r[e])&&i.details)||e<-1||e>=r.length)return;this.clearTimer();let a=r[e];if(this.log(`Switching to subtitle-track ${e}`+(a?` "${a.name}" lang:${a.lang} group:${a.groupId}`:"")),this.trackId=e,a){let{id:e,groupId:i="",name:r,type:s,url:n}=a;this.hls.trigger(r8.SUBTITLE_TRACK_SWITCH,{id:e,groupId:i,name:r,type:s,url:n});let o=this.switchParams(a.url,null==t?void 0:t.details);this.loadPlaylist(o)}else this.hls.trigger(r8.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1,t=oa(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},timelineController:class{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=oZ(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){let e=new oL(this,"textTrack1"),t=new oL(this,"textTrack2"),i=new oL(this,"textTrack3"),r=new oL(this,"textTrack4");this.cea608Parser1=new oA(1,e,t),this.cea608Parser2=new oA(3,i,r)}e.on(r8.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(r8.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(r8.FRAG_LOADING,this.onFragLoading,this),e.on(r8.FRAG_LOADED,this.onFragLoaded,this),e.on(r8.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(r8.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(r8.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(r8.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(r8.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){let{hls:e}=this;e.off(r8.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(r8.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(r8.FRAG_LOADING,this.onFragLoading,this),e.off(r8.FRAG_LOADED,this.onFragLoaded,this),e.off(r8.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(r8.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(r8.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(r8.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(r8.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,i,r,a){let s=!1;for(let e=a.length;e--;){var n;let r=a[e],o=(n=r[0],Math.min(r[1],i)-Math.max(n,t));if(o>=0&&(r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],i),s=!0,o/(i-t)>.5))return}if(s||a.push([t,i]),this.config.renderTextTracksNatively){let a=this.captionsTracks[e];this.Cues.newCue(a,t,i,r)}else{let a=this.Cues.newCue(null,t,i,r);this.hls.trigger(r8.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:a}){let{unparsedVttFrags:s}=this;"main"===i&&(this.initPTS[t.cc]={baseTime:r,timescale:a}),s.length&&(this.unparsedVttFrags=[],s.forEach(e=>{this.onFragLoaded(r8.FRAG_LOADED,e)}))}getExistingTrack(e){let{media:t}=this;if(t)for(let i=0;i<t.textTracks.length;i++){let r=t.textTracks[i];if(r[e])return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:i,media:r}=this,{label:a,languageCode:s}=t[e],n=this.getExistingTrack(e);if(n)i[e]=n,sE(i[e]),sg(i[e],r);else{let t=this.createTextTrack("captions",a,s);t&&(t[e]=!0,i[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let i=t.label,r={_id:e,label:i,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(r8.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){let r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){let{captionsTracks:e}=this;Object.keys(e).forEach(t=>{sE(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=oZ(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let e=0;e<t.length;e++)sE(t[e])}onSubtitleTracksUpdated(e,t){let i=t.subtitleTracks||[],r=i.some(e=>e.textCodec===oH);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){let e=oi(this.tracks,i);if(e){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){let e=this.media?this.media.textTracks:null;this.tracks.forEach((t,i)=>{let r;if(e&&i<e.length){let i=null;for(let r=0;r<e.length;r++){var a;if((a=e[r])&&a.label===t.name&&!(a.textTrack1||a.textTrack2)){i=e[r];break}}i&&(r=i)}if(r)sE(r);else{let e=this._captionsOrSubtitlesFromCharacteristics(t);(r=this.createTextTrack(e,t.name,t.lang))&&(r.mode="disabled")}r&&(r.groupId=t.groupId,this.textTracks.push(r))})}else if(this.tracks.length){let e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(r8.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){let t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&i)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{let t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;let i=`textTrack${t[1]}`,r=this.captionsProperties[i];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)})}closedCaptionsForLevel(e){let t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){let{cea608Parser1:i,cea608Parser2:r,lastSn:a,lastPartIndex:s}=this;if(this.enabled&&i&&r&&t.frag.type===sc.MAIN){var n,o;let e=t.frag.sn,l=null!=(n=null==t?void 0:null==(o=t.part)?void 0:o.index)?n:-1;e===a+1||e===a&&l===s+1||(i.reset(),r.reset()),this.lastSn=e,this.lastPartIndex=l}}onFragLoaded(e,t){let{frag:i,payload:r}=t;if(i.type===sc.SUBTITLE){if(r.byteLength){let e=i.decryptdata,a="stats"in t;if(null==e||!e.encrypted||a){let e=this.tracks[i.level],a=this.vttCCs;a[i.cc]||(a[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),e&&e.textCodec===oH?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(r8.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:Error("Empty subtitle payload")})}}_parseIMSC1(e,t){let i=this.hls;oq(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),i.trigger(r8.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{ai.log(`Failed to parse IMSC1: ${t}`),i.trigger(r8.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;let{frag:i,payload:r}=e,{initPTS:a,unparsedVttFrags:s}=this,n=a.length-1;if(!a[i.cc]&&-1===n){s.push(e);return}let o=this.hls,l=null!=(t=i.initSegment)&&t.data?az(i.initSegment.data,new Uint8Array(r)):r;!function(e,t,i,r,a,s,n){let o;let l=new oP,d=aU(new Uint8Array(e)).trim().replace(oN,"\n").split("\n"),u=[],h=t?function(e,t=1){return n$(e,9e4,1/t)}(t.baseTime,t.timescale):0,c="00:00.000",m=0,f=0,p=!0;l.oncue=function(e){let s=i[r],n=i.ccOffset,l=(m-h)/9e4;if(null!=s&&s.new&&(void 0!==f?n=i.ccOffset=s.start:oV(i,r,l)),l){if(!t){o=Error("Missing initPTS for VTT MPEGTS");return}n=l-i.presentationOffset}let d=e.endTime-e.startTime,c=nK((e.startTime+n-f)*9e4,9e4*a)/9e4;e.startTime=Math.max(c,0),e.endTime=Math.max(c+d,0);let p=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(p)),e.id||(e.id=o$(e.startTime,e.endTime,p)),e.endTime>0&&u.push(e)},l.onparsingerror=function(e){o=e},l.onflush=function(){if(o){n(o);return}s(u)},d.forEach(e=>{if(p){if(oU(e,"X-TIMESTAMP-MAP=")){p=!1,e.slice(16).split(",").forEach(e=>{oU(e,"LOCAL:")?c=e.slice(6):oU(e,"MPEGTS:")&&(m=parseInt(e.slice(7)))});try{f=oF(c)/1e3}catch(e){o=e}return}""===e&&(p=!1)}l.parse(e+"\n")}),l.flush()}(l,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,e=>{this._appendCues(e,i.level),o.trigger(r8.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},t=>{let a="Missing initPTS for VTT MPEGTS"===t.message;a?s.push(e):this._fallbackToIMSC1(i,r),ai.log(`Failed to parse VTT cue: ${t}`),a&&n>i.cc||o.trigger(r8.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:t})})}_fallbackToIMSC1(e,t){let i=this.tracks[e.level];i.textCodec||oq(t,this.initPTS[e.cc],()=>{i.textCodec=oH,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){let i=this.hls;if(this.config.renderTextTracksNatively){let i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach(e=>sv(i,e))}else{let r=this.tracks[t];if(!r)return;let a=r.default?"default":"subtitles"+t;i.trigger(r8.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){let{frag:i}=t;i.type===sc.SUBTITLE&&this.onFragLoaded(r8.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){let{cea608Parser1:i,cea608Parser2:r}=this;if(!this.enabled||!(i&&r))return;let{frag:a,samples:s}=t;if(a.type!==sc.MAIN||"NONE"!==this.closedCaptionsForLevel(a))for(let e=0;e<s.length;e++){let t=s[e].bytes;if(t){let a=this.extractCea608Data(t);i.addData(s[e].pts,a[0]),r.addData(s[e].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:a}){let{media:s}=this;if(s&&!(s.currentTime<i)){if(!a||"video"===a){let{captionsTracks:e}=this;Object.keys(e).forEach(r=>sb(e[r],t,i))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==r){let{textTracks:e}=this;Object.keys(e).forEach(i=>sb(e[i],t,r))}}}extractCea608Data(e){let t=[[],[]],i=31&e[0],r=2;for(let a=0;a<i;a++){let i=e[r++],a=127&e[r++],s=127&e[r++];if(0===a&&0===s)continue;let n=(4&i)!=0;if(n){let e=3&i;(0===e||1===e)&&(t[e].push(a),t[e].push(s))}}return t}},audioStreamController:class extends nu{constructor(e,t,i){super(e,t,i,"[audio-stream-controller]",sc.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){let{hls:e}=this;e.on(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.LEVEL_LOADED,this.onLevelLoaded,this),e.on(r8.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(r8.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(r8.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(r8.ERROR,this.onError,this),e.on(r8.BUFFER_RESET,this.onBufferReset,this),e.on(r8.BUFFER_CREATED,this.onBufferCreated,this),e.on(r8.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(r8.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(r8.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(r8.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r8.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.LEVEL_LOADED,this.onLevelLoaded,this),e.off(r8.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(r8.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(r8.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(r8.ERROR,this.onError,this),e.off(r8.BUFFER_RESET,this.onBufferReset,this),e.off(r8.BUFFER_CREATED,this.onBufferCreated,this),e.off(r8.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(r8.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(r8.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:a}){if("main"===i){let e=t.cc;this.initPTS[t.cc]={baseTime:r,timescale:a},this.log(`InitPTS for cc: ${e} found from main: ${r}`),this.videoTrackCC=e,this.state===nd.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=nd.STOPPED;return}let t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=nd.IDLE):(this.loadedmetadata=!1,this.state=nd.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){var e,t;switch(this.state){case nd.IDLE:this.doTickIdle();break;case nd.WAITING_TRACK:{let{levels:t,trackId:i}=this,r=null==t?void 0:null==(e=t[i])?void 0:e.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=nd.WAITING_INIT_PTS}break}case nd.FRAG_LOADING_WAITING_RETRY:{let e=performance.now(),i=this.retryDate;(!i||e>=i||null!=(t=this.media)&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=nd.IDLE);break}case nd.WAITING_INIT_PTS:{let e=this.waitingData;if(e){let{frag:t,part:i,cache:r,complete:a}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=nd.FRAG_LOADING;let e=r.flush(),s={frag:t,part:i,payload:e,networkDetails:null};this._handleFragmentLoadProgress(s),a&&super._handleFragmentLoadComplete(s)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{let e=this.getLoadPosition(),i=s9.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole),r=sG(i.end,this.config.maxFragLookUpTolerance,t);r<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${i.end} is needed`),this.clearWaitingFragment())}}else this.state=nd.IDLE}}this.onTickEnd()}clearWaitingFragment(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=nd.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){let{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){let{hls:e,levels:t,media:i,trackId:r}=this,a=e.config;if(!(null!=t&&t[r])||!i&&(this.startFragRequested||!a.startFragPrefetch))return;let s=t[r],n=s.details;if(!n||n.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(n)){this.state=nd.WAITING_TRACK;return}let o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,al.AUDIO,sc.AUDIO));let l=this.getFwdBufferInfo(o,sc.AUDIO);if(null===l)return;let{bufferedTrack:d,switchingTrack:u}=this;if(!u&&this._streamEnded(l,n)){e.trigger(r8.BUFFER_EOS,{type:"audio"}),this.state=nd.ENDED;return}let h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,sc.MAIN),c=l.len,m=this.getMaxBufferLength(null==h?void 0:h.len);if(c>=m&&!u)return;let f=n.fragments,p=f[0].start,g=l.end;if(u&&i){let e=this.getLoadPosition();d&&u.attrs!==d.attrs&&(g=e),n.PTSKnown&&e<p&&(l.end>p||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}let v=this.getNextFragment(g,n),E=!1;if(v&&this.isLoopLoading(v,g)&&(E=!!v.gap,v=this.getNextFragmentLoopLoading(v,n,l,sc.MAIN,m)),!v){this.bufferFlushed=!0;return}let b=h&&v.start>h.end+n.targetduration;if(b||!(null!=h&&h.len)&&l.len){let e=this.getAppendedFrag(v.start,sc.MAIN);if(null===e||(E||(E=!!e.gap||!!b&&0===h.len),b&&!E||E&&l.nextStart&&l.nextStart<e.end))return}this.loadFragment(v,s,g)}getMaxBufferLength(e){let t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new sw(e))}onAudioTrackSwitching(e,t){let i=!!t.url;this.trackId=t.id;let{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=t,this.state=nd.IDLE):(this.switchingTrack=null,this.bufferedTrack=t,this.state=nd.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(r8.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var i;if(null==this.mainDetails){this.cachedTrackLoadedData=t;return}let{levels:r}=this,{details:a,id:s}=t;if(!r){this.warn(`Audio tracks were reset while loading level ${s}`);return}this.log(`Track ${s} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);let n=r[s],o=0;if(a.live||null!=(i=n.details)&&i.live){this.checkLiveUpdate(a);let e=this.mainDetails;if(a.deltaUpdateFailed||!e)return;!n.details&&a.hasProgramDateTime&&e.hasProgramDateTime?(nr(a,e),o=a.fragments[0].start):o=this.alignPlaylists(a,n.details)}n.details=a,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(n.details,o),this.state!==nd.WAITING_TRACK||this.waitForCdnTuneIn(a)||(this.state=nd.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let{frag:i,part:r,payload:a}=e,{config:s,trackId:n,levels:o}=this;if(!o){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let l=o[n];if(!l){this.warn("Audio track is undefined on fragment load progress");return}let d=l.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}let u=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2",h=this.transmuxer;h||(h=this.transmuxer=new n8(this.hls,sc.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let c=this.initPTS[i.cc],m=null==(t=i.initSegment)?void 0:t.data;if(void 0!==c){let e=r?r.index:-1,t=-1!==e,s=new s6(i.level,i.sn,i.stats.chunkCount,a.byteLength,e,t);h.push(a,m,u,"",i,r,d.totalduration,!1,s,c)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${d.startSN} ,${d.endSN}],track ${n}`);let{cache:e}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new ot,complete:!1};e.push(new Uint8Array(a)),this.waitingVideoCC=this.videoTrackCC,this.state=nd.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){let i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){let{frag:i,part:r}=t;if(i.type!==sc.AUDIO){if(!this.loadedmetadata&&i.type===sc.MAIN){let e=this.videoBuffer||this.media;if(e){let t=s9.getBuffered(e);t.length&&(this.loadedmetadata=!0)}}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if("initSegment"!==i.sn){this.fragPrevious=i;let e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(r8.AUDIO_TRACK_SWITCHED,r3({},e)))}this.fragBufferedComplete(i,r)}onError(e,t){var i;if(t.fatal){this.state=nd.ERROR;return}switch(t.details){case r6.FRAG_GAP:case r6.FRAG_PARSING_ERROR:case r6.FRAG_DECRYPT_ERROR:case r6.FRAG_LOAD_ERROR:case r6.FRAG_LOAD_TIMEOUT:case r6.KEY_LOAD_ERROR:case r6.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(sc.AUDIO,t);break;case r6.AUDIO_TRACK_LOAD_ERROR:case r6.AUDIO_TRACK_LOAD_TIMEOUT:case r6.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==nd.WAITING_TRACK||(null==(i=t.context)?void 0:i.type)!==sh.AUDIO_TRACK||(this.state=nd.IDLE);break;case r6.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case r6.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){t===al.AUDIO&&(this.bufferFlushed=!0,this.state===nd.ENDED&&(this.state=nd.IDLE))}_handleTransmuxComplete(e){var t;let i="audio",{hls:r}=this,{remuxResult:a,chunkMeta:s}=e,n=this.getCurrentContext(s);if(!n){this.resetWhenMissingContext(s);return}let{frag:o,part:l,level:d}=n,{details:u}=d,{audio:h,text:c,id3:m,initSegment:f}=a;if(this.fragContextChanged(o)||!u){this.fragmentTracker.removeFragment(o);return}if(this.state=nd.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=f&&f.tracks){let e=o.initSegment||o;this._bufferInitSegment(f.tracks,e,s),r.trigger(r8.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:f.tracks})}if(h){let{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=h;l&&(l.elementaryStreams[al.AUDIO]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),o.setElementaryStreamInfo(al.AUDIO,e,t,i,r),this.bufferFragmentData(h,o,l,s)}if(null!=m&&null!=(t=m.samples)&&t.length){let e=r4({id:i,frag:o,details:u},m);r.trigger(r8.FRAG_PARSING_METADATA,e)}if(c){let e=r4({id:i,frag:o,details:u},c);r.trigger(r8.FRAG_PARSING_USERDATA,e)}}_bufferInitSegment(e,t,i){if(this.state!==nd.PARSING)return;e.video&&delete e.video;let r=e.audio;if(!r)return;r.levelCodec=r.codec,r.id="audio",this.log(`Init audio buffer, container:${r.container}, codecs[parsed]=[${r.codec}]`),this.hls.trigger(r8.BUFFER_CODECS,e);let a=r.initSegment;if(null!=a&&a.byteLength){let e={type:"audio",frag:t,part:null,chunkMeta:i,parent:t.type,data:a};this.hls.trigger(r8.BUFFER_APPENDING,e)}this.tick()}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||r===sX.NOT_LOADED||r===sX.PARTIAL){var a;"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(a=t.details)&&a.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=nd.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(e,t,i))}else this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){let{hls:t,media:i,bufferedTrack:r}=this,a=null==r?void 0:r.attrs,s=e.attrs;i&&a&&(a.CHANNELS!==s.CHANNELS||a.NAME!==s.NAME||a.LANGUAGE!==s.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(r8.AUDIO_TRACK_SWITCHED,r3({},e))}},audioTrackController:class extends sq{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r8.LEVEL_LOADING,this.onLevelLoading,this),e.on(r8.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(r8.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(r8.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r8.LEVEL_LOADING,this.onLevelLoading,this),e.off(r8.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(r8.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(r8.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:i,groupId:r,details:a}=t,s=this.tracksInGroup[i];if(!s||s.groupId!==r){this.warn(`Track with id:${i} and group:${r} not found in active group ${s.groupId}`);return}let n=s.details;s.details=t.details,this.log(`audio-track ${i} "${s.name}" lang:${s.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,n)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!(null!=t&&t.audioGroupIds))return;let i=t.audioGroupIds[t.urlId];if(this.groupId!==i){this.groupId=i||null;let e=this.tracks.filter(e=>!i||e.groupId===i);this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=e,this.log(`Updating audio tracks, ${e.length} track(s) found in group:${i}`),this.hls.trigger(r8.AUDIO_TRACKS_UPDATED,{audioTracks:e}),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&t.context.type===sh.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();let i=this.currentTrack;t[this.trackId];let r=t[e],{groupId:a,name:s}=r;if(this.log(`Switching to audio-track ${e} "${s}" lang:${r.lang} group:${a}`),this.trackId=e,this.currentTrack=r,this.selectDefaultTrack=!1,this.hls.trigger(r8.AUDIO_TRACK_SWITCHING,r3({},r)),r.details&&!r.details.live)return;let n=this.switchParams(r.url,null==i?void 0:i.details);this.loadPlaylist(n)}selectInitialTrack(){let e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{let t=Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(r8.ERROR,{type:r9.MEDIA_ERROR,details:r6.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}findTrackId(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let r=t[i];if((!this.selectDefaultTrack||r.default)&&(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===r.attrs["STABLE-RENDITION-ID"]||e.name===r.name&&e.lang===r.lang))return r.id}return -1}loadPlaylist(e){super.loadPlaylist();let t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){let i=t.id,r=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`loading audio-track playlist ${i} "${t.name}" lang:${t.lang} group:${r}`),this.clearTimer(),this.hls.trigger(r8.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:e||null})}}},emeController:o1,cmcdController:o4,contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=ai.log.bind(ai,"[content-steering]:"),this.registerListeners()}registerListeners(){let e=this.hls;e.on(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r8.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r8.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;e&&(e.off(r8.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r8.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(r8.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r8.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri){if(this.updated){let e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:i}=t;null!==i&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:i}=t;if((null==i?void 0:i.action)===sW.SendAlternateToPenaltyBox&&i.flags===sK.MoveAllAlternatesMatchingHost){let e=this.pathwayPriority,t=this.pathwayId;this.penalizedPathways[t]||(this.penalizedPathways[t]=performance.now()),!e&&this.levels&&(e=this.levels.reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])),e&&e.length>1&&(this.updatePathwayPriority(e),i.resolved=this.pathwayId!==t)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){let i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this.pathwayPriority=e;let i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(e=>{r-i[e]>3e5&&delete i[e]});for(let r=0;r<e.length;r++){let a=e[r];if(i[a])continue;if(a===this.pathwayId)return;let s=this.hls.nextLoadLevel,n=this.hls.levels[s];if((t=this.getLevelsForPathway(a)).length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,this.hls.trigger(r8.LEVELS_UPDATED,{levels:t});let e=this.hls.levels[s];n&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==n.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==n.bitrate&&this.log(`Unstable Pathways change from bitrate ${n.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=s);break}}}clonePathways(e){let t=this.levels;if(!t)return;let i={},r={};e.forEach(e=>{let{ID:a,"BASE-ID":s,"URI-REPLACEMENT":n}=e;if(t.some(e=>e.pathwayId===a))return;let o=this.getLevelsForPathway(s).map(e=>{let t=r4({},e);t.details=void 0,t.url=o8(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",n);let s=new as(e.attrs);s["PATHWAY-ID"]=a;let o=s.AUDIO&&`${s.AUDIO}_clone_${a}`,l=s.SUBTITLES&&`${s.SUBTITLES}_clone_${a}`;o&&(i[s.AUDIO]=o,s.AUDIO=o),l&&(r[s.SUBTITLES]=l,s.SUBTITLES=l),t.attrs=s;let d=new sw(t);return sY(d,"audio",o),sY(d,"text",l),d});t.push(...o),o5(this.audioTracks,i,n,a),o5(this.subtitleTracks,r,n,a)})}loadSteeringManifest(e){let t;let i=this.hls.config,r=i.loader;this.loader&&this.loader.destroy(),this.loader=new r(i);try{t=new self.URL(e)}catch(t){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if("data:"!==t.protocol){let e=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+e)}let a={responseType:"json",url:t.href},s=i.steeringManifestLoadPolicy.default,n=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0};this.log(`Requesting steering manifest: ${t}`),this.loader.load(a,o,{onSuccess:(e,i,r,a)=>{this.log(`Loaded steering manifest: "${t}"`);let s=e.data;if(1!==s.VERSION){this.log(`Steering VERSION ${s.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=s.TTL;let{"RELOAD-URI":n,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(n)try{this.uri=new self.URL(n,t).href}catch(e){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${n}`);return}this.scheduleRefresh(this.uri||r.url),o&&this.clonePathways(o),l&&this.updatePathwayPriority(l)},onError:(e,t,i,r)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code){this.enabled=!1,this.log(`Steering manifest ${t.url} no longer available`);return}let a=1e3*this.timeToLoad;if(429===e.code){let e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){let t=e.getResponseHeader("Retry-After");t&&(a=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`);return}this.scheduleRefresh(this.uri||t.url,a)},onTimeout:(e,t,i)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}})}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}}});class ls{static get version(){return"1.4.12"}static isSupported(){return function(){let e=a5();if(!e)return!1;let t=nh(),i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!r}()}static get Events(){return r8}static get ErrorTypes(){return r9}static get ErrorDetails(){return r6}static get DefaultConfig(){return ls.defaultConfig?ls.defaultConfig:la}static set DefaultConfig(e){ls.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new n4,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,function(e,t){if(self.console&&!0===e||"object"==typeof e){!function(e,...t){t.forEach(function(t){at[t]=e[t]?e[t].bind(e):function(e){let t=self.console[e];return t?t.bind(self.console,`[${e}] >`):r7}(t)})}(e,"debug","log","info","warn","error");try{at.log(`Debug logs enabled for "${t}" in hls.js version 1.4.12`)}catch(e){at=ae}}else at=ae}(e.debug||!1,"Hls instance");let t=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let i=function e(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(e):Object.keys(t).reduce((i,r)=>(i[r]=e(t[r]),i),{}):t}(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{let a=`${"level"===e?"playlist":e}LoadPolicy`,s=void 0===t[a],n=[];r.forEach(r=>{let o=`${e}Loading${r}`,l=t[o];if(void 0!==l&&s){n.push(o);let e=i[a].default;switch(t[a]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),n.length&&ai.warn(`hls.js config: "${n.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(t[a])}`)}),r3(r3({},i),t)}(ls.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&function(e){let t=e.loader;if(t!==le&&t!==o6)ai.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{let t=function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}();t&&(e.loader=le,e.progressive=!0,e.enableSoftwareAES=!0,ai.log("[config]: Progressive streaming enabled, using FetchLoader"))}}(t);let{abrController:i,bufferController:r,capLevelController:a,errorController:s,fpsController:n}=t,o=new s(this),l=this.abrController=new i(this),d=this.bufferController=new r(this),u=this.capLevelController=new a(this),h=new n(this),c=new sp(this),m=new sS(this),f=t.contentSteeringController,p=f?new f(this):null,g=this.levelController=new sj(this,p),v=new sQ(this),E=new s4(this.config),b=this.streamController=new n6(this,v,E);u.setStreamController(b),h.setStreamController(b);let y=[c,g,b];p&&y.splice(1,0,p),this.networkControllers=y;let T=[l,d,u,h,m,v];this.audioTrackController=this.createController(t.audioTrackController,y);let A=t.audioStreamController;A&&y.push(new A(this,v,E)),this.subtitleTrackController=this.createController(t.subtitleTrackController,y);let _=t.subtitleStreamController;_&&y.push(new _(this,v,E)),this.createController(t.timelineController,T),E.emeController=this.emeController=this.createController(t.emeController,T),this.cmcdController=this.createController(t.cmcdController,T),this.latencyController=this.createController(sk,T),this.coreComponents=T,y.push(o);let S=o.onErrorOut;"function"==typeof S&&this.on(r8.ERROR,S,o)}createController(e,t){if(e){let i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){ai.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(r8.ERROR,{type:r9.OTHER_ERROR,details:r6.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){ai.log("destroy"),this.trigger(r8.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;let e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){ai.log("attachMedia"),this._media=e,this.trigger(r8.MEDIA_ATTACHING,{media:e})}detachMedia(){ai.log("detachMedia"),this.trigger(r8.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();let t=this.media,i=this.url,r=this.url=r1.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});ai.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(r8.MANIFEST_LOADING,{url:e})}startLoad(e=-1){ai.log(`startLoad(${e})`),this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){ai.log("stopLoad"),this.networkControllers.forEach(e=>{e.stopLoad()})}swapAudioCodec(){ai.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){ai.log("recoverMediaError");let e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){let e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){ai.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){ai.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){ai.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){ai.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){ai.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){let t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(ai.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){sL.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return -1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;let i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){let e;let{levels:t,autoLevelCapping:i,maxHdcpLevel:r}=this;if(e=-1===i&&t&&t.length?t.length-1:i,r)for(let i=e;i--;){let e=t[i].attrs["HDCP-LEVEL"];if(e&&e<=r)return i}return e}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){let e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){let e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){let t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){let e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){let e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){let t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){let e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){let t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}ls.defaultConfig=void 0;var ln=class extends Error{constructor(e,t=ln.MEDIA_ERR_CUSTOM,i,r){var a;super(e),this.name="MediaError",this.code=t,this.context=r,this.fatal=null!=i?i:t>=ln.MEDIA_ERR_NETWORK&&t<=ln.MEDIA_ERR_ENCRYPTED,this.message||(this.message=null!=(a=ln.defaultMessages[this.code])?a:"")}};ln.MEDIA_ERR_ABORTED=1,ln.MEDIA_ERR_NETWORK=2,ln.MEDIA_ERR_DECODE=3,ln.MEDIA_ERR_SRC_NOT_SUPPORTED=4,ln.MEDIA_ERR_ENCRYPTED=5,ln.MEDIA_ERR_CUSTOM=100,ln.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var lo=e=>null==e,ll=(e,t)=>!lo(t)&&e in t,ld={ANY:"any",MUTED:"muted"},lu={ON_DEMAND:"on-demand",LIVE:"live",UNKNOWN:"unknown"},lh={MSE:"mse",NATIVE:"native"},lc={HEADER:"header",QUERY:"query",NONE:"none"},lm=Object.values(lc),lf={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},lp={HLS:lf.M3U8};Object.keys(lp),[...Object.values(lf)];var lg=(e,t,i,r,a=e)=>{a.addEventListener(t,i,r),e.addEventListener("teardown",()=>{a.removeEventListener(t,i)},{once:!0})},lv=e=>{let t=e.indexOf("?");return t<0?[e]:[e.slice(0,t),e.slice(t)]},lE=e=>{let t=e.type;if(t){let e=t.toUpperCase();return ll(e,lp)?lp[e]:t}let{src:i}=e;return i?lT(i):""},lb=e=>"VOD"===e?lu.ON_DEMAND:lu.LIVE,ly=e=>"EVENT"===e?Number.POSITIVE_INFINITY:"VOD"===e?Number.NaN:0,lT=e=>{let t="";try{t=new URL(e).pathname}catch{console.error("invalid url")}let i=t.lastIndexOf(".");if(i<0)return"";let r=t.slice(i+1).toUpperCase();return ll(r,lf)?lf[r]:""},lA=Object.values(ld),l_=e=>"boolean"==typeof e||"string"==typeof e&&lA.includes(e),lS=({autoplay:e},t,i)=>{let r=!1,a=!1,s=l_(e)?e:!!e,n=()=>{r||lg(t,"playing",()=>{r=!0},{once:!0})};if(n(),lg(t,"loadstart",()=>{r=!1,n(),lk(t,s)},{once:!0}),lg(t,"loadstart",()=>{i||(a=!Number.isFinite(t.duration)),lk(t,s)},{once:!0}),i&&i.once(ls.Events.LEVEL_LOADED,(e,t)=>{var i;a=null!=(i=t.details.live)&&i}),!s){let e=()=>{!a||(null!=i&&i.liveSyncPosition?t.currentTime=i.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};i&&lg(t,"play",()=>{"metadata"===t.preload?i.once(ls.Events.LEVEL_UPDATED,e):e()},{once:!0})}return e=>{r||lk(t,s=l_(e)?e:!!e)}},lk=(e,t)=>{if(!t)return;let i=e.muted,r=()=>e.muted=i;switch(t){case ld.ANY:e.play().catch(()=>{e.muted=!0,e.play().catch(r)});break;case ld.MUTED:e.muted=!0,e.play().catch(r);break;default:e.play().catch(()=>{})}},lL=({preload:e,src:t},i,r)=>{let a=e=>{null!=e&&["","none","metadata","auto"].includes(e)?i.setAttribute("preload",e):i.removeAttribute("preload")};if(!r)return a(e),a;let s=!1,n=!1,o=r.config.maxBufferLength,l=r.config.maxBufferSize,d=e=>{a(e);let t=null!=e?e:i.preload;n||"none"===t||("metadata"===t?(r.config.maxBufferLength=1,r.config.maxBufferSize=1):(r.config.maxBufferLength=o,r.config.maxBufferSize=l),u())},u=()=>{!s&&t&&(s=!0,r.loadSource(t))};return lg(i,"play",()=>{n=!0,r.config.maxBufferLength=o,r.config.maxBufferSize=l,u()},{once:!0}),d(e),d};function lI(e,t,i,r,a){let s=document.createElement("track");return s.kind=t,s.label=i,r&&(s.srclang=r),a&&(s.id=a),s.track.mode=["subtitles","captions"].includes(t)?"disabled":"hidden",s.setAttribute("data-removeondestroy",""),e.append(s),s.track}var lR="cuepoints",lw=Object.freeze({label:lR}),lD=(e,{label:t=lR}=lw)=>{var i;return null==(i=Array.from(e.querySelectorAll("track")).find(e=>e.track.label===t&&"metadata"===e.track.kind))?void 0:i.track};async function lC(e,t,i=lw){let r=lD(e,i);if(!r){let{label:t=lR}=i;(r=lI(e,"metadata",t)).mode="hidden",await new Promise(e=>setTimeout(()=>e(void 0),0))}return"hidden"!==r.mode&&(r.mode="hidden"),[...t].sort(({time:e},{time:t})=>t-e).forEach(({time:t,value:i})=>{var a,s;let n=Array.prototype.findIndex.call(null==r?void 0:r.cues,e=>e.startTime>=t),o=null==(a=null==r?void 0:r.cues)?void 0:a[n],l=o?o.startTime:Number.isFinite(e.duration)?e.duration:Number.MAX_SAFE_INTEGER,d=null==(s=null==r?void 0:r.cues)?void 0:s[n-1];d&&(d.endTime=t);let u=new VTTCue(t,l,JSON.stringify(null!=i?i:null));r.addCue(u)}),r}var lM=e=>({time:e.startTime,value:JSON.parse(e.text)});function lx(e,t={label:lR}){var i,r;let a=lD(e,t);if(!(null!=(i=null==a?void 0:a.activeCues)&&i.length))return;let{currentTime:s}=e;return lM(Array.prototype.find.call(null!=(r=a.activeCues)?r:[],({startTime:e,endTime:t})=>e<=s&&t>s))}async function lO(e,t=lw){return new Promise(i=>{lg(e,"loadstart",async()=>{let r=await lC(e,[],t);lg(e,"cuechange",()=>{let t=lx(e);if(t){let i=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:t});e.dispatchEvent(i)}},{},r),i(r)})})}var lP,lN,lU,lF,lB,l$,lV,lH,lG,lW,lK,lq,lj,lY,lz,lX,lQ,lZ,lJ,l0,l1,l2,l3,l4,l5,l8,l9,l6,l7,de,dt,di,dr,da,ds,dn,dl,dd,du,dh,dc,dm,df,dp,dg,dv,dE,db,dy,dT,dA,d_,dS,dk,dL,dI,dR,dw,dD,dC,dM,dx,dO,dP,dN,dU,dF,dB,d$,dV,dH,dG,dW,dK,dq,dj,dY,dz,dX,dQ,dZ,dJ,d0,d1,d2,d3,d4,d5,d8,d9,d6,d7,ue,ut,ui,ur,ua,us,un,uo,ul,ud,uu,uh,uc,um,uf,up,ug,uv,uE,ub,uy,uT,uA=async e=>fetch(e).then(e=>e.text()).then(e=>{let t=e.split(`
`).find((e,t,i)=>t&&i[t-1].startsWith("#EXT-X-STREAM-INF"));return fetch(t).then(e=>e.text()).then(e=>e.split(`
`))}),u_=e=>{var t,i,r;let a=null==(i=(null!=(t=e.find(e=>e.startsWith("#EXT-X-PLAYLIST-TYPE")))?t:"").split(":")[1])?void 0:i.trim(),s=lb(a),n=ly(a),o;if(s===lu.LIVE){let t=e.find(e=>e.startsWith("#EXT-X-PART-INF"));if(t)o=2*+t.split(":")[1].split("=")[1];else{let t=e.find(e=>e.startsWith("#EXT-X-TARGETDURATION")),i=null==(r=null==t?void 0:t.split(":"))?void 0:r[1];o=3*+(null!=i?i:6)}}return{streamType:s,targetLiveWindow:n,liveEdgeStartOffset:o}},uS=async(e,t)=>t===lf.MP4?{streamType:lu.ON_DEMAND,targetLiveWindow:Number.NaN,liveEdgeStartOffset:void 0}:t===lf.M3U8?u_(await uA(e)):(console.error(`Media type ${t} is an unrecognized or unsupported type for src ${e}.`),{streamType:void 0,targetLiveWindow:void 0,liveEdgeStartOffset:void 0}),uk=async(e,t,i=lE({src:e}))=>{var r,a,s;let{streamType:n,targetLiveWindow:o,liveEdgeStartOffset:l}=await uS(e,i);(null!=(r=uw.get(t))?r:{}).liveEdgeStartOffset=l,(null!=(a=uw.get(t))?a:{}).targetLiveWindow=o,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),(null!=(s=uw.get(t))?s:{}).streamType=n,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},uL=e=>{var t;let i=e.type,r=lb(i),a=ly(i),s,n=!!(null!=(t=e.partList)&&t.length);return r===lu.LIVE&&(s=n?2*e.partTarget:3*e.targetduration),{streamType:r,targetLiveWindow:a,liveEdgeStartOffset:s,lowLatency:n}},uI=(e,t,i)=>{var r,a,s,n,o,l,d,u;let{streamType:h,targetLiveWindow:c,liveEdgeStartOffset:m,lowLatency:f}=uL(e);if(h===lu.LIVE){f?(i.config.backBufferLength=null!=(r=i.userConfig.backBufferLength)?r:4,i.config.maxFragLookUpTolerance=null!=(a=i.userConfig.maxFragLookUpTolerance)?a:.001,i.config.abrBandWidthUpFactor=null!=(s=i.userConfig.abrBandWidthUpFactor)?s:i.config.abrBandWidthFactor):i.config.backBufferLength=null!=(n=i.userConfig.backBufferLength)?n:8;let e=Object.freeze({get length(){return t.seekable.length},start:e=>t.seekable.start(e),end(e){var r;return e>this.length?t.seekable.end(e):null!=(r=i.liveSyncPosition)?r:t.seekable.end(e)}});(null!=(o=uw.get(t))?o:{}).seekable=e}(null!=(l=uw.get(t))?l:{}).liveEdgeStartOffset=m,(null!=(d=uw.get(t))?d:{}).targetLiveWindow=c,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),(null!=(u=uw.get(t))?u:{}).streamType=h,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},uR=-1!==(null!=(uy=null==(ub=null==globalThis?void 0:globalThis.navigator)?void 0:ub.userAgent)?uy:"").toLowerCase().indexOf("android"),uw=new WeakMap,uD="mux.com",uC=null==(uT=ls.isSupported)?void 0:uT.call(ls),uM=()=>rJ.utils.now(),ux=rJ.utils.generateUUID,uO=(e,{domain:t=uD,maxResolution:i=""}={})=>{if(!e)return;let[r,a=""]=lv(e),s=new URL(`https://stream.${t}/${r}.m3u8${a}`);return i&&s.searchParams.set("max_resolution",i),s.toString()},uP=e=>{if(!e)return;let[t]=e.split("?");return t||void 0},uN=e=>{if(!e||!e.startsWith("https://stream."))return;let[t]=new URL(e).pathname.slice(1).split(".m3u8");return t||void 0},uU=e=>{var t,i,r;return null!=(t=null==e?void 0:e.metadata)&&t.video_id?e.metadata.video_id:uZ(e)&&null!=(r=null!=(i=uP(e.playbackId))?i:uN(e.src))?r:e.src},uF=e=>{var t;return null==(t=uw.get(e))?void 0:t.error},uB=e=>{var t,i;return null!=(i=null==(t=uw.get(e))?void 0:t.streamType)?i:lu.UNKNOWN},u$=e=>{var t,i;return null!=(i=null==(t=uw.get(e))?void 0:t.targetLiveWindow)?i:Number.NaN},uV=e=>{var t,i;return null!=(i=null==(t=uw.get(e))?void 0:t.seekable)?i:e.seekable},uH=e=>{var t;let i=null==(t=uw.get(e))?void 0:t.liveEdgeStartOffset;if("number"!=typeof i)return Number.NaN;let r=uV(e);return r.length?r.end(r.length-1)-i:Number.NaN},uG=(e,t,i=.001)=>Math.abs(e-t)<=i,uW=(e,t,i=.001)=>e>t||uG(e,t,i),uK=e=>e.paused&&uW(e.currentTime,e.duration),uq=(e,t)=>e.loop||t?e.ended:e.ended||uK(e),uj=(e,t,i)=>{uY(t,i);let{metadata:r={}}=e,{view_session_id:a=ux()}=r,s=uU(e);r.view_session_id=a,r.video_id=s,e.metadata=r,uw.set(t,{});let n=uX(e,t);uJ(e,t,n),u0(e,t,n),lO(t);let o=lS(e,t,n),l=lL(e,t,n);return{engine:n,setAutoplay:o,setPreload:l}},uY=(e,t)=>{let i=null==t?void 0:t.engine;i&&(i.detachMedia(),i.destroy()),(null==e?void 0:e.mux)&&!e.mux.deleted&&(e.mux.destroy(),delete e.mux),e&&(e.removeAttribute("src"),e.load(),e.removeEventListener("error",u2),e.removeEventListener("error",u3),e.removeEventListener("durationchange",u1),uw.delete(e),e.dispatchEvent(new Event("teardown")))};function uz(e,t){var i;let r=lE(e);if(r!==lf.M3U8)return!0;let a=!r||null==(i=t.canPlayType(r))||i,{preferPlayback:s}=e,n=s===lh.MSE,o=s===lh.NATIVE;return a&&(o||!(uC&&(n||uR)))}var uX=(e,t)=>{let{debug:i,streamType:r,startTime:a=-1,metadata:s,preferCmcd:n}=e,o=lE(e)===lf.M3U8,l=uz(e,t);if(o&&!l&&uC){let e=uQ(r),t=n!==lc.NONE?{useHeaders:n===lc.HEADER,sessionId:null==s?void 0:s.view_session_id,contentId:null==s?void 0:s.video_id}:void 0;return new ls({debug:i,startPosition:a,cmcd:t,backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelToPlayerSize:!0,capLevelOnFPSDrop:!0,...e})}},uQ=e=>e===lu.LIVE?{backBufferLength:8}:{},uZ=({playbackId:e,src:t,customDomain:i})=>{if(e)return!0;if("string"!=typeof t)return!1;let r=null==window?void 0:window.location.href,a=new URL(t,r).hostname.toLocaleLowerCase();return a.includes(uD)||!!i&&a.includes(i.toLocaleLowerCase())},uJ=(e,t,i)=>{var r;let{envKey:a}=e,s=uZ(e);if(a||s){let{playerInitTime:s,playerSoftwareName:n,playerSoftwareVersion:o,beaconCollectionDomain:l,debug:d,disableCookies:u}=e,h={...e.metadata,video_title:(null==(r=null==e?void 0:e.metadata)?void 0:r.video_title)||void 0};rJ.monitor(t,{debug:d,beaconCollectionDomain:l,hlsjs:i,Hls:i?ls:void 0,automaticErrorTracking:!1,errorTranslator:t=>"string"!=typeof t.player_error_code&&("function"==typeof e.errorTranslator?e.errorTranslator(t):t),disableCookies:u,data:{...a?{env_key:a}:{},player_software_name:n,player_software:n,player_software_version:o,player_init_time:s,...h}})}},u0=(e,t,i)=>{var r;let a=uz(e,t),{src:s}=e;if(t&&a){let i=lE(e);"string"==typeof s?("none"===t.preload?lg(t,"loadstart",()=>uk(s,t,i)):uk(s,t,i),t.setAttribute("src",s),e.startTime&&((null!=(r=uw.get(t))?r:{}).startTime=e.startTime,t.addEventListener("durationchange",u1,{once:!0}))):t.removeAttribute("src"),t.addEventListener("error",u2),t.addEventListener("error",u3),t.addEventListener("emptied",()=>{t.querySelectorAll("track[data-removeondestroy]").forEach(e=>{e.remove()})},{once:!0});let a=()=>{t.ended||!uq(t)||t.dispatchEvent(new Event("ended"))};lg(t,"pause",a),lg(t,"seeked",a),lg(t,"play",()=>{t.ended||!uW(t.currentTime,t.duration)||(t.currentTime=t.seekable.start(0))})}else i&&s?(i.once(ls.Events.LEVEL_LOADED,(e,r)=>{uI(r.details,t,i)}),i.on(ls.Events.ERROR,(e,i)=>{let r={[ls.ErrorTypes.NETWORK_ERROR]:ln.MEDIA_ERR_NETWORK,[ls.ErrorTypes.MEDIA_ERROR]:ln.MEDIA_ERR_DECODE},a=new ln("",r[i.type]);a.fatal=i.fatal,a.data=i,t.dispatchEvent(new CustomEvent("error",{detail:a}))}),t.addEventListener("error",u3),function(e,t){var i;if(!("videoTracks"in e))return;let r=new WeakMap;t.on(ls.Events.MANIFEST_PARSED,function(t,i){o();let a=e.addVideoTrack("main");for(let[e,t]of(a.selected=!0,i.levels.entries())){let i=a.addRendition(t.url[0],t.width,t.height,t.videoCodec,t.bitrate);r.set(t,`${e}`),i.id=`${e}`}}),t.on(ls.Events.AUDIO_TRACKS_UPDATED,function(t,i){for(let t of(n(),i.audioTracks)){let i=t.default?"main":"alternative",r=e.addAudioTrack(i,t.name,t.lang);r.id=`${t.id}`,t.default&&(r.enabled=!0)}}),e.audioTracks.addEventListener("change",()=>{var i;let r=+(null==(i=[...e.audioTracks].find(e=>e.enabled))?void 0:i.id),a=t.audioTracks.map(e=>e.id);r!=t.audioTrack&&a.includes(r)&&(t.audioTrack=r)}),t.on(ls.Events.LEVELS_UPDATED,function(t,i){var a;let s=e.videoTracks[null!=(a=e.videoTracks.selectedIndex)?a:0];if(!s)return;let n=i.levels.map(e=>r.get(e));for(let t of e.videoRenditions)t.id&&!n.includes(t.id)&&s.removeRendition(t)});let a=i=>{let r=e.currentTime,a=!1,s=(e,t)=>{a||(a=!Number.isFinite(t.endOffset))};t.on(ls.Events.BUFFER_FLUSHING,s),t.nextLevel=i,t.off(ls.Events.BUFFER_FLUSHING,s),a||t.trigger(ls.Events.BUFFER_FLUSHING,{startOffset:r+10,endOffset:1/0,type:"video"})};null==(i=e.videoRenditions)||i.addEventListener("change",e=>{let i=e.target.selectedIndex;i!=t.nextLevel&&a(i)});let s=()=>{for(let t of e.videoTracks)e.removeVideoTrack(t)},n=()=>{for(let t of e.audioTracks)e.removeAudioTrack(t)},o=()=>{s(),n()};t.once(ls.Events.DESTROYING,o)}(e,i),function(e,t){t.on(ls.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(i,{tracks:r})=>{r.forEach(i=>{var r;let a=null!=(r=i.subtitleTrack)?r:i.closedCaptions,s=t.subtitleTracks.findIndex(({lang:e,name:t,type:r})=>e==(null==a?void 0:a.lang)&&t===i.label&&r.toLowerCase()===i.kind);lI(e,i.kind,i.label,null==a?void 0:a.lang,`${i.kind}${s}`)})});let i=()=>{var i;if(!t.subtitleTracks.length)return;let r=Array.from(e.textTracks).find(e=>e.id&&"showing"===e.mode&&["subtitles","captions"].includes(e.kind)),a=`${null==(i=t.subtitleTracks[t.subtitleTrack])?void 0:i.type.toLowerCase()}${t.subtitleTrack}`;if(r&&(t.subtitleTrack<0||(null==r?void 0:r.id)!==a)){let e=t.subtitleTracks.findIndex(({lang:e,name:t,type:i})=>e==r.language&&t===r.label&&i.toLowerCase()===r.kind);t.subtitleTrack=e}r&&(null==r?void 0:r.id)===a&&r.cues&&Array.from(r.cues).forEach(e=>{r.addCue(e)})};e.textTracks.addEventListener("change",i),t.on(ls.Events.CUES_PARSED,(t,{track:i,cues:r})=>{let a=e.textTracks.getTrackById(i);if(!a)return;let s="disabled"===a.mode;s&&(a.mode="hidden"),r.forEach(e=>{var t;null!=(t=a.cues)&&t.getCueById(e.id)||a.addCue(e)}),s&&(a.mode="disabled")}),t.once(ls.Events.DESTROYING,()=>{e.textTracks.removeEventListener("change",i),e.querySelectorAll("track[data-removeondestroy]").forEach(e=>{e.remove()})});let r=()=>{Array.from(e.textTracks).forEach(t=>{var i,r;if(!["subtitles","caption"].includes(t.kind)&&"thumbnails"===t.label){if(!(null!=(i=t.cues)&&i.length)){let t=e.querySelector('track[label="thumbnails"]'),i=null!=(r=null==t?void 0:t.getAttribute("src"))?r:"";null==t||t.removeAttribute("src"),setTimeout(()=>{null==t||t.setAttribute("src",i)},0)}"hidden"!==t.mode&&(t.mode="hidden")}})};t.once(ls.Events.MANIFEST_LOADED,r),t.once(ls.Events.MEDIA_ATTACHED,r)}(t,i),i.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function u1(e){var t;let i=e.target,r=null==(t=uw.get(i))?void 0:t.startTime;if(r&&function(e,t,i){t&&i>t&&(i=t);for(let t=0;t<e.length;t++)if(e.start(t)<=i&&e.end(t)>=i)return!0;return!1}(i.seekable,i.duration,r)){let e="auto"===i.preload;e&&(i.preload="none"),i.currentTime=r,e&&(i.preload="auto")}}async function u2(e){if(!e.isTrusted)return;e.stopImmediatePropagation();let t=e.target;if(!(null!=t&&t.error))return;let{message:i,code:r}=t.error,a=new ln(i,r);if(t.src&&(r!==ln.MEDIA_ERR_DECODE||void 0!==r))try{let{status:e}=await fetch(t.src);a.data={response:{code:e}}}catch{}t.dispatchEvent(new CustomEvent("error",{detail:a}))}function u3(e){var t,i;if(!(e instanceof CustomEvent)||!(e.detail instanceof ln))return;let r=e.target,a=e.detail;a&&a.fatal&&((null!=(t=uw.get(r))?t:{}).error=a,null==(i=r.mux)||i.emit("error",{player_error_code:a.code,player_error_message:a.message,player_error_context:a.context}))}var u4=Object.defineProperty,u5=(e,t,i)=>t in e?u4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,u8=(e,t,i)=>(u5(e,"symbol"!=typeof t?t+"":t,i),i),u9=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},u6=(e,t,i)=>(u9(e,t,"read from private field"),i?i.call(e):t.get(e)),u7=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},he=(e,t,i,r)=>(u9(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),ht=(e,t,i)=>(u9(e,t,"access private method"),i),hi=class{addEventListener(){}removeEventListener(){}dispatchEvent(e){return!0}};"undefined"==typeof DocumentFragment&&(globalThis.DocumentFragment=class extends hi{});var hr,ha=class extends hi{},hs=class{constructor(e,t={}){u7(this,hr,void 0),he(this,hr,null==t?void 0:t.detail)}get detail(){return u6(this,hr)}initCustomEvent(){}};hr=new WeakMap;var hn={document:{createElement:function(e,t){return new ha}},DocumentFragment,customElements:{get(e){},define(e,t,i){},upgrade(e){},whenDefined:e=>Promise.resolve(ha)},CustomEvent:hs,EventTarget:hi,HTMLElement:ha,HTMLVideoElement:class extends hi{}},ho="undefined"==typeof window||void 0===globalThis.customElements,hl=ho?hn:globalThis;ho?hn.document:globalThis.document;var hd=(()=>{try{return"0.16.5"}catch{}return"UNKNOWN"})(),hu=e=>{var t,i,r,a,s,n,o,l,d,u,h,c,m,f,p,g,v,E,b,y,T,A,_,S,k,L,I,R,w,D,C,M,x,O,P,N,U,F,B,$;return t=class extends e{constructor(){super(),u7(this,I),u7(this,w),u7(this,C),u7(this,x),u7(this,P),u7(this,U),u7(this,B),u8(this,"castEnabled",!1),u7(this,T,{paused:!1}),u7(this,A,void 0),u7(this,_,{}),u7(this,S,void 0),u7(this,k,void 0),u7(this,L,void 0),t.instances.add(this),ht(this,P,N).call(this)}static get castElement(){return u6(t,i)}static get castEnabled(){return u6(t,r)}static get castState(){var e;return null==(e=u6(t,d,u))?void 0:e.getCastState()}static async exitCast(){try{await u6(t,d,u).endCurrentSession(!0)}catch(e){console.error(e);return}}get castPlayer(){if(t.castElement===this)return u6(this,A)}attributeChangedCallback(e){if(this.castPlayer)switch(e){case"cast-stream-type":case"cast-src":this.load()}}async requestCast(e={}){ht(t,b,y).call(t,e),he(t,i,this),Object.entries(u6(this,_)).forEach(([e,t])=>{u6(this,A).controller.addEventListener(e,t)});try{await u6(t,d,u).requestSession()}catch{he(t,i,void 0);return}u6(this,T).paused=super.paused,super.pause(),this.muted=super.muted;try{await this.load()}catch(e){console.error(e)}}async load(){var e,i;if(!this.castPlayer)return super.load();let r=new chrome.cast.media.MediaInfo(this.castSrc,this.castContentType),a=[...this.querySelectorAll("track")].filter(({kind:e,src:t})=>t&&("subtitles"===e||"captions"===e)),s=[],n=0;a.length&&(r.tracks=a.map(e=>{let t=++n;0===s.length&&"showing"===e.track.mode&&s.push(t);let i=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);return i.trackContentId=e.src,i.trackContentType="text/vtt",i.subtype="captions"===e.kind?chrome.cast.media.TextTrackType.CAPTIONS:chrome.cast.media.TextTrackType.SUBTITLES,i.name=e.label,i.language=e.srclang,i})),"live"===this.castStreamType?r.streamType=chrome.cast.media.StreamType.LIVE:r.streamType=chrome.cast.media.StreamType.BUFFERED,r.metadata=new chrome.cast.media.GenericMediaMetadata,r.metadata.title=this.title,r.metadata.images=[{url:this.poster}];let o=new chrome.cast.media.LoadRequest(r);o.currentTime=null!=(e=super.currentTime)?e:0,o.autoplay=!u6(this,T).paused,o.activeTrackIds=s,await (null==(i=u6(t,h,c))?void 0:i.loadMedia(o)),this.dispatchEvent(new Event("volumechange"))}play(){var e;if(this.castPlayer){this.castPlayer.isPaused&&(null==(e=this.castPlayer.controller)||e.playOrPause());return}return super.play()}pause(){var e;if(this.castPlayer){this.castPlayer.isPaused||null==(e=this.castPlayer.controller)||e.playOrPause();return}super.pause()}get castSrc(){var e,t,i;return null!=(i=null!=(t=this.getAttribute("cast-src"))?t:null==(e=this.querySelector("source"))?void 0:e.src)?i:this.currentSrc}set castSrc(e){this.castSrc!=e&&this.setAttribute("cast-src",`${e}`)}get castContentType(){var e;return null!=(e=this.getAttribute("cast-content-type"))?e:void 0}set castContentType(e){this.setAttribute("cast-content-type",`${e}`)}get castStreamType(){var e,t;return null!=(t=null!=(e=this.getAttribute("cast-stream-type"))?e:this.streamType)?t:void 0}set castStreamType(e){this.setAttribute("cast-stream-type",`${e}`)}get readyState(){if(this.castPlayer)switch(this.castPlayer.playerState){case chrome.cast.media.PlayerState.IDLE:return 0;case chrome.cast.media.PlayerState.BUFFERING:return 2;default:return 3}return super.readyState}get paused(){return this.castPlayer?this.castPlayer.isPaused:super.paused}get muted(){var e;return this.castPlayer?null==(e=this.castPlayer)?void 0:e.isMuted:super.muted}set muted(e){var t;if(this.castPlayer){(e&&!this.castPlayer.isMuted||!e&&this.castPlayer.isMuted)&&(null==(t=this.castPlayer.controller)||t.muteOrUnmute());return}super.muted=e}get volume(){var e,t;return this.castPlayer?null!=(t=null==(e=this.castPlayer)?void 0:e.volumeLevel)?t:1:super.volume}set volume(e){var t;if(this.castPlayer){this.castPlayer.volumeLevel=e,null==(t=this.castPlayer.controller)||t.setVolumeLevel();return}super.volume=e}get duration(){var e,t;return this.castPlayer&&u6(this,I,R)?null!=(t=null==(e=this.castPlayer)?void 0:e.duration)?t:NaN:super.duration}get currentTime(){var e,t;return this.castPlayer&&u6(this,I,R)?null!=(t=null==(e=this.castPlayer)?void 0:e.currentTime)?t:0:super.currentTime}set currentTime(e){var t;if(this.castPlayer){this.castPlayer.currentTime=e,null==(t=this.castPlayer.controller)||t.seek();return}super.currentTime=e}get onentercast(){return u6(this,S)}set onentercast(e){u6(this,S)&&(this.removeEventListener("entercast",u6(this,S)),he(this,S,null)),"function"==typeof e&&(he(this,S,e),this.addEventListener("entercast",e))}get onleavecast(){return u6(this,k)}set onleavecast(e){u6(this,k)&&(this.removeEventListener("leavecast",u6(this,k)),he(this,k,null)),"function"==typeof e&&(he(this,k,e),this.addEventListener("leavecast",e))}get oncastchange(){return u6(this,L)}set oncastchange(e){u6(this,L)&&(this.removeEventListener("castchange",u6(this,L)),he(this,L,null)),"function"==typeof e&&(he(this,L,e),this.addEventListener("castchange",e))}},i=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakSet,n=function(){return"undefined"!=typeof chrome&&chrome.cast&&chrome.cast.isAvailable},o=new WeakSet,l=function(){return"undefined"!=typeof cast&&cast.framework},d=new WeakSet,u=function(){if(u6(t,o,l))return cast.framework.CastContext.getInstance()},h=new WeakSet,c=function(){var e;return null==(e=u6(t,d,u))?void 0:e.getCurrentSession()},m=new WeakSet,f=function(){var e;return null==(e=u6(t,h,c))?void 0:e.getSessionObj().media[0]},p=new WeakSet,g=function(e){return new Promise((i,r)=>{u6(t,m,f).editTracksInfo(e,i,r)})},v=new WeakSet,E=function(e){return new Promise((i,r)=>{u6(t,m,f).getStatus(e,i,r)})},b=new WeakSet,y=function(e){return u6(t,d,u).setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,androidReceiverCompatible:!1,language:"en-US",resumeSavedSession:!0,...e})},T=new WeakMap,A=new WeakMap,_=new WeakMap,S=new WeakMap,k=new WeakMap,L=new WeakMap,I=new WeakSet,R=function(){var e;return null==(e=this.castPlayer)?void 0:e.isMediaLoaded},w=new WeakSet,D=function(){u6(t,i)===this&&(Object.entries(u6(this,_)).forEach(([e,t])=>{u6(this,A).controller.removeEventListener(e,t)}),he(t,i,void 0),this.muted=u6(this,A).isMuted,this.currentTime=u6(this,A).savedPlayerState.currentTime,!1===u6(this,A).savedPlayerState.isPaused&&this.play())},C=new WeakSet,M=function(){this.dispatchEvent(new CustomEvent("castchange",{detail:u6(t,d,u).getCastState()}))},x=new WeakSet,O=async function(){var e;let{SESSION_RESUMED:r}=cast.framework.SessionState;if(u6(t,d,u).getSessionState()===r&&this.castSrc===(null==(e=u6(t,m,f))?void 0:e.media.contentId)){he(t,i,this),Object.entries(u6(this,_)).forEach(([e,t])=>{u6(this,A).controller.addEventListener(e,t)});try{await ht(t,v,E).call(t,new chrome.cast.media.GetStatusRequest)}catch(e){console.error(e)}u6(this,_)[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED](),u6(this,_)[cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED]()}},P=new WeakSet,N=function(){!u6(t,o,l)||this.castEnabled||(this.castEnabled=!0,ht(t,b,y).call(t),this.textTracks.addEventListener("change",ht(this,B,$).bind(this)),ht(this,C,M).call(this),he(this,A,new cast.framework.RemotePlayer),new cast.framework.RemotePlayerController(u6(this,A)),he(this,_,{[cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED]:({value:e})=>{!1===e&&ht(this,w,D).call(this),this.dispatchEvent(new Event(e?"entercast":"leavecast"))},[cast.framework.RemotePlayerEventType.DURATION_CHANGED]:()=>{this.dispatchEvent(new Event("durationchange"))},[cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED]:()=>{this.dispatchEvent(new Event("volumechange"))},[cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED]:()=>{this.dispatchEvent(new Event("volumechange"))},[cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED]:()=>{u6(this,I,R)&&this.dispatchEvent(new Event("timeupdate"))},[cast.framework.RemotePlayerEventType.VIDEO_INFO_CHANGED]:()=>{this.dispatchEvent(new Event("resize"))},[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED]:()=>{this.dispatchEvent(new Event(this.paused?"pause":"play"))},[cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED]:()=>{var e,t;(null==(e=this.castPlayer)?void 0:e.playerState)!==chrome.cast.media.PlayerState.PAUSED&&this.dispatchEvent(new Event({[chrome.cast.media.PlayerState.PLAYING]:"playing",[chrome.cast.media.PlayerState.BUFFERING]:"waiting",[chrome.cast.media.PlayerState.IDLE]:"emptied"}[null==(t=this.castPlayer)?void 0:t.playerState]))},[cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED]:async()=>{u6(this,I,R)&&(await Promise.resolve(),ht(this,U,F).call(this))}}))},U=new WeakSet,F=function(){ht(this,B,$).call(this)},B=new WeakSet,$=async function(){var e,i,r,a,s,n;if(!this.castPlayer)return;let o=(null!=(i=null==(e=u6(this,A).mediaInfo)?void 0:e.tracks)?i:[]).filter(({type:e})=>e===chrome.cast.media.TrackType.TEXT),l=[...this.textTracks].filter(({kind:e})=>"subtitles"===e||"captions"===e),d=o.map(({language:e,name:t,trackId:i})=>{var r;let{mode:a}=null!=(r=l.find(i=>i.language===e&&i.label===t))?r:{};return!!a&&{mode:a,trackId:i}}).filter(Boolean),u=d.filter(({mode:e})=>"showing"!==e).map(({trackId:e})=>e),m=d.find(({mode:e})=>"showing"===e),f=null!=(s=null==(a=null==(r=u6(t,h,c))?void 0:r.getSessionObj().media[0])?void 0:a.activeTrackIds)?s:[],v=f;if(f.length&&(v=v.filter(e=>!u.includes(e))),null!=m&&m.trackId&&(v=[...v,m.trackId]),n=v=[...new Set(v)],!(f.length===n.length&&f.every(e=>n.includes(e))))try{let e=new chrome.cast.media.EditTracksInfoRequest(v);await ht(t,p,g).call(t,e)}catch(e){console.error(e)}},u7(t,s),u7(t,o),u7(t,d),u7(t,h),u7(t,m),u7(t,p),u7(t,v),u7(t,b),u8(t,"observedAttributes",["cast-src","cast-content-type","cast-stream-type"]),u8(t,"instances",new Set),u7(t,i,void 0),u7(t,r,!1),u8(t,"initCast",()=>{u6(t,s,n)?u6(t,o,l)?u6(t,a).call(t,chrome.cast.isAvailable):customElements.whenDefined("google-cast-button").then(()=>u6(t,a).call(t,chrome.cast.isAvailable)):globalThis.__onGCastApiAvailable=()=>{customElements.whenDefined("google-cast-button").then(()=>u6(t,a).call(t,chrome.cast.isAvailable))}}),u7(t,a,e=>{if(e){he(t,r,!0);let{CAST_STATE_CHANGED:e}=cast.framework.CastContextEventType;u6(t,d,u).addEventListener(e,e=>{t.instances.forEach(t=>ht(t,C,M).call(t,e))});let{SESSION_STATE_CHANGED:i}=cast.framework.CastContextEventType;u6(t,d,u).addEventListener(i,e=>{t.instances.forEach(t=>ht(t,x,O).call(t,e))}),t.instances.forEach(e=>ht(e,P,N).call(e))}}),t},hh=globalThis.HTMLVideoElement?hu(HTMLVideoElement):hu(Object);globalThis.customElements&&!globalThis.customElements.get("castable-video")&&(customElements.define("castable-video",hh,{extends:"video"}),globalThis.CastableVideoElement=hh),hh.initCast();var hc,hm=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"],hf=null==(hc=globalThis.document)?void 0:hc.createElement("template");hf&&(hf.innerHTML=`
    <style>
      :host {
        display: inline-block;
        line-height: 0;
      }

      audio {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
      }
    </style>
    <slot></slot>
  `);var hp,hg=null==(hp=globalThis.document)?void 0:hp.createElement("template");hg&&(hg.innerHTML=`
    <style>
      :host {
        display: inline-block;
        line-height: 0;
      }

      video {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
        object-fit: var(--media-object-fit, contain);
        object-position: var(--media-object-position, 50% 50%);
      }

      video::-webkit-media-text-track-container {
        transform: var(--media-webkit-text-track-transform);
        transition: var(--media-webkit-text-track-transition);
      }
    </style>
    <slot></slot>
  `);var hv=(e,{tag:t,is:i})=>{var r,a,s,n,o,l,d,u,h,c,m,f,p;let g=null==(r=globalThis.document)?void 0:r.createElement(t,{is:i}),v=g?function(e){let t=[];for(let i=Object.getPrototypeOf(e);i&&i!==HTMLElement.prototype;i=Object.getPrototypeOf(i))t.push(...Object.getOwnPropertyNames(i));return t}(g):[];return a=class extends e{constructor(){super(),u7(this,u),u7(this,c),u7(this,f),u7(this,l,void 0),u7(this,d,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.append(this.constructor.template.content.cloneNode(!0)))}static get observedAttributes(){var e,t;return ht(a,n,o).call(a),[...null!=(t=null==(e=null==g?void 0:g.constructor)?void 0:e.observedAttributes)?t:[],"autopictureinpicture","disablepictureinpicture","disableremoteplayback","autoplay","controls","controlslist","crossorigin","loop","muted","playsinline","poster","preload","src"]}get nativeEl(){var e,i;return null!=(i=null!=(e=u6(this,d))?e:this.shadowRoot.querySelector(t))?i:this.querySelector(t)}set nativeEl(e){he(this,d,e)}get defaultMuted(){return this.hasAttribute("muted")}set defaultMuted(e){this.toggleAttribute("muted",!!e)}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src",`${e}`)}get preload(){var e,t;return null!=(t=this.getAttribute("preload"))?t:null==(e=this.nativeEl)?void 0:e.preload}set preload(e){this.setAttribute("preload",`${e}`)}attributeChangedCallback(e,t,i){ht(this,u,h).call(this),ht(this,f,p).call(this,e,t,i)}connectedCallback(){ht(this,u,h).call(this)}},s=new WeakMap,n=new WeakSet,o=function(){if(u6(this,s))return;he(this,s,!0);let e=new Set(this.observedAttributes);for(let t of(e.delete("muted"),v))if(!(t in this.prototype)){if("function"==typeof g[t])this.prototype[t]=function(...e){return ht(this,u,h).call(this),this.call?this.call(t,...e):this.nativeEl[t].apply(this.nativeEl,e)};else{let i={get(){var i,r,a;ht(this,u,h).call(this);let s=t.toLowerCase();if(e.has(s)){let e=this.getAttribute(s);return null!==e&&(""===e||e)}return null!=(a=null==(i=this.get)?void 0:i.call(this,t))?a:null==(r=this.nativeEl)?void 0:r[t]}};t!==t.toUpperCase()&&(i.set=function(i){ht(this,u,h).call(this);let r=t.toLowerCase();if(e.has(r)){!0===i||!1===i||null==i?this.toggleAttribute(r,!!i):this.setAttribute(r,i);return}if(this.set){this.set(t,i);return}this.nativeEl[t]=i}),Object.defineProperty(this.prototype,t,i)}}},l=new WeakMap,d=new WeakMap,u=new WeakSet,h=function(){var e,r;if(u6(this,l))return;if(he(this,l,!0),!this.nativeEl){let e=document.createElement(t,{is:i});e.part=t,this.shadowRoot.append(e)}for(let e of(this.nativeEl.muted=this.hasAttribute("muted"),v))ht(this,c,m).call(this,e);let a=new Map,s=this.shadowRoot.querySelector("slot:not([name])");for(let t of(null==s||s.addEventListener("slotchange",()=>{let e=new Map(a);s.assignedElements().filter(e=>["track","source"].includes(e.localName)).forEach(t=>{var i,r;e.delete(t);let s=a.get(t);s||(s=t.cloneNode(),a.set(t,s)),null==(r=(i=this.nativeEl).append)||r.call(i,s)}),e.forEach(e=>e.remove())}),this.constructor.Events))null==(r=(e=this.shadowRoot).addEventListener)||r.call(e,t,e=>{e.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(e.type,{detail:e.detail}))},!0)},c=new WeakSet,m=function(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}},f=new WeakSet,p=function(e,t,i){var r,a,s,n;["id","class"].includes(e)||(null===i?null==(a=(r=this.nativeEl).removeAttribute)||a.call(r,e):null==(n=(s=this.nativeEl).setAttribute)||n.call(s,e,i))},u7(a,n),u8(a,"Events",hm),u8(a,"template",t.endsWith("audio")?hf:hg),u7(a,s,void 0),a};globalThis.document&&hv(HTMLElement,{tag:"video"}),globalThis.document&&hv(HTMLElement,{tag:"audio"});var hE=class extends Event{constructor(e,t){super(e),u8(this,"track"),this.track=t.track}},hb=new WeakMap;function hy(e){var t;let i;return null!=(t=hb.get(e))?t:((i=hb.get(e))||hb.set(e,i={}),Object.assign(i,{}))}function hT(e,t){let i=e.videoTracks;hy(t).media=e,hy(t).renditionSet||(hy(t).renditionSet=new Set);let r=hy(i).trackSet;r.add(t);let a=r.size-1;a in hR.prototype||Object.defineProperty(hR.prototype,a,{get(){return[...hy(this).trackSet][a]}}),queueMicrotask(()=>{i.dispatchEvent(new hE("addtrack",{track:t}))})}function hA(e){var t;let i=null==(t=hy(e).media)?void 0:t.videoTracks;i&&(hy(i).trackSet.delete(e),queueMicrotask(()=>{i.dispatchEvent(new hE("removetrack",{track:e}))}))}var h_,hS,hk,hL,hI,hR=class extends EventTarget{constructor(){super(),u7(this,hL),u7(this,h_,void 0),u7(this,hS,void 0),u7(this,hk,void 0),hy(this).trackSet=new Set}[Symbol.iterator](){return u6(this,hL,hI).values()}get length(){return u6(this,hL,hI).size}getTrackById(e){var t;return null!=(t=[...u6(this,hL,hI)].find(t=>t.id===e))?t:null}get selectedIndex(){return[...u6(this,hL,hI)].findIndex(e=>e.selected)}get onaddtrack(){return u6(this,h_)}set onaddtrack(e){u6(this,h_)&&(this.removeEventListener("addtrack",u6(this,h_)),he(this,h_,void 0)),"function"==typeof e&&(he(this,h_,e),this.addEventListener("addtrack",e))}get onremovetrack(){return u6(this,hS)}set onremovetrack(e){u6(this,hS)&&(this.removeEventListener("removetrack",u6(this,hS)),he(this,hS,void 0)),"function"==typeof e&&(he(this,hS,e),this.addEventListener("removetrack",e))}get onchange(){return u6(this,hk)}set onchange(e){u6(this,hk)&&(this.removeEventListener("change",u6(this,hk)),he(this,hk,void 0)),"function"==typeof e&&(he(this,hk,e),this.addEventListener("change",e))}};h_=new WeakMap,hS=new WeakMap,hk=new WeakMap,hL=new WeakSet,hI=function(){return hy(this).trackSet};var hw=class extends Event{constructor(e,t){super(e),u8(this,"rendition"),this.rendition=t.rendition}};function hD(e){return[...hy(e).media.videoTracks].filter(e=>e.selected).flatMap(e=>[...hy(e).renditionSet])}var hC,hM,hx,hO=class extends EventTarget{constructor(){super(...arguments),u7(this,hC,void 0),u7(this,hM,void 0),u7(this,hx,void 0)}[Symbol.iterator](){return hD(this).values()}get length(){return hD(this).length}getRenditionById(e){var t;return null!=(t=hD(this).find(t=>`${t.id}`==`${e}`))?t:null}get selectedIndex(){return hD(this).findIndex(e=>e.selected)}set selectedIndex(e){for(let[t,i]of hD(this).entries())i.selected=t===e}get onaddrendition(){return u6(this,hC)}set onaddrendition(e){u6(this,hC)&&(this.removeEventListener("addrendition",u6(this,hC)),he(this,hC,void 0)),"function"==typeof e&&(he(this,hC,e),this.addEventListener("addrendition",e))}get onremoverendition(){return u6(this,hM)}set onremoverendition(e){u6(this,hM)&&(this.removeEventListener("removerendition",u6(this,hM)),he(this,hM,void 0)),"function"==typeof e&&(he(this,hM,e),this.addEventListener("removerendition",e))}get onchange(){return u6(this,hx)}set onchange(e){u6(this,hx)&&(this.removeEventListener("change",u6(this,hx)),he(this,hx,void 0)),"function"==typeof e&&(he(this,hx,e),this.addEventListener("change",e))}};hC=new WeakMap,hM=new WeakMap,hx=new WeakMap;var hP,hN=class{constructor(){u8(this,"src"),u8(this,"id"),u8(this,"width"),u8(this,"height"),u8(this,"bitrate"),u8(this,"frameRate"),u8(this,"codec"),u7(this,hP,!1)}get selected(){return u6(this,hP)}set selected(e){var t;let i;u6(this,hP)!==e&&(he(this,hP,e),t=this,(i=hy(t).media.videoRenditions)&&!hy(i).changeRequested&&(hy(i).changeRequested=!0,queueMicrotask(()=>{delete hy(i).changeRequested,hy(t).track.selected&&i.dispatchEvent(new Event("change"))})))}};hP=new WeakMap;var hU,hF=class{constructor(){u8(this,"id"),u8(this,"kind"),u8(this,"label",""),u8(this,"language",""),u8(this,"sourceBuffer"),u7(this,hU,!1)}addRendition(e,t,i,r,a,s){var n;let o,l,d,u=new hN;return u.src=e,u.width=t,u.height=i,u.frameRate=s,u.bitrate=a,u.codec=r,n=this,o=hy(n).media.videoRenditions,hy(u).media=hy(n).media,hy(u).track=n,(l=hy(n).renditionSet).add(u),(d=l.size-1)in hO.prototype||Object.defineProperty(hO.prototype,d,{get(){return hD(this)[d]}}),queueMicrotask(()=>{n.selected&&o.dispatchEvent(new hw("addrendition",{rendition:u}))}),u}removeRendition(e){let t,i;t=hy(e).media.videoRenditions,i=hy(e).track,hy(i).renditionSet.delete(e),queueMicrotask(()=>{hy(e).track.selected&&t.dispatchEvent(new hw("removerendition",{rendition:e}))})}get selected(){return u6(this,hU)}set selected(e){u6(this,hU)!==e&&(he(this,hU,e),!0===e&&function(e){var t;let i=null!=(t=hy(e).media.videoTracks)?t:[],r=!1;for(let t of i)t!==e&&(t.selected=!1,r=!0);if(r){if(hy(i).changeRequested)return;hy(i).changeRequested=!0,queueMicrotask(()=>{delete hy(i).changeRequested,i.dispatchEvent(new Event("change"))})}}(this))}};function hB(e){return[...hy(e).media.audioTracks].filter(e=>e.enabled).flatMap(e=>[...hy(e).renditionSet])}hU=new WeakMap;var h$,hV,hH,hG=class extends EventTarget{constructor(){super(...arguments),u7(this,h$,void 0),u7(this,hV,void 0),u7(this,hH,void 0)}[Symbol.iterator](){return hB(this).values()}get length(){return hB(this).length}getRenditionById(e){var t;return null!=(t=hB(this).find(t=>`${t.id}`==`${e}`))?t:null}get selectedIndex(){return hB(this).findIndex(e=>e.selected)}set selectedIndex(e){for(let[t,i]of hB(this).entries())i.selected=t===e}get onaddrendition(){return u6(this,h$)}set onaddrendition(e){u6(this,h$)&&(this.removeEventListener("addrendition",u6(this,h$)),he(this,h$,void 0)),"function"==typeof e&&(he(this,h$,e),this.addEventListener("addrendition",e))}get onremoverendition(){return u6(this,hV)}set onremoverendition(e){u6(this,hV)&&(this.removeEventListener("removerendition",u6(this,hV)),he(this,hV,void 0)),"function"==typeof e&&(he(this,hV,e),this.addEventListener("removerendition",e))}get onchange(){return u6(this,hH)}set onchange(e){u6(this,hH)&&(this.removeEventListener("change",u6(this,hH)),he(this,hH,void 0)),"function"==typeof e&&(he(this,hH,e),this.addEventListener("change",e))}};h$=new WeakMap,hV=new WeakMap,hH=new WeakMap;var hW,hK=class{constructor(){u8(this,"src"),u8(this,"id"),u8(this,"bitrate"),u8(this,"codec"),u7(this,hW,!1)}get selected(){return u6(this,hW)}set selected(e){var t;let i;u6(this,hW)!==e&&(he(this,hW,e),t=this,(i=hy(t).media.audioRenditions)&&!hy(i).changeRequested&&(hy(i).changeRequested=!0,queueMicrotask(()=>{delete hy(i).changeRequested,hy(t).track.enabled&&i.dispatchEvent(new Event("change"))})))}};function hq(e,t){let i=e.audioTracks;hy(t).media=e,hy(t).renditionSet||(hy(t).renditionSet=new Set);let r=hy(i).trackSet;r.add(t);let a=r.size-1;a in hJ.prototype||Object.defineProperty(hJ.prototype,a,{get(){return[...hy(this).trackSet][a]}}),queueMicrotask(()=>{i.dispatchEvent(new hE("addtrack",{track:t}))})}function hj(e){var t;let i=null==(t=hy(e).media)?void 0:t.audioTracks;i&&(hy(i).trackSet.delete(e),queueMicrotask(()=>{i.dispatchEvent(new hE("removetrack",{track:e}))}))}hW=new WeakMap;var hY,hz,hX,hQ,hZ,hJ=class extends EventTarget{constructor(){super(),u7(this,hQ),u7(this,hY,void 0),u7(this,hz,void 0),u7(this,hX,void 0),hy(this).trackSet=new Set}[Symbol.iterator](){return u6(this,hQ,hZ).values()}get length(){return u6(this,hQ,hZ).size}getTrackById(e){var t;return null!=(t=[...u6(this,hQ,hZ)].find(t=>t.id===e))?t:null}get onaddtrack(){return u6(this,hY)}set onaddtrack(e){u6(this,hY)&&(this.removeEventListener("addtrack",u6(this,hY)),he(this,hY,void 0)),"function"==typeof e&&(he(this,hY,e),this.addEventListener("addtrack",e))}get onremovetrack(){return u6(this,hz)}set onremovetrack(e){u6(this,hz)&&(this.removeEventListener("removetrack",u6(this,hz)),he(this,hz,void 0)),"function"==typeof e&&(he(this,hz,e),this.addEventListener("removetrack",e))}get onchange(){return u6(this,hX)}set onchange(e){u6(this,hX)&&(this.removeEventListener("change",u6(this,hX)),he(this,hX,void 0)),"function"==typeof e&&(he(this,hX,e),this.addEventListener("change",e))}};hY=new WeakMap,hz=new WeakMap,hX=new WeakMap,hQ=new WeakSet,hZ=function(){return hy(this).trackSet};var h0,h1=class{constructor(){u8(this,"id"),u8(this,"kind"),u8(this,"label",""),u8(this,"language",""),u8(this,"sourceBuffer"),u7(this,h0,!1)}addRendition(e,t,i){var r;let a,s,n,o=new hK;return o.src=e,o.codec=t,o.bitrate=i,r=this,a=hy(r).media.audioRenditions,hy(o).media=hy(r).media,hy(o).track=r,(s=hy(r).renditionSet).add(o),(n=s.size-1)in hG.prototype||Object.defineProperty(hG.prototype,n,{get(){return hB(this)[n]}}),queueMicrotask(()=>{r.enabled&&a.dispatchEvent(new hw("addrendition",{rendition:o}))}),o}removeRendition(e){let t,i;t=hy(e).media.audioRenditions,i=hy(e).track,hy(i).renditionSet.delete(e),queueMicrotask(()=>{hy(e).track.enabled&&t.dispatchEvent(new hw("removerendition",{rendition:e}))})}get enabled(){return u6(this,h0)}set enabled(e){let t;u6(this,h0)!==e&&(he(this,h0,e),(t=hy(this).media.audioTracks)&&!hy(t).changeRequested&&(hy(t).changeRequested=!0,queueMicrotask(()=>{delete hy(t).changeRequested,t.dispatchEvent(new Event("change"))})))}};h0=new WeakMap;var h2=h4(globalThis.HTMLMediaElement,"video"),h3=h4(globalThis.HTMLMediaElement,"audio");function h4(e,t){var i;if(null!=e&&e.prototype)return null==(i=Object.getOwnPropertyDescriptor(e.prototype,`${t}Tracks`))?void 0:i.get}hm.push("castchange","entercast","leavecast");var h5,h8,h9,h6,h7,ce,ct,ci,cr,ca=function(e){if(!(null!=e&&e.prototype))return e;let t=h4(e,"video");(!t||`${t}`.includes("[native code]"))&&Object.defineProperty(e.prototype,"videoTracks",{get(){return function(e){var t;let i=hy(e).videoTracks;if(!i&&(i=new hR,hy(e).videoTracks=i,h2)){let r=h2.call(null!=(t=e.nativeEl)?t:e);for(let t of r)hT(e,t);r.addEventListener("change",()=>{i.dispatchEvent(new Event("change"))}),r.addEventListener("addtrack",t=>{if([...i].some(e=>e instanceof hF)){for(let e of r)hA(e);return}hT(e,t.track)}),r.addEventListener("removetrack",e=>{hA(e.track)})}return i}(this)}});let i=h4(e,"audio");(!i||`${i}`.includes("[native code]"))&&Object.defineProperty(e.prototype,"audioTracks",{get(){return function(e){var t;let i=hy(e).audioTracks;if(!i&&(i=new hJ,hy(e).audioTracks=i,h3)){let r=h3.call(null!=(t=e.nativeEl)?t:e);for(let t of r)hq(e,t);r.addEventListener("change",()=>{i.dispatchEvent(new Event("change"))}),r.addEventListener("addtrack",t=>{if([...i].some(e=>e instanceof h1)){for(let e of r)hj(e);return}hq(e,t.track)}),r.addEventListener("removetrack",e=>{hj(e.track)})}return i}(this)}}),"addVideoTrack"in e.prototype||(e.prototype.addVideoTrack=function(e,t="",i=""){let r=new hF;return r.kind=e,r.label=t,r.language=i,hT(this,r),r}),"removeVideoTrack"in e.prototype||(e.prototype.removeVideoTrack=hA),"addAudioTrack"in e.prototype||(e.prototype.addAudioTrack=function(e,t="",i=""){let r=new h1;return r.kind=e,r.label=t,r.language=i,hq(this,r),r}),"removeAudioTrack"in e.prototype||(e.prototype.removeAudioTrack=hj),"videoRenditions"in e.prototype||Object.defineProperty(e.prototype,"videoRenditions",{get(){return r(this)}});let r=e=>{let t=hy(e).videoRenditions;return t||(hy(t=new hO).media=e,hy(e).videoRenditions=t),t};"audioRenditions"in e.prototype||Object.defineProperty(e.prototype,"audioRenditions",{get(){return a(this)}});let a=e=>{let t=hy(e).audioRenditions;return t||(hy(t=new hG).media=e,hy(e).audioRenditions=t),t};return e}(hv(hl.HTMLElement,{tag:"video",is:"castable-video"})),cs={BEACON_COLLECTION_DOMAIN:"beacon-collection-domain",CUSTOM_DOMAIN:"custom-domain",DEBUG:"debug",DISABLE_COOKIES:"disable-cookies",ENV_KEY:"env-key",MAX_RESOLUTION:"max-resolution",METADATA_URL:"metadata-url",PLAYBACK_ID:"playback-id",PLAYER_SOFTWARE_NAME:"player-software-name",PLAYER_SOFTWARE_VERSION:"player-software-version",PREFER_CMCD:"prefer-cmcd",PREFER_PLAYBACK:"prefer-playback",START_TIME:"start-time",STREAM_TYPE:"stream-type",TARGET_LIVE_WINDOW:"target-live-window",LIVE_EDGE_OFFSET:"live-edge-offset",TYPE:"type"},cn=Object.values(cs),co=class extends ca{constructor(){super(),u7(this,ci),u7(this,h5,void 0),u7(this,h8,void 0),u7(this,h9,void 0),u7(this,h6,{}),u7(this,h7,void 0),u7(this,ce,void 0),u7(this,ct,void 0),he(this,h9,uM())}static get observedAttributes(){var e;return[...cn,...null!=(e=ca.observedAttributes)?e:[]]}get preferCmcd(){var e;return null!=(e=this.getAttribute(cs.PREFER_CMCD))?e:void 0}set preferCmcd(e){e!==this.preferCmcd&&(e?lm.includes(e)?this.setAttribute(cs.PREFER_CMCD,e):console.warn(`Invalid value for preferCmcd. Must be one of ${lm.join()}`):this.removeAttribute(cs.PREFER_CMCD))}get playerInitTime(){return u6(this,h9)}get playerSoftwareName(){var e;return null!=(e=u6(this,ce))?e:"mux-video"}set playerSoftwareName(e){he(this,ce,e)}get playerSoftwareVersion(){var e;return null!=(e=u6(this,h7))?e:hd}set playerSoftwareVersion(e){he(this,h7,e)}get _hls(){var e;return null==(e=u6(this,h5))?void 0:e.engine}get mux(){var e;return null==(e=this.nativeEl)?void 0:e.mux}get error(){var e;return null!=(e=uF(this.nativeEl))?e:null}get errorTranslator(){return u6(this,ct)}set errorTranslator(e){he(this,ct,e)}get src(){return this.getAttribute("src")}set src(e){e!==this.src&&(null==e?this.removeAttribute("src"):this.setAttribute("src",e))}get type(){var e;return null!=(e=this.getAttribute(cs.TYPE))?e:void 0}set type(e){e!==this.type&&(e?this.setAttribute(cs.TYPE,e):this.removeAttribute(cs.TYPE))}get autoplay(){let e=this.getAttribute("autoplay");return null!==e&&(""===e||e)}set autoplay(e){e!==this.autoplay&&(e?this.setAttribute("autoplay","string"==typeof e?e:""):this.removeAttribute("autoplay"))}get preload(){let e=this.getAttribute("preload");return""===e?"auto":["none","metadata","auto"].includes(e)?e:super.preload}set preload(e){e!=this.getAttribute("preload")&&(["","none","metadata","auto"].includes(e)?this.setAttribute("preload",e):this.removeAttribute("preload"))}get debug(){return null!=this.getAttribute(cs.DEBUG)}set debug(e){e!==this.debug&&(e?this.setAttribute(cs.DEBUG,""):this.removeAttribute(cs.DEBUG))}get disableCookies(){return this.hasAttribute(cs.DISABLE_COOKIES)}set disableCookies(e){e!==this.disableCookies&&(e?this.setAttribute(cs.DISABLE_COOKIES,""):this.removeAttribute(cs.DISABLE_COOKIES))}get startTime(){let e=this.getAttribute(cs.START_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set startTime(e){e!==this.startTime&&(null==e?this.removeAttribute(cs.START_TIME):this.setAttribute(cs.START_TIME,`${e}`))}get playbackId(){var e;return null!=(e=this.getAttribute(cs.PLAYBACK_ID))?e:void 0}set playbackId(e){e!==this.playbackId&&(e?this.setAttribute(cs.PLAYBACK_ID,e):this.removeAttribute(cs.PLAYBACK_ID))}get maxResolution(){var e;return null!=(e=this.getAttribute(cs.MAX_RESOLUTION))?e:void 0}set maxResolution(e){e!==this.maxResolution&&(e?this.setAttribute(cs.MAX_RESOLUTION,e):this.removeAttribute(cs.MAX_RESOLUTION))}get customDomain(){var e;return null!=(e=this.getAttribute(cs.CUSTOM_DOMAIN))?e:void 0}set customDomain(e){e!==this.customDomain&&(e?this.setAttribute(cs.CUSTOM_DOMAIN,e):this.removeAttribute(cs.CUSTOM_DOMAIN))}get ended(){return uq(this.nativeEl,this._hls)}get envKey(){var e;return null!=(e=this.getAttribute(cs.ENV_KEY))?e:void 0}set envKey(e){e!==this.envKey&&(e?this.setAttribute(cs.ENV_KEY,e):this.removeAttribute(cs.ENV_KEY))}get beaconCollectionDomain(){var e;return null!=(e=this.getAttribute(cs.BEACON_COLLECTION_DOMAIN))?e:void 0}set beaconCollectionDomain(e){e!==this.beaconCollectionDomain&&(e?this.setAttribute(cs.BEACON_COLLECTION_DOMAIN,e):this.removeAttribute(cs.BEACON_COLLECTION_DOMAIN))}get streamType(){var e;return null!=(e=this.getAttribute(cs.STREAM_TYPE))?e:uB(this.nativeEl)}set streamType(e){e!==this.streamType&&(e?this.setAttribute(cs.STREAM_TYPE,e):this.removeAttribute(cs.STREAM_TYPE))}get targetLiveWindow(){return this.hasAttribute(cs.TARGET_LIVE_WINDOW)?+this.getAttribute(cs.TARGET_LIVE_WINDOW):u$(this.nativeEl)}set targetLiveWindow(e){e!=this.targetLiveWindow&&(null==e?this.removeAttribute(cs.TARGET_LIVE_WINDOW):this.setAttribute(cs.TARGET_LIVE_WINDOW,`${+e}`))}get liveEdgeStart(){var e,t;if(this.hasAttribute(cs.LIVE_EDGE_OFFSET)){let{liveEdgeOffset:i}=this,r=null!=(e=this.nativeEl.seekable.end(0))?e:0;return Math.max(null!=(t=this.nativeEl.seekable.start(0))?t:0,r-i)}return uH(this.nativeEl)}get liveEdgeOffset(){if(this.hasAttribute(cs.LIVE_EDGE_OFFSET))return+this.getAttribute(cs.LIVE_EDGE_OFFSET)}set liveEdgeOffset(e){e!=this.targetLiveWindow&&(null==e?this.removeAttribute(cs.LIVE_EDGE_OFFSET):this.setAttribute(cs.LIVE_EDGE_OFFSET,`${+e}`))}get seekable(){return uV(this.nativeEl)}async addCuePoints(e){return lC(this.nativeEl,e)}get activeCuePoint(){return lx(this.nativeEl)}get cuePoints(){return function(e,t={label:lR}){let i=lD(e,t);return null!=i&&i.cues?Array.from(i.cues,e=>lM(e)):[]}(this.nativeEl)}getStartDate(){return function(e,t){if(t){let i=t.playingDate;if(null!=i)return new Date(i.getTime()-1e3*e.currentTime)}return"function"==typeof e.getStartDate?e.getStartDate():new Date(NaN)}(this.nativeEl,this._hls)}get currentPdt(){return function(e,t){if(t&&t.playingDate)return t.playingDate;if("function"==typeof e.getStartDate){let t=e.getStartDate();return new Date(t.getTime()+1e3*e.currentTime)}return new Date(NaN)}(this.nativeEl,this._hls)}get preferPlayback(){let e=this.getAttribute(cs.PREFER_PLAYBACK);if(e===lh.MSE||e===lh.NATIVE)return e}set preferPlayback(e){e!==this.preferPlayback&&(e===lh.MSE||e===lh.NATIVE?this.setAttribute(cs.PREFER_PLAYBACK,e):this.removeAttribute(cs.PREFER_PLAYBACK))}get metadata(){return{...this.getAttributeNames().filter(e=>e.startsWith("metadata-")&&![cs.METADATA_URL].includes(e)).reduce((e,t)=>{let i=this.getAttribute(t);return null!=i&&(e[t.replace(/^metadata-/,"").replace(/-/g,"_")]=i),e},{}),...u6(this,h6)}}set metadata(e){he(this,h6,null!=e?e:{}),this.mux&&this.mux.emit("hb",u6(this,h6))}load(){he(this,h5,uj(this,this.nativeEl,u6(this,h5)))}unload(){uY(this.nativeEl,u6(this,h5)),he(this,h5,void 0)}attributeChangedCallback(e,t,i){var r,a;switch(ca.observedAttributes.includes(e)&&!["src","autoplay","preload"].includes(e)&&super.attributeChangedCallback(e,t,i),e){case cs.PLAYER_SOFTWARE_NAME:this.playerSoftwareName=null!=i?i:void 0;break;case cs.PLAYER_SOFTWARE_VERSION:this.playerSoftwareVersion=null!=i?i:void 0;break;case"src":{let e=!!t,r=!!i;!e&&r?ht(this,ci,cr).call(this):e&&!r?this.unload():e&&r&&(this.unload(),ht(this,ci,cr).call(this));break}case"autoplay":if(i===t)break;null==(r=u6(this,h5))||r.setAutoplay(this.autoplay);break;case"preload":if(i===t)break;null==(a=u6(this,h5))||a.setPreload(i);break;case cs.PLAYBACK_ID:this.src=uO(null!=i?i:void 0,{maxResolution:this.maxResolution,domain:this.customDomain});break;case cs.DEBUG:{let e=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this._hls&&(this._hls.config.debug=e);break}case cs.METADATA_URL:i&&fetch(i).then(e=>e.json()).then(e=>this.metadata=e).catch(()=>console.error(`Unable to load or parse metadata JSON from metadata-url ${i}!`));break;case cs.STREAM_TYPE:(null==i||i!==t)&&this.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}));break;case cs.TARGET_LIVE_WINDOW:(null==i||i!==t)&&this.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0,detail:this.targetLiveWindow}))}}connectedCallback(){var e;null==(e=super.connectedCallback)||e.call(this),this.nativeEl&&this.src&&!u6(this,h5)&&ht(this,ci,cr).call(this)}disconnectedCallback(){this.unload()}};h5=new WeakMap,h8=new WeakMap,h9=new WeakMap,h6=new WeakMap,h7=new WeakMap,ce=new WeakMap,ct=new WeakMap,ci=new WeakSet,cr=async function(){u6(this,h8)||(await he(this,h8,Promise.resolve()),he(this,h8,null),this.load())},hl.customElements.get("mux-video")||(hl.customElements.define("mux-video",co),hl.MuxVideoElement=co);var cl=Object.defineProperty,cd=(e,t,i)=>t in e?cl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,cu=(e,t,i)=>(cd(e,"symbol"!=typeof t?t+"":t,i),i),ch=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cc=(e,t,i)=>(ch(e,t,"read from private field"),i?i.call(e):t.get(e)),cm=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},cf=(e,t,i,r)=>(ch(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let cp={processCallback(e,t,i){if(i){for(let[e,r]of t)if(e in i){let t=i[e];"boolean"==typeof t&&r instanceof c_&&"boolean"==typeof r.element[r.attributeName]?r.booleanValue=t:"function"==typeof t&&r instanceof c_?r.element[r.attributeName]=t:r.value=t}}}};class cg extends Q.DocumentFragment{constructor(e,t,i=cp){var r;super(),cm(this,c2,void 0),cm(this,c3,void 0),this.append(e.content.cloneNode(!0)),cf(this,c2,cv(this)),cf(this,c3,i),null==(r=i.createCallback)||r.call(i,this,cc(this,c2),t),i.processCallback(this,cc(this,c2),t)}update(e){cc(this,c3).processCallback(this,cc(this,c2),e)}}c2=new WeakMap,c3=new WeakMap;let cv=(e,t=[])=>{let i,r;for(let a of e.attributes||[])if(a.value.includes("{{")){let s=new cA;for([i,r]of cb(a.value))if(i){let i=new c_(e,a.name,a.namespaceURI);s.append(i),t.push([r,i])}else s.append(r);a.value=s.toString()}for(let a of e.childNodes)if(1!==a.nodeType||a instanceof HTMLTemplateElement){if(1===a.nodeType||a.data.includes("{{")){let s=[];if(a.data)for([i,r]of cb(a.data))if(i){let i=new cS(e);s.push(i),t.push([r,i])}else s.push(new Text(r));else if(a instanceof HTMLTemplateElement){let i=new ck(e,a);s.push(i),t.push([i.expression,i])}a.replaceWith(...s.flatMap(e=>e.replacementNodes||[e]))}}else cv(a,t);return t},cE={},cb=e=>{let t="",i=0,r=cE[e],a=0,s;if(r)return r;for(r=[];s=e[a];a++)"{"===s&&"{"===e[a+1]&&"\\"!==e[a-1]&&e[a+2]&&1==++i?(t&&r.push([0,t]),t="",a++):"}"!==s||"}"!==e[a+1]||"\\"===e[a-1]||--i?t+=s||"":(r.push([1,t.trim()]),t="",a++);return t&&r.push([0,(i>0?"{{":"")+t]),cE[e]=r};class cy{get value(){return""}set value(e){}toString(){return this.value}}let cT=new WeakMap;class cA{constructor(){cm(this,c4,[])}[Symbol.iterator](){return cc(this,c4).values()}get length(){return cc(this,c4).length}item(e){return cc(this,c4)[e]}append(...e){for(let t of e)t instanceof c_&&cT.set(t,this),cc(this,c4).push(t)}toString(){return cc(this,c4).join("")}}c4=new WeakMap;class c_ extends cy{constructor(e,t,i){super(),cm(this,c7),cm(this,c5,""),cm(this,c8,void 0),cm(this,c9,void 0),cm(this,c6,void 0),cf(this,c8,e),cf(this,c9,t),cf(this,c6,i)}get attributeName(){return cc(this,c9)}get attributeNamespace(){return cc(this,c6)}get element(){return cc(this,c8)}get value(){return cc(this,c5)}set value(e){cc(this,c5)!==e&&(cf(this,c5,e),cc(this,c7,me)&&1!==cc(this,c7,me).length?cc(this,c8).setAttributeNS(cc(this,c6),cc(this,c9),cc(this,c7,me)):null==e?cc(this,c8).removeAttributeNS(cc(this,c6),cc(this,c9)):cc(this,c8).setAttributeNS(cc(this,c6),cc(this,c9),e))}get booleanValue(){return cc(this,c8).hasAttributeNS(cc(this,c6),cc(this,c9))}set booleanValue(e){if(cc(this,c7,me)&&1!==cc(this,c7,me).length)throw new DOMException("Value is not fully templatized");this.value=e?"":null}}c5=new WeakMap,c8=new WeakMap,c9=new WeakMap,c6=new WeakMap,c7=new WeakSet,me=function(){return cT.get(this)};class cS extends cy{constructor(e,t){super(),cm(this,mt,void 0),cm(this,mi,void 0),cf(this,mt,e),cf(this,mi,t?[...t]:[new Text])}get replacementNodes(){return cc(this,mi)}get parentNode(){return cc(this,mt)}get nextSibling(){return cc(this,mi)[cc(this,mi).length-1].nextSibling}get previousSibling(){return cc(this,mi)[0].previousSibling}get value(){return cc(this,mi).map(e=>e.textContent).join("")}set value(e){this.replace(e)}replace(...e){let t=e.flat().flatMap(e=>null==e?[new Text]:e.forEach?[...e]:11===e.nodeType?[...e.childNodes]:e.nodeType?[e]:[new Text(e)]);t.length||t.push(new Text),cf(this,mi,function(e,t,i,r=null){let a=0,s,n,o,l=i.length,d=t.length;for(;a<l&&a<d&&t[a]==i[a];)a++;for(;a<l&&a<d&&i[l-1]==t[d-1];)r=i[--d,--l];if(a==d)for(;a<l;)e.insertBefore(i[a++],r);if(a==l)for(;a<d;)e.removeChild(t[a++]);else{for(s=t[a];a<l;)o=i[a++],n=s?s.nextSibling:r,s==o?s=n:a<l&&i[a]==n?(e.replaceChild(o,s),s=n):e.insertBefore(o,s);for(;s!=r;)n=s.nextSibling,e.removeChild(s),s=n}return i}(cc(this,mi)[0].parentNode,cc(this,mi),t,this.nextSibling))}}mt=new WeakMap,mi=new WeakMap;class ck extends cS{constructor(e,t){let i=t.getAttribute("directive")||t.getAttribute("type"),r=t.getAttribute("expression")||t.getAttribute(i)||"";r.startsWith("{{")&&(r=r.trim().slice(2,-2).trim()),super(e),cu(this,"directive"),this.expression=r,this.template=t,this.directive=i}}let cL={string:e=>String(e)};class cI{constructor(e){this.template=e,this.state=void 0}}let cR=new WeakMap,cw=new WeakMap,cD={partial:(e,t)=>{t[e.expression]=new cI(e.template)},if:(e,t)=>{var i;if(cO(e.expression,t)){if(cR.get(e)!==e.template){cR.set(e,e.template);let i=new cg(e.template,t,cM);e.replace(i),cw.set(e,i)}else null==(i=cw.get(e))||i.update(t)}else e.replace(""),cR.delete(e),cw.delete(e)}},cC=Object.keys(cD),cM={processCallback(e,t,i){var r,a;if(i)for(let[e,s]of t){if(s instanceof ck){if(!s.directive){let e=cC.find(e=>s.template.hasAttribute(e));e&&(s.directive=e,s.expression=s.template.getAttribute(e))}null==(r=cD[s.directive])||r.call(cD,s,i);continue}let t=cO(e,i);if(t instanceof cI){cR.get(s)!==t.template?(cR.set(s,t.template),t=new cg(t.template,t.state,cM),s.value=t,cw.set(s,t)):null==(a=cw.get(s))||a.update(t.state);continue}t?(s instanceof c_&&s.attributeName.startsWith("aria-")&&(t=String(t)),s instanceof c_?"boolean"==typeof t?s.booleanValue=t:"function"==typeof t?s.element[s.attributeName]=t:s.value=t:(s.value=t,cR.delete(s),cw.delete(s))):s instanceof c_?s.value=void 0:(s.value=void 0,cR.delete(s),cw.delete(s))}}},cx={"!":e=>!e,"!!":e=>!!e,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,"??":(e,t)=>null!=e?e:t,"|":(e,t)=>{var i;return null==(i=cL[t])?void 0:i.call(cL,e)}};function cO(e,t={}){var i,r,a,s,n,o,l;let d=(function(e,t){let i,r,a,s=[];for(;e;){for(let s in a=null,i=e.length,t)(r=t[s].exec(e))&&r.index<i&&(a={token:r[0],type:s,matches:r.slice(1)},i=r.index);i&&s.push({token:e.substr(0,i),type:void 0}),a&&s.push(a),e=e.substr(i+(a?a.token.length:0))}return s})(e,{boolean:/true|false/,number:/-?\d+\.?\d*/,string:/(["'])((?:\\.|[^\\])*?)\1/,operator:/[!=><][=!]?|\?\?|\|/,ws:/\s+/,param:/[$a-z_][$\w]*/i}).filter(({type:e})=>"ws"!==e);if(0===d.length||d.some(({type:e})=>!e))return cP(e);if((null==(i=d[0])?void 0:i.token)===">"){let i=t[null==(r=d[1])?void 0:r.token];if(!i)return cP(e);let o={...t};i.state=o;let l=d.slice(2);for(let e=0;e<l.length;e+=3){let i=null==(a=l[e])?void 0:a.token,r=null==(s=l[e+1])?void 0:s.token,d=null==(n=l[e+2])?void 0:n.token;i&&"="===r&&(o[i]=cU(d,t))}return i}if(1===d.length)return cN(d[0])?cU(d[0].token,t):cP(e);if(2===d.length){let i=null==(o=d[0])?void 0:o.token,r=cx[i];if(!r||!cN(d[1]))return cP(e);let a=cU(d[1].token,t);return r(a)}if(3===d.length){let i=null==(l=d[1])?void 0:l.token,r=cx[i];if(!r||!cN(d[0])||!cN(d[2]))return cP(e);let a=cU(d[0].token,t);if("|"===i)return r(a,d[2].token);let s=cU(d[2].token,t);return r(a,s)}}function cP(e){return console.warn(`Warning: invalid expression \`${e}\``),!1}function cN({type:e}){return["number","boolean","string","param"].includes(e)}function cU(e,t){let i=e[0],r=e.slice(-1);return"true"===e||"false"===e?"true"===e:i===r&&["'",'"'].includes(i)?e.slice(1,-1):R(e)?parseFloat(e):t[e]}var cF=Object.defineProperty,cB=(e,t,i)=>t in e?cF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,c$=(e,t,i)=>(cB(e,"symbol"!=typeof t?t+"":t,i),i),cV=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cH=(e,t,i)=>(cV(e,t,"read from private field"),i?i.call(e):t.get(e)),cG=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},cW=(e,t,i,r)=>(cV(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),cK=(e,t,i)=>(cV(e,t,"access private method"),i);let cq={mediatargetlivewindow:"targetlivewindow",mediastreamtype:"streamtype"},cj=Z.createElement("template");cj.innerHTML=`
  <style>
    :host {
      display: inline-block;
      line-height: 0;
    }

    media-controller {
      width: 100%;
      height: 100%;
    }

    media-controller:not([mediasubtitleslist]) media-captions-selectmenu,
    media-captions-button:not([mediasubtitleslist]),
    media-rendition-selectmenu[mediarenditionunavailable],
    media-audio-track-selectmenu[mediaaudiotrackunavailable],
    media-volume-range[mediavolumeunavailable],
    media-airplay-button[mediaairplayunavailable],
    media-fullscreen-button[mediafullscreenunavailable],
    media-cast-button[mediacastunavailable],
    media-pip-button[mediapipunavailable] {
      display: none;
    }
  </style>
`;class cY extends Q.HTMLElement{constructor(){super(),cG(this,mn),cG(this,ml),c$(this,"renderRoot"),c$(this,"renderer"),cG(this,mr,void 0),cG(this,ma,void 0),cG(this,ms,void 0),this.shadowRoot?this.renderRoot=this.shadowRoot:(this.renderRoot=this.attachShadow({mode:"open"}),this.createRenderer());let e=new MutationObserver(e=>{var t;(!this.mediaController||(null==(t=this.mediaController)?void 0:t.breakpointsComputed))&&e.some(e=>{let t=e.target;return t===this||"media-controller"===t.localName&&!!(cq[e.attributeName]||e.attributeName.startsWith("breakpoint"))})&&this.render()});e.observe(this,{attributes:!0}),e.observe(this.renderRoot,{attributes:!0,subtree:!0}),this.addEventListener(f.BREAKPOINTS_COMPUTED,this.render),cK(this,mn,mo).call(this,"template")}get mediaController(){return this.renderRoot.querySelector("media-controller")}get template(){var e;return null!=(e=cH(this,mr))?e:this.constructor.template}set template(e){cW(this,ms,null),cW(this,mr,e),this.createRenderer()}get props(){var e,t,i;let r=[...Array.from(null!=(t=null==(e=this.mediaController)?void 0:e.attributes)?t:[]).filter(({name:e})=>cq[e]||e.startsWith("breakpoint")),...Array.from(this.attributes)],a={};for(let e of r){let t=null!=(i=cq[e.name])?i:e.name.replace(/[-_]([a-z])/g,(e,t)=>t.toUpperCase()),{value:r}=e;null!=r?(R(r)&&(r=parseFloat(r)),a[t]=""===r||r):a[t]=!1}return a}attributeChangedCallback(e,t,i){"template"===e&&t!=i&&cK(this,ml,md).call(this)}connectedCallback(){cK(this,ml,md).call(this)}createRenderer(){this.template&&this.template!==cH(this,ma)&&(cW(this,ma,this.template),this.renderer=new cg(this.template,this.props,this.constructor.processor),this.renderRoot.textContent="",this.renderRoot.append(cj.content.cloneNode(!0),this.renderer))}render(){var e;null==(e=this.renderer)||e.update(this.props)}}async function cz(e){let t=await fetch(e);if(200!==t.status)throw Error(`Failed to load resource: the server responded with a status of ${t.status}`);return t.text()}mr=new WeakMap,ma=new WeakMap,ms=new WeakMap,mn=new WeakSet,mo=function(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}},ml=new WeakSet,md=function(){var e;let t=this.getAttribute("template");if(!t||t===cH(this,ms))return;let i=this.getRootNode(),r=null==(e=null==i?void 0:i.getElementById)?void 0:e.call(i,t);if(r){cW(this,ms,t),cW(this,mr,r),this.createRenderer();return}(function(e){if(!/^(\/|\.\/|https?:\/\/)/.test(e))return!1;let t=/^https?:\/\//.test(e)?void 0:location.origin;try{new URL(e,t)}catch(e){return!1}return!0})(t)&&(cW(this,ms,t),cz(t).then(e=>{let t=Z.createElement("template");t.innerHTML=e,cW(this,mr,t),this.createRenderer()}).catch(console.error))},c$(cY,"template"),c$(cY,"observedAttributes",["template"]),c$(cY,"processor",cM),Q.customElements.get("media-theme")||Q.customElements.define("media-theme",cY);var cX=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cQ=(e,t,i)=>(cX(e,t,"read from private field"),i?i.call(e):t.get(e)),cZ=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},cJ=(e,t,i,r)=>(cX(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),c0=(e,t,i)=>(cX(e,t,"access private method"),i),c1=class{addEventListener(){}removeEventListener(){}dispatchEvent(e){return!0}};"undefined"==typeof DocumentFragment&&(globalThis.DocumentFragment=class extends c1{});var c2,c3,c4,c5,c8,c9,c6,c7,me,mt,mi,mr,ma,ms,mn,mo,ml,md,mu,mh=class extends c1{},mc=class{constructor(e,t={}){cZ(this,mu,void 0),cJ(this,mu,null==t?void 0:t.detail)}get detail(){return cQ(this,mu)}initCustomEvent(){}};mu=new WeakMap;var mm={document:{createElement:function(e,t){return new mh}},DocumentFragment,customElements:{get(e){},define(e,t,i){},upgrade(e){},whenDefined:e=>Promise.resolve(mh)},CustomEvent:mc,EventTarget:c1,HTMLElement:mh,HTMLVideoElement:class extends c1{}},mf="undefined"==typeof window||void 0===globalThis.customElements,mp=mf?mm:globalThis,mg=mf?mm.document:globalThis.document,mv={code:"en"};function mE(e,t=!0){var i;let r=t&&null!=(i=null==mv?void 0:mv[e])?i:e,a=t?mv.code:"en";return new mb(r,a)}var mb=class{constructor(e,t=null!=(mk=mv.code)?mk:"en"){this.message=e,this.locale=t}format(e){return this.message.replace(/\{(\w+)\}/g,(t,i)=>{var r;return null!=(r=e[i])?r:""})}toString(){return this.message}};function my(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function mT(e){return e.replace(/[-_]([a-z])/g,(e,t)=>t.toUpperCase())}function mA(e){if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}function m_(e){let t=(function(e){let t={};for(let i in e)null!=e[i]&&(t[i]=e[i]);return new URLSearchParams(t)})(e).toString();return t?"?"+t:""}function mS(e){let t=(null!=e?e:"").split(".")[1];return t?JSON.parse(decodeURIComponent(atob(t.replace(/-/g,"+").replace(/_/g,"/")).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))):{}}var mk,mL,mI,mR,mw=(e,t)=>!!e&&!!t&&(!!e.contains(t)||mw(e,t.getRootNode().host)),mD="mux.com",mC=(()=>{try{return"2.0.1"}catch{}return"UNKNOWN"})(),mM=(e,{maxResolution:t,token:i,domain:r=mD}={})=>`https://stream.${r}/${e}.m3u8${m_(i?{token:i}:{redundant_streams:!0,...t?{max_resolution:t}:{}})}`,mx=(e,{token:t,thumbnailTime:i,domain:r=mD}={})=>{let a=null==t?i:void 0,{aud:s}=mS(t);if(!(t&&"t"!==s))return`https://image.${r}/${e}/thumbnail.webp${m_({token:t,time:a})}`},mO=(e,{token:t,domain:i=mD}={})=>{let{aud:r}=mS(t);if(!(t&&"s"!==r))return`https://image.${i}/${e}/storyboard.vtt${m_({token:t,format:"webp"})}`},mP=e=>{if(e){if([lu.LIVE,lu.ON_DEMAND].includes(e))return e;if(null!=e&&e.includes("live"))return lu.LIVE}},mN={crossorigin:"crossOrigin",playsinline:"playsInline"},mU=class{constructor(e,t){cZ(this,mL,void 0),cZ(this,mI,void 0),cZ(this,mR,[]),cJ(this,mL,e),cJ(this,mI,t)}[Symbol.iterator](){return cQ(this,mR).values()}get length(){return cQ(this,mR).length}get value(){var e;return null!=(e=cQ(this,mR).join(" "))?e:""}set value(e){var t;e!==this.value&&(cJ(this,mR,[]),this.add(...null!=(t=null==e?void 0:e.split(" "))?t:[]))}toString(){return this.value}item(e){return cQ(this,mR)[e]}values(){return cQ(this,mR).values()}keys(){return cQ(this,mR).keys()}forEach(e){cQ(this,mR).forEach(e)}add(...e){var t,i;e.forEach(e=>{this.contains(e)||cQ(this,mR).push(e)}),(""!==this.value||null!=(t=cQ(this,mL))&&t.hasAttribute(`${cQ(this,mI)}`))&&null!=(i=cQ(this,mL))&&i.setAttribute(`${cQ(this,mI)}`,`${this.value}`)}remove(...e){var t;e.forEach(e=>{cQ(this,mR).splice(cQ(this,mR).indexOf(e),1)}),null==(t=cQ(this,mL))||t.setAttribute(`${cQ(this,mI)}`,`${this.value}`)}contains(e){return cQ(this,mR).includes(e)}toggle(e,t){return void 0!==t?t?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,t){this.remove(e),this.add(t)}};mL=new WeakMap,mI=new WeakMap,mR=new WeakMap;var mF=`[mux-player ${mC}]`;function mB(...e){console.warn(mF,...e)}function m$(...e){console.error(mF,...e)}function mV(e){var t;let i=null!=(t=e.message)?t:"";e.context&&(i+=` ${e.context}`),e.file&&(i+=` ${mE("Read more: ")}
https://github.com/muxinc/elements/blob/main/errors/${e.file}`),mB(i)}var mH={AUTOPLAY:"autoplay",CROSSORIGIN:"crossorigin",LOOP:"loop",MUTED:"muted",PLAYSINLINE:"playsinline",PRELOAD:"preload"},mG={VOLUME:"volume",PLAYBACKRATE:"playbackrate",MUTED:"muted"},mW=Object.freeze({length:0,start(e){let t=e>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(e){let t=e>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0}}),mK=hm.filter(e=>"error"!==e),mq=Object.values(mH).filter(e=>![mH.PLAYSINLINE].includes(e)),mj=Object.values(mG);function mY(e,t){return e.media?e.media.getAttribute(t):e.getAttribute(t)}var mz=class extends mp.HTMLElement{static get observedAttributes(){return[...mq,...mj]}constructor(){super(),this.querySelectorAll(":scope > track").forEach(e=>{var t;null==(t=this.media)||t.append(e.cloneNode())}),new MutationObserver(e=>{for(let t of e)"childList"===t.type&&(t.removedNodes.forEach(e=>{var t,i;let r=null==(t=this.media)?void 0:t.querySelector(`track[src="${e.src}"]`);r&&(null==(i=this.media)||i.removeChild(r))}),t.addedNodes.forEach(e=>{var t;null==(t=this.media)||t.append(e.cloneNode())}))}).observe(this,{childList:!0,subtree:!0})}attributeChangedCallback(e,t,i){var r,a;switch(e){case mG.MUTED:this.media&&(this.media.muted=null!=i,this.media.defaultMuted=null!=i);return;case mG.VOLUME:{let e=null!=(r=mA(i))?r:1;this.media&&(this.media.volume=e);return}case mG.PLAYBACKRATE:{let e=null!=(a=mA(i))?a:1;this.media&&(this.media.playbackRate=e,this.media.defaultPlaybackRate=e);return}}}play(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.play())?t:Promise.reject()}pause(){var e;null==(e=this.media)||e.pause()}requestCast(e){var t;return null==(t=this.media)?void 0:t.requestCast(e)}get media(){var e;return null==(e=this.shadowRoot)?void 0:e.querySelector("mux-video")}get audioTracks(){return this.media.audioTracks}get videoTracks(){return this.media.videoTracks}get audioRenditions(){return this.media.audioRenditions}get videoRenditions(){return this.media.videoRenditions}get paused(){var e,t;return null==(t=null==(e=this.media)?void 0:e.paused)||t}get duration(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.duration)?t:NaN}get ended(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.ended)&&t}get buffered(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.buffered)?t:mW}get seekable(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.seekable)?t:mW}get readyState(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.readyState)?t:0}get videoWidth(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.videoWidth)?t:0}get videoHeight(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.videoHeight)?t:0}get currentTime(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.currentTime)?t:0}set currentTime(e){this.media&&(this.media.currentTime=Number(e))}get volume(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.volume)?t:1}set volume(e){this.media&&(this.media.volume=Number(e))}get playbackRate(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.playbackRate)?t:1}set playbackRate(e){this.media&&(this.media.playbackRate=Number(e))}get defaultPlaybackRate(){var e;return null!=(e=mA(this.getAttribute(mG.PLAYBACKRATE)))?e:1}set defaultPlaybackRate(e){null!=e?this.setAttribute(mG.PLAYBACKRATE,`${e}`):this.removeAttribute(mG.PLAYBACKRATE)}get crossOrigin(){return mY(this,mH.CROSSORIGIN)}set crossOrigin(e){this.setAttribute(mH.CROSSORIGIN,`${e}`)}get autoplay(){return null!=mY(this,mH.AUTOPLAY)}set autoplay(e){e?this.setAttribute(mH.AUTOPLAY,"string"==typeof e?e:""):this.removeAttribute(mH.AUTOPLAY)}get loop(){return null!=mY(this,mH.LOOP)}set loop(e){e?this.setAttribute(mH.LOOP,""):this.removeAttribute(mH.LOOP)}get muted(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.muted)&&t}set muted(e){this.media&&(this.media.muted=!!e)}get defaultMuted(){return null!=mY(this,mH.MUTED)}set defaultMuted(e){e?this.setAttribute(mH.MUTED,""):this.removeAttribute(mH.MUTED)}get playsInline(){return null!=mY(this,mH.PLAYSINLINE)}set playsInline(e){m$("playsInline is set to true by default and is not currently supported as a setter.")}get preload(){return this.media?this.media.preload:this.getAttribute("preload")}set preload(e){["","none","metadata","auto"].includes(e)?this.setAttribute(mH.PRELOAD,e):this.removeAttribute(mH.PRELOAD)}},mX=`:host {
  --media-control-display: var(--controls);
  --media-loading-indicator-display: var(--loading-indicator);
  --media-dialog-display: var(--dialog);
  --media-play-button-display: var(--play-button);
  --media-live-button-display: var(--live-button);
  --media-seek-backward-button-display: var(--seek-backward-button);
  --media-seek-forward-button-display: var(--seek-forward-button);
  --media-mute-button-display: var(--mute-button);
  --media-captions-button-display: var(--captions-button);
  --media-captions-selectmenu-display: var(--captions-selectmenu, var(--media-captions-button-display));
  --media-rendition-selectmenu-display: var(--rendition-selectmenu);
  --media-audio-track-selectmenu-display: var(--audio-track-selectmenu);
  --media-airplay-button-display: var(--airplay-button);
  --media-pip-button-display: var(--pip-button);
  --media-fullscreen-button-display: var(--fullscreen-button);
  --media-cast-button-display: var(--cast-button);
  --media-playback-rate-button-display: var(--playback-rate-button);
  --media-volume-range-display: var(--volume-range);
  --media-time-range-display: var(--time-range);
  --media-time-display-display: var(--time-display);
  --media-duration-display-display: var(--duration-display);
  --media-title-display-display: var(--title-display);

  display: inline-block;
  width: 100%;
  line-height: 0;
}

/* Hide custom elements that are not defined yet */
:not(:defined) {
  display: none;
}

a {
  color: #fff;
  font-size: 0.9em;
  text-decoration: underline;
}

media-theme {
  width: 100%;
  height: 100%;
  direction: ltr;
}

media-poster-image {
  width: 100%;
  height: 100%;
}

media-poster-image:not([src]):not([placeholdersrc]) {
  display: none;
}

::part(top),
[part~='top'] {
  --media-control-display: var(--controls, var(--top-controls));
  --media-play-button-display: var(--play-button, var(--top-play-button));
  --media-live-button-display: var(--live-button, var(--top-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--top-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--top-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--top-mute-button));
  --media-captions-button-display: var(--captions-button, var(--top-captions-button));
  --media-captions-selectmenu-display: var(
    --captions-selectmenu,
    var(--media-captions-button-display, var(--top-captions-selectmenu))
  );
  --media-rendition-selectmenu-display: var(--rendition-selectmenu, var(--top-rendition-selectmenu));
  --media-audio-track-selectmenu-display: var(--audio-track-selectmenu, var(--top-audio-track-selectmenu));
  --media-airplay-button-display: var(--airplay-button, var(--top-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--top-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--top-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--top-cast-button));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--top-playback-rate-button));
  --media-volume-range-display: var(--volume-range, var(--top-volume-range));
  --media-time-range-display: var(--time-range, var(--top-time-range));
  --media-time-display-display: var(--time-display, var(--top-time-display));
  --media-duration-display-display: var(--duration-display, var(--top-duration-display));
  --media-title-display-display: var(--title-display, var(--top-title-display));
}

::part(center),
[part~='center'] {
  --media-control-display: var(--controls, var(--center-controls));
  --media-play-button-display: var(--play-button, var(--center-play-button));
  --media-live-button-display: var(--live-button, var(--center-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--center-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--center-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--center-mute-button));
  --media-captions-button-display: var(--captions-button, var(--center-captions-button));
  --media-captions-selectmenu-display: var(
    --captions-selectmenu,
    var(--media-captions-button-display, var(--center-captions-selectmenu))
  );
  --media-rendition-selectmenu-display: var(--rendition-selectmenu, var(--center-rendition-selectmenu));
  --media-audio-track-selectmenu-display: var(--audio-track-selectmenu, var(--center-audio-track-selectmenu));
  --media-airplay-button-display: var(--airplay-button, var(--center-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--center-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--center-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--center-cast-button));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--center-playback-rate-button));
  --media-volume-range-display: var(--volume-range, var(--center-volume-range));
  --media-time-range-display: var(--time-range, var(--center-time-range));
  --media-time-display-display: var(--time-display, var(--center-time-display));
  --media-duration-display-display: var(--duration-display, var(--center-duration-display));
}

::part(bottom),
[part~='bottom'] {
  --media-control-display: var(--controls, var(--bottom-controls));
  --media-play-button-display: var(--play-button, var(--bottom-play-button));
  --media-live-button-display: var(--live-button, var(--bottom-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--bottom-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--bottom-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--bottom-mute-button));
  --media-captions-button-display: var(--captions-button, var(--bottom-captions-button));
  --media-captions-selectmenu-display: var(
    --captions-selectmenu,
    var(--media-captions-button-display, var(--bottom-captions-selectmenu))
  );
  --media-rendition-selectmenu-display: var(--rendition-selectmenu, var(--bottom-rendition-selectmenu));
  --media-audio-track-selectmenu-display: var(--audio-track-selectmenu, var(--bottom-audio-track-selectmenu));
  --media-airplay-button-display: var(--airplay-button, var(--bottom-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--bottom-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--bottom-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--bottom-cast-button));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--bottom-playback-rate-button));
  --media-volume-range-display: var(--volume-range, var(--bottom-volume-range));
  --media-time-range-display: var(--time-range, var(--bottom-time-range));
  --media-time-display-display: var(--time-display, var(--bottom-time-display));
  --media-duration-display-display: var(--duration-display, var(--bottom-duration-display));
  --media-title-display-display: var(--title-display, var(--bottom-title-display));
}
`,mQ=`
  :host {
    z-index: 100;
    display: var(--media-dialog-display, flex);
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    box-sizing: border-box;
    color: #fff;
    line-height: 18px;
    font-family: Arial, sans-serif;
    padding: var(--media-dialog-backdrop-padding, 0);
    background: var(--media-dialog-backdrop-background,
      linear-gradient(to bottom, rgba(20, 20, 30, 0.7) 50%, rgba(20, 20, 30, 0.9))
    );
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-open, visibility .2s, opacity .2s) !important;
    transform: var(--media-dialog-transform-open, none) !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  :host(:not([open])) {
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-close, visibility .1s, opacity .1s) !important;
    transform: var(--media-dialog-transform-close, none) !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }

  :focus-visible {
    box-shadow: 0 0 0 2px rgba(27, 127, 204, 0.9);
  }

  .dialog {
    position: relative;
    box-sizing: border-box;
    background: var(--media-dialog-background, none);
    padding: var(--media-dialog-padding, 10px);
    width: min(320px, 100%);
    word-wrap: break-word;
    max-height: 100%;
    overflow: auto;
    text-align: center;
    line-height: 1.4;
  }
`,mZ=mg.createElement("template");mZ.innerHTML=`
  <style>
    ${mQ}
  </style>

  <div class="dialog">
    <slot></slot>
  </div>
`;var mJ=class extends mp.HTMLElement{constructor(){var e;super(),this.attachShadow({mode:"open"}),null==(e=this.shadowRoot)||e.appendChild(this.constructor.template.content.cloneNode(!0))}show(){this.setAttribute("open",""),this.dispatchEvent(new CustomEvent("open",{composed:!0,bubbles:!0})),m0(this)}close(){this.hasAttribute("open")&&(this.removeAttribute("open"),this.dispatchEvent(new CustomEvent("close",{composed:!0,bubbles:!0})),this._previouslyFocusedElement instanceof HTMLElement&&this._previouslyFocusedElement.focus())}attributeChangedCallback(e,t,i){"open"===e&&t!==i&&(null!=i?this.show():this.close())}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","dialog"),this.hasAttribute("open")&&m0(this)}};function m0(e){let t=new CustomEvent("initfocus",{composed:!0,bubbles:!0,cancelable:!0});if(e.dispatchEvent(t),t.defaultPrevented)return;let i=e.querySelector("[autofocus]:not([disabled])");!i&&e.tabIndex>=0&&(i=e),i||(i=function e(t){let i=["button","input","keygen","select","textarea"].map(function(e){return e+":not([disabled])"});i.push('[tabindex]:not([disabled]):not([tabindex=""])');let r=null==t?void 0:t.querySelector(i.join(", "));if(!r&&"attachShadow"in Element.prototype){let i=(null==t?void 0:t.querySelectorAll("*"))||[];for(let t=0;t<i.length&&!(i[t].tagName&&i[t].shadowRoot&&(r=e(i[t].shadowRoot)));t++);}return r}(e.shadowRoot)),e._previouslyFocusedElement=mg.activeElement,mg.activeElement instanceof HTMLElement&&mg.activeElement.blur(),e.addEventListener("transitionend",()=>{i instanceof HTMLElement&&i.focus({preventScroll:!0})},{once:!0})}mJ.styles=mQ,mJ.template=mZ,mJ.observedAttributes=["open"],mp.customElements.get("media-dialog")||(mp.customElements.define("media-dialog",mJ),mp.MediaDialog=mJ);var m1=mJ,m2=mg.createElement("template");m2.innerHTML=`
  <style>
    ${m1.styles}

    .close {
      background: none;
      color: inherit;
      border: none;
      padding: 0;
      font: inherit;
      cursor: pointer;
      outline: inherit;
      width: 28px;
      height: 28px;
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
  </style>

  <div class="dialog">
    <slot></slot>
  </div>

  <slot name="close">
    <button class="close" tabindex="0">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </slot>
`;var m3=class extends m1{constructor(){var e,t;super(),null==(t=null==(e=this.shadowRoot)?void 0:e.querySelector(".close"))||t.addEventListener("click",()=>{this.close()})}};m3.template=m2,mp.customElements.get("mxp-dialog")||(mp.customElements.define("mxp-dialog",m3),mp.MxpDialog=m3);var m4=new WeakMap,m5=class{constructor(e,t){this.element=e,this.type=t,this.element.addEventListener(this.type,this);let i=m4.get(this.element);i&&i.set(this.type,this)}set(e){if("function"==typeof e)this.handleEvent=e.bind(this.element);else if("object"==typeof e&&"function"==typeof e.handleEvent)this.handleEvent=e.handleEvent.bind(e);else{this.element.removeEventListener(this.type,this);let e=m4.get(this.element);e&&e.delete(this.type)}}static for(e){m4.has(e.element)||m4.set(e.element,new Map);let t=e.attributeName.slice(2),i=m4.get(e.element);return i&&i.has(t)?i.get(t):new m5(e.element,t)}},m8=new Map,m9=new WeakMap,m6=new WeakMap,m7=class{constructor(e,t,i){this.strings=e,this.values=t,this.processor=i,this.stringsKey=this.strings.join("\x01")}get template(){if(m8.has(this.stringsKey))return m8.get(this.stringsKey);{let e=mg.createElement("template"),t=this.strings.length-1;return e.innerHTML=this.strings.reduce((e,i,r)=>e+i+(r<t?`{{ ${r} }}`:""),""),m8.set(this.stringsKey,e),e}}renderInto(e){var t;let i=this.template;if(m9.get(e)!==i){m9.set(e,i);let t=new cg(i,this.values,this.processor);m6.set(e,t),e instanceof cS?e.replace(...t.children):e.appendChild(t);return}let r=m6.get(e);null==(t=null==r?void 0:r.update)||t.call(r,this.values)}},fe={processCallback(e,t,i){var r,a,s;if(i)for(let[e,n]of t){e in i&&(function(e,t){if(e instanceof c_&&t instanceof Element){let i=e.element;return i[e.attributeName]!==t&&(e.element.removeAttributeNS(e.attributeNamespace,e.attributeName),i[e.attributeName]=t),!0}return!1}(a=n,s=null!=(r=i[e])?r:"")||function(e,t){if("boolean"==typeof t&&e instanceof c_){let i=e.attributeNamespace;return t!==e.element.hasAttributeNS(i,e.attributeName)&&(e.booleanValue=t),!0}return!1}(a,s)||a instanceof c_&&a.attributeName.startsWith("on")&&(m5.for(a).set(s),a.element.removeAttributeNS(a.attributeNamespace,a.attributeName),1)||!1===s&&a instanceof cS&&(a.replace(""),1)||s instanceof m7&&a instanceof cS&&(s.renderInto(a),1)||s instanceof DocumentFragment&&a instanceof cS&&(s.childNodes.length&&a.replace(...s.childNodes),1)||function(e,t){if(e instanceof c_){let i=e.attributeNamespace,r=e.element.getAttributeNS(i,e.attributeName);return String(t)!==r&&(e.value=String(t))}e.value=String(t)}(a,s))}}};function ft(e,...t){return new m7(e,t,fe)}var fi=e=>ft`
  <style>
    ${mX}
  </style>
  ${fa(e)}
`,fr=e=>{let t=e.hotKeys?`${e.hotKeys}`:"";return"live"===mP(e.streamType)&&(t+=" noarrowleft noarrowright"),t},fa=e=>{var t,i,r,a,s,n,o,l,d,u,h,c,m,f,p,g,v,E,b,y,T,A,_,S,k,L,I,R,w,D,C,M,x,O;return ft`
  <media-theme
    template="${e.themeTemplate||!1}"
    defaultstreamtype="${null!=(t=e.defaultStreamType)&&t}"
    hotkeys="${fr(e)||!1}"
    nohotkeys="${e.noHotKeys||!e.hasSrc||e.isDialogOpen||!1}"
    noautoseektolive="${!!(null!=(i=e.streamType)&&i.includes(lu.LIVE))&&0!==e.targetLiveWindow}"
    novolumepref="${e.novolumepref||!1}"
    disabled="${!e.hasSrc||e.isDialogOpen}"
    audio="${null!=(r=e.audio)&&r}"
    style="${null!=(a=function(e){let t="";return Object.entries(e).forEach(([e,i])=>{null!=i&&(t+=`${my(e)}: ${i}; `)}),t?t.trim():void 0}({"--media-primary-color":e.primaryColor,"--media-secondary-color":e.secondaryColor,"--media-accent-color":e.accentColor}))&&a}"
    defaultsubtitles="${!e.defaultHiddenCaptions}"
    forwardseekoffset="${null!=(s=e.forwardSeekOffset)&&s}"
    backwardseekoffset="${null!=(n=e.backwardSeekOffset)&&n}"
    playbackrates="${null!=(o=e.playbackRates)&&o}"
    defaultshowremainingtime="${null!=(l=e.defaultShowRemainingTime)&&l}"
    hideduration="${null!=(d=e.hideDuration)&&d}"
    title="${null!=(u=e.title)&&u}"
    exportparts="top, center, bottom, layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer, controller, poster, live, play, button, seek-backward, seek-forward, mute, captions, airplay, pip, fullscreen, cast, playback-rate, volume, range, time, display, control-bar"
  >
    <mux-video
      slot="media"
      target-live-window="${null!=(h=e.targetLiveWindow)&&h}"
      stream-type="${null!=(c=mP(e.streamType))&&c}"
      crossorigin="${null!=(m=e.crossOrigin)?m:""}"
      playsinline
      autoplay="${null!=(f=e.autoplay)&&f}"
      muted="${null!=(p=e.muted)&&p}"
      loop="${null!=(g=e.loop)&&g}"
      preload="${null!=(v=e.preload)&&v}"
      debug="${null!=(E=e.debug)&&E}"
      prefer-cmcd="${null!=(b=e.preferCmcd)&&b}"
      disable-cookies="${null!=(y=e.disableCookies)&&y}"
      prefer-playback="${null!=(T=e.preferPlayback)&&T}"
      start-time="${null!=e.startTime&&e.startTime}"
      beacon-collection-domain="${null!=(A=e.beaconCollectionDomain)&&A}"
      player-software-name="${null!=(_=e.playerSoftwareName)&&_}"
      player-software-version="${null!=(S=e.playerSoftwareVersion)&&S}"
      env-key="${null!=(k=e.envKey)&&k}"
      custom-domain="${null!=(L=e.customDomain)&&L}"
      src="${e.src?e.src:!!e.playbackId&&mM(e.playbackId,{maxResolution:e.maxResolution,domain:e.customDomain,token:e.tokens.playback})}"
      cast-src="${e.src?e.src:!!e.playbackId&&mM(e.playbackId,{maxResolution:e.maxResolution,domain:e.customDomain,token:e.tokens.playback})}"
      exportparts="video"
    >
      ${e.storyboard?ft`<track label="thumbnails" default kind="metadata" src="${e.storyboard}" />`:ft``}
    </mux-video>
    <slot name="poster" slot="poster">
      <media-poster-image
        part="poster"
        exportparts="poster, img"
        src="${""!==e.poster&&null!=(I=e.poster)&&I}"
        placeholdersrc="${null!=(R=e.placeholder)&&R}"
      ></media-poster-image>
    </slot>
    <mxp-dialog
      no-auto-hide
      open="${null!=(w=e.isDialogOpen)&&w}"
      onclose="${e.onCloseErrorDialog}"
      oninitfocus="${e.onInitFocusDialog}"
    >
      ${null!=(D=e.dialog)&&D.title?ft`<h3>${e.dialog.title}</h3>`:ft``}
      <p>
        ${null==(C=e.dialog)?void 0:C.message}
        ${null!=(M=e.dialog)&&M.linkUrl?ft`<a
              href="${e.dialog.linkUrl}"
              target="_blank"
              rel="external noopener"
              aria-label="${null!=(x=e.dialog.linkText)?x:""} ${mE("(opens in a new window)")}"
              >${null!=(O=e.dialog.linkText)?O:e.dialog.linkUrl}</a
            >`:ft``}
      </p>
    </mxp-dialog>
  </media-theme>
`};function fs(e,t,i,r,a){var s,n,o;let l={},d={};switch(e.code){case ln.MEDIA_ERR_NETWORK:switch(l.title=mE("Network Error",a),l.message=e.message,null==(s=e.data)?void 0:s.response.code){case 412:l.title=mE("Video is not currently available",a),l.message=mE("The live stream or video file are not yet ready.",a),d.message=mE("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",a),d.file="412-not-playable.md";break;case 404:l.title=mE("Video does not exist",a),l.message="",d.message=mE("This playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",a),d.file="404-not-found.md";break;case 403:{if(l.title=mE("Invalid playback URL",a),l.message=mE("The video URL or playback-token are formatted with incorrect or incomplete information.",a),d.message=mE("403 error trying to access this playback URL. If this is a signed URL, you might need to provide a playback-token.",a),d.file="missing-signed-tokens.md",!r)break;let{exp:e,aud:t,sub:s}=mS(r),n=Date.now()>1e3*e,o=s!==i,u="v"!==t,h={timeStyle:"medium",dateStyle:"medium"};if(n){l.title=mE("Video URL has expired",a),l.message=mE("The videos secured playback-token has expired.",a),d.message=mE("The videos secured playback-token has expired.",a),d.context=mE("Expired at: {expiredDate}. Current time: {currentDate}.",a).format({expiredDate:new Intl.DateTimeFormat(mv.code,h).format(1e3*e),currentDate:new Intl.DateTimeFormat(mv.code,h).format(Date.now())}),d.file="403-expired-token.md";break}if(o){l.title=mE("Video URL is formatted incorrectly",a),l.message=mE("The videos playback ID does not match the one encoded in the playback-token.",a),d.message=mE("The videos playback ID does not match the one encoded in the playback-token.",a),d.context=mE("Specified playback ID: {playbackId} and the playback ID encoded in the playback-token: {tokenPlaybackId}",a).format({playbackId:i,tokenPlaybackId:s}),d.file="403-playback-id-mismatch.md";break}if(u){l.title=mE("Video URL is formatted incorrectly",a),l.message=mE("The playback-token is formatted with incorrect information.",a),d.message=mE("The playback-token is formatted with incorrect information.",a),d.context=mE("The playback-token has an incorrect aud value: {tokenType}. aud value should be v.",a).format({tokenType:t}),d.file="403-incorrect-aud-value.md";break}d.message=mE("403 error trying to access this playback URL. If this is a signed playback ID, the token might not have been generated correctly.",a),d.file="403-malformatted-token.md"}}break;case ln.MEDIA_ERR_DECODE:{let{message:t}=e;l={title:mE("Media Error",a),message:t},d.file="media-decode-error.md";break}case ln.MEDIA_ERR_SRC_NOT_SUPPORTED:{let s=null==(o=null==(n=e.data)?void 0:n.response)?void 0:o.code;if(s>=400&&s<500){e.code=ln.MEDIA_ERR_NETWORK,e.data={response:{code:s}},{dialog:l,devlog:d}=fs(e,t,i,r);break}l={title:mE("Source Not Supported",a),message:e.message},d.file="media-src-not-supported.md";break}default:l={title:mE("Error",a),message:e.message}}return t&&(l={title:mE("Your device appears to be offline",a),message:mE("Check your internet connection and try reloading this video.",a)}),{dialog:l,devlog:d}}var fn=`<template id="media-theme-gerwig">
  <style>
    @keyframes pre-play-hide {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      30% {
        transform: scale(0.7);
      }

      100% {
        transform: scale(1.5);
        opacity: 0;
      }
    }

    :host {
      --_primary-color: var(--media-primary-color, #fff);
      --_secondary-color: var(--media-secondary-color, transparent);
      --_accent-color: var(--media-accent-color, #fa50b5);
      --_text-color: var(--media-text-color, #000);

      --media-icon-color: var(--_primary-color);
      --media-control-background: var(--_secondary-color);
      --media-control-hover-background: var(--_accent-color);
      --media-time-buffered-color: rgba(255, 255, 255, 0.4);
      --media-preview-thumbnail-border: 0;
      --media-preview-thumbnail-border-radius: 2px 2px 0 0;
      --media-preview-time-border-radius: 0 0 2px 2px;
      --media-preview-time-margin: 0 0 8px;
      --media-preview-time-text-shadow: none;
      --media-control-height: 14px;
      --media-control-padding: 6px;

      color: var(--_primary-color);
      display: inline-block;
      width: 100%;
      height: 100%;
    }

    :host([audio]) {
      --media-preview-time-border-radius: 3px;
      --media-preview-time-margin: 0 0 5px;
      --media-preview-time-text-shadow: none;
    }

    :host([audio]) ::slotted([slot='media']) {
      height: 0px;
    }

    :host([audio]) media-loading-indicator {
      display: none;
    }

    :host([audio]) media-controller {
      background: transparent;
    }

    :host([audio]) media-controller::part(vertical-layer) {
      background: transparent;
    }

    :host([audio]) media-control-bar {
      width: 100%;
    }

    /*
     * 0.433s is the transition duration for VTT Regions.
     * Borrowed here, so the captions don't move too fast.
     */
    media-controller ::slotted([slot='media']) {
      --media-webkit-text-track-transition: transform 0.433s ease-out 0.3s;
    }
    media-controller:is([mediapaused], :not([userinactive])) ::slotted([slot='media']) {
      --media-webkit-text-track-transform: translateY(-50px);
      --media-webkit-text-track-transition: transform 0.15s ease;
    }

    media-time-range {
      --media-range-bar-color: var(--_accent-color);
      --media-time-range-buffered-color: var(--_primary-color);
      --media-range-track-color: transparent;
      --media-range-track-background: rgba(255, 255, 255, 0.4);
      --media-range-thumb-background: radial-gradient(
        circle,
        #000 0%,
        #000 25%,
        var(--_accent-color) 25%,
        var(--_accent-color)
      );
      --media-range-thumb-width: 0;
      --media-range-thumb-height: 0;
      --media-range-thumb-transition: all 0.3s;
      --media-range-thumb-opacity: 1;
      --media-preview-thumbnail-background: var(--_primary-color);
      --media-preview-thumbnail-border: 5px solid var(--_primary-color);
      --media-preview-thumbnail-border-radius: 5px 5px 0 0;
      --media-preview-time-background: var(--_primary-color);
      --media-preview-time-border-radius: 0 0 5px 5px;
      --media-preview-time-margin: 0 0 10px;
      --media-preview-time-padding: 2px 0 6px;
      --media-text-color: var(--_text-color);
      --media-preview-thumbnail-max-width: 150px;
      --media-range-track-pointer-border-right: 2px solid #000;
      --media-control-hover-background: transparent;
      color: var(--_accent-color);
      padding: 0 6px;
    }

    :host([audio]) media-time-range {
      --media-preview-time-border-radius: 5px;
      --media-preview-time-padding: 5px;
    }

    media-time-range:hover {
      --media-range-thumb-width: 12px;
      --media-range-thumb-height: 12px;
    }

    media-time-range::part(preview-box)::after {
      position: absolute;
      content: '';
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 10px 8.5px 0 8.5px;
      border-color: var(--_primary-color) transparent transparent transparent;
      top: 100%;
      left: 50%;
      transform: translate(-50%, -10px);
    }

    :is(media-captions-listbox, media-rendition-listbox, media-audio-track-listbox)::part(indicator) {
      fill: var(--_accent-color);
    }

    :is(media-captions-listbox, media-rendition-listbox, media-audio-track-listbox)::part(option) {
      display: flex;
      align-items: center;
      padding: 8px 10px;
    }

    :is(media-captions-listbox, media-rendition-listbox, media-audio-track-listbox)::part(option-selected) {
      font-weight: 700;
    }

    media-captions-listbox,
    media-rendition-listbox,
    media-audio-track-listbox {
      border-radius: 2px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      bottom: calc(100% + 16px);
      padding: 10px;
    }

    media-captions-selectmenu,
    media-rendition-selectmenu,
    media-audio-track-selectmenu {
      --media-listbox-background: var(--_primary-color);
      --media-option-selected-background: transparent;
      --media-option-hover-background: transparent;
      --media-option-hover-outline: var(--_accent-color) solid 1px;
      --media-text-color: var(--_text-color);
    }

    /* The icon is a circle so make it 16px high instead of 14px for more balance. */
    media-audio-track-selectmenu {
      --media-control-padding: 5px;
      --media-control-height: 16px;
    }

    :host(:not([audio])) media-time-range {
      --media-range-padding: 0;
      background: transparent;
      z-index: 10;
      height: 10px;
      bottom: -3px;
      width: 100%;
    }

    media-control-bar :is([role='button'], [role='switch'], button) {
      line-height: 0;
    }

    media-control-bar :is([part*='button'], [part*='range'], [part*='display']) {
      border-radius: 3px;
    }

    .spacer {
      flex-grow: 1;
      background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
    }

    media-control-bar[slot~='top-chrome'] {
      min-height: 42px;
      pointer-events: none;
    }

    :host([title]:not([audio])) media-control-bar[slot='top-chrome']::before {
      content: '';
      position: absolute;
      width: 100%;
      padding-bottom: min(100px, 25%);
      background: linear-gradient(#000, transparent);
      opacity: 0.8;
    }

    :host(:not([audio])) media-control-bar[part~='bottom']::before {
      content: '';
      position: absolute;
      width: 100%;
      bottom: 0;
      left: 0;
      padding-bottom: min(100px, 25%);
      background: linear-gradient(transparent, #000);
      opacity: 0.8;
      z-index: 1;
    }

    media-control-bar[part~='bottom'] > * {
      z-index: 2;
    }

    media-control-bar[part~='bottom'] {
      padding: 6px 6px;
    }

    media-control-bar[slot~='top-chrome'] > * {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      position: relative;
    }

    media-controller::part(vertical-layer) {
      transition: background-color 1s;
    }

    media-controller:is([mediapaused], :not([userinactive]))::part(vertical-layer) {
      background-color: var(--controls-backdrop-color, var(--controls, transparent));
      transition: background-color 0.25s;
    }

    .center-controls {
      --media-button-icon-width: 100%;
      --media-button-icon-height: auto;
      pointer-events: none;
      width: 100%;
      display: flex;
      flex-flow: row;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));
      paint-order: stroke;
      stroke: rgba(102, 102, 102, 1);
      stroke-width: 0.3px;
      text-shadow: 0 0 2px rgb(0 0 0 / 0.25), 0 0 6px rgb(0 0 0 / 0.25);
    }

    .center-controls media-play-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      --media-control-padding: 0;
      width: 40px;
    }

    [breakpointsm] .center-controls media-play-button {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      transition: background 0.4s;
      padding: 24px;
      --media-control-background: #000;
      --media-control-hover-background: var(--_accent-color);
    }

    .center-controls media-seek-backward-button,
    .center-controls media-seek-forward-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      margin: 0 20px;
      width: max(33px, min(8%, 40px));
    }

    [breakpointsm]:not([audio]) .center-controls.pre-playback {
      display: grid;
      align-items: initial;
      justify-content: initial;
      height: 100%;
      overflow: hidden;
    }

    [breakpointsm]:not([audio]) .center-controls.pre-playback media-play-button {
      place-self: var(--_pre-playback-place, center);
      grid-area: 1 / 1;
      margin: 16px;
    }

    /* Show and hide controls or pre-playback state */

    [breakpointsm]:is([mediahasplayed], :not([mediapaused])):not([audio])
      .center-controls.pre-playback
      media-play-button {
      animation: 0.3s linear forwards pre-play-hide;
    }

    .autoplay-unmute {
      --media-control-hover-background: transparent;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));
    }

    .autoplay-unmute-btn {
      --media-control-height: 16px;
      border-radius: 8px;
      background: #000;
      color: var(--_primary-color);
      display: flex;
      align-items: center;
      padding: 8px 16px;
      font-size: 18px;
      font-weight: 500;
      cursor: pointer;
    }

    .autoplay-unmute-btn:hover {
      background: var(--_accent-color);
    }

    [breakpointsm] .autoplay-unmute-btn {
      --media-control-height: 30px;
      padding: 14px 24px;
      font-size: 26px;
    }

    .autoplay-unmute-btn svg {
      margin: 0 6px 0 0;
    }

    [breakpointsm] .autoplay-unmute-btn svg {
      margin: 0 10px 0 0;
    }

    media-controller:not([audio]):not([mediahasplayed]) *:is(media-control-bar, media-time-range) {
      display: none;
    }

    media-loading-indicator {
      --media-loading-icon-width: 100%;
      --media-button-icon-height: auto;
      display: var(--media-control-display, var(--media-loading-indicator-display, flex));
      pointer-events: none;
      position: absolute;
      width: min(15%, 150px);
      flex-flow: row;
      align-items: center;
      justify-content: center;
    }

    /* Intentionally don't target the div for transition but the children
		 of the div. Prevents messing with media-chrome's autohide feature. */
    media-loading-indicator + div * {
      transition: opacity 0.15s;
      opacity: 1;
    }

    media-loading-indicator[media-loading]:not([media-paused]) ~ div > * {
      opacity: 0;
      transition-delay: 400ms;
    }

    media-volume-range {
      width: min(100%, 100px);
      --media-range-thumb-width: 12px;
      --media-range-thumb-height: 12px;
      --media-range-thumb-background: radial-gradient(
        circle,
        #000 0%,
        #000 25%,
        var(--_primary-color) 25%,
        var(--_primary-color)
      );
      --media-control-hover-background: none;
    }

    media-time-display {
      white-space: nowrap;
    }

    /* Generic style for explicitly disabled controls */
    media-control-bar[part~='bottom'] [disabled],
    media-control-bar[part~='bottom'] [aria-disabled='true'] {
      opacity: 60%;
      cursor: not-allowed;
    }

    media-text-display {
      --media-font-size: 16px;
      --media-control-padding: 14px;
      font-weight: 500;
    }

    media-play-button.animated *:is(g, path) {
      transition: all 0.3s;
    }

    media-play-button.animated[mediapaused] .pause-icon-pt1 {
      opacity: 0;
    }

    media-play-button.animated[mediapaused] .pause-icon-pt2 {
      transform-origin: center center;
      transform: scaleY(0);
    }

    media-play-button.animated[mediapaused] .play-icon {
      clip-path: inset(0 0 0 0);
    }

    media-play-button.animated:not([mediapaused]) .play-icon {
      clip-path: inset(0 0 0 100%);
    }

    media-seek-forward-button,
    media-seek-backward-button {
      --media-font-weight: 400;
    }

    .mute-icon {
      display: inline-block;
    }

    .mute-icon :is(path, g) {
      transition: opacity 0.5s;
    }

    .muted {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='low'] :is(.volume-medium, .volume-high),
    media-mute-button[mediavolumelevel='medium'] :is(.volume-high) {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='off'] .unmuted {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='off'] .muted {
      opacity: 1;
    }
  </style>

  <template partial="TitleDisplay">
    <template if="title">
      <media-text-display part="top title display" class="title-display">{{title}}</media-text-display>
    </template>
  </template>

  <template partial="PlayButton">
    <media-play-button
      part="{{section ?? 'bottom'}} play button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
      class="animated"
    >
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="icon">
        <g class="play-icon">
          <path
            d="M15.5987 6.2911L3.45577 0.110898C2.83667 -0.204202 2.06287 0.189698 2.06287 0.819798V13.1802C2.06287 13.8103 2.83667 14.2042 3.45577 13.8891L15.5987 7.7089C16.2178 7.3938 16.2178 6.6061 15.5987 6.2911Z"
          />
        </g>
        <g class="pause-icon">
          <path
            class="pause-icon-pt1"
            d="M5.90709 0H2.96889C2.46857 0 2.06299 0.405585 2.06299 0.9059V13.0941C2.06299 13.5944 2.46857 14 2.96889 14H5.90709C6.4074 14 6.81299 13.5944 6.81299 13.0941V0.9059C6.81299 0.405585 6.4074 0 5.90709 0Z"
          />
          <path
            class="pause-icon-pt2"
            d="M15.1571 0H12.2189C11.7186 0 11.313 0.405585 11.313 0.9059V13.0941C11.313 13.5944 11.7186 14 12.2189 14H15.1571C15.6574 14 16.063 13.5944 16.063 13.0941V0.9059C16.063 0.405585 15.6574 0 15.1571 0Z"
          />
        </g>
      </svg>
    </media-play-button>
  </template>

  <template partial="PrePlayButton">
    <media-play-button
      part="{{section ?? 'center'}} play button pre-play"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="icon" style="transform: translate(3px, 0)">
        <path
          d="M15.5987 6.2911L3.45577 0.110898C2.83667 -0.204202 2.06287 0.189698 2.06287 0.819798V13.1802C2.06287 13.8103 2.83667 14.2042 3.45577 13.8891L15.5987 7.7089C16.2178 7.3938 16.2178 6.6061 15.5987 6.2911Z"
        />
      </svg>
    </media-play-button>
  </template>

  <template partial="SeekBackwardButton">
    <media-seek-backward-button
      seekoffset="{{backwardseekoffset}}"
      part="{{section ?? 'bottom'}} seek-backward button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg viewBox="0 0 22 14" aria-hidden="true" slot="icon">
        <path
          d="M3.65 2.07888L0.0864 6.7279C-0.0288 6.87812 -0.0288 7.12188 0.0864 7.2721L3.65 11.9211C3.7792 12.0896 4 11.9703 4 11.7321V2.26787C4 2.02968 3.7792 1.9104 3.65 2.07888Z"
        />
        <text transform="translate(6 12)" style="font-size: 14px; font-family: 'ArialMT', 'Arial'">
          {{backwardseekoffset}}
        </text>
      </svg>
    </media-seek-backward-button>
  </template>

  <template partial="SeekForwardButton">
    <media-seek-forward-button
      seekoffset="{{forwardseekoffset}}"
      part="{{section ?? 'bottom'}} seek-forward button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg viewBox="0 0 22 14" aria-hidden="true" slot="icon">
        <g>
          <text transform="translate(-1 12)" style="font-size: 14px; font-family: 'ArialMT', 'Arial'">
            {{forwardseekoffset}}
          </text>
          <path
            d="M18.35 11.9211L21.9136 7.2721C22.0288 7.12188 22.0288 6.87812 21.9136 6.7279L18.35 2.07888C18.2208 1.91041 18 2.02968 18 2.26787V11.7321C18 11.9703 18.2208 12.0896 18.35 11.9211Z"
          />
        </g>
      </svg>
    </media-seek-forward-button>
  </template>

  <template partial="MuteButton">
    <media-mute-button part="bottom mute button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" slot="icon" class="mute-icon" aria-hidden="true">
        <g class="unmuted">
          <path
            d="M6.76786 1.21233L3.98606 3.98924H1.19937C0.593146 3.98924 0.101743 4.51375 0.101743 5.1607V6.96412L0 6.99998L0.101743 7.03583V8.83926C0.101743 9.48633 0.593146 10.0108 1.19937 10.0108H3.98606L6.76773 12.7877C7.23561 13.2547 8 12.9007 8 12.2171V1.78301C8 1.09925 7.23574 0.745258 6.76786 1.21233Z"
          />
          <path
            class="volume-low"
            d="M10 3.54781C10.7452 4.55141 11.1393 5.74511 11.1393 6.99991C11.1393 8.25471 10.7453 9.44791 10 10.4515L10.7988 11.0496C11.6734 9.87201 12.1356 8.47161 12.1356 6.99991C12.1356 5.52821 11.6735 4.12731 10.7988 2.94971L10 3.54781Z"
          />
          <path
            class="volume-medium"
            d="M12.3778 2.40086C13.2709 3.76756 13.7428 5.35806 13.7428 7.00026C13.7428 8.64246 13.2709 10.233 12.3778 11.5992L13.2106 12.1484C14.2107 10.6185 14.739 8.83796 14.739 7.00016C14.739 5.16236 14.2107 3.38236 13.2106 1.85156L12.3778 2.40086Z"
          />
          <path
            class="volume-high"
            d="M15.5981 0.75L14.7478 1.2719C15.7937 2.9919 16.3468 4.9723 16.3468 7C16.3468 9.0277 15.7937 11.0082 14.7478 12.7281L15.5981 13.25C16.7398 11.3722 17.343 9.211 17.343 7C17.343 4.789 16.7398 2.6268 15.5981 0.75Z"
          />
        </g>
        <g class="muted">
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M4.39976 4.98924H1.19937C1.19429 4.98924 1.17777 4.98961 1.15296 5.01609C1.1271 5.04369 1.10174 5.09245 1.10174 5.1607V8.83926C1.10174 8.90761 1.12714 8.95641 1.15299 8.984C1.17779 9.01047 1.1943 9.01084 1.19937 9.01084H4.39977L7 11.6066V2.39357L4.39976 4.98924ZM7.47434 1.92006C7.4743 1.9201 7.47439 1.92002 7.47434 1.92006V1.92006ZM6.76773 12.7877L3.98606 10.0108H1.19937C0.593146 10.0108 0.101743 9.48633 0.101743 8.83926V7.03583L0 6.99998L0.101743 6.96412V5.1607C0.101743 4.51375 0.593146 3.98924 1.19937 3.98924H3.98606L6.76786 1.21233C7.23574 0.745258 8 1.09925 8 1.78301V12.2171C8 12.9007 7.23561 13.2547 6.76773 12.7877Z"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M15.2677 9.30323C15.463 9.49849 15.7796 9.49849 15.9749 9.30323C16.1701 9.10796 16.1701 8.79138 15.9749 8.59612L14.2071 6.82841L15.9749 5.06066C16.1702 4.8654 16.1702 4.54882 15.9749 4.35355C15.7796 4.15829 15.4631 4.15829 15.2678 4.35355L13.5 6.1213L11.7322 4.35348C11.537 4.15822 11.2204 4.15822 11.0251 4.35348C10.8298 4.54874 10.8298 4.86532 11.0251 5.06058L12.7929 6.82841L11.0251 8.59619C10.8299 8.79146 10.8299 9.10804 11.0251 9.3033C11.2204 9.49856 11.537 9.49856 11.7323 9.3033L13.5 7.53552L15.2677 9.30323Z"
          />
        </g>
      </svg>
    </media-mute-button>
  </template>

  <template partial="PipButton">
    <media-pip-button part="bottom pip button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="icon">
        <path
          d="M15.9891 0H2.011C0.9004 0 0 0.9003 0 2.0109V11.989C0 13.0996 0.9004 14 2.011 14H15.9891C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.9891 0ZM17 11.9891C17 12.5465 16.5465 13 15.9891 13H2.011C1.4536 13 1.0001 12.5465 1.0001 11.9891V2.0109C1.0001 1.4535 1.4536 0.9999 2.011 0.9999H15.9891C16.5465 0.9999 17 1.4535 17 2.0109V11.9891Z"
        />
        <path
          d="M15.356 5.67822H8.19523C8.03253 5.67822 7.90063 5.81012 7.90063 5.97282V11.3836C7.90063 11.5463 8.03253 11.6782 8.19523 11.6782H15.356C15.5187 11.6782 15.6506 11.5463 15.6506 11.3836V5.97282C15.6506 5.81012 15.5187 5.67822 15.356 5.67822Z"
        />
      </svg>
    </media-pip-button>
  </template>

  <template partial="CaptionsMenuButton">
    <media-captions-selectmenu part="bottom captions selectmenu" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <media-captions-button
        slot="button"
        part="bottom captions button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 18 14" slot="on">
          <path
            d="M15.989 0H2.011C0.9004 0 0 0.9003 0 2.0109V11.9891C0 13.0997 0.9004 14 2.011 14H15.989C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.989 0ZM4.2292 8.7639C4.5954 9.1902 5.0935 9.4031 5.7233 9.4031C6.1852 9.4031 6.5544 9.301 6.8302 9.0969C7.1061 8.8933 7.2863 8.614 7.3702 8.26H8.4322C8.3062 8.884 8.0093 9.3733 7.5411 9.7273C7.0733 10.0813 6.4703 10.2581 5.732 10.2581C5.108 10.2581 4.5699 10.1219 4.1168 9.8489C3.6637 9.5759 3.3141 9.1946 3.0685 8.7058C2.8224 8.2165 2.6994 7.6511 2.6994 7.009C2.6994 6.3611 2.8224 5.7927 3.0685 5.3034C3.3141 4.8146 3.6637 4.4323 4.1168 4.1559C4.5699 3.88 5.108 3.7418 5.732 3.7418C6.4703 3.7418 7.0733 3.922 7.5411 4.2818C8.0094 4.6422 8.3062 5.1461 8.4322 5.794H7.3702C7.2862 5.4283 7.106 5.1368 6.8302 4.921C6.5544 4.7052 6.1852 4.5968 5.7233 4.5968C5.0934 4.5968 4.5954 4.8116 4.2292 5.2404C3.8635 5.6696 3.6804 6.259 3.6804 7.009C3.6804 7.7531 3.8635 8.3381 4.2292 8.7639ZM11.0974 8.7639C11.4636 9.1902 11.9617 9.4031 12.5915 9.4031C13.0534 9.4031 13.4226 9.301 13.6984 9.0969C13.9743 8.8933 14.1545 8.614 14.2384 8.26H15.3004C15.1744 8.884 14.8775 9.3733 14.4093 9.7273C13.9415 10.0813 13.3385 10.2581 12.6002 10.2581C11.9762 10.2581 11.4381 10.1219 10.985 9.8489C10.5319 9.5759 10.1823 9.1946 9.9367 8.7058C9.6906 8.2165 9.5676 7.6511 9.5676 7.009C9.5676 6.3611 9.6906 5.7927 9.9367 5.3034C10.1823 4.8146 10.5319 4.4323 10.985 4.1559C11.4381 3.88 11.9762 3.7418 12.6002 3.7418C13.3385 3.7418 13.9415 3.922 14.4093 4.2818C14.8776 4.6422 15.1744 5.1461 15.3004 5.794H14.2384C14.1544 5.4283 13.9742 5.1368 13.6984 4.921C13.4226 4.7052 13.0534 4.5968 12.5915 4.5968C11.9616 4.5968 11.4636 4.8116 11.0974 5.2404C10.7317 5.6696 10.5486 6.259 10.5486 7.009C10.5486 7.7531 10.7317 8.3381 11.0974 8.7639Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 18 14" slot="off">
          <path
            d="M5.73219 10.258C5.10819 10.258 4.57009 10.1218 4.11699 9.8488C3.66389 9.5758 3.31429 9.1945 3.06869 8.7057C2.82259 8.2164 2.69958 7.651 2.69958 7.0089C2.69958 6.361 2.82259 5.7926 3.06869 5.3033C3.31429 4.8145 3.66389 4.4322 4.11699 4.1558C4.57009 3.8799 5.10819 3.7417 5.73219 3.7417C6.47049 3.7417 7.07348 3.9219 7.54128 4.2817C8.00958 4.6421 8.30638 5.146 8.43238 5.7939H7.37039C7.28639 5.4282 7.10618 5.1367 6.83039 4.9209C6.55459 4.7051 6.18538 4.5967 5.72348 4.5967C5.09358 4.5967 4.59559 4.8115 4.22939 5.2403C3.86369 5.6695 3.68058 6.2589 3.68058 7.0089C3.68058 7.753 3.86369 8.338 4.22939 8.7638C4.59559 9.1901 5.09368 9.403 5.72348 9.403C6.18538 9.403 6.55459 9.3009 6.83039 9.0968C7.10629 8.8932 7.28649 8.6139 7.37039 8.2599H8.43238C8.30638 8.8839 8.00948 9.3732 7.54128 9.7272C7.07348 10.0812 6.47049 10.258 5.73219 10.258Z"
          />
          <path
            d="M12.6003 10.258C11.9763 10.258 11.4382 10.1218 10.9851 9.8488C10.532 9.5758 10.1824 9.1945 9.93685 8.7057C9.69075 8.2164 9.56775 7.651 9.56775 7.0089C9.56775 6.361 9.69075 5.7926 9.93685 5.3033C10.1824 4.8145 10.532 4.4322 10.9851 4.1558C11.4382 3.8799 11.9763 3.7417 12.6003 3.7417C13.3386 3.7417 13.9416 3.9219 14.4094 4.2817C14.8777 4.6421 15.1745 5.146 15.3005 5.7939H14.2385C14.1545 5.4282 13.9743 5.1367 13.6985 4.9209C13.4227 4.7051 13.0535 4.5967 12.5916 4.5967C11.9617 4.5967 11.4637 4.8115 11.0975 5.2403C10.7318 5.6695 10.5487 6.2589 10.5487 7.0089C10.5487 7.753 10.7318 8.338 11.0975 8.7638C11.4637 9.1901 11.9618 9.403 12.5916 9.403C13.0535 9.403 13.4227 9.3009 13.6985 9.0968C13.9744 8.8932 14.1546 8.6139 14.2385 8.2599H15.3005C15.1745 8.8839 14.8776 9.3732 14.4094 9.7272C13.9416 10.0812 13.3386 10.258 12.6003 10.258Z"
          />
          <path
            d="M15.9891 1C16.5465 1 17 1.4535 17 2.011V11.9891C17 12.5465 16.5465 13 15.9891 13H2.0109C1.4535 13 1 12.5465 1 11.9891V2.0109C1 1.4535 1.4535 0.9999 2.0109 0.9999L15.9891 1ZM15.9891 0H2.0109C0.9003 0 0 0.9003 0 2.0109V11.9891C0 13.0997 0.9003 14 2.0109 14H15.9891C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.9891 0Z"
          />
        </svg>
      </media-captions-button>
      <media-captions-listbox slot="listbox" part="bottom captions listbox">
        <div slot="select-indicator">
          <style>
            .listbox-indicator {
              position: relative;
              top: 1px;
              width: 0.9em;
              height: auto;
              fill: var(--_accent-color);
            }

            [aria-selected='false'] .listbox-indicator {
              display: none;
            }
          </style>
          <svg viewBox="0 0 14 18" class="listbox-indicator">
            <path
              d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
              fill-rule="evenodd"
            />
          </svg>
        </div>
      </media-captions-listbox>
    </media-captions-selectmenu>
  </template>

  <template partial="AirplayButton">
    <media-airplay-button part="bottom airplay button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="icon">
        <path
          d="M16.1383 0H1.8618C0.8335 0 0 0.8335 0 1.8617V10.1382C0 11.1664 0.8335 12 1.8618 12H3.076C3.1204 11.9433 3.1503 11.8785 3.2012 11.826L4.004 11H1.8618C1.3866 11 1 10.6134 1 10.1382V1.8617C1 1.3865 1.3866 0.9999 1.8618 0.9999H16.1383C16.6135 0.9999 17.0001 1.3865 17.0001 1.8617V10.1382C17.0001 10.6134 16.6135 11 16.1383 11H13.9961L14.7989 11.826C14.8499 11.8785 14.8798 11.9432 14.9241 12H16.1383C17.1665 12 18.0001 11.1664 18.0001 10.1382V1.8617C18 0.8335 17.1665 0 16.1383 0Z"
        />
        <path
          d="M9.55061 8.21903C9.39981 8.06383 9.20001 7.98633 9.00011 7.98633C8.80021 7.98633 8.60031 8.06383 8.44951 8.21903L4.09771 12.697C3.62471 13.1838 3.96961 13.9998 4.64831 13.9998H13.3518C14.0304 13.9998 14.3754 13.1838 13.9023 12.697L9.55061 8.21903Z"
        />
      </svg>
    </media-airplay-button>
  </template>

  <template partial="FullscreenButton">
    <media-fullscreen-button part="bottom fullscreen button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="enter">
        <path
          d="M1.00745 4.39539L1.01445 1.98789C1.01605 1.43049 1.47085 0.978289 2.02835 0.979989L6.39375 0.992589L6.39665 -0.007411L2.03125 -0.020011C0.920646 -0.023211 0.0176463 0.874489 0.0144463 1.98509L0.00744629 4.39539H1.00745Z"
        />
        <path
          d="M17.0144 2.03431L17.0076 4.39541H18.0076L18.0144 2.03721C18.0176 0.926712 17.1199 0.0237125 16.0093 0.0205125L11.6439 0.0078125L11.641 1.00781L16.0064 1.02041C16.5638 1.02201 17.016 1.47681 17.0144 2.03431Z"
        />
        <path
          d="M16.9925 9.60498L16.9855 12.0124C16.9839 12.5698 16.5291 13.022 15.9717 13.0204L11.6063 13.0078L11.6034 14.0078L15.9688 14.0204C17.0794 14.0236 17.9823 13.1259 17.9855 12.0153L17.9925 9.60498H16.9925Z"
        />
        <path
          d="M0.985626 11.9661L0.992426 9.60498H-0.0074737L-0.0142737 11.9632C-0.0174737 13.0738 0.880226 13.9767 1.99083 13.98L6.35623 13.9926L6.35913 12.9926L1.99373 12.98C1.43633 12.9784 0.983926 12.5236 0.985626 11.9661Z"
        />
      </svg>
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="exit">
        <path
          d="M5.39655 -0.0200195L5.38955 2.38748C5.38795 2.94488 4.93315 3.39708 4.37565 3.39538L0.0103463 3.38278L0.00744629 4.38278L4.37285 4.39538C5.48345 4.39858 6.38635 3.50088 6.38965 2.39028L6.39665 -0.0200195H5.39655Z"
        />
        <path
          d="M12.6411 2.36891L12.6479 0.0078125H11.6479L11.6411 2.36601C11.6379 3.47651 12.5356 4.37951 13.6462 4.38271L18.0116 4.39531L18.0145 3.39531L13.6491 3.38271C13.0917 3.38111 12.6395 2.92641 12.6411 2.36891Z"
        />
        <path
          d="M12.6034 14.0204L12.6104 11.613C12.612 11.0556 13.0668 10.6034 13.6242 10.605L17.9896 10.6176L17.9925 9.61759L13.6271 9.60499C12.5165 9.60179 11.6136 10.4995 11.6104 11.6101L11.6034 14.0204H12.6034Z"
        />
        <path
          d="M5.359 11.6315L5.3522 13.9926H6.3522L6.359 11.6344C6.3622 10.5238 5.4645 9.62088 4.3539 9.61758L-0.0115043 9.60498L-0.0144043 10.605L4.351 10.6176C4.9084 10.6192 5.3607 11.074 5.359 11.6315Z"
        />
      </svg>
    </media-fullscreen-button>
  </template>

  <template partial="CastButton">
    <media-cast-button part="bottom cast button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="enter">
        <path
          d="M16.0072 0H2.0291C0.9185 0 0.0181 0.9003 0.0181 2.011V5.5009C0.357 5.5016 0.6895 5.5275 1.0181 5.5669V2.011C1.0181 1.4536 1.4716 1 2.029 1H16.0072C16.5646 1 17.0181 1.4536 17.0181 2.011V11.9891C17.0181 12.5465 16.5646 13 16.0072 13H8.4358C8.4746 13.3286 8.4999 13.6611 8.4999 13.9999H16.0071C17.1177 13.9999 18.018 13.0996 18.018 11.989V2.011C18.0181 0.9003 17.1178 0 16.0072 0ZM0 6.4999V7.4999C3.584 7.4999 6.5 10.4159 6.5 13.9999H7.5C7.5 9.8642 4.1357 6.4999 0 6.4999ZM0 8.7499V9.7499C2.3433 9.7499 4.25 11.6566 4.25 13.9999H5.25C5.25 11.1049 2.895 8.7499 0 8.7499ZM0.0181 11V14H3.0181C3.0181 12.3431 1.675 11 0.0181 11Z"
        />
      </svg>
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="exist">
        <path
          d="M15.9891 0H2.01103C0.900434 0 3.35947e-05 0.9003 3.35947e-05 2.011V5.5009C0.338934 5.5016 0.671434 5.5275 1.00003 5.5669V2.011C1.00003 1.4536 1.45353 1 2.01093 1H15.9891C16.5465 1 17 1.4536 17 2.011V11.9891C17 12.5465 16.5465 13 15.9891 13H8.41773C8.45653 13.3286 8.48183 13.6611 8.48183 13.9999H15.989C17.0996 13.9999 17.9999 13.0996 17.9999 11.989V2.011C18 0.9003 17.0997 0 15.9891 0ZM-0.0180664 6.4999V7.4999C3.56593 7.4999 6.48193 10.4159 6.48193 13.9999H7.48193C7.48193 9.8642 4.11763 6.4999 -0.0180664 6.4999ZM-0.0180664 8.7499V9.7499C2.32523 9.7499 4.23193 11.6566 4.23193 13.9999H5.23193C5.23193 11.1049 2.87693 8.7499 -0.0180664 8.7499ZM3.35947e-05 11V14H3.00003C3.00003 12.3431 1.65693 11 3.35947e-05 11Z"
        />
        <path d="M2.15002 5.634C5.18352 6.4207 7.57252 8.8151 8.35282 11.8499H15.8501V2.1499H2.15002V5.634Z" />
      </svg>
    </media-cast-button>
  </template>

  <template partial="LiveButton">
    <media-live-button part="{{section ?? 'top'}} live button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <span slot="text">Live</span>
    </media-live-button>
  </template>

  <template partial="PlaybackRateButton">
    <media-playback-rate-button
      rates="{{playbackrates}}"
      part="bottom playback-rate button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
    </media-playback-rate-button>
  </template>

  <template partial="VolumeRange">
    <media-volume-range
      part="bottom volume range"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    ></media-volume-range>
  </template>

  <template partial="TimeDisplay">
    <media-time-display
      remaining="{{defaultshowremainingtime}}"
      showduration="{{!hideduration}}"
      part="bottom time display"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    ></media-time-display>
  </template>

  <template partial="TimeRange">
    <media-time-range part="bottom time range" disabled="{{disabled}}" aria-disabled="{{disabled}}"></media-time-range>
  </template>

  <template partial="AudioTrackSelect">
    <media-audio-track-selectmenu
      part="bottom audio-track selectmenu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <media-audio-track-button slot="button" part="bottom audio-track button">
        <svg aria-hidden="true" slot="icon" viewBox="0 0 18 16">
          <path d="M9 15A7 7 0 1 1 9 1a7 7 0 0 1 0 14Zm0 1A8 8 0 1 0 9 0a8 8 0 0 0 0 16Z" />
          <path
            d="M5.2 6.3a.5.5 0 0 1 .5.5v2.4a.5.5 0 1 1-1 0V6.8a.5.5 0 0 1 .5-.5Zm2.4-2.4a.5.5 0 0 1 .5.5v7.2a.5.5 0 0 1-1 0V4.4a.5.5 0 0 1 .5-.5ZM10 5.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.4-.8a.5.5 0 0 1 .5.5v5.6a.5.5 0 0 1-1 0V5.2a.5.5 0 0 1 .5-.5Z"
          />
        </svg>
      </media-audio-track-button>
      <media-audio-track-listbox slot="listbox" part="bottom audio-track listbox">
        <div slot="select-indicator">
          <style>
            .listbox-indicator {
              position: relative;
              top: 1px;
              width: 0.9em;
              height: auto;
              fill: var(--_accent-color);
            }

            [aria-selected='false'] .listbox-indicator {
              display: none;
            }
          </style>
          <svg viewBox="0 0 14 18" class="listbox-indicator">
            <path
              d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
              fill-rule="evenodd"
            />
          </svg>
        </div>
      </media-audio-track-listbox>
    </media-audio-track-selectmenu>
  </template>

  <template partial="RenditionSelect">
    <media-rendition-selectmenu part="bottom rendition selectmenu" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <media-rendition-button slot="button" part="bottom rendition button">
        <svg aria-hidden="true" slot="icon" viewBox="0 0 18 14">
          <path
            d="M2.25 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM9 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm6.75 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"
          />
        </svg>
      </media-rendition-button>
      <media-rendition-listbox slot="listbox" part="bottom rendition listbox">
        <div slot="select-indicator">
          <style>
            .listbox-indicator {
              position: relative;
              top: 1px;
              width: 0.9em;
              height: auto;
              fill: var(--_accent-color);
            }

            [aria-selected='false'] .listbox-indicator {
              display: none;
            }
          </style>
          <svg viewBox="0 0 14 18" class="listbox-indicator">
            <path
              d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
              fill-rule="evenodd"
            />
          </svg>
        </div>
      </media-rendition-listbox>
    </media-rendition-selectmenu>
  </template>

  <media-controller
    defaultstreamtype="{{defaultstreamtype ?? 'on-demand'}}"
    breakpoints="sm:470"
    gesturesdisabled="{{disabled}}"
    hotkeys="{{hotkeys}}"
    nohotkeys="{{nohotkeys}}"
    novolumepref="{{novolumepref}}"
    audio="{{audio}}"
    noautoseektolive="{{noautoseektolive}}"
    defaultsubtitles="{{defaultsubtitles}}"
    exportparts="layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer"
    style="--_pre-playback-place:{{preplaybackplace ?? 'center'}}"
  >
    <slot name="media" slot="media"></slot>
    <slot name="poster" slot="poster"></slot>

    <media-loading-indicator slot="centered-chrome" no-auto-hide></media-loading-indicator>

    <template if="!audio">
      <!-- Pre-playback UI -->
      <div slot="centered-chrome" class="center-controls pre-playback">
        <template if="streamtype == 'on-demand'">
          <template if="!breakpointsm"> {{>SeekBackwardButton section="center"}} </template>
          <template if="!breakpointsm"> {{>PlayButton section="center"}} </template>
          <template if="breakpointsm"> {{>PrePlayButton section="center"}} </template>
          <template if="!breakpointsm"> {{>SeekForwardButton section="center"}} </template>
        </template>

        <template if="streamtype == 'live'">
          <template if="!breakpointsm">
            <template if="targetlivewindow > 0"> {{>SeekBackwardButton section="center"}} </template>
          </template>
          <template if="!breakpointsm"> {{>PlayButton section="center"}} </template>
          <template if="breakpointsm"> {{>PrePlayButton section="center"}} </template>
          <template if="!breakpointsm">
            <template if="targetlivewindow > 0"> {{>SeekForwardButton section="center"}} </template>
          </template>
        </template>
      </div>

      <!-- Auotplay centered unmute button -->
      <!--
        todo: figure out how show this with available state variables
        needs to show when:
        - autoplay is enabled
        - playback has been successful
        - audio is muted
        - in place / instead of the pre-plaback play button
        - not to show again after user has interacted with this button
          - OR user has interacted with the mute button in the control bar
      -->
      <!--
        There should be a >MuteButton to the left of the "Unmute" text, but a templating bug
        makes it appear even if commented out in the markup, add it back when code is un-commented
      -->
      <!-- <div slot="centered-chrome" class="autoplay-unmute">
        <div role="button" class="autoplay-unmute-btn">Unmute</div>
      </div> -->

      <template if="streamtype == 'on-demand'">
        <template if="breakpointsm">
          <media-control-bar part="control-bar top" slot="top-chrome">{{>TitleDisplay}} </media-control-bar>
        </template>
        {{>TimeRange}}
        <media-control-bar part="control-bar bottom">
          <template if="breakpointsm">
            {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}}
          </template>
          {{>MuteButton}} {{>VolumeRange}}
          <div class="spacer"></div>
          {{>RenditionSelect}}
          <template if="breakpointsm"> {{>PlaybackRateButton}} </template>
          {{>AudioTrackSelect}} {{>CaptionsMenuButton}} {{>AirplayButton}} {{>CastButton}}
          <template if="breakpointsm"> {{>PipButton}} </template>
          {{>FullscreenButton}}
        </media-control-bar>
      </template>

      <template if="streamtype == 'live'">
        <media-control-bar part="control-bar top" slot="top-chrome">
          {{>LiveButton}}
          <template if="breakpointsm"> {{>TitleDisplay}} </template>
        </media-control-bar>
        <template if="targetlivewindow > 0">{{>TimeRange}}</template>
        <media-control-bar part="control-bar bottom">
          <template if="breakpointsm">
            {{>PlayButton}}
            <template if="targetlivewindow > 0"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>
          </template>
          {{>MuteButton}}
          <div class="spacer"></div>
          {{>RenditionSelect}} {{>AudioTrackSelect}} {{>CaptionsMenuButton}} {{>AirplayButton}} {{>CastButton}}
          <template if="breakpointsm">{{>PipButton}}</template>
          {{>FullscreenButton}}
        </media-control-bar>
      </template>
    </template>

    <template if="audio">
      <template if="streamtype == 'on-demand'">
        <template if="title">
          <media-control-bar part="control-bar top">{{>TitleDisplay}}</media-control-bar>
        </template>
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}}
          <template if="breakpointsm"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>
          {{>MuteButton}}
          <template if="breakpointsm">{{>VolumeRange}}</template>
          {{>TimeDisplay}} {{>TimeRange}}
          <div class="spacer"></div>
          <template if="breakpointsm">{{>PlaybackRateButton}}</template>
          {{>AirplayButton}} {{>CastButton}}
        </media-control-bar>
      </template>

      <template if="streamtype == 'live'">
        <template if="title">
          <media-control-bar part="control-bar top">{{>TitleDisplay}}</media-control-bar>
        </template>
        <media-control-bar part="control-bar bottom">
          <template if="breakpointsm">
            {{>PlayButton}} {{>LiveButton section="bottom"}} {{>MuteButton}} {{>VolumeRange}}
            <template if="targetlivewindow > 0"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>
          </template>
          <template if="targetlivewindow > 0"> {{>TimeDisplay}} {{>TimeRange}} </template>
          <div class="spacer"></div>
          {{>AirplayButton}} {{>CastButton}}
        </media-control-bar>
      </template>
    </template>

    <slot></slot>
  </media-controller>
</template>
`,fo=mg.createElement("template");"innerHTML"in fo&&(fo.innerHTML=fn);var fl,fd,fu=class extends cY{};fu.template=null==(fd=null==(fl=fo.content)?void 0:fl.children)?void 0:fd[0],mp.customElements.get("media-theme-gerwig")||mp.customElements.define("media-theme-gerwig",fu);var fh={SRC:"src",POSTER:"poster"},fc={STYLE:"style",DEFAULT_HIDDEN_CAPTIONS:"default-hidden-captions",PRIMARY_COLOR:"primary-color",SECONDARY_COLOR:"secondary-color",ACCENT_COLOR:"accent-color",FORWARD_SEEK_OFFSET:"forward-seek-offset",BACKWARD_SEEK_OFFSET:"backward-seek-offset",PLAYBACK_TOKEN:"playback-token",THUMBNAIL_TOKEN:"thumbnail-token",STORYBOARD_TOKEN:"storyboard-token",STORYBOARD_SRC:"storyboard-src",THUMBNAIL_TIME:"thumbnail-time",AUDIO:"audio",NOHOTKEYS:"nohotkeys",HOTKEYS:"hotkeys",PLAYBACK_RATES:"playbackrates",DEFAULT_SHOW_REMAINING_TIME:"default-show-remaining-time",TITLE:"title",PLACEHOLDER:"placeholder",THEME:"theme",DEFAULT_STREAM_TYPE:"default-stream-type",TARGET_LIVE_WINDOW:"target-live-window",NO_VOLUME_PREF:"no-volume-pref"},fm=["audio","backwardseekoffset","defaultshowremainingtime","defaultsubtitles","noautoseektolive","disabled","exportparts","forwardseekoffset","hideduration","hotkeys","nohotkeys","playbackrates","defaultstreamtype","streamtype","style","targetlivewindow","template","title","novolumepref"];function ff(e){let t=e.hasAttribute(fc.TITLE)?{video_title:e.getAttribute(fc.TITLE)}:{};return e.getAttributeNames().filter(e=>e.startsWith("metadata-")).reduce((t,i)=>{let r=e.getAttribute(i);return null!==r&&(t[i.replace(/^metadata-/,"").replace(/-/g,"_")]=r),t},t)}var fp,fg,fv,fE,fb,fy,fT,fA,f_,fS,fk,fL,fI,fR,fw,fD,fC,fM,fx,fO,fP,fN=Object.values(cs),fU=Object.values(fh),fF=Object.values(fc),fB={dialog:void 0,isDialogOpen:!1},f$=class extends mz{constructor(){super(),cZ(this,fy),cZ(this,fA),cZ(this,fS),cZ(this,fL),cZ(this,fR),cZ(this,fD),cZ(this,fM),cZ(this,fO),cZ(this,fp,!1),cZ(this,fg,{}),cZ(this,fv,!0),cZ(this,fE,new mU(this,"hotkeys")),cZ(this,fb,{...fB,onCloseErrorDialog:()=>c0(this,fS,fk).call(this,{dialog:void 0,isDialogOpen:!1}),onInitFocusDialog:e=>{mw(this,mg.activeElement)||e.preventDefault()}}),this.attachShadow({mode:"open"}),c0(this,fA,f_).call(this),this.isConnected&&c0(this,fy,fT).call(this)}static get observedAttributes(){var e;return[...null!=(e=mz.observedAttributes)?e:[],...fU,...fN,...fF]}get mediaTheme(){var e;return null==(e=this.shadowRoot)?void 0:e.querySelector("media-theme")}get mediaController(){var e,t;return null==(t=null==(e=this.mediaTheme)?void 0:e.shadowRoot)?void 0:t.querySelector("media-controller")}connectedCallback(){var e;let t=null==(e=this.shadowRoot)?void 0:e.querySelector("mux-video");t&&(t.metadata=ff(this))}attributeChangedCallback(e,t,i){var r;switch(c0(this,fy,fT).call(this),super.attributeChangedCallback(e,t,i),e){case fc.HOTKEYS:cQ(this,fE).value=i;break;case fc.THUMBNAIL_TIME:null!=i&&this.tokens.thumbnail&&mB(mE("Use of thumbnail-time with thumbnail-token is currently unsupported. Ignore thumbnail-time.").format({}));break;case fc.THUMBNAIL_TOKEN:{let{aud:e}=mS(i);i&&"t"!==e&&mB(mE("The provided thumbnail-token should have audience value 't' instead of '{aud}'.").format({aud:e}));break}case fc.STORYBOARD_TOKEN:{let{aud:e}=mS(i);i&&"s"!==e&&mB(mE("The provided storyboard-token should have audience value 's' instead of '{aud}'.").format({aud:e}));break}case cs.PLAYBACK_ID:null!=i&&i.includes("?token")&&m$(mE("The specificed playback ID {playbackId} contains a token which must be provided via the playback-token attribute.").format({playbackId:i}));break;case cs.STREAM_TYPE:i&&![lu.LIVE,lu.ON_DEMAND,lu.UNKNOWN].includes(i)?["ll-live","live:dvr","ll-live:dvr"].includes(this.streamType)?this.targetLiveWindow=i.includes("dvr")?Number.POSITIVE_INFINITY:0:mV({file:"invalid-stream-type.md",message:mE("Invalid stream-type value supplied: `{streamType}`. Please provide stream-type as either: `on-demand` or `live`").format({streamType:this.streamType})}):this.targetLiveWindow=i===lu.LIVE?0:Number.NaN}[cs.PLAYBACK_ID,fh.SRC,fc.PLAYBACK_TOKEN].includes(e)&&t!==i&&cJ(this,fb,{...cQ(this,fb),...fB}),c0(this,fL,fI).call(this,{[null!=(r=mN[e])?r:mT(e)]:i})}get preferCmcd(){var e;return null!=(e=this.getAttribute(cs.PREFER_CMCD))?e:void 0}set preferCmcd(e){e!==this.preferCmcd&&(e?lm.includes(e)?this.setAttribute(cs.PREFER_CMCD,e):mB(`Invalid value for preferCmcd. Must be one of ${lm.join()}`):this.removeAttribute(cs.PREFER_CMCD))}get hasPlayed(){var e,t;return null!=(t=null==(e=this.mediaController)?void 0:e.hasAttribute("media-has-played"))&&t}get inLiveWindow(){var e;return null==(e=this.mediaController)?void 0:e.hasAttribute("media-time-is-live")}get _hls(){var e;return null==(e=this.media)?void 0:e._hls}get mux(){var e;return null==(e=this.media)?void 0:e.mux}get theme(){var e;return null!=(e=this.getAttribute(fc.THEME))?e:"gerwig"}set theme(e){this.setAttribute(fc.THEME,`${e}`)}get themeProps(){let e=this.mediaTheme;if(!e)return;let t={};for(let i of e.getAttributeNames()){if(fm.includes(i))continue;let r=e.getAttribute(i);t[mT(i)]=""===r||r}return t}set themeProps(e){var t,i;c0(this,fy,fT).call(this);let r={...this.themeProps,...e};for(let a in r){if(fm.includes(a))continue;let r=null==e?void 0:e[a];"boolean"==typeof r||null==r?null==(t=this.mediaTheme)||t.toggleAttribute(my(a),!!r):null==(i=this.mediaTheme)||i.setAttribute(my(a),r)}}get playbackId(){var e;return null!=(e=this.getAttribute(cs.PLAYBACK_ID))?e:void 0}set playbackId(e){e?this.setAttribute(cs.PLAYBACK_ID,e):this.removeAttribute(cs.PLAYBACK_ID)}get src(){var e,t;return this.playbackId?null!=(e=fV(this,fh.SRC))?e:void 0:null!=(t=this.getAttribute(fh.SRC))?t:void 0}set src(e){e?this.setAttribute(fh.SRC,e):this.removeAttribute(fh.SRC)}get poster(){var e;let t=this.getAttribute(fh.POSTER);return null!=t?t:this.playbackId&&!this.audio?mx(this.playbackId,{domain:this.customDomain,thumbnailTime:null!=(e=this.thumbnailTime)?e:this.startTime,token:this.tokens.thumbnail}):void 0}set poster(e){e||""===e?this.setAttribute(fh.POSTER,e):this.removeAttribute(fh.POSTER)}get storyboardSrc(){var e;return null!=(e=this.getAttribute(fc.STORYBOARD_SRC))?e:void 0}set storyboardSrc(e){e?this.setAttribute(fc.STORYBOARD_SRC,e):this.removeAttribute(fc.STORYBOARD_SRC)}get storyboard(){return this.storyboardSrc&&!this.tokens.storyboard?this.storyboardSrc:this.audio||!this.playbackId||!this.streamType||[lu.LIVE,lu.UNKNOWN].includes(this.streamType)?void 0:mO(this.playbackId,{domain:this.customDomain,token:this.tokens.storyboard})}get audio(){return this.hasAttribute(fc.AUDIO)}set audio(e){if(!e){this.removeAttribute(fc.AUDIO);return}this.setAttribute(fc.AUDIO,"")}get hotkeys(){return cQ(this,fE)}get nohotkeys(){return this.hasAttribute(fc.NOHOTKEYS)}set nohotkeys(e){if(!e){this.removeAttribute(fc.NOHOTKEYS);return}this.setAttribute(fc.NOHOTKEYS,"")}get thumbnailTime(){return mA(this.getAttribute(fc.THUMBNAIL_TIME))}set thumbnailTime(e){this.setAttribute(fc.THUMBNAIL_TIME,`${e}`)}get title(){var e;return null!=(e=this.getAttribute(fc.TITLE))?e:""}set title(e){e!==this.title&&(e?this.setAttribute(fc.TITLE,e):this.removeAttribute("title"),super.title=e)}get placeholder(){var e;return null!=(e=fV(this,fc.PLACEHOLDER))?e:""}set placeholder(e){this.setAttribute(fc.PLACEHOLDER,`${e}`)}get primaryColor(){var e,t;let i=this.getAttribute(fc.PRIMARY_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=mp.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_primary-color"))?void 0:t.trim()))return i}set primaryColor(e){this.setAttribute(fc.PRIMARY_COLOR,`${e}`)}get secondaryColor(){var e,t;let i=this.getAttribute(fc.SECONDARY_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=mp.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_secondary-color"))?void 0:t.trim()))return i}set secondaryColor(e){this.setAttribute(fc.SECONDARY_COLOR,`${e}`)}get accentColor(){var e,t;let i=this.getAttribute(fc.ACCENT_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=mp.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_accent-color"))?void 0:t.trim()))return i}set accentColor(e){this.setAttribute(fc.ACCENT_COLOR,`${e}`)}get defaultShowRemainingTime(){return this.hasAttribute(fc.DEFAULT_SHOW_REMAINING_TIME)}set defaultShowRemainingTime(e){e?this.setAttribute(fc.DEFAULT_SHOW_REMAINING_TIME,""):this.removeAttribute(fc.DEFAULT_SHOW_REMAINING_TIME)}get playbackRates(){if(this.hasAttribute(fc.PLAYBACK_RATES))return this.getAttribute(fc.PLAYBACK_RATES).trim().split(/\s*,?\s+/).map(e=>Number(e)).filter(e=>!Number.isNaN(e)).sort((e,t)=>e-t)}set playbackRates(e){if(!e){this.removeAttribute(fc.PLAYBACK_RATES);return}this.setAttribute(fc.PLAYBACK_RATES,e.join(" "))}get forwardSeekOffset(){var e;return null!=(e=mA(this.getAttribute(fc.FORWARD_SEEK_OFFSET)))?e:10}set forwardSeekOffset(e){this.setAttribute(fc.FORWARD_SEEK_OFFSET,`${e}`)}get backwardSeekOffset(){var e;return null!=(e=mA(this.getAttribute(fc.BACKWARD_SEEK_OFFSET)))?e:10}set backwardSeekOffset(e){this.setAttribute(fc.BACKWARD_SEEK_OFFSET,`${e}`)}get defaultHiddenCaptions(){return this.hasAttribute(fc.DEFAULT_HIDDEN_CAPTIONS)}set defaultHiddenCaptions(e){e?this.setAttribute(fc.DEFAULT_HIDDEN_CAPTIONS,""):this.removeAttribute(fc.DEFAULT_HIDDEN_CAPTIONS)}get playerSoftwareName(){var e;return null!=(e=this.getAttribute(cs.PLAYER_SOFTWARE_NAME))?e:"mux-player"}get playerSoftwareVersion(){var e;return null!=(e=this.getAttribute(cs.PLAYER_SOFTWARE_VERSION))?e:mC}get beaconCollectionDomain(){var e;return null!=(e=this.getAttribute(cs.BEACON_COLLECTION_DOMAIN))?e:void 0}set beaconCollectionDomain(e){e!==this.beaconCollectionDomain&&(e?this.setAttribute(cs.BEACON_COLLECTION_DOMAIN,e):this.removeAttribute(cs.BEACON_COLLECTION_DOMAIN))}get maxResolution(){var e;return null!=(e=this.getAttribute(cs.MAX_RESOLUTION))?e:void 0}set maxResolution(e){e!==this.maxResolution&&(e?this.setAttribute(cs.MAX_RESOLUTION,e):this.removeAttribute(cs.MAX_RESOLUTION))}get customDomain(){var e;return null!=(e=this.getAttribute(cs.CUSTOM_DOMAIN))?e:void 0}set customDomain(e){e!==this.customDomain&&(e?this.setAttribute(cs.CUSTOM_DOMAIN,e):this.removeAttribute(cs.CUSTOM_DOMAIN))}get envKey(){var e;return null!=(e=fV(this,cs.ENV_KEY))?e:void 0}set envKey(e){this.setAttribute(cs.ENV_KEY,`${e}`)}get noVolumePref(){return this.hasAttribute(fc.NO_VOLUME_PREF)}set noVolumePref(e){e?this.setAttribute(fc.NO_VOLUME_PREF,""):this.removeAttribute(fc.NO_VOLUME_PREF)}get debug(){return null!=fV(this,cs.DEBUG)}set debug(e){e?this.setAttribute(cs.DEBUG,""):this.removeAttribute(cs.DEBUG)}get disableCookies(){return null!=fV(this,cs.DISABLE_COOKIES)}set disableCookies(e){e?this.setAttribute(cs.DISABLE_COOKIES,""):this.removeAttribute(cs.DISABLE_COOKIES)}get streamType(){var e,t,i;return null!=(i=null!=(t=this.getAttribute(cs.STREAM_TYPE))?t:null==(e=this.media)?void 0:e.streamType)?i:lu.UNKNOWN}set streamType(e){this.setAttribute(cs.STREAM_TYPE,`${e}`)}get defaultStreamType(){var e,t,i;return null!=(i=null!=(t=this.getAttribute(fc.DEFAULT_STREAM_TYPE))?t:null==(e=this.mediaController)?void 0:e.getAttribute(fc.DEFAULT_STREAM_TYPE))?i:lu.ON_DEMAND}set defaultStreamType(e){e?this.setAttribute(fc.DEFAULT_STREAM_TYPE,e):this.removeAttribute(fc.DEFAULT_STREAM_TYPE)}get targetLiveWindow(){var e,t;return this.hasAttribute(fc.TARGET_LIVE_WINDOW)?+this.getAttribute(fc.TARGET_LIVE_WINDOW):null!=(t=null==(e=this.media)?void 0:e.targetLiveWindow)?t:Number.NaN}set targetLiveWindow(e){e!=this.targetLiveWindow&&(null==e?this.removeAttribute(fc.TARGET_LIVE_WINDOW):this.setAttribute(fc.TARGET_LIVE_WINDOW,`${+e}`))}get liveEdgeStart(){var e;return null==(e=this.media)?void 0:e.liveEdgeStart}get startTime(){return mA(fV(this,cs.START_TIME))}set startTime(e){this.setAttribute(cs.START_TIME,`${e}`)}get preferPlayback(){let e=this.getAttribute(cs.PREFER_PLAYBACK);if(e===lh.MSE||e===lh.NATIVE)return e}set preferPlayback(e){e!==this.preferPlayback&&(e===lh.MSE||e===lh.NATIVE?this.setAttribute(cs.PREFER_PLAYBACK,e):this.removeAttribute(cs.PREFER_PLAYBACK))}get metadata(){var e;return null==(e=this.media)?void 0:e.metadata}set metadata(e){if(c0(this,fy,fT).call(this),!this.media){m$("underlying media element missing when trying to set metadata. metadata will not be set.");return}this.media.metadata={...ff(this),...e}}async addCuePoints(e){var t;if(c0(this,fy,fT).call(this),!this.media){m$("underlying media element missing when trying to addCuePoints. cuePoints will not be added.");return}return null==(t=this.media)?void 0:t.addCuePoints(e)}get activeCuePoint(){var e;return null==(e=this.media)?void 0:e.activeCuePoint}get cuePoints(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.cuePoints)?t:[]}getStartDate(){var e;return null==(e=this.media)?void 0:e.getStartDate()}get currentPdt(){var e;return null==(e=this.media)?void 0:e.currentPdt}get tokens(){let e=this.getAttribute(fc.PLAYBACK_TOKEN),t=this.getAttribute(fc.THUMBNAIL_TOKEN),i=this.getAttribute(fc.STORYBOARD_TOKEN);return{...cQ(this,fg),...null!=e?{playback:e}:{},...null!=t?{thumbnail:t}:{},...null!=i?{storyboard:i}:{}}}set tokens(e){cJ(this,fg,null!=e?e:{})}get playbackToken(){var e;return null!=(e=this.getAttribute(fc.PLAYBACK_TOKEN))?e:void 0}set playbackToken(e){this.setAttribute(fc.PLAYBACK_TOKEN,`${e}`)}get thumbnailToken(){var e;return null!=(e=this.getAttribute(fc.THUMBNAIL_TOKEN))?e:void 0}set thumbnailToken(e){this.setAttribute(fc.THUMBNAIL_TOKEN,`${e}`)}get storyboardToken(){var e;return null!=(e=this.getAttribute(fc.STORYBOARD_TOKEN))?e:void 0}set storyboardToken(e){this.setAttribute(fc.STORYBOARD_TOKEN,`${e}`)}addTextTrack(e,t,i,r){var a;let s=null==(a=this.media)?void 0:a.nativeEl;if(s)return lI(s,e,t,i,r)}removeTextTrack(e){var t;let i=null==(t=this.media)?void 0:t.nativeEl;if(i){let t;return void(null==(t=Array.prototype.find.call(i.querySelectorAll("track"),t=>t.track===e))||t.remove())}}get textTracks(){var e;return null==(e=this.media)?void 0:e.textTracks}};function fV(e,t){return e.media?e.media.getAttribute(t):e.getAttribute(t)}fp=new WeakMap,fg=new WeakMap,fv=new WeakMap,fE=new WeakMap,fb=new WeakMap,fy=new WeakSet,fT=function(){var e,t,i,r;if(!cQ(this,fp)){cJ(this,fp,!0),c0(this,fL,fI).call(this);try{if(customElements.upgrade(this.mediaTheme),!(this.mediaTheme instanceof mp.HTMLElement))throw""}catch{m$("<media-theme> failed to upgrade!")}try{if(customElements.upgrade(this.media),!(this.media instanceof co))throw""}catch{m$("<mux-video> failed to upgrade!")}try{if(customElements.upgrade(this.mediaController),!(this.mediaController instanceof e6))throw""}catch{m$("<media-controller> failed to upgrade!")}r=this,r.querySelectorAll(":scope > track").forEach(e=>{var t;null==(t=r.media)||t.append(e.cloneNode())}),mK.forEach(e=>{var t;null==(t=r.media)||t.addEventListener(e,e=>{r.dispatchEvent(new Event(e.type))})}),c0(this,fR,fw).call(this),c0(this,fD,fC).call(this),c0(this,fM,fx).call(this),cJ(this,fv,null==(t=null==(e=this.mediaController)?void 0:e.hasAttribute("userinactive"))||t),c0(this,fO,fP).call(this),null==(i=this.media)||i.addEventListener("streamtypechange",()=>{c0(this,fL,fI).call(this)})}},fA=new WeakSet,f_=function(){var e,t;try{null==(e=null==window?void 0:window.CSS)||e.registerProperty({name:"--media-primary-color",syntax:"<color>",inherits:!0}),null==(t=null==window?void 0:window.CSS)||t.registerProperty({name:"--media-secondary-color",syntax:"<color>",inherits:!0})}catch{}},fS=new WeakSet,fk=function(e){Object.assign(cQ(this,fb),e),c0(this,fL,fI).call(this)},fL=new WeakSet,fI=function(e={}){var t,i,r;let a;(function(e,t){e.renderInto(t)})(fi((t={...cQ(this,fb),...e},{src:!this.playbackId&&this.src,playbackId:this.playbackId,hasSrc:!!this.playbackId||!!this.src,poster:this.poster,storyboard:this.storyboard,storyboardSrc:this.getAttribute(fc.STORYBOARD_SRC),placeholder:this.getAttribute("placeholder"),themeTemplate:function(e){var t,i;let r=e.theme;if(r){let a=null==(i=null==(t=e.getRootNode())?void 0:t.getElementById)?void 0:i.call(t,r);if(a&&a instanceof HTMLTemplateElement)return a;r.startsWith("media-theme-")||(r=`media-theme-${r}`);let s=mp.customElements.get(r);if(null!=s&&s.template)return s.template}}(this),thumbnailTime:!this.tokens.thumbnail&&this.thumbnailTime,autoplay:this.autoplay,crossOrigin:this.crossOrigin,loop:this.loop,noHotKeys:this.hasAttribute(fc.NOHOTKEYS),hotKeys:this.getAttribute(fc.HOTKEYS),muted:this.muted,paused:this.paused,preload:this.preload,envKey:this.envKey,preferCmcd:this.preferCmcd,debug:this.debug,disableCookies:this.disableCookies,tokens:this.tokens,beaconCollectionDomain:this.beaconCollectionDomain,maxResolution:this.maxResolution,metadata:this.metadata,playerSoftwareName:this.playerSoftwareName,playerSoftwareVersion:this.playerSoftwareVersion,startTime:this.startTime,preferPlayback:this.preferPlayback,audio:this.audio,defaultStreamType:this.defaultStreamType,targetLiveWindow:this.getAttribute(cs.TARGET_LIVE_WINDOW),streamType:mP(this.getAttribute(cs.STREAM_TYPE)),primaryColor:this.primaryColor,secondaryColor:this.secondaryColor,accentColor:this.accentColor,forwardSeekOffset:this.forwardSeekOffset,backwardSeekOffset:this.backwardSeekOffset,defaultHiddenCaptions:this.defaultHiddenCaptions,defaultShowRemainingTime:this.defaultShowRemainingTime,hideDuration:(a=null==(r=this.mediaController)?void 0:r.querySelector("media-time-display"))&&"none"===getComputedStyle(a).getPropertyValue("--media-duration-display-display").trim(),playbackRates:this.getAttribute(fc.PLAYBACK_RATES),customDomain:null!=(i=this.getAttribute(cs.CUSTOM_DOMAIN))?i:void 0,title:this.getAttribute(fc.TITLE),novolumepref:this.hasAttribute(fc.NO_VOLUME_PREF),...t})),this.shadowRoot)},fR=new WeakSet,fw=function(){let e=e=>{var t,i;if(!(null!=e&&e.startsWith("theme-")))return;let r=e.replace(/^theme-/,"");if(fm.includes(r))return;let a=this.getAttribute(e);null!=a?null==(t=this.mediaTheme)||t.setAttribute(r,a):null==(i=this.mediaTheme)||i.removeAttribute(r)};new MutationObserver(t=>{for(let{attributeName:i}of t)e(i)}).observe(this,{attributes:!0}),this.getAttributeNames().forEach(e)},fD=new WeakSet,fC=function(){var e;this.addEventListener("error",e=>{let{detail:t}=e;if(t instanceof ln||(t=new ln(t.message,t.code,t.fatal)),!(null!=t&&t.fatal)){mB(t),t.data&&mB(`${t.name} data:`,t.data);return}let{dialog:i,devlog:r}=fs(t,!window.navigator.onLine,this.playbackId,this.playbackToken);r.message&&mV(r),m$(t),t.data&&m$(`${t.name} data:`,t.data),c0(this,fS,fk).call(this,{isDialogOpen:!0,dialog:i})}),this.media&&(this.media.errorTranslator=(e={})=>{var t,i,r;if(!((null==(t=this.media)?void 0:t.error)instanceof ln))return e;let{devlog:a}=fs(null==(i=this.media)?void 0:i.error,!window.navigator.onLine,this.playbackId,this.playbackToken,!1);return{player_error_code:null==(r=this.media)?void 0:r.error.code,player_error_message:a.message?String(a.message):e.player_error_message,player_error_context:a.context?String(a.context):e.player_error_context}}),null==(e=this.media)||e.addEventListener("error",e=>{var t,i;let{detail:r}=e;if(!r){let{message:e,code:a}=null!=(i=null==(t=this.media)?void 0:t.error)?i:{};r=new ln(e,a)}null!=r&&r.fatal&&this.dispatchEvent(new CustomEvent("error",{detail:r}))})},fM=new WeakSet,fx=function(){var e,t,i,r;let a=()=>c0(this,fL,fI).call(this);null==(t=null==(e=this.media)?void 0:e.textTracks)||t.addEventListener("addtrack",a),null==(r=null==(i=this.media)?void 0:i.textTracks)||r.addEventListener("removetrack",a)},fO=new WeakSet,fP=function(){var e,t;let i=/.*Version\/.*Safari\/.*/.test(navigator.userAgent);if(!/Firefox/i.test(navigator.userAgent))return;let r,a=new WeakMap,s=()=>this.streamType===lu.LIVE&&!this.secondaryColor&&this.offsetWidth>=800,n=(e,t,r=!1)=>{s()||Array.from(e&&e.activeCues||[]).forEach(e=>{if(!(!e.snapToLines||e.line<-5||e.line>=0&&e.line<10)){if(!t||this.paused){let t=e.text.split(`
`).length,s=i?-2:-3;this.streamType===lu.LIVE&&(s=i?-1:-2);let n=s-t;(e.line!==n||r)&&(a.has(e)||a.set(e,e.line),e.line=n-1,e.line=n)}else setTimeout(()=>{e.line=a.get(e)||"auto"},500)}})},o=()=>{var e,t;n(r,null!=(t=null==(e=this.mediaController)?void 0:e.hasAttribute("userinactive"))&&t)},l=()=>{var e,t;let i=Array.from((null==(t=null==(e=this.mediaController)?void 0:e.media)?void 0:t.textTracks)||[]).filter(e=>["subtitles","captions"].includes(e.kind)&&"showing"===e.mode)[0];i!==r&&(null==r||r.removeEventListener("cuechange",o)),null==(r=i)||r.addEventListener("cuechange",o),n(r,cQ(this,fv))};if(l(),null==(e=this.textTracks)||e.addEventListener("change",l),null==(t=this.textTracks)||t.addEventListener("addtrack",l),navigator.userAgent.includes("Chrome/")){let e=()=>{n(r,cQ(this,fv),!0),this.paused||window.requestAnimationFrame(e)};this.addEventListener("playing",()=>{e()})}this.addEventListener("userinactivechange",()=>{var e,t;let i=null==(t=null==(e=this.mediaController)?void 0:e.hasAttribute("userinactive"))||t;cQ(this,fv)!==i&&(cJ(this,fv,i),n(r,cQ(this,fv)))})},mp.customElements.get("mux-player")||(mp.customElements.define("mux-player",f$),mp.MuxPlayerElement=f$);var fH={className:"class",classname:"class",htmlFor:"for",crossOrigin:"crossorigin",viewBox:"viewBox",playsInline:"playsinline",autoPlay:"autoplay",playbackRate:"playbackrate"},fG=e=>null==e,fW=(e,t)=>!fG(t)&&e in t,fK=e=>e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),fq=(e,t)=>{if(!("boolean"==typeof t&&!t))return fW(e,fH)?fH[e]:/[A-Z]/.test(e)?fK(e):e},fj=(e,t)=>"boolean"==typeof e?"":e,fY=(e={})=>Object.entries(e).reduce((e,[t,i])=>{let r=fq(t,i);if(!r)return e;let a=fj(i,t);return e[r]=a,e},{}),fz=(...e)=>{let t=(0,l.useRef)(null);return(0,l.useEffect)(()=>{e.forEach(e=>{e&&("function"==typeof e?e(t.current):e.current=t.current)})},[e]),t},fX=Object.prototype.hasOwnProperty,fQ=(e,t)=>{if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(Array.isArray(e))return!!Array.isArray(t)&&e.length===t.length&&e.some((e,i)=>t[i]===e);let i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(let r=0;r<i.length;r++)if(!fX.call(t,i[r])||!Object.is(e[i[r]],t[i[r]]))return!1;return!0},fZ=(e,t,i)=>!fQ(t,e[i]),fJ=(e,t,i)=>{e[i]=t},f0=(e,t,i,r=fJ,a=fZ)=>(0,l.useEffect)(()=>{let s=null==i?void 0:i.current;s&&a(s,t,e)&&r(s,t,e)},[null==i?void 0:i.current,t]),f1=(()=>{try{return"2.0.1"}catch{}return"UNKNOWN"})(),f2=l.forwardRef(({children:e,...t},i)=>l.createElement("mux-player",fY({...t,ref:i}),e)),f3=(e,t,i)=>(0,l.useEffect)(()=>{let r=null==t?void 0:t.current;if(!(!r||!i))return r.addEventListener(e,i),()=>{r.removeEventListener(e,i)}},[null==t?void 0:t.current,i]),f4=(e,t)=>{let{onAbort:i,onCanPlay:r,onCanPlayThrough:a,onEmptied:s,onLoadStart:n,onLoadedData:o,onLoadedMetadata:l,onProgress:d,onDurationChange:u,onVolumeChange:h,onRateChange:c,onResize:m,onWaiting:f,onPlay:p,onPlaying:g,onTimeUpdate:v,onPause:E,onSeeking:b,onSeeked:y,onStalled:T,onSuspend:A,onEnded:_,onError:S,onCuePointChange:k,onCuePointsChange:L,metadata:I,tokens:R,paused:w,playbackId:D,playbackRates:C,currentTime:M,themeProps:x,...O}=t;return f0("playbackRates",C,e),f0("metadata",I,e),f0("themeProps",x,e),f0("tokens",R,e),f0("playbackId",D,e),f0("paused",w,e,(e,t)=>{null!=t&&(t?e.pause():e.play())},(e,t,i)=>(!e.hasAttribute("autoplay")||!!e.hasPlayed)&&fZ(e,t,i)),f0("currentTime",M,e,(e,t)=>{null!=t&&(e.currentTime=t)}),f3("abort",e,i),f3("canplay",e,r),f3("canplaythrough",e,a),f3("emptied",e,s),f3("loadstart",e,n),f3("loadeddata",e,o),f3("loadedmetadata",e,l),f3("progress",e,d),f3("durationchange",e,u),f3("volumechange",e,h),f3("ratechange",e,c),f3("resize",e,m),f3("waiting",e,f),f3("play",e,p),f3("playing",e,g),f3("timeupdate",e,v),f3("pause",e,E),f3("seeking",e,b),f3("seeked",e,y),f3("stalled",e,T),f3("suspend",e,A),f3("ended",e,_),f3("error",e,S),f3("cuepointchange",e,k),f3("cuepointschange",e,L),[O]},f5=l.forwardRef((e,t)=>{let i=(0,l.useRef)(null),r=fz(i,t),[a]=f4(i,e);return l.createElement(f2,{ref:r,playerSoftwareName:"mux-player-react",playerSoftwareVersion:f1,...a})})},97312:(e,t,i)=>{"use strict";i.d(t,{z$:()=>_,fC:()=>A});var r=i(35108),a=i(9885),s=i(80880),n=i(8718),o=i(32840),l=i(43408),d=i(46896),u=i(79752),h=i(43979);let c="Checkbox",[m,f]=(0,n.b)(c),[p,g]=m(c),v=(0,a.forwardRef)((e,t)=>{let{__scopeCheckbox:i,name:n,checked:d,defaultChecked:u,required:c,disabled:m,value:f="on",onCheckedChange:g,...v}=e,[E,A]=(0,a.useState)(null),_=(0,s.e)(t,e=>A(e)),S=(0,a.useRef)(!1),k=!E||!!E.closest("form"),[L=!1,I]=(0,l.T)({prop:d,defaultProp:u,onChange:g}),R=(0,a.useRef)(L);return(0,a.useEffect)(()=>{let e=null==E?void 0:E.form;if(e){let t=()=>I(R.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[E,I]),(0,a.createElement)(p,{scope:i,state:L,disabled:m},(0,a.createElement)(h.WV.button,(0,r.Z)({type:"button",role:"checkbox","aria-checked":y(L)?"mixed":L,"aria-required":c,"data-state":T(L),"data-disabled":m?"":void 0,disabled:m,value:f},v,{ref:_,onKeyDown:(0,o.M)(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,o.M)(e.onClick,e=>{I(e=>!!y(e)||!e),k&&(S.current=e.isPropagationStopped(),S.current||e.stopPropagation())})})),k&&(0,a.createElement)(b,{control:E,bubbles:!S.current,name:n,value:f,checked:L,required:c,disabled:m,style:{transform:"translateX(-100%)"}}))}),E=(0,a.forwardRef)((e,t)=>{let{__scopeCheckbox:i,forceMount:s,...n}=e,o=g("CheckboxIndicator",i);return(0,a.createElement)(u.z,{present:s||y(o.state)||!0===o.state},(0,a.createElement)(h.WV.span,(0,r.Z)({"data-state":T(o.state),"data-disabled":o.disabled?"":void 0},n,{ref:t,style:{pointerEvents:"none",...e.style}})))}),b=e=>{let{control:t,checked:i,bubbles:s=!0,...n}=e,o=(0,a.useRef)(null),l=function(e){let t=(0,a.useRef)({value:e,previous:e});return(0,a.useMemo)(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}(i),u=(0,d.t)(t);return(0,a.useEffect)(()=>{let e=o.current,t=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(t,"checked"),a=r.set;if(l!==i&&a){let t=new Event("click",{bubbles:s});e.indeterminate=y(i),a.call(e,!y(i)&&i),e.dispatchEvent(t)}},[l,i,s]),(0,a.createElement)("input",(0,r.Z)({type:"checkbox","aria-hidden":!0,defaultChecked:!y(i)&&i},n,{tabIndex:-1,ref:o,style:{...e.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function y(e){return"indeterminate"===e}function T(e){return y(e)?"indeterminate":e?"checked":"unchecked"}let A=v,_=E}};