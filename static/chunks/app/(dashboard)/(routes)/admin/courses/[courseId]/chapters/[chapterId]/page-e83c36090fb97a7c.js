(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[480],{9153:function(e,t,r){Promise.resolve().then(r.bind(r,6595)),Promise.resolve().then(r.bind(r,9726)),Promise.resolve().then(r.bind(r,6620)),Promise.resolve().then(r.bind(r,5230)),Promise.resolve().then(r.bind(r,2505)),Promise.resolve().then(r.bind(r,7303)),Promise.resolve().then(r.bind(r,3530)),Promise.resolve().then(r.bind(r,1507)),Promise.resolve().then(r.bind(r,1726)),Promise.resolve().then(r.bind(r,9776)),Promise.resolve().then(r.bind(r,1142)),Promise.resolve().then(r.t.bind(r,4724,23)),Promise.resolve().then(r.t.bind(r,3388,23))},6595:function(e,t,r){"use strict";r.r(t),r.d(t,{ChapterAccessForm:function(){return v}});var s=r(7437),n=r(4578),a=r(9222),i=r(8110),l=r(1865),c=r(4033),d=r(459),o=r(3023),u=r(3905),m=r(2265),f=r(5925),x=r(9311),h=r(2237),p=r(2442);let j=m.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(h.fC,{ref:t,className:(0,x.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...n,children:(0,s.jsx)(h.z$,{className:(0,x.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(p.Z,{className:"h-4 w-4"})})})});j.displayName=h.fC.displayName;let b=n.Ry({isFree:n.O7().default(!1)}),v=e=>{let{initialData:t,courseId:r,chapterId:n}=e,[h,p]=m.useState(!1),v=(0,c.useRouter)(),g=()=>p(e=>!e),y=(0,l.cI)({resolver:(0,i.F)(b),defaultValues:{isFree:!!t.isFree}}),{isSubmitting:N,isValid:w}=y.formState,F=async e=>{try{await a.Z.patch("/api/courses/".concat(r,"/chapters/").concat(n),e),f.ZP.success("更新成功"),g(),v.refresh()}catch(e){f.ZP.error("有東西出錯了")}};return(0,s.jsxs)("div",{className:"mt-6 rounded-md border bg-slate-100 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between font-medium",children:["章節權限",(0,s.jsx)(o.z,{variant:"ghost",onClick:g,children:h?(0,s.jsx)(s.Fragment,{children:"取消"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"編輯權限"]})})]}),!h&&(0,s.jsx)("p",{className:(0,x.cn)("mt-2 text-sm",!t.isFree&&"italic text-slate-500"),children:t.isFree?(0,s.jsx)(s.Fragment,{children:"本章節可免費觀看"}):(0,s.jsx)(s.Fragment,{children:"本章節無法免費觀看"})}),h&&(0,s.jsx)(d.l0,{...y,children:(0,s.jsxs)("form",{onSubmit:y.handleSubmit(F),className:"mt-4 space-y-4",children:[(0,s.jsx)(d.Wi,{control:y.control,name:"isFree",render:e=>{let{field:t}=e;return(0,s.jsxs)(d.xJ,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[(0,s.jsx)(d.NI,{children:(0,s.jsx)(j,{checked:t.value,onCheckedChange:t.onChange})}),(0,s.jsx)("div",{className:"space-y-1 leading-none",children:(0,s.jsx)(d.pf,{children:"勾選即可設定成免費觀看"})})]})}}),(0,s.jsx)("div",{className:"flex items-center gap-x-2",children:(0,s.jsx)(o.z,{disabled:!w||N,type:"submit",children:"儲存"})})]})})]})}},9726:function(e,t,r){"use strict";r.r(t);var s=r(7437),n=r(8634),a=r(3023),i=r(9222),l=r(4737),c=r(4033),d=r(2265),o=r(5925);t.default=e=>{let{disabled:t,courseId:r,chapterId:u,isPublished:m}=e,f=(0,c.useRouter)(),[x,h]=d.useState(!1),p=async()=>{try{h(!0),m?(await i.Z.patch("/api/courses/".concat(r,"/chapters/").concat(u,"/unpublish")),o.ZP.success("已取消發布此章節")):(await i.Z.patch("/api/courses/".concat(r,"/chapters/").concat(u,"/publish")),o.ZP.success("已發布此章節")),f.refresh()}catch(e){o.ZP.error("有東西出錯了")}finally{h(!1)}},j=async()=>{try{h(!0),await i.Z.delete("/api/courses/".concat(r,"/chapters/").concat(u)),o.ZP.success("章節刪除成功"),f.refresh(),f.push("/admin/courses/".concat(r))}catch(e){o.ZP.error("有東西出錯了")}finally{h(!1)}};return(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(a.z,{onClick:p,disabled:t||x,variant:"outline",size:"sm",children:m?"取消發布":"發布"}),(0,s.jsx)(n.w,{onConfirm:j,children:(0,s.jsx)(a.z,{size:"sm",disabled:x,children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})})})]})}},6620:function(e,t,r){"use strict";r.r(t),r.d(t,{ChapterDescriptionForm:function(){return g}});var s=r(7437),n=r(4578),a=r(9222),i=r(8110),l=r(1865),c=r(4033),d=r(459),o=r(3023),u=r(3905),m=r(2265),f=r(5925),x=r(9311),h=r(415),p=r.n(h);r(8416);let j=e=>{let{onChange:t,value:n}=e,a=m.useMemo(()=>p()(()=>Promise.all([r.e(70),r.e(233)]).then(r.t.bind(r,6233,23)),{loadableGenerated:{webpack:()=>[6233]},ssr:!1}),[]);return(0,s.jsx)("div",{className:"bg-white",children:(0,s.jsx)(a,{theme:"snow",value:n,onChange:t})})};r(2636);let b=e=>{let{value:t}=e,n=m.useMemo(()=>p()(()=>Promise.all([r.e(70),r.e(233)]).then(r.t.bind(r,6233,23)),{loadableGenerated:{webpack:()=>[6233]},ssr:!1}),[]);return(0,s.jsx)(n,{theme:"bubble",value:t,readOnly:!0})},v=n.Ry({description:n.Z_().min(1)}),g=e=>{let{initialData:t,courseId:r,chapterId:n}=e,[h,p]=m.useState(!1),g=(0,c.useRouter)(),y=()=>p(e=>!e),N=(0,l.cI)({resolver:(0,i.F)(v),defaultValues:{description:t.description||""}}),{isSubmitting:w,isValid:F}=N.formState,Z=async e=>{try{await a.Z.patch("/api/courses/".concat(r,"/chapters/").concat(n),e),f.ZP.success("更新成功"),y(),g.refresh()}catch(e){f.ZP.error("有東西出錯了")}};return(0,s.jsxs)("div",{className:"mt-6 rounded-md border bg-slate-100 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between font-medium",children:["章節內容",(0,s.jsx)(o.z,{variant:"ghost",onClick:y,children:h?(0,s.jsx)(s.Fragment,{children:"取消"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"編輯內容"]})})]}),!h&&(0,s.jsxs)("div",{className:(0,x.cn)("mt-2 text-sm",!t.description&&"italic text-slate-500"),children:[!t.description&&"尚未添加內容",t.description&&(0,s.jsx)(b,{value:t.description})]}),h&&(0,s.jsx)(d.l0,{...N,children:(0,s.jsxs)("form",{onSubmit:N.handleSubmit(Z),className:"mt-4 space-y-4",children:[(0,s.jsx)(d.Wi,{control:N.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(d.xJ,{children:[(0,s.jsx)(d.NI,{children:(0,s.jsx)(j,{...t})}),(0,s.jsx)(d.zG,{})]})}}),(0,s.jsx)("div",{className:"flex items-center gap-x-2",children:(0,s.jsx)(o.z,{disabled:!F||w,type:"submit",children:"儲存"})})]})})]})}},5230:function(e,t,r){"use strict";r.r(t),r.d(t,{ChapterTitleForm:function(){return p}});var s=r(7437),n=r(4578),a=r(9222),i=r(8110),l=r(1865),c=r(4033),d=r(459),o=r(3023),u=r(1908),m=r(3905),f=r(2265),x=r(5925);let h=n.Ry({title:n.Z_().min(1)}),p=e=>{let{initialData:t,courseId:r,chapterId:n}=e,[p,j]=f.useState(!1),b=(0,c.useRouter)(),v=()=>j(e=>!e),g=(0,l.cI)({resolver:(0,i.F)(h),defaultValues:t}),{isSubmitting:y,isValid:N}=g.formState,w=async e=>{try{await a.Z.patch("/api/courses/".concat(r,"/chapters/").concat(n),e),x.ZP.success("更新成功"),b.refresh(),v()}catch(e){x.ZP.error("有東西出錯了")}};return(0,s.jsxs)("div",{className:"mt-6 rounded-md border bg-slate-100 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between font-medium",children:["章節標題",(0,s.jsx)(o.z,{variant:"ghost",onClick:v,children:p?(0,s.jsx)(s.Fragment,{children:"取消"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"編輯標題"]})})]}),!p&&(0,s.jsx)("p",{className:"mt-2 text-sm",children:t.title}),p&&(0,s.jsx)(d.l0,{...g,children:(0,s.jsxs)("form",{onSubmit:g.handleSubmit(w),className:"mt-4 space-y-4",children:[(0,s.jsx)(d.Wi,{control:g.control,name:"title",render:e=>{let{field:t}=e;return(0,s.jsxs)(d.xJ,{children:[(0,s.jsx)(d.NI,{children:(0,s.jsx)(u.I,{disabled:y,placeholder:'e.g. "章節介紹..."',...t})}),(0,s.jsx)(d.zG,{})]})}}),(0,s.jsx)("div",{className:"flex items-center gap-x-2",children:(0,s.jsx)(o.z,{disabled:!N||y,type:"submit",children:"儲存"})})]})})]})}},2505:function(e,t,r){"use strict";r.r(t),r.d(t,{ChapterVideoForm:function(){return h}});var s=r(7437),n=r(4578),a=r(9222),i=r(4033),l=r(2297),c=r(3023),d=r(1981),o=r(3905),u=r(8339),m=r(2265),f=r(5925),x=r(617);n.Ry({videoUrl:n.Z_().min(1)});let h=e=>{var t;let{initialData:r,courseId:n,chapterId:h}=e,[p,j]=m.useState(!1),b=(0,i.useRouter)(),v=()=>j(e=>!e),g=async e=>{try{await a.Z.patch("/api/courses/".concat(n,"/chapters/").concat(h),e),f.ZP.success("更新成功"),v(),b.refresh()}catch(e){f.ZP.error("有東西出錯了")}};return(0,s.jsxs)("div",{className:"mt-6 rounded-md border bg-slate-100 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between font-medium",children:["章節影片",(0,s.jsxs)(c.z,{variant:"ghost",onClick:v,children:[p&&(0,s.jsx)(s.Fragment,{children:"取消"}),!p&&!r.videoUrl&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"上傳影片"]}),!p&&r.videoUrl&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"編輯影片"]})]})]}),!p&&(r.videoUrl?(0,s.jsx)("div",{className:"relative mt-2 aspect-square",children:(0,s.jsx)(l.Z,{playbackId:(null===(t=r.muxData)||void 0===t?void 0:t.playbackId)||""})}):(0,s.jsx)("div",{className:"flex h-60 items-center justify-center rounded-md bg-slate-200",children:(0,s.jsx)(u.Z,{className:"h-10 w-10 text-slate-500"})})),p&&(0,s.jsxs)("div",{children:[(0,s.jsx)(x.p,{endpoint:"chapterVideo",onChange:e=>{e&&g({videoUrl:e})}}),(0,s.jsx)("div",{className:"mt-4 text-xs text-muted-foreground",children:"上傳本章節的教學影片"})]}),r.videoUrl&&!p&&(0,s.jsx)("div",{className:"mt-2 text-xs text-muted-foreground",children:"影片加載可能需要等待幾分鐘，如果看不到影片，請重新整理頁面"})]})}},617:function(e,t,r){"use strict";r.d(t,{p:function(){return d}});var s=r(7437),n=r(5925),a=r(4854);let{UploadButton:i,UploadDropzone:l,Uploader:c}=(0,a.jp)(),d=e=>{let{onChange:t,endpoint:r}=e;return(0,s.jsx)(l,{endpoint:r,onClientUploadComplete:e=>{t(null==e?void 0:e[0].url)},onUploadError:e=>{n.ZP.error("".concat(null==e?void 0:e.message))}})}},8634:function(e,t,r){"use strict";r.d(t,{w:function(){return v}});var s=r(7437),n=r(2265),a=r(6645),i=r(9311),l=r(3023);let c=a.fC,d=a.xz,o=a.h_,u=n.forwardRef((e,t)=>{let{className:r,children:n,...l}=e;return(0,s.jsx)(a.aV,{className:(0,i.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...l,ref:t})});u.displayName=a.aV.displayName;let m=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(u,{}),(0,s.jsx)(a.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full",r),...n})]})});m.displayName=a.VY.displayName;let f=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...r})};f.displayName="AlertDialogHeader";let x=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};x.displayName="AlertDialogFooter";let h=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold",r),...n})});h.displayName=a.Dx.displayName;let p=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...n})});p.displayName=a.dk.displayName;let j=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.aU,{ref:t,className:(0,i.cn)((0,l.d)(),r),...n})});j.displayName=a.aU.displayName;let b=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.$j,{ref:t,className:(0,i.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",r),...n})});b.displayName=a.$j.displayName;let v=e=>{let{children:t,onConfirm:r}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(d,{asChild:!0,children:t}),(0,s.jsxs)(m,{children:[(0,s.jsxs)(f,{children:[(0,s.jsx)(h,{children:"確定執行此操作？"}),(0,s.jsx)(p,{children:"此操作執行後無法取消"})]}),(0,s.jsxs)(x,{children:[(0,s.jsx)(b,{children:"取消"}),(0,s.jsx)(j,{onClick:r,children:"繼續"})]})]})]})}},3023:function(e,t,r){"use strict";r.d(t,{d:function(){return c},z:function(){return d}});var s=r(7437),n=r(2265),a=r(7256),i=r(6061),l=r(9311);let c=(0,i.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:r,variant:n,size:i,asChild:d=!1,...o}=e,u=d?a.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(c({variant:n,size:i,className:r})),ref:t,...o})});d.displayName="Button"},459:function(e,t,r){"use strict";r.d(t,{l0:function(){return m},NI:function(){return v},pf:function(){return g},Wi:function(){return x},xJ:function(){return j},lX:function(){return b},zG:function(){return y}});var s=r(7437),n=r(2265),a=r(7256),i=r(1865),l=r(9311),c=r(6743),d=r(6061);let o=(0,d.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(c.f,{ref:t,className:(0,l.cn)(o(),r),...n})});u.displayName=c.f.displayName;let m=i.RV,f=n.createContext({}),x=e=>{let{...t}=e;return(0,s.jsx)(f.Provider,{value:{name:t.name},children:(0,s.jsx)(i.Qr,{...t})})},h=()=>{let e=n.useContext(f),t=n.useContext(p),{getFieldState:r,formState:s}=(0,i.Gc)(),a=r(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=t;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...a}},p=n.createContext({}),j=n.forwardRef((e,t)=>{let{className:r,...a}=e,i=n.useId();return(0,s.jsx)(p.Provider,{value:{id:i},children:(0,s.jsx)("div",{ref:t,className:(0,l.cn)("space-y-2",r),...a})})});j.displayName="FormItem";let b=n.forwardRef((e,t)=>{let{className:r,...n}=e,{error:a,formItemId:i}=h();return(0,s.jsx)(u,{ref:t,className:(0,l.cn)(a&&"text-destructive",r),htmlFor:i,...n})});b.displayName="FormLabel";let v=n.forwardRef((e,t)=>{let{...r}=e,{error:n,formItemId:i,formDescriptionId:l,formMessageId:c}=h();return(0,s.jsx)(a.g7,{ref:t,id:i,"aria-describedby":n?"".concat(l," ").concat(c):"".concat(l),"aria-invalid":!!n,...r})});v.displayName="FormControl";let g=n.forwardRef((e,t)=>{let{className:r,...n}=e,{formDescriptionId:a}=h();return(0,s.jsx)("p",{ref:t,id:a,className:(0,l.cn)("text-sm text-muted-foreground",r),...n})});g.displayName="FormDescription";let y=n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e,{error:i,formMessageId:c}=h(),d=i?String(null==i?void 0:i.message):n;return d?(0,s.jsx)("p",{ref:t,id:c,className:(0,l.cn)("text-sm font-medium text-destructive",r),...a,children:d}):null});y.displayName="FormMessage"},1908:function(e,t,r){"use strict";r.d(t,{I:function(){return i}});var s=r(7437),n=r(2265),a=r(9311);let i=n.forwardRef((e,t)=>{let{className:r,type:n,...i}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...i})});i.displayName="Input"},9311:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(7042),n=r(3986);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m)((0,s.W)(t))}}},function(e){e.O(0,[404,666,841,724,853,259,330,87,971,864,744],function(){return e(e.s=9153)}),_N_E=e.O()}]);